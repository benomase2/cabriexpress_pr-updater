(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";var Algebrite=require("algebrite");window.Algebrite=Algebrite;

},{"algebrite":2}],2:[function(require,module,exports){
(function(){var $,ABS,ADD,ADJ,AND,APPROXRATIO,ARCCOS,ARCCOSH,ARCSIN,ARCSINH,ARCTAN,ARCTANH,ARG,ASSUME_REAL_VARIABLES,ATOMIZE,AUTOEXPAND,BAKE,BESSELJ,BESSELY,BINDING,BINOMIAL,BINOM_check_args,BUF,C1,C2,C3,C4,C5,C6,CEILING,CHECK,CHOOSE,CIRCEXP,CLEAR,CLEARALL,CLEARPATTERNS,CLOCK,COEFF,COFACTOR,CONDENSE,CONJ,CONS,CONTRACT,COS,COSH,Condense,DEBUG,DEBUG_ABS,DEBUG_ARG,DEBUG_CLOCKFORM,DEBUG_IMAG,DEBUG_IS,DEBUG_POWER,DEBUG_RECT,DECOMP,DEFINT,DEGREE,DENOMINATOR,DERIVATIVE,DET,DET_check_arg,DIM,DIRAC,DIVISORS,DO,DOT,DOUBLE,DRAW,DRAWX,DSOLVE,E,EIGEN,EIGENVAL,EIGENVEC,EIG_N,EIG_check_arg,EIG_yydd,EIG_yyqq,ERF,ERFC,EVAL,EXP,EXPAND,EXPCOS,EXPSIN,Eval,Eval_Eval,Eval_abs,Eval_add,Eval_adj,Eval_and,Eval_approxratio,Eval_arccos,Eval_arccosh,Eval_arcsin,Eval_arcsinh,Eval_arctan,Eval_arctanh,Eval_arg,Eval_besselj,Eval_bessely,Eval_binding,Eval_binomial,Eval_ceiling,Eval_check,Eval_choose,Eval_circexp,Eval_clear,Eval_clearall,Eval_clearpatterns,Eval_clock,Eval_coeff,Eval_cofactor,Eval_condense,Eval_conj,Eval_cons,Eval_contract,Eval_cos,Eval_cosh,Eval_decomp,Eval_defint,Eval_degree,Eval_denominator,Eval_derivative,Eval_det,Eval_dim,Eval_dirac,Eval_divisors,Eval_do,Eval_dsolve,Eval_eigen,Eval_eigenval,Eval_eigenvec,Eval_erf,Eval_erfc,Eval_exp,Eval_expand,Eval_expcos,Eval_expsin,Eval_factor,Eval_factorial,Eval_factorpoly,Eval_filter,Eval_float,Eval_floor,Eval_for,Eval_function_reference,Eval_gamma,Eval_gcd,Eval_hermite,Eval_hilbert,Eval_imag,Eval_index,Eval_inner,Eval_integral,Eval_inv,Eval_invg,Eval_isinteger,Eval_isprime,Eval_laguerre,Eval_lcm,Eval_leading,Eval_legendre,Eval_log,Eval_lookup,Eval_mod,Eval_multiply,Eval_noexpand,Eval_not,Eval_nroots,Eval_number,Eval_numerator,Eval_operator,Eval_or,Eval_outer,Eval_pattern,Eval_patternsinfo,Eval_polar,Eval_power,Eval_predicate,Eval_prime,Eval_print,Eval_print2dascii,Eval_printcomputer,Eval_printhuman,Eval_printlatex,Eval_printlist,Eval_product,Eval_quote,Eval_quotient,Eval_rank,Eval_rationalize,Eval_real,Eval_rect,Eval_roots,Eval_round,Eval_setq,Eval_sgn,Eval_shape,Eval_silentpattern,Eval_simfac,Eval_simplify,Eval_sin,Eval_sinh,Eval_sqrt,Eval_stop,Eval_subst,Eval_sum,Eval_sym,Eval_symbolsinfo,Eval_tan,Eval_tanh,Eval_taylor,Eval_tensor,Eval_test,Eval_testeq,Eval_testge,Eval_testgt,Eval_testle,Eval_testlt,Eval_transpose,Eval_unit,Eval_user_function,Eval_zero,Evalpoly,FACTOR,FACTORIAL,FACTORPOLY,FILTER,FLOATF,FLOOR,FOR,FUNCTION,Find,GAMMA,GCD,HERMITE,HILBERT,IMAG,INDEX,INNER,INTEGRAL,INV,INVG,INV_check_arg,INV_decomp,ISINTEGER,ISPRIME,LAGUERRE,LAST,LAST_2DASCII_PRINT,LAST_FULL_PRINT,LAST_LATEX_PRINT,LAST_LIST_PRINT,LAST_PLAIN_PRINT,LAST_PRINT,LCM,LEADING,LEGENDRE,LOG,LOOKUP,M,MAXDIM,MAXPRIMETAB,MAX_CONSECUTIVE_APPLICATIONS_OF_ALL_RULES,MAX_CONSECUTIVE_APPLICATIONS_OF_SINGLE_RULE,MAX_PROGRAM_SIZE,MEQUAL,METAA,METAB,METAX,MLENGTH,MOD,MSIGN,MULTIPLY,MZERO,N,NIL,NOT,NROOTS,NROOTS_ABS,NROOTS_DELTA,NROOTS_EPSILON,NROOTS_RANDOM,NROOTS_YMAX,NROOTS_divpoly,NSYM,NUM,NUMBER,NUMERATOR,OPERATOR,OR,OUTER,PATTERN,PATTERNSINFO,PI,POLAR,POWER,PRIME,PRINT,PRINT2DASCII,PRINTFULL,PRINTLATEX,PRINTLIST,PRINTMODE_2DASCII,PRINTMODE_COMPUTER,PRINTMODE_HUMAN,PRINTMODE_LATEX,PRINTMODE_LIST,PRINTOUTRESULT,PRINTPLAIN,PRINT_LEAVE_E_ALONE,PRINT_LEAVE_X_ALONE,PRODUCT,QUOTE,QUOTIENT,RANK,RATIONALIZE,REAL,ROOTS,ROUND,SECRETX,SELFTEST,SETQ,SGN,SHAPE,SILENTPATTERN,SIMPLIFY,SIN,SINH,SPACE_BETWEEN_COLUMNS,SPACE_BETWEEN_ROWS,SQRT,STOP,STR,SUBST,SUM,SYM,SYMBOLSINFO,SYMBOL_A,SYMBOL_A_UNDERSCORE,SYMBOL_B,SYMBOL_B_UNDERSCORE,SYMBOL_C,SYMBOL_D,SYMBOL_I,SYMBOL_IDENTITY_MATRIX,SYMBOL_J,SYMBOL_N,SYMBOL_R,SYMBOL_S,SYMBOL_T,SYMBOL_X,SYMBOL_X_UNDERSCORE,SYMBOL_Y,SYMBOL_Z,TAN,TANH,TAYLOR,TENSOR,TEST,TESTEQ,TESTGE,TESTGT,TESTLE,TESTLT,TIMING_DEBUGS,TOS,TRACE,TRANSPOSE,T_DOUBLE,T_EQ,T_FUNCTION,T_GTEQ,T_INTEGER,T_LTEQ,T_NEQ,T_NEWLINE,T_QUOTASSIGN,T_STRING,T_SYMBOL,U,UNIT,USR_SYMBOLS,VERSION,YMAX,YYE,YYRECT,ZERO,__emit_char,__emit_str,__factor_add,__factorial,__is_negative,__is_radical_number,__lcm,__legendre,__legendre2,__legendre3,__normalize_radical_factors,__rationalize_tensor,_print,abs,absValFloat,absval,absval_tensor,add,addSymbolLeftOfAssignment,addSymbolRightOfAssignment,add_all,add_factor_to_accumulator,add_numbers,add_terms,addf,adj,alloc_tensor,allocatedId,any_denominators,approxAll,approxLogs,approxLogsOfRationals,approxOneRatioOnly,approxRadicals,approxRadicalsOfRationals,approxRationalsOfLogs,approxRationalsOfPowersOfE,approxRationalsOfPowersOfPI,approxRationalsOfRadicals,approxSineOfRationalMultiplesOfPI,approxSineOfRationals,approxTrigonometric,approx_just_an_integer,approx_logarithmsOfRationals,approx_nothingUseful,approx_radicalOfRatio,approx_ratioOfRadical,approx_rationalOfE,approx_rationalOfPi,approx_rationalsOfLogarithms,approx_sine_of_pi_times_rational,approx_sine_of_rational,approxratioRecursive,arccos,arccosh,arcsin,arcsinh,arctan,arctanh,arg,arglist,assignmentFound,avoidCalculatingPowersIntoArctans,bake,bake_poly,bake_poly_term,besselj,bessely,bigInt,bignum_factorial,bignum_float,bignum_power_number,bignum_scan_float,bignum_scan_integer,bignum_truncate,binding,binomial,buffer,build_tensor,caaddr,caadr,caar,cadaddr,cadadr,cadar,caddaddr,caddadr,caddar,caddddr,cadddr,caddr,cadr,called_from_Algebra_block,car,cdaddr,cdadr,cdar,cddaddr,cddar,cdddaddr,cddddr,cdddr,cddr,cdr,ceiling,chainOfUserSymbolsNotFunctionsBeingEvaluated,charTabIndex,chartab,checkFloatHasWorkedOutCompletely,check_esc_flag,check_stack,check_tensor_dimensions,choose,choose_check_args,circexp,clearAlgebraEnvironment,clearRenamedVariablesToAvoidBindingToExternalScope,clear_symbols,clear_term,clearall,clockform,cmpGlyphs,cmp_args,cmp_expr,cmp_terms,cmp_terms_count,codeGen,coeff,cofactor,collectLatexStringFromReturnValue,collectUserSymbols,combine_factors,combine_gammas,combine_terms,compareState,compare_numbers,compare_rationals,compare_tensors,compatible,computeDependenciesFromAlgebra,computeResultsAndJavaScriptFromAlgebra,compute_fa,conjugate,cons,consCount,contract,convert_bignum_to_double,convert_rational_to_double,copy_tensor,cosine,cosine_of_angle,cosine_of_angle_sum,count,countOccurrencesOfSymbol,count_denominators,counter,countsize,d_scalar_scalar,d_scalar_scalar_1,d_scalar_tensor,d_tensor_scalar,d_tensor_tensor,dabs,darccos,darccosh,darcsin,darcsinh,darctan,darctanh,dbesselj0,dbesseljn,dbessely0,dbesselyn,dcos,dcosh,dd,decomp,decomp_product,decomp_sum,defineSomeHandyConstants,define_user_function,defn,defn_str,degree,denominator,derf,derfc,derivative,derivative_of_integral,det,determinant,detg,dfunction,dhermite,dirac,display,display_flag,displaychar,divide,divide_numbers,divisors,divisors_onstack,divpoly,dlog,do_clearPatterns,do_clearall,do_simplify_nested_radicals,dontCreateNewRadicalsInDenominatorWhenEvalingMultiplication,dotprod_unicode,doubleToReasonableString,dpow,dpower,dproduct,draw_flag,draw_stop_return,dsgn,dsin,dsinh,dsum,dtan,dtanh,dupl,eigen,elelmIndex,elem,emit_denominator,emit_denominators,emit_expr,emit_factor,emit_factorial_function,emit_flat_tensor,emit_fraction,emit_function,emit_index_function,emit_multiply,emit_number,emit_numerators,emit_numerical_fraction,emit_power,emit_string,emit_subexpr,emit_symbol,emit_tensor,emit_tensor_inner,emit_term,emit_top_expr,emit_unsigned_expr,emit_x,equal,equaln,equalq,erfc,errorMessage,esc_flag,evaluatingAsFloats,evaluatingPolar,exec,expand,expand_get_A,expand_get_AF,expand_get_B,expand_get_C,expand_get_CF,expand_tensor,expanding,expcos,exponential,expr_level,expsin,f1,f10,f2,f3,f4,f5,f9,f_equals_a,factor,factor_a,factor_again,factor_b,factor_number,factor_small_number,factor_term,factorial,factorpoly,factors,factpoly_expo,fill_buf,filter,filter_main,filter_sum,filter_tensor,findDependenciesInScript,findPossibleClockForm,findPossibleExponentialForm,findroot,fixup_fraction,fixup_power,flag,floatToRatioRoutine,fmt_index,fmt_level,fmt_x,frame,freeze,functionInvokationsScanningStack,gamma,gamma_of_sum,gammaf,gcd,gcd_expr,gcd_expr_expr,gcd_factor_term,gcd_main,gcd_numbers,gcd_term_factor,gcd_term_term,gen,getSimpleRoots,getStateHash,get_binding,get_factor_from_complex_root,get_factor_from_real_root,get_innerprod_factors,get_next_token,get_printname,get_size,get_token,getdisplaystr,glyph,gp,guess,hasImaginaryCoeff,hasNegativeRationalExponent,hermite,hilbert,i1,imag,imaginaryunit,index_function,init,initNRoots,inited,inner,inner_f,input_str,integral,integral_of_form,integral_of_product,integral_of_sum,inv,inverse,invert_number,invg,isNumberOneOverSomething,isNumericAtom,isNumericAtomOrTensor,isSimpleRoot,isSmall,isSymbolLeftOfAssignment,isSymbolReclaimable,isZeroAtomOrTensor,isZeroLikeOrNonZeroLikeOrUndetermined,is_denominator,is_factor,is_small_integer,is_square_matrix,is_usr_symbol,isadd,isalnumorunderscore,isalpha,isalphaOrUnderscore,iscomplexnumber,iscomplexnumberdouble,iscons,isdenominator,isdigit,isdouble,iseveninteger,isfactor,isfactorial,isfloating,isfraction,isidentitymatrix,isimaginarynumber,isimaginarynumberdouble,isimaginaryunit,isinnerordot,isinteger,isintegerfactor,isintegerorintegerfloat,isinv,iskeyword,isminusone,isminusoneoversqrttwo,isminusoneovertwo,ismultiply,isnegative,isnegativenumber,isnegativeterm,isnonnegativeinteger,isnpi,isone,isoneover,isoneoversqrttwo,isoneovertwo,isplusone,isplustwo,ispoly,ispoly_expr,ispoly_factor,ispoly_term,isposint,ispositivenumber,ispower,isquarterturn,isrational,isspace,isstr,issymbol,issymbolic,istensor,istranspose,isunderscore,itab,j1,laguerre,laguerre2,lastFoundSymbol,latexErrorSign,lcm,leading,legendre,length,lessp,level,list,listLength,logarithm,logbuf,lookupsTotal,lu_decomp,madd,makePositive,makeSignSameAs,mask,mcmp,mcmpint,mdiv,mdivrem,meta_mode,mgcd,mini_solve,mint,mmod,mmul,mod,monic,move,moveTos,mp_clr_bit,mp_denominator,mp_numerator,mp_set_bit,mpow,mprime,mroot,mshiftright,msub,mtotal,multinomial_sum,multiply,multiply_all,multiply_all_noexpand,multiply_consecutive_constants,multiply_denominators,multiply_denominators_factor,multiply_denominators_term,multiply_noexpand,multiply_numbers,n_factor_number,negate,negate_expand,negate_noexpand,negate_number,new_string,newline_flag,nil_symbols,normaliseDots,normalisedCoeff,normalize_angle,nroots_a,nroots_b,nroots_c,nroots_df,nroots_dx,nroots_fa,nroots_fb,nroots_x,nroots_y,nterms,nthCadr,numerator,numericRootOfPolynomial,o,one,oneElement,one_as_double,out_buf,out_count,out_of_memory,outer,p0,p1,p2,p3,p4,p5,p6,p7,p8,p9,parse,parse_internal,parse_p1,parse_p2,parse_time_simplifications,partition,patternHasBeenFound,patternsinfo,peek,performing_roots,polar,polarRectAMinusOneBase,polycoeff,polyform,pop,pop_double,pop_frame,pop_integer,power,power_str,power_sum,power_tensor,predefinedSymbolsInGlobalScope_doNotTrackInDependencies,prime,primetab,print2dascii,printMode,print_ABS_latex,print_ARCCOS_codegen,print_ARCSIN_codegen,print_ARCTAN_codegen,print_BINOMIAL_latex,print_COS_codegen,print_DEFINT_latex,print_DOT_codegen,print_DOT_latex,print_DO_codegen,print_FOR_codegen,print_INV_codegen,print_INV_latex,print_PRODUCT_codegen,print_PRODUCT_latex,print_SETQ_codegen,print_SIN_codegen,print_SQRT_latex,print_SUM_codegen,print_SUM_latex,print_TAN_codegen,print_TESTEQ_latex,print_TESTGE_latex,print_TESTGT_latex,print_TESTLE_latex,print_TESTLT_latex,print_TEST_codegen,print_TEST_latex,print_TRANSPOSE_codegen,print_TRANSPOSE_latex,print_UNIT_codegen,print_a_over_b,print_base,print_base_of_denom,print_char,print_denom,print_double,print_expo_of_denom,print_exponent,print_expr,print_factor,print_factorial_function,print_glyphs,print_index_function,print_list,print_multiply_sign,print_number,print_power,print_str,print_subexpr,print_tensor,print_tensor_inner,print_tensor_inner_latex,print_tensor_latex,print_term,printchar,printchar_nowrap,printline,program_buf,promote_tensor,push,pushTryNotToDuplicate,push_cars,push_double,push_factor,push_frame,push_identity_matrix,push_integer,push_rational,push_symbol,push_term_factors,push_terms,push_zero_matrix,qadd,qdiv,qmul,qpow,qpowf,quickfactor,quickpower,rational,rationalize,rationalize_coefficients,real,reciprocate,rect,recursionLevelNestedRadicalsRemoval,recursiveDependencies,ref,ref1,rememberPrint,remove_negative_exponents,reset_after_error,restore,restoreMetaBindings,rewrite_args,rewrite_args_tensor,roots,roots2,roots3,run,runUserDefinedSimplifications,save,saveMetaBindings,scalar_times_tensor,scan,scan_error,scan_expression,scan_factor,scan_function_call_with_function_name,scan_function_call_without_function_name,scan_index,scan_meta,scan_power,scan_relation,scan_stmt,scan_str,scan_string,scan_subexpr,scan_symbol,scan_tensor,scan_term,scanned,scanningParameters,setM,setSignTo,set_binding,set_component,setq_indexed,sfac_product,sfac_product_f,sgn,shape,show_power_debug,sign,sign_of_term,simfac,simfac_term,simpleComplexityMeasure,simplify,simplifyForCodeGeneration,simplify_1_in_products,simplify_main,simplify_nested_radicals,simplify_polar,simplify_polarRect,simplify_rectToClock,simplify_tensor,simplify_trig,simplifyfactorials,sine,sine_of_angle,sine_of_angle_sum,skipRootVariableToBeSolved,sort_stack,square,ssqrt,stack,stackAddsCount,std_symbol,step,step2,stop,strcmp,stringsEmittedByUserPrintouts,subf,subst,subtract,subtract_numbers,swap,symbol,symbolsDependencies,symbolsHavingReassignments,symbolsInExpressionsWithoutAssignments,symbolsLeftOfAssignment,symbolsRightOfAssignment,symbolsinfo,symnum,symtab,take_care_of_nested_radicals,tangent,taylor,tensor,tensor_plus_tensor,tensor_times_scalar,testApprox,test_flag,text_metric,theRandom,token,token_buf,token_str,top,top_level_eval,tos,transform,transpose,transpose_unicode,trigmode,trivial_divide,try_kth_prime,turnErrorMessageToLatex,ucmp,unfreeze,unique,unique_f,update_token_buf,userSimplificationsInListForm,userSimplificationsInStringForm,usr_symbol,verbosing,version,will_be_displayed_as_fraction,ybinomial,ycosh,ydirac,yerf,yerfc,yfloor,yindex,yround,ysinh,yyarg,yybesselj,yybessely,yyceiling,yycondense,yycontract,yycosh,yydegree,yydetg,yydivpoly,yyerf,yyerfc,yyexpand,yyfactorpoly,yyfloat,yyfloor,yyhermite,yyhermite2,yyinvg,yylcm,yylog,yymultiply,yyouter,yypower,yyrationalize,yyround,yysgn,yysimfac,yysinh,yytangent,zero,zzfloat;for(bigInt=require("big-integer"),version="1.2.1",SELFTEST=1,NSYM=1e3,DEBUG=!1,PRINTOUTRESULT=!1,PRINTMODE_LATEX="PRINTMODE_LATEX",PRINTMODE_2DASCII="PRINTMODE_2DASCII",PRINTMODE_COMPUTER="PRINTMODE_COMPUTER",PRINTMODE_HUMAN="PRINTMODE_HUMAN",PRINTMODE_LIST="PRINTMODE_LIST",printMode=PRINTMODE_COMPUTER,dontCreateNewRadicalsInDenominatorWhenEvalingMultiplication=!0,recursionLevelNestedRadicalsRemoval=0,do_simplify_nested_radicals=!0,avoidCalculatingPowersIntoArctans=!0,rational=function(){class r{}return r.prototype.a=null,r.prototype.b=null,r}.call(this),U=function(){class r{toString(){return print_expr(this)}toLatexString(){return collectLatexStringFromReturnValue(this)}constructor(){this.cons={},this.cons.car=null,this.cons.cdr=null,this.q=new rational}}return r.prototype.cons=null,r.prototype.printname="",r.prototype.str="",r.prototype.tensor=null,r.prototype.q=null,r.prototype.d=0,r.prototype.k=0,r.prototype.tag=0,r}.call(this),errorMessage="",CONS=0,NUM=1,DOUBLE=2,STR=3,TENSOR=4,SYM=5,counter=0,ABS=counter++,ADD=counter++,ADJ=counter++,AND=counter++,APPROXRATIO=counter++,ARCCOS=counter++,ARCCOSH=counter++,ARCSIN=counter++,ARCSINH=counter++,ARCTAN=counter++,ARCTANH=counter++,ARG=counter++,ATOMIZE=counter++,BESSELJ=counter++,BESSELY=counter++,BINDING=counter++,BINOMIAL=counter++,CEILING=counter++,CHECK=counter++,CHOOSE=counter++,CIRCEXP=counter++,CLEAR=counter++,CLEARALL=counter++,CLEARPATTERNS=counter++,CLOCK=counter++,COEFF=counter++,COFACTOR=counter++,CONDENSE=counter++,CONJ=counter++,CONTRACT=counter++,COS=counter++,COSH=counter++,DECOMP=counter++,DEFINT=counter++,DEGREE=counter++,DENOMINATOR=counter++,DERIVATIVE=counter++,DET=counter++,DIM=counter++,DIRAC=counter++,DIVISORS=counter++,DO=counter++,DOT=counter++,DRAW=counter++,DSOLVE=counter++,EIGEN=counter++,EIGENVAL=counter++,EIGENVEC=counter++,ERF=counter++,ERFC=counter++,EVAL=counter++,EXP=counter++,EXPAND=counter++,EXPCOS=counter++,EXPSIN=counter++,FACTOR=counter++,FACTORIAL=counter++,FACTORPOLY=counter++,FILTER=counter++,FLOATF=counter++,FLOOR=counter++,FOR=counter++,FUNCTION=counter++,GAMMA=counter++,GCD=counter++,HERMITE=counter++,HILBERT=counter++,IMAG=counter++,INDEX=counter++,INNER=counter++,INTEGRAL=counter++,INV=counter++,INVG=counter++,ISINTEGER=counter++,ISPRIME=counter++,LAGUERRE=counter++,LCM=counter++,LEADING=counter++,LEGENDRE=counter++,LOG=counter++,LOOKUP=counter++,MOD=counter++,MULTIPLY=counter++,NOT=counter++,NROOTS=counter++,NUMBER=counter++,NUMERATOR=counter++,OPERATOR=counter++,OR=counter++,OUTER=counter++,PATTERN=counter++,PATTERNSINFO=counter++,POLAR=counter++,POWER=counter++,PRIME=counter++,PRINT_LEAVE_E_ALONE=counter++,PRINT_LEAVE_X_ALONE=counter++,PRINT=counter++,PRINT2DASCII=counter++,PRINTFULL=counter++,PRINTLATEX=counter++,PRINTLIST=counter++,PRINTPLAIN=counter++,PRODUCT=counter++,QUOTE=counter++,QUOTIENT=counter++,RANK=counter++,RATIONALIZE=counter++,REAL=counter++,ROUND=counter++,YYRECT=counter++,ROOTS=counter++,SETQ=counter++,SGN=counter++,SILENTPATTERN=counter++,SIMPLIFY=counter++,SIN=counter++,SINH=counter++,SHAPE=counter++,SQRT=counter++,STOP=counter++,SUBST=counter++,SUM=counter++,SYMBOLSINFO=counter++,TAN=counter++,TANH=counter++,TAYLOR=counter++,TEST=counter++,TESTEQ=counter++,TESTGE=counter++,TESTGT=counter++,TESTLE=counter++,TESTLT=counter++,TRANSPOSE=counter++,UNIT=counter++,ZERO=counter++,NIL=counter++,LAST=counter++,LAST_PRINT=counter++,LAST_2DASCII_PRINT=counter++,LAST_FULL_PRINT=counter++,LAST_LATEX_PRINT=counter++,LAST_LIST_PRINT=counter++,LAST_PLAIN_PRINT=counter++,AUTOEXPAND=counter++,BAKE=counter++,ASSUME_REAL_VARIABLES=counter++,TRACE=counter++,YYE=counter++,DRAWX=counter++,METAA=counter++,METAB=counter++,METAX=counter++,SECRETX=counter++,VERSION=counter++,PI=counter++,SYMBOL_A=counter++,SYMBOL_B=counter++,SYMBOL_C=counter++,SYMBOL_D=counter++,SYMBOL_I=counter++,SYMBOL_J=counter++,SYMBOL_N=counter++,SYMBOL_R=counter++,SYMBOL_S=counter++,SYMBOL_T=counter++,SYMBOL_X=counter++,SYMBOL_Y=counter++,SYMBOL_Z=counter++,SYMBOL_IDENTITY_MATRIX=counter++,SYMBOL_A_UNDERSCORE=counter++,SYMBOL_B_UNDERSCORE=counter++,SYMBOL_X_UNDERSCORE=counter++,C1=counter++,C2=counter++,C3=counter++,C4=counter++,C5=counter++,C6=counter++,USR_SYMBOLS=counter++,E=YYE,TOS=1e5,BUF=1e4,MAX_PROGRAM_SIZE=100001,MAXPRIMETAB=1e4,MAX_CONSECUTIVE_APPLICATIONS_OF_ALL_RULES=5,MAX_CONSECUTIVE_APPLICATIONS_OF_SINGLE_RULE=10,MAXDIM=24,symbolsDependencies={},symbolsHavingReassignments=[],symbolsInExpressionsWithoutAssignments=[],patternHasBeenFound=!1,predefinedSymbolsInGlobalScope_doNotTrackInDependencies=["rationalize","abs","e","i","pi","sin","ceiling","cos","roots","integral","derivative","defint","sqrt","eig","cov","deig","dcov","float","floor","product","root","round","sum","test","unit"],parse_time_simplifications=!0,chainOfUserSymbolsNotFunctionsBeingEvaluated=[],stringsEmittedByUserPrintouts="",called_from_Algebra_block=!1,tensor=function(){class r{constructor(){this.dim=function(){var r,e,s;for(s=[],r=0,e=MAXDIM;0<=e?r<=e:r>=e;0<=e?r++:r--)s.push(0);return s}(),this.elem=[]}}return r.prototype.ndim=0,r.prototype.dim=null,r.prototype.nelem=0,r.prototype.elem=null,r}.call(this),display=function(){class r{}return r.prototype.h=0,r.prototype.w=0,r.prototype.n=0,r.prototype.a=[],r}.call(this),text_metric=function(){class r{}return r.prototype.ascent=0,r.prototype.descent=0,r.prototype.width=0,r}.call(this),tos=0,expanding=0,evaluatingAsFloats=0,evaluatingPolar=0,fmt_x=0,fmt_index=0,fmt_level=0,verbosing=0,primetab=function(){var r,e,s,o;for(o=[2],e=3;o.length<MAXPRIMETAB;){for(s=0,r=Math.sqrt(e);s<o.length&&o[s]<=r;){if(e%o[s]==0){s=-1;break}s++}-1!==s&&o.push(e),e+=2}return o[MAXPRIMETAB]=0,o}(),esc_flag=0,draw_flag=0,mtotal=0,trigmode=0,logbuf="",program_buf="",symtab=[],binding=[],isSymbolReclaimable=[],arglist=[],stack=[],frame=0,p0=null,p1=null,p2=null,p3=null,p4=null,p5=null,p6=null,p7=null,p8=null,p9=null,zero=null,one=null,one_as_double=null,imaginaryunit=null,out_buf="",out_count=0,test_flag=0,codeGen=!1,draw_stop_return=null,userSimplificationsInListForm=[],userSimplificationsInStringForm=[],transpose_unicode=7488,dotprod_unicode=183,symbol=function(r){return symtab[r]},iscons=function(r){return r.k===CONS},isrational=function(r){return r.k===NUM},isdouble=function(r){return r.k===DOUBLE},isNumericAtom=function(r){return isrational(r)||isdouble(r)},isstr=function(r){return r.k===STR},istensor=function(r){if(null!=r)return r.k===TENSOR},isNumericAtomOrTensor=function(r){var e,s,o,t,n;if(isNumericAtom(r)||r===symbol(SYMBOL_IDENTITY_MATRIX))return 1;if(!istensor(r)&&!isNumericAtom(r))return 0;for(o=r.tensor.nelem,e=r.tensor.elem,s=t=0,n=o;0<=n?t<n:t>n;s=0<=n?++t:--t)if(!isNumericAtomOrTensor(e[s]))return 0;return 1},issymbol=function(r){return r.k===SYM},iskeyword=function(r){return issymbol(r)&&symnum(r)<NIL},car=function(r){return iscons(r)?r.cons.car:symbol(NIL)},cdr=function(r){return iscons(r)?r.cons.cdr:symbol(NIL)},caar=function(r){return car(car(r))},cadr=function(r){return car(cdr(r))},cdar=function(r){return cdr(car(r))},cddr=function(r){return cdr(cdr(r))},caadr=function(r){return car(car(cdr(r)))},caddr=function(r){return car(cdr(cdr(r)))},cadar=function(r){return car(cdr(car(r)))},cdadr=function(r){return cdr(car(cdr(r)))},cddar=function(r){return cdr(cdr(car(r)))},cdddr=function(r){return cdr(cdr(cdr(r)))},caaddr=function(r){return car(car(cdr(cdr(r))))},cadadr=function(r){return car(cdr(car(cdr(r))))},caddar=function(r){return car(cdr(cdr(car(r))))},cdaddr=function(r){return cdr(car(cdr(cdr(r))))},cadddr=function(r){return car(cdr(cdr(cdr(r))))},cddddr=function(r){return cdr(cdr(cdr(cdr(r))))},caddddr=function(r){return car(cdr(cdr(cdr(cdr(r)))))},cadaddr=function(r){return car(cdr(car(cdr(cdr(r)))))},cddaddr=function(r){return cdr(cdr(car(cdr(cdr(r)))))},caddadr=function(r){return car(cdr(cdr(car(cdr(r)))))},cdddaddr=function(r){return cdr(cdr(cdr(car(cdr(cdr(r))))))},caddaddr=function(r){return car(cdr(cdr(car(cdr(cdr(r))))))},listLength=function(r){var e;for(e=-1;iscons(r);)r=cdr(r),e++;return e},nthCadr=function(r,e){var s;for(s=0;s<=e;)r=cdr(r),s++;return car(r)},isadd=function(r){return car(r)===symbol(ADD)},ismultiply=function(r){return car(r)===symbol(MULTIPLY)},ispower=function(r){return car(r)===symbol(POWER)},isfactorial=function(r){return car(r)===symbol(FACTORIAL)},isinnerordot=function(r){return car(r)===symbol(INNER)||car(r)===symbol(DOT)},istranspose=function(r){return car(r)===symbol(TRANSPOSE)},isinv=function(r){return car(r)===symbol(INV)},isidentitymatrix=function(r){return r===symbol(SYMBOL_IDENTITY_MATRIX)},MSIGN=function(r){return r.isPositive()?1:r.isZero()?0:-1},MLENGTH=function(r){return r.toString().length},MZERO=function(r){return r.isZero()},MEQUAL=function(r,e){return r.equals(e)},reset_after_error=function(){return moveTos(0),esc_flag=0,draw_flag=0,frame=TOS,evaluatingAsFloats=0,evaluatingPolar=0},$="undefined"!=typeof exports&&null!==exports?exports:this,$.version=version,$.isadd=isadd,$.ismultiply=ismultiply,$.ispower=ispower,$.isfactorial=isfactorial,$.car=car,$.cdr=cdr,$.caar=caar,$.cadr=cadr,$.cdar=cdar,$.cddr=cddr,$.caadr=caadr,$.caddr=caddr,$.cadar=cadar,$.cdadr=cdadr,$.cddar=cddar,$.cdddr=cdddr,$.caaddr=caaddr,$.cadadr=cadadr,$.caddar=caddar,$.cdaddr=cdaddr,$.cadddr=cadddr,$.cddddr=cddddr,$.caddddr=caddddr,$.cadaddr=cadaddr,$.cddaddr=cddaddr,$.caddadr=caddadr,$.cdddaddr=cdddaddr,$.caddaddr=caddaddr,$.symbol=symbol,$.iscons=iscons,$.isrational=isrational,$.isdouble=isdouble,$.isNumericAtom=isNumericAtom,$.isstr=isstr,$.istensor=istensor,$.issymbol=issymbol,$.iskeyword=iskeyword,$.CONS=CONS,$.NUM=NUM,$.DOUBLE=DOUBLE,$.STR=STR,$.TENSOR=TENSOR,$.SYM=SYM,DEBUG_ABS=!1,Eval_abs=function(){return push(cadr(p1)),Eval(),abs()},absValFloat=function(){return Eval(),absval(),Eval(),zzfloat()},abs=function(){var r;if(r=top(),DEBUG_ABS&&console.trace(">>>>  ABS of "+r),numerator(),DEBUG_ABS&&console.log("ABS numerator "+stack[tos-1]),absval(),DEBUG_ABS&&console.log("ABSVAL numerator: "+stack[tos-1]),push(r),denominator(),DEBUG_ABS&&console.log("ABS denominator: "+stack[tos-1]),absval(),DEBUG_ABS&&console.log("ABSVAL denominator: "+stack[tos-1]),divide(),DEBUG_ABS&&console.log("ABSVAL divided: "+stack[tos-1]),DEBUG_ABS)return console.log("<<<<<<<  ABS")},absval=function(){var r,e;if(save(),e=p1=pop(),DEBUG_ABS&&console.log("ABS of "+p1),isZeroAtomOrTensor(p1))return DEBUG_ABS&&console.log(" abs: "+p1+" just zero"),push(zero),DEBUG_ABS&&console.log(" --\x3e ABS of "+e+" : "+stack[tos-1]),void restore();if(isnegativenumber(p1))return DEBUG_ABS&&console.log(" abs: "+p1+" just a negative"),push(p1),negate(),void restore();if(ispositivenumber(p1))return DEBUG_ABS&&console.log(" abs: "+p1+" just a positive"),push(p1),DEBUG_ABS&&console.log(" --\x3e ABS of "+e+" : "+stack[tos-1]),void restore();if(p1===symbol(PI))return DEBUG_ABS&&console.log(" abs: "+p1+" of PI"),push(p1),DEBUG_ABS&&console.log(" --\x3e ABS of "+e+" : "+stack[tos-1]),void restore();if(car(p1)===symbol(ADD)&&(findPossibleClockForm(p1)||findPossibleExponentialForm(p1)||Find(p1,imaginaryunit)))return DEBUG_ABS&&console.log(" abs: "+p1+" is a sum"),DEBUG_ABS&&console.log("abs of a sum"),push(p1),rect(),p1=pop(),push(p1),real(),push_integer(2),power(),push(p1),imag(),push_integer(2),power(),add(),push_rational(1,2),power(),simplify_trig(),DEBUG_ABS&&console.log(" --\x3e ABS of "+e+" : "+stack[tos-1]),void restore();if(car(p1)===symbol(POWER)&&equaln(cadr(p1),-1))return DEBUG_ABS&&console.log(" abs: "+p1+" is -1 to any power"),evaluatingAsFloats?(DEBUG_ABS&&console.log(" abs: numeric, so result is 1.0"),push_double(1)):(DEBUG_ABS&&console.log(" abs: symbolic, so result is 1"),push_integer(1)),DEBUG_ABS&&console.log(" --\x3e ABS of "+e+" : "+stack[tos-1]),void restore();if(car(p1)===symbol(POWER)&&ispositivenumber(caddr(p1)))return DEBUG_ABS&&console.log(" abs: "+p1+" is something to the power of a positive number"),push(cadr(p1)),abs(),push(caddr(p1)),power(),DEBUG_ABS&&console.log(" --\x3e ABS of "+e+" : "+stack[tos-1]),void restore();if(car(p1)===symbol(POWER)&&cadr(p1)===symbol(E))return DEBUG_ABS&&console.log(" abs: "+p1+" is an exponential"),push(caddr(p1)),real(),exponential(),DEBUG_ABS&&console.log(" --\x3e ABS of "+e+" : "+stack[tos-1]),void restore();if(car(p1)===symbol(MULTIPLY)){for(DEBUG_ABS&&console.log(" abs: "+p1+" is a product"),r=!1,p1=cdr(p1);iscons(p1);)push(car(p1)),absval(),r&&multiply(),r=!0,p1=cdr(p1);return DEBUG_ABS&&console.log(" --\x3e ABS of "+e+" : "+stack[tos-1]),void restore()}return car(p1)===symbol(ABS)?(DEBUG_ABS&&console.log(" abs: "+p1+" is abs of a abs"),push_symbol(ABS),push(cadr(p1)),list(2),DEBUG_ABS&&console.log(" --\x3e ABS of "+e+" : "+stack[tos-1]),void restore()):istensor(p1)?(absval_tensor(),void restore()):((isnegativeterm(p1)||car(p1)===symbol(ADD)&&isnegativeterm(cadr(p1)))&&(push(p1),negate(),p1=pop()),DEBUG_ABS&&console.log(" abs: "+p1+" is nothing decomposable"),push_symbol(ABS),push(p1),list(2),DEBUG_ABS&&console.log(" --\x3e ABS of "+e+" : "+stack[tos-1]),restore())},absval_tensor=function(){return 1!==p1.tensor.ndim&&stop("abs(tensor) with tensor rank > 1"),push(p1),push(p1),conjugate(),inner(),push_rational(1,2),power(),simplify(),Eval()},flag=0,Eval_add=function(){var r;for(r=tos,p1=cdr(p1);iscons(p1);)push(car(p1)),Eval(),p2=pop(),push_terms(p2),p1=cdr(p1);return add_terms(tos-r)},stackAddsCount=0,add_terms=function(r){var e,s,o,t,n,p,i,a,u;if(stackAddsCount++,s=0,e=tos-r,DEBUG&&console.log("stack before adding terms #"+stackAddsCount),DEBUG)for(s=n=0,p=tos;0<=p?n<p:n>p;s=0<=p?++n:--n)console.log(print_list(stack[s]));for(s=o=0;o<10&&!(r<2)&&(flag=0,(u=stack.slice(e,e+r)).sort(cmp_terms),stack=stack.slice(0,e).concat(u).concat(stack.slice(e+r)),0!==flag);s=++o)r=combine_terms(e,r);switch(moveTos(e+r),r){case 0:evaluatingAsFloats?push_double(0):push(zero);break;case 1:break;default:list(r),p1=pop(),push_symbol(ADD),push(p1),cons()}if(DEBUG&&console.log("stack after adding terms #"+stackAddsCount),DEBUG){for(a=[],s=t=0,i=tos;0<=i?t<i:t>i;s=0<=i?++t:--t)a.push(console.log(print_list(stack[s])));return a}},cmp_terms_count=0,cmp_terms=function(r,e){var s,o,t,n;if(cmp_terms_count++,s=0,isNumericAtom(r)&&isNumericAtom(e))return flag=1,0;if(istensor(r)&&istensor(e)){if(r.tensor.ndim<e.tensor.ndim)return-1;if(r.tensor.ndim>e.tensor.ndim)return 1;for(s=o=0,t=r.tensor.ndim;0<=t?o<t:o>t;s=0<=t?++o:--o){if(r.tensor.dim[s]<e.tensor.dim[s])return-1;if(r.tensor.dim[s]>e.tensor.dim[s])return 1}return flag=1,0}return car(r)===symbol(MULTIPLY)&&(r=cdr(r),isNumericAtom(car(r))&&(r=cdr(r),cdr(r)===symbol(NIL)&&(r=car(r)))),car(e)===symbol(MULTIPLY)&&(e=cdr(e),isNumericAtom(car(e))&&(e=cdr(e),cdr(e)===symbol(NIL)&&(e=car(e)))),0===(n=cmp_expr(r,e))&&(flag=1),n},combine_terms=function(r,e){var s,o,t,n,p,i,a,u,l,c,d,_,m,f,h,g,b,y;for(s=0;s<e-1;)if(check_esc_flag(),p3=stack[r+s],p4=stack[r+s+1],istensor(p3)&&istensor(p4)){if(push(p3),push(p4),tensor_plus_tensor(),(p1=pop())!==symbol(NIL)){for(stack[r+s]=p1,t=a=u=s+1,l=e-1;u<=l?a<l:a>l;t=u<=l?++a:--a)stack[r+t]=stack[r+t+1];e--,s--}s++}else if(istensor(p3)||istensor(p4))s++;else if(isNumericAtom(p3)&&isNumericAtom(p4)){if(push(p3),push(p4),add_numbers(),p1=pop(),isZeroAtomOrTensor(p1)){for(t=o=c=s,d=e-2;c<=d?o<d:o>d;t=c<=d?++o:--o)stack[r+t]=stack[r+t+2];e-=2}else{for(stack[r+s]=p1,t=n=_=s+1,m=e-1;_<=m?n<m:n>m;t=_<=m?++n:--n)stack[r+t]=stack[r+t+1];e--}s--,s++}else if(isNumericAtom(p3)||isNumericAtom(p4))s++;else if(evaluatingAsFloats?(p1=one_as_double,p2=one_as_double):(p1=one,p2=one),y=0,car(p3)===symbol(MULTIPLY)&&(p3=cdr(p3),y=1,isNumericAtom(car(p3))&&(p1=car(p3),p3=cdr(p3),cdr(p3)===symbol(NIL)&&(p3=car(p3),y=0))),car(p4)===symbol(MULTIPLY)&&(p4=cdr(p4),isNumericAtom(car(p4))&&(p2=car(p4),p4=cdr(p4),cdr(p4)===symbol(NIL)&&(p4=car(p4)))),equal(p3,p4))if(push(p1),push(p2),add_numbers(),p1=pop(),isZeroAtomOrTensor(p1)){for(t=p=f=s,h=e-2;f<=h?p<h:p>h;t=f<=h?++p:--p)stack[r+t]=stack[r+t+2];e-=2,s--,s++}else{for(push(p1),y?(push(symbol(MULTIPLY)),push(p3),cons()):push(p3),multiply(),stack[r+s]=pop(),t=i=g=s+1,b=e-1;g<=b?i<b:i>b;t=g<=b?++i:--i)stack[r+t]=stack[r+t+1];e--,s--,s++}else s++;return e},push_terms=function(r){var e;if(car(r)===symbol(ADD)){for(r=cdr(r),e=[];iscons(r);)push(car(r)),e.push(r=cdr(r));return e}if(!isZeroAtomOrTensor(r))return push(r)},add=function(){var r;return save(),p2=pop(),p1=pop(),r=tos,push_terms(p1),push_terms(p2),add_terms(tos-r),restore()},add_all=function(r){var e,s,o,t,n;for(s=0,save(),n=tos-r,e=tos,s=o=0,t=r;0<=t?o<t:o>t;s=0<=t?++o:--o)push_terms(stack[n+s]);return add_terms(tos-e),p1=pop(),moveTos(tos-r),push(p1),restore()},subtract=function(){return negate(),add()},Eval_adj=function(){return push(cadr(p1)),Eval(),adj()},adj=function(){var r,e,s,o,t,n,p;for(r=0,s=0,0,save(),p1=pop(),istensor(p1)&&2===p1.tensor.ndim&&p1.tensor.dim[0]===p1.tensor.dim[1]?1:stop("adj: square matrix expected"),o=p1.tensor.dim[0],(p2=alloc_tensor(o*o)).tensor.ndim=2,p2.tensor.dim[0]=o,p2.tensor.dim[1]=o,r=t=0,n=o;0<=n?t<n:t>n;r=0<=n?++t:--t)for(s=e=0,p=o;0<=p?e<p:e>p;s=0<=p?++e:--e)cofactor(p1,o,r,s),p2.tensor.elem[o*s+r]=pop();return push(p2),restore()},Eval_approxratio=function(){var r;return r=cadr(p1),push(r),approxratioRecursive()},approxratioRecursive=function(){var r,e,s,o,t;if(r=0,save(),p1=pop(),istensor(p1)){for((p4=alloc_tensor(p1.tensor.nelem)).tensor.ndim=p1.tensor.ndim,r=s=0,o=p1.tensor.ndim;0<=o?s<o:s>o;r=0<=o?++s:--s)p4.tensor.dim[r]=p1.tensor.dim[r];for(r=e=0,t=p1.tensor.nelem;0<=t?e<t:e>t;r=0<=t?++e:--e)push(p1.tensor.elem[r]),approxratioRecursive(),p4.tensor.elem[r]=pop(),check_tensor_dimensions(p4);push(p4)}else p1.k===DOUBLE?(push(p1),approxOneRatioOnly()):iscons(p1)?(push(car(p1)),approxratioRecursive(),push(cdr(p1)),approxratioRecursive(),cons()):push(p1);return restore()},approxOneRatioOnly=function(){var r,e,s,o,t,n;if(zzfloat(),(o=pop()).k!==DOUBLE)return push_symbol(APPROXRATIO),push(theArgument),list(2);2===(s=(t=o.d).toString().split(".")).length?(r=s[1].length,e=1/Math.pow(10,r),n=floatToRatioRoutine(t,e),push_rational(n[0],n[1])):push_integer(t)},floatToRatioRoutine=function(r,e){var s,o,t,n,p,i,a;if(t=void 0,o=void 0,s=void 0,i=void 0,n=void 0,p=void 0,a=[0,0],isNaN(r))return a;if(Infinity===r)return a[0]=1,a[1]=0,a;if(-Infinity===r)return a[0]=-1,a[1]=0,a;if(s=r<0?-1:1,r=Math.abs(r),Math.abs(r-Math.floor(r))<e)return t=r*s,o=1,a[0]=t,a[1]=o,a;if(r<1e-19)return t=s,o=1e19,a[0]=t,a[1]=o,a;if(r>1e19)return t=1e19*s,o=1,a[0]=t,a[1]=o,a;for(i=r,n=0,o=1;i=1/(i-Math.floor(i)),p=o,o=o*Math.floor(i)+n,n=p,t=Math.floor(r*o+.5),Math.abs(r-t/o)>e&&i!==Math.floor(i););return t*=s,a[0]=t,a[1]=o,a},approx_just_an_integer=0,approx_sine_of_rational=1,approx_sine_of_pi_times_rational=2,approx_rationalOfPi=3,approx_radicalOfRatio=4,approx_nothingUseful=5,approx_ratioOfRadical=6,approx_rationalOfE=7,approx_logarithmsOfRationals=8,approx_rationalsOfLogarithms=9,approxRationalsOfRadicals=function(r){var e,s,o,t,n,p,i,a,u,l,c,d,_,m,f,h;if(2!==(h=r.toString().split(".")).length)return[""+Math.floor(r),approx_just_an_integer,Math.floor(r),1,2];for(c=h[1].length,_=1/Math.pow(10,c),console.log("precision: "+_),e=null,l=Number.MAX_VALUE,d=0,a=(f=[2,3,5,6,7,8,10]).length;d<a;d++)for(n=f[d],i=p=1;p<=10;i=++p)t=Math.sqrt(n)/i,Math.abs(t)>1e-10?(m=r/t,u=Math.round(m),o=Math.abs(1-m/u)):(m=1,u=1,o=Math.abs(r-t)),o<2*_&&(s=simpleComplexityMeasure(u,n,i))<l&&(l=s,e=[u+" * sqrt( "+n+" ) / "+i,approx_ratioOfRadical,u,n,i]);return e},approxRadicalsOfRationals=function(r){var e,s,o,t,n,p,i,a,u,l,c,d,_,m,f,h,g,b;if(2!==(b=r.toString().split(".")).length)return[""+Math.floor(r),approx_just_an_integer,Math.floor(r),1,2];for(d=b[1].length,m=1/Math.pow(10,d),console.log("precision: "+m),e=null,c=Number.MAX_VALUE,_=0,a=(h=[1,2,3,5,6,7,8,10]).length;_<a;_++)for(n=h[_],p=0,u=(g=[1,2,3,5,6,7,8,10]).length;p<u;p++)i=g[p],t=Math.sqrt(n/i),Math.abs(t)>1e-10?(f=r/t,l=Math.round(f),o=Math.abs(1-f/l)):(f=1,l=1,o=Math.abs(r-t)),o<2*m&&(s=simpleComplexityMeasure(l,n,i))<c&&(c=s,e=[l+" * (sqrt( "+n+" / "+i+" )",approx_radicalOfRatio,l,n,i]);return e},approxRadicals=function(r){var e,s,o,t,n;return 2!==(n=r.toString().split(".")).length?[""+Math.floor(r),approx_just_an_integer,Math.floor(r),1,2]:(o=n[1].length,t=1/Math.pow(10,o),console.log("precision: "+t),null!=(s=approxRationalsOfRadicals(r))?s:null!=(e=approxRadicalsOfRationals(r))?e:null)},approxLogs=function(r){var e,s,o,t,n;return 2!==(n=r.toString().split(".")).length?[""+Math.floor(r),approx_just_an_integer,Math.floor(r),1,2]:(o=n[1].length,t=1/Math.pow(10,o),console.log("precision: "+t),null!=(s=approxRationalsOfLogs(r))?s:null!=(e=approxLogsOfRationals(r))?e:null)},approxRationalsOfLogs=function(r){var e,s,o,t,n,p,i,a,u,l,c,d,_,m;if(2!==(m=r.toString().split(".")).length)return[""+Math.floor(r),approx_just_an_integer,Math.floor(r),1,2];for(l=m[1].length,d=1/Math.pow(10,l),console.log("precision: "+d),e=null,u=Number.MAX_VALUE,n=c=2;c<=5;n=++c)for(i=p=1;p<=5;i=++p)t=Math.log(n)/i,Math.abs(t)>1e-10?(_=r/t,a=Math.round(_),o=Math.abs(1-_/a)):(_=1,a=1,o=Math.abs(r-t)),1!==a&&Math.abs(Math.floor(a/i))===Math.abs(a/i)||o<2.2*d&&(s=simpleComplexityMeasure(a,n,i))<u&&(u=s,e=[a+" * log( "+n+" ) / "+i,approx_rationalsOfLogarithms,a,n,i]);return e},approxLogsOfRationals=function(r){var e,s,o,t,n,p,i,a,u,l,c,d,_,m;if(2!==(m=r.toString().split(".")).length)return[""+Math.floor(r),approx_just_an_integer,Math.floor(r),1,2];for(l=m[1].length,d=1/Math.pow(10,l),console.log("precision: "+d),e=null,u=Number.MAX_VALUE,n=c=1;c<=5;n=++c)for(i=p=1;p<=5;i=++p)t=Math.log(n/i),Math.abs(t)>1e-10?(_=r/t,a=Math.round(_),o=Math.abs(1-_/a)):(_=1,a=1,o=Math.abs(r-t)),o<1.96*d&&(s=simpleComplexityMeasure(a,n,i))<u&&(u=s,e=[a+" * log( "+n+" / "+i+" )",approx_logarithmsOfRationals,a,n,i]);return e},approxRationalsOfPowersOfE=function(r){var e,s,o,t,n,p,i,a,u,l,c,d,_,m;if(2!==(m=r.toString().split(".")).length)return[""+Math.floor(r),approx_just_an_integer,Math.floor(r),1,2];for(l=m[1].length,d=1/Math.pow(10,l),console.log("precision: "+d),e=null,u=Number.MAX_VALUE,n=c=1;c<=2;n=++c)for(i=p=1;p<=12;i=++p)t=Math.pow(Math.E,n)/i,Math.abs(t)>1e-10?(_=r/t,a=Math.round(_),o=Math.abs(1-_/a)):(_=1,a=1,o=Math.abs(r-t)),o<2*d&&(s=simpleComplexityMeasure(a,n,i))<u&&(u=s,e=[a+" * (e ^ "+n+" ) / "+i,approx_rationalOfE,a,n,i]);return e},approxRationalsOfPowersOfPI=function(r){var e,s,o,t,n,p,i,a,u,l,c,d,_,m;if(2!==(m=r.toString().split(".")).length)return[""+Math.floor(r),approx_just_an_integer,Math.floor(r),1,2];for(l=m[1].length,d=1/Math.pow(10,l),console.log("precision: "+d),e=null,u=Number.MAX_VALUE,n=c=1;c<=5;n=++c)for(i=p=1;p<=12;i=++p)t=Math.pow(Math.PI,n)/i,Math.abs(t)>1e-10?(_=r/t,a=Math.round(_),o=Math.abs(1-_/a)):(_=1,a=1,o=Math.abs(r-t)),o<2*d&&(s=simpleComplexityMeasure(a,n,i))<u&&(u=s,e=[a+" * (pi ^ "+n+" ) / "+i+" )",approx_rationalOfPi,a,n,i]);return e},approxTrigonometric=function(r){var e,s,o,t,n;return 2!==(n=r.toString().split(".")).length?[""+Math.floor(r),approx_just_an_integer,Math.floor(r),1,2]:(o=n[1].length,t=1/Math.pow(10,o),console.log("precision: "+t),null!=(s=approxSineOfRationals(r))?s:null!=(e=approxSineOfRationalMultiplesOfPI(r))?e:null)},approxSineOfRationals=function(r){var e,s,o,t,n,p,i,a,u,l,c,d,_,m,f;if(2!==(f=r.toString().split(".")).length)return[""+Math.floor(r),approx_just_an_integer,Math.floor(r),1,2];for(c=f[1].length,_=1/Math.pow(10,c),console.log("precision: "+_),e=null,l=Number.MAX_VALUE,p=d=1;d<=4;p=++d)for(a=i=1;i<=4;a=++i)t=p/a,n=Math.sin(t),Math.abs(n)>1e-10?(m=r/n,u=Math.round(m),o=Math.abs(1-m/u)):(m=1,u=1,o=Math.abs(r-n)),o<2*_&&(s=simpleComplexityMeasure(u,p,a))<l&&(l=s,e=[u+" * sin( "+p+"/"+a+" )",approx_sine_of_rational,u,p,a]);return e},approxSineOfRationalMultiplesOfPI=function(r){var e,s,o,t,n,p,i,a,u,l,c,d,_,m,f;if(2!==(f=r.toString().split(".")).length)return[""+Math.floor(r),approx_just_an_integer,Math.floor(r),1,2];for(c=f[1].length,_=1/Math.pow(10,c),console.log("precision: "+_),e=null,l=Number.MAX_VALUE,p=d=1;d<=13;p=++d)for(a=i=1;i<=13;a=++i)t=p/a,n=Math.sin(Math.PI*t),Math.abs(n)>1e-10?(m=r/n,u=Math.round(m),o=Math.abs(1-m/u)):(m=1,u=1,o=Math.abs(r-n)),o<23*_&&(s=simpleComplexityMeasure(u,p,a))<l&&(l=s,e=[u+" * sin( "+p+"/"+a+" * pi )",approx_sine_of_pi_times_rational,u,p,a]);return e},approxAll=function(r){var e,s,o,t,n,p,i,a,u,l,c;return 2!==(c=r.toString().split(".")).length?[""+Math.floor(r),approx_just_an_integer,Math.floor(r),1,2]:(u=c[1].length,l=1/Math.pow(10,u),console.log("precision: "+l),a=Number.MAX_VALUE,i=0,p=null,!0,null!=(s=approxRadicals(r))&&((i=simpleComplexityMeasure(s))<a?(console.log("better explanation by approxRadicals: "+s+" complexity: "+i),a=i,p=s):console.log("subpar explanation by approxRadicals: "+s+" complexity: "+i)),null!=(e=approxLogs(r))&&((i=simpleComplexityMeasure(e))<a?(console.log("better explanation by approxLogs: "+e+" complexity: "+i),a=i,p=e):console.log("subpar explanation by approxLogs: "+e+" complexity: "+i)),null!=(o=approxRationalsOfPowersOfE(r))&&((i=simpleComplexityMeasure(o))<a?(console.log("better explanation by approxRationalsOfPowersOfE: "+o+" complexity: "+i),a=i,p=o):console.log("subpar explanation by approxRationalsOfPowersOfE: "+o+" complexity: "+i)),null!=(t=approxRationalsOfPowersOfPI(r))&&((i=simpleComplexityMeasure(t))<a?(console.log("better explanation by approxRationalsOfPowersOfPI: "+t+" complexity: "+i),a=i,p=t):console.log("subpar explanation by approxRationalsOfPowersOfPI: "+t+" complexity: "+i)),null!=(n=approxTrigonometric(r))&&((i=simpleComplexityMeasure(n))<a?(console.log("better explanation by approxTrigonometric: "+n+" complexity: "+i),a=i,p=n):console.log("subpar explanation by approxTrigonometric: "+n+" complexity: "+i)),p)},simpleComplexityMeasure=function(r,e,s){var o;if(o=null,r instanceof Array){switch(r[1]){case approx_sine_of_pi_times_rational:o=4;break;case approx_rationalOfPi:o=Math.pow(4,Math.abs(r[3]))*Math.abs(r[2]);break;case approx_rationalOfE:o=Math.pow(3,Math.abs(r[3]))*Math.abs(r[2]);break;default:o=0}o+=Math.abs(r[2])*(Math.abs(r[3])+Math.abs(r[4]))}else o+=Math.abs(r)*(Math.abs(e)+Math.abs(s));return 1===r[2]?o-=1:o+=1,1===r[3]?o-=1:o+=1,1===r[4]?o-=1:o+=1,o<0&&(o=0),o},testApprox=function(){var r,e,s,o,t,n,p,i,a,u,l,c,d,_,m,f,h,g,b,y,E,v,x,A,T,O,I,N,S,R,M,L,k,D,U,P,B,q,G,w,C,F,Y,X,W,z,V,Z,$,H,Q,j,J,K,rr,er,sr,or,tr;for(N=0,m=(P=[2,3,5,6,7,8,10]).length;N<m;N++)for(s=P[N],o=0,f=(B=[2,3,5,6,7,8,10]).length;o<f;o++)s!==(p=B[o])&&(console.log("testapproxRadicals testing: 1 * sqrt( "+s+" ) / "+p),e=s/p,rr=Math.sqrt(s)/p,z=(X=approxRadicals(rr))[2]*Math.sqrt(X[3])/X[4],Math.abs(rr-z)>1e-15&&console.log("fail testapproxRadicals: 1 * sqrt( "+s+" ) / "+p+" . obtained: "+X));for(i=0,h=(q=[2,3,5,6,7,8,10]).length;i<h;i++)for(s=q[i],c=0,g=(G=[2,3,5,6,7,8,10]).length;c<g;c++)s!==(p=G[c])&&(console.log("testapproxRadicals testing with 4 digits: 1 * sqrt( "+s+" ) / "+p),e=s/p,rr=(M=Math.sqrt(s)/p).toFixed(4),z=(X=approxRadicals(rr))[2]*Math.sqrt(X[3])/X[4],Math.abs(M-z)>1e-15&&console.log("fail testapproxRadicals with 4 digits: 1 * sqrt( "+s+" ) / "+p+" . obtained: "+X));for(x=0,b=(w=[2,3,5,6,7,8,10]).length;x<b;x++)for(s=w[x],O=0,y=(C=[2,3,5,6,7,8,10]).length;O<y;O++)s!==(p=C[O])&&(console.log("testapproxRadicals testing: 1 * sqrt( "+s+" / "+p+" )"),e=s/p,rr=Math.sqrt(s/p),null!=(X=approxRadicals(rr))&&(z=X[2]*Math.sqrt(X[3]/X[4]),X[1]===approx_radicalOfRatio&&Math.abs(rr-z)>1e-15&&console.log("fail testapproxRadicals: 1 * sqrt( "+s+" / "+p+" ) . obtained: "+X)));for(S=0,E=(F=[1,2,3,5,6,7,8,10]).length;S<E;S++)for(s=F[S],L=0,v=(Y=[1,2,3,5,6,7,8,10]).length;L<v;L++)p=Y[L],1===s&&1===p||(console.log("testapproxRadicals testing with 4 digits:: 1 * sqrt( "+s+" / "+p+" )"),e=s/p,rr=(M=Math.sqrt(s/p)).toFixed(4),z=(X=approxRadicals(rr))[2]*Math.sqrt(X[3]/X[4]),X[1]===approx_radicalOfRatio&&Math.abs(M-z)>1e-15&&console.log("fail testapproxRadicals with 4 digits:: 1 * sqrt( "+s+" / "+p+" ) . obtained: "+X));for(s=D=1;D<=5;s=++D)for(p=V=1;V<=5;p=++V)console.log("testApproxAll testing: 1 * log("+s+" ) / "+p),e=s/p,rr=Math.log(s)/p,z=(X=approxAll(rr))[2]*Math.log(X[3])/X[4],Math.abs(rr-z)>1e-15&&console.log("fail testApproxAll: 1 * log("+s+" ) / "+p+" . obtained: "+X);for(s=$=1;$<=5;s=++$)for(p=Q=1;Q<=5;p=++Q)console.log("testApproxAll testing with 4 digits: 1 * log("+s+" ) / "+p),e=s/p,rr=(M=Math.log(s)/p).toFixed(4),z=(X=approxAll(rr))[2]*Math.log(X[3])/X[4],Math.abs(M-z)>1e-15&&console.log("fail testApproxAll with 4 digits: 1 * log("+s+" ) / "+p+" . obtained: "+X);for(s=J=1;J<=5;s=++J)for(p=er=1;er<=5;p=++er)console.log("testApproxAll testing: 1 * log("+s+" / "+p+" )"),e=s/p,rr=Math.log(s/p),z=(X=approxAll(rr))[2]*Math.log(X[3]/X[4]),Math.abs(rr-z)>1e-15&&console.log("fail testApproxAll: 1 * log("+s+" / "+p+" ) . obtained: "+X);for(s=or=1;or<=5;s=++or)for(p=t=1;t<=5;p=++t)console.log("testApproxAll testing with 4 digits: 1 * log("+s+" / "+p+" )"),e=s/p,rr=(M=Math.log(s/p)).toFixed(4),z=(X=approxAll(rr))[2]*Math.log(X[3]/X[4]),Math.abs(M-z)>1e-15&&console.log("fail testApproxAll with 4 digits: 1 * log("+s+" / "+p+" ) . obtained: "+X);for(s=a=1;a<=2;s=++a)for(p=d=1;d<=12;p=++d)console.log("testApproxAll testing: 1 * (e ^ "+s+" ) / "+p),e=s/p,rr=Math.pow(Math.E,s)/p,z=(X=approxAll(rr))[2]*Math.pow(Math.E,X[3])/X[4],Math.abs(rr-z)>1e-15&&console.log("fail testApproxAll: 1 * (e ^ "+s+" ) / "+p+" . obtained: "+X);for(s=A=1;A<=2;s=++A)for(p=I=1;I<=12;p=++I)console.log("approxRationalsOfPowersOfE testing with 4 digits: 1 * (e ^ "+s+" ) / "+p),e=s/p,rr=(M=Math.pow(Math.E,s)/p).toFixed(4),z=(X=approxRationalsOfPowersOfE(rr))[2]*Math.pow(Math.E,X[3])/X[4],Math.abs(M-z)>1e-15&&console.log("fail approxRationalsOfPowersOfE with 4 digits: 1 * (e ^ "+s+" ) / "+p+" . obtained: "+X);for(s=R=1;R<=2;s=++R)for(p=k=1;k<=12;p=++k)console.log("testApproxAll testing: 1 * pi ^ "+s+" / "+p),e=s/p,rr=Math.pow(Math.PI,s)/p,z=(X=approxAll(rr))[2]*Math.pow(Math.PI,X[3])/X[4],Math.abs(rr-z)>1e-15&&console.log("fail testApproxAll: 1 * pi ^ "+s+" / "+p+" ) . obtained: "+X);for(s=U=1;U<=2;s=++U)for(p=Z=1;Z<=12;p=++Z)console.log("approxRationalsOfPowersOfPI testing with 4 digits: 1 * pi ^ "+s+" / "+p),e=s/p,rr=(M=Math.pow(Math.PI,s)/p).toFixed(4),z=(X=approxRationalsOfPowersOfPI(rr))[2]*Math.pow(Math.PI,X[3])/X[4],Math.abs(M-z)>1e-15&&console.log("fail approxRationalsOfPowersOfPI with 4 digits: 1 * pi ^ "+s+" / "+p+" ) . obtained: "+X);for(s=H=1;H<=4;s=++H)for(p=j=1;j<=4;p=++j)console.log("testApproxAll testing: 1 * sin( "+s+"/"+p+" )"),e=s/p,rr=Math.sin(e),W=(X=approxAll(rr))[3]/X[4],z=X[2]*Math.sin(W),Math.abs(rr-z)>1e-15&&console.log("fail testApproxAll: 1 * sin( "+s+"/"+p+" ) . obtained: "+X);for(s=K=1;K<=4;s=++K)for(p=sr=1;sr<=4;p=++sr)console.log("testApproxAll testing with 5 digits: 1 * sin( "+s+"/"+p+" )"),e=s/p,rr=(M=Math.sin(e)).toFixed(5),null==(X=approxAll(rr))&&console.log("fail testApproxAll with 5 digits: 1 * sin( "+s+"/"+p+" ) . obtained:  undefined "),W=X[3]/X[4],z=X[2]*Math.sin(W),(r=Math.abs(M-z))>1e-14&&console.log("fail testApproxAll with 5 digits: 1 * sin( "+s+"/"+p+" ) . obtained: "+X+" error: "+r);for(s=tr=1;tr<=4;s=++tr)for(p=n=1;n<=4;p=++n)console.log("testApproxAll testing with 4 digits: 1 * sin( "+s+"/"+p+" )"),e=s/p,rr=(M=Math.sin(e)).toFixed(4),null==(X=approxAll(rr))&&console.log("fail testApproxAll with 4 digits: 1 * sin( "+s+"/"+p+" ) . obtained:  undefined "),W=X[3]/X[4],z=X[2]*Math.sin(W),(r=Math.abs(M-z))>1e-14&&console.log("fail testApproxAll with 4 digits: 1 * sin( "+s+"/"+p+" ) . obtained: "+X+" error: "+r);for("0"!==approxAll(rr=0)[0]&&console.log("fail testApproxAll: 0"),"0"!==approxAll(rr=0)[0]&&console.log("fail testApproxAll: 0.0"),"0"!==approxAll(rr=0)[0]&&console.log("fail testApproxAll: 0.00"),"0"!==approxAll(rr=0)[0]&&console.log("fail testApproxAll: 0.000"),"0"!==approxAll(rr=0)[0]&&console.log("fail testApproxAll: 0.0000"),"1"!==approxAll(rr=1)[0]&&console.log("fail testApproxAll: 1"),"1"!==approxAll(rr=1)[0]&&console.log("fail testApproxAll: 1.0"),"1"!==approxAll(rr=1)[0]&&console.log("fail testApproxAll: 1.00"),"1"!==approxAll(rr=1)[0]&&console.log("fail testApproxAll: 1.000"),"1"!==approxAll(rr=1)[0]&&console.log("fail testApproxAll: 1.0000"),"1"!==approxAll(rr=1)[0]&&console.log("fail testApproxAll: 1.00000"),rr=Math.sqrt(2),"1 * sqrt( 2 ) / 1"!==approxAll(rr)[0]&&console.log("fail testApproxAll: Math.sqrt(2)"),"1 * sqrt( 2 ) / 1"!==approxAll(rr=1.41)[0]&&console.log("fail testApproxAll: 1.41"),"1 * sqrt( 2 ) / 1"!==approxRadicals(rr=1.4)[0]&&console.log("fail approxRadicals: 1.4"),"1 * log( 2 ) / 1"!==approxLogs(rr=.6)[0]&&console.log("fail approxLogs: 0.6"),"1 * log( 2 ) / 1"!==approxLogs(rr=.69)[0]&&console.log("fail approxLogs: 0.69"),"1 * log( 2 ) / 1"!==approxLogs(rr=.7)[0]&&console.log("fail approxLogs: 0.7"),"1 * log( 3 ) / 1"!==approxLogs(rr=1.09)[0]&&console.log("fail approxLogs: 1.09"),"1 * log( 3 ) / 1"!==approxAll(rr=1.09)[0]&&console.log("fail approxAll: 1.09"),"1 * log( 3 ) / 1"!==approxAll(rr=1.098)[0]&&console.log("fail approxAll: 1.098"),"1 * log( 3 ) / 1"!==approxAll(rr=1.1)[0]&&console.log("fail approxAll: 1.1"),"1 * log( 3 ) / 1"!==approxAll(rr=1.11)[0]&&console.log("fail approxAll: 1.11"),rr=Math.sqrt(3),"1 * sqrt( 3 ) / 1"!==approxAll(rr)[0]&&console.log("fail testApproxAll: Math.sqrt(3)"),"1"!==approxAll(rr=1)[0]&&console.log("fail testApproxAll: 1.0000"),"1 * (pi ^ 1 ) / 1 )"!==approxAll(rr=3.141592)[0]&&console.log("fail testApproxAll: 3.141592"),"10 * (pi ^ 1 ) / 1 )"!==approxAll(rr=31.41592)[0]&&console.log("fail testApproxAll: 31.41592"),"100 * (pi ^ 1 ) / 1 )"!==approxAll(rr=314.1592)[0]&&console.log("fail testApproxAll: 314.1592"),"10000000 * (pi ^ 1 ) / 1 )"!==approxAll(rr=31415926.53589793)[0]&&console.log("fail testApproxAll: 31415926.53589793"),rr=Math.sqrt(2),"2 * sin( 1/4 * pi )"!==approxTrigonometric(rr)[0]&&console.log("fail approxTrigonometric: Math.sqrt(2)"),rr=Math.sqrt(3),"2 * sin( 1/3 * pi )"!==approxTrigonometric(rr)[0]&&console.log("fail approxTrigonometric: Math.sqrt(3)"),rr=(Math.sqrt(6)-Math.sqrt(2))/4,"1 * sin( 1/12 * pi )"!==approxAll(rr)[0]&&console.log("fail testApproxAll: (Math.sqrt(6) - Math.sqrt(2))/4"),rr=Math.sqrt(2-Math.sqrt(2))/2,"1 * sin( 1/8 * pi )"!==approxAll(rr)[0]&&console.log("fail testApproxAll: Math.sqrt(2 - Math.sqrt(2))/2"),rr=(Math.sqrt(6)+Math.sqrt(2))/4,"1 * sin( 5/12 * pi )"!==approxAll(rr)[0]&&console.log("fail testApproxAll: (Math.sqrt(6) + Math.sqrt(2))/4"),rr=Math.sqrt(2+Math.sqrt(3))/2,"1 * sin( 5/12 * pi )"!==approxAll(rr)[0]&&console.log("fail testApproxAll: Math.sqrt(2 + Math.sqrt(3))/2"),rr=(Math.sqrt(5)-1)/4,"1 * sin( 1/10 * pi )"!==approxAll(rr)[0]&&console.log("fail testApproxAll: (Math.sqrt(5) - 1)/4"),rr=Math.sqrt(10-2*Math.sqrt(5))/4,"1 * sin( 1/5 * pi )"!==approxAll(rr)[0]&&console.log("fail testApproxAll: Math.sqrt(10 - 2*Math.sqrt(5))/4"),rr=Math.sin(Math.PI/7),"1 * sin( 1/7 * pi )"!==approxAll(rr)[0]&&console.log("fail testApproxAll: Math.sin(Math.PI/7)"),rr=Math.sin(Math.PI/9),"1 * sin( 1/9 * pi )"!==approxAll(rr)[0]&&console.log("fail testApproxAll: Math.sin(Math.PI/9)"),"6 * (pi ^ 5 ) / 1 )"!==approxRationalsOfPowersOfPI(rr=1836.15267)[0]&&console.log("fail approxRationalsOfPowersOfPI: 1836.15267"),s=u=1;u<=13;s=++u)for(p=l=1;l<=13;p=++l)console.log("approxTrigonometric testing: 1 * sin( "+s+"/"+p+" * pi )"),e=s/p,rr=Math.sin(Math.PI*e),W=(X=approxTrigonometric(rr))[3]/X[4],z=X[2]*Math.sin(Math.PI*W),Math.abs(rr-z)>1e-15&&console.log("fail approxTrigonometric: 1 * sin( "+s+"/"+p+" * pi ) . obtained: "+X);for(s=_=1;_<=13;s=++_)for(p=T=1;T<=13;p=++T)5===s&&11===p||6===s&&11===p||(console.log("approxTrigonometric testing with 4 digits: 1 * sin( "+s+"/"+p+" * pi )"),e=s/p,rr=(M=Math.sin(Math.PI*e)).toFixed(4),W=(X=approxTrigonometric(rr))[3]/X[4],z=X[2]*Math.sin(Math.PI*W),(r=Math.abs(M-z))>1e-14&&console.log("fail approxTrigonometric with 4 digits: 1 * sin( "+s+"/"+p+" * pi ) . obtained: "+X+" error: "+r));return console.log("testApprox done")},$.approxRadicals=approxRadicals,$.approxRationalsOfLogs=approxRationalsOfLogs,$.approxAll=approxAll,$.testApprox=testApprox,Eval_arccos=function(){return push(cadr(p1)),Eval(),arccos()},arccos=function(){var r,e;if(0,r=0,save(),p1=pop(),car(p1)===symbol(COS))return push(cadr(p1)),void restore();if(isdouble(p1))return e=0,r=Math.acos(p1.d),e&&stop("arccos function argument is not in the interval [-1,1]"),push_double(r),void restore();if(isoneoversqrttwo(p1)||car(p1)===symbol(MULTIPLY)&&equalq(car(cdr(p1)),1,2)&&car(car(cdr(cdr(p1))))===symbol(POWER)&&equaln(car(cdr(car(cdr(cdr(p1))))),2)&&equalq(car(cdr(cdr(car(cdr(cdr(p1)))))),1,2))return evaluatingAsFloats?push_double(Math.PI/4):(push_rational(1,4),push_symbol(PI),multiply()),void restore();if(isminusoneoversqrttwo(p1)||car(p1)===symbol(MULTIPLY)&&equalq(car(cdr(p1)),-1,2)&&car(car(cdr(cdr(p1))))===symbol(POWER)&&equaln(car(cdr(car(cdr(cdr(p1))))),2)&&equalq(car(cdr(cdr(car(cdr(cdr(p1)))))),1,2))return evaluatingAsFloats?push_double(3*Math.PI/4):(push_rational(3,4),push_symbol(PI),multiply()),void restore();if(!isrational(p1))return push_symbol(ARCCOS),push(p1),list(2),void restore();switch(push(p1),push_integer(2),multiply(),pop_integer()){case-2:evaluatingAsFloats?push_double(Math.PI):push_symbol(PI);break;case-1:evaluatingAsFloats?push_double(2*Math.PI/3):(push_rational(2,3),push_symbol(PI),multiply());break;case 0:evaluatingAsFloats?push_double(Math.PI/2):(push_rational(1,2),push_symbol(PI),multiply());break;case 1:evaluatingAsFloats?push_double(Math.PI/3):(push_rational(1,3),push_symbol(PI),multiply());break;case 2:evaluatingAsFloats?push_double(0):push(zero);break;default:push_symbol(ARCCOS),push(p1),list(2)}return restore()},Eval_arccosh=function(){return push(cadr(p1)),Eval(),arccosh()},arccosh=function(){var r;return r=0,save(),p1=pop(),car(p1)===symbol(COSH)?(push(cadr(p1)),void restore()):isdouble(p1)?((r=p1.d)<1&&stop("arccosh function argument is less than 1.0"),r=Math.log(r+Math.sqrt(r*r-1)),push_double(r),void restore()):isplusone(p1)?(push(zero),void restore()):(push_symbol(ARCCOSH),push(p1),list(2),restore())},Eval_arcsin=function(){return push(cadr(p1)),Eval(),arcsin()},arcsin=function(){var r,e;if(0,r=0,save(),p1=pop(),car(p1)===symbol(SIN))return push(cadr(p1)),void restore();if(isdouble(p1))return e=0,r=Math.asin(p1.d),e&&stop("arcsin function argument is not in the interval [-1,1]"),push_double(r),void restore();if(isoneoversqrttwo(p1)||car(p1)===symbol(MULTIPLY)&&equalq(car(cdr(p1)),1,2)&&car(car(cdr(cdr(p1))))===symbol(POWER)&&equaln(car(cdr(car(cdr(cdr(p1))))),2)&&equalq(car(cdr(cdr(car(cdr(cdr(p1)))))),1,2))return push_rational(1,4),push_symbol(PI),multiply(),void restore();if(isminusoneoversqrttwo(p1)||car(p1)===symbol(MULTIPLY)&&equalq(car(cdr(p1)),-1,2)&&car(car(cdr(cdr(p1))))===symbol(POWER)&&equaln(car(cdr(car(cdr(cdr(p1))))),2)&&equalq(car(cdr(cdr(car(cdr(cdr(p1)))))),1,2))return evaluatingAsFloats?push_double(-Math.PI/4):(push_rational(-1,4),push_symbol(PI),multiply()),void restore();if(!isrational(p1))return push_symbol(ARCSIN),push(p1),list(2),void restore();switch(push(p1),push_integer(2),multiply(),pop_integer()){case-2:evaluatingAsFloats?push_double(-Math.PI/2):(push_rational(-1,2),push_symbol(PI),multiply());break;case-1:evaluatingAsFloats?push_double(-Math.PI/6):(push_rational(-1,6),push_symbol(PI),multiply());break;case 0:evaluatingAsFloats?push_double(0):push(zero);break;case 1:evaluatingAsFloats?push_double(Math.PI/6):(push_rational(1,6),push_symbol(PI),multiply());break;case 2:evaluatingAsFloats?push_double(Math.PI/2):(push_rational(1,2),push_symbol(PI),multiply());break;default:push_symbol(ARCSIN),push(p1),list(2)}return restore()},Eval_arcsinh=function(){return push(cadr(p1)),Eval(),arcsinh()},arcsinh=function(){var r;return r=0,save(),p1=pop(),car(p1)===symbol(SINH)?(push(cadr(p1)),void restore()):isdouble(p1)?(r=p1.d,r=Math.log(r+Math.sqrt(r*r+1)),push_double(r),void restore()):isZeroAtomOrTensor(p1)?(push(zero),void restore()):(push_symbol(ARCSINH),push(p1),list(2),restore())},Eval_arctan=function(){return push(cadr(p1)),Eval(),arctan()},arctan=function(){var r,e;return r=0,save(),p1=pop(),car(p1)===symbol(TAN)?(push(cadr(p1)),void restore()):isdouble(p1)?(e=0,r=Math.atan(p1.d),e&&stop("arctan function error"),push_double(r),void restore()):isZeroAtomOrTensor(p1)?(push(zero),void restore()):isnegative(p1)?(push(p1),negate(),arctan(),negate(),void restore()):Find(p1,symbol(SIN))&&Find(p1,symbol(COS))&&(push(p1),numerator(),p2=pop(),push(p1),denominator(),p3=pop(),car(p2)===symbol(SIN)&&car(p3)===symbol(COS)&&equal(cadr(p2),cadr(p3)))?(push(cadr(p2)),void restore()):car(p1)===symbol(POWER)&&equaln(cadr(p1),3)&&equalq(caddr(p1),-1,2)||car(p1)===symbol(MULTIPLY)&&equalq(car(cdr(p1)),1,3)&&car(car(cdr(cdr(p1))))===symbol(POWER)&&equaln(car(cdr(car(cdr(cdr(p1))))),3)&&equalq(car(cdr(cdr(car(cdr(cdr(p1)))))),1,2)?(push_rational(1,6),evaluatingAsFloats?push_double(Math.PI):push(symbol(PI)),multiply(),void restore()):equaln(p1,1)?(push_rational(1,4),evaluatingAsFloats?push_double(Math.PI):push(symbol(PI)),multiply(),void restore()):car(p1)===symbol(POWER)&&equaln(cadr(p1),3)&&equalq(caddr(p1),1,2)?(push_rational(1,3),evaluatingAsFloats?push_double(Math.PI):push(symbol(PI)),multiply(),void restore()):(push_symbol(ARCTAN),push(p1),list(2),restore())},Eval_arctanh=function(){return push(cadr(p1)),Eval(),arctanh()},arctanh=function(){var r;return r=0,save(),p1=pop(),car(p1)===symbol(TANH)?(push(cadr(p1)),void restore()):isdouble(p1)?(((r=p1.d)<-1||r>1)&&stop("arctanh function argument is not in the interval [-1,1]"),r=Math.log((1+r)/(1-r))/2,push_double(r),void restore()):isZeroAtomOrTensor(p1)?(push(zero),void restore()):(push_symbol(ARCTANH),push(p1),list(2),restore())},DEBUG_ARG=!1,Eval_arg=function(){return push(cadr(p1)),Eval(),arg()},arg=function(){return save(),p1=pop(),push(p1),numerator(),yyarg(),push(p1),denominator(),yyarg(),subtract(),restore()},yyarg=function(){if(save(),p1=pop(),ispositivenumber(p1)||p1===symbol(PI))isdouble(p1)||evaluatingAsFloats?push_double(0):push_integer(0);else if(isnegativenumber(p1))isdouble(p1)||evaluatingAsFloats?push_double(Math.PI):push(symbol(PI)),negate();else if(issymbol(p1))push_symbol(ARG),push(p1),list(2);else if(car(p1)===symbol(POWER)&&equaln(cadr(p1),-1))evaluatingAsFloats?push_double(Math.PI):push(symbol(PI)),push(caddr(p1)),multiply();else if(car(p1)===symbol(POWER)&&cadr(p1)===symbol(E))push(caddr(p1)),imag();else if(car(p1)===symbol(POWER)&&isoneovertwo(caddr(p1)))DEBUG_ARG&&console.log("arg of a sqrt: "+p1),push(cadr(p1)),arg(),DEBUG_ARG&&console.log(" = 1/2 * "+stack[tos-1]),push(caddr(p1)),multiply();else if(car(p1)===symbol(MULTIPLY))for(push_integer(0),p1=cdr(p1);iscons(p1);)push(car(p1)),arg(),add(),p1=cdr(p1);else car(p1)===symbol(ADD)?(push(p1),rect(),p1=pop(),push(p1),real(),p2=pop(),push(p1),imag(),p3=pop(),isZeroAtomOrTensor(p2)?(evaluatingAsFloats?push_double(Math.PI):push(symbol(PI)),isnegative(p3)&&negate()):(push(p3),push(p2),divide(),arctan(),isnegative(p2)&&(evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),isnegative(p3)?subtract():add()))):isZeroAtomOrTensor(get_binding(symbol(ASSUME_REAL_VARIABLES)))?(push_symbol(ARG),push(p1),list(2)):push_integer(0);return restore()},bake=function(){var r,e,s,o,t,n;if(r=0,0,0,0,0,0,expanding++,save(),p1=pop(),e=ispoly(p1,symbol(SYMBOL_S)),s=ispoly(p1,symbol(SYMBOL_T)),o=ispoly(p1,symbol(SYMBOL_X)),t=ispoly(p1,symbol(SYMBOL_Y)),n=ispoly(p1,symbol(SYMBOL_Z)),1===e&&0===s&&0===o&&0===t&&0===n)p2=symbol(SYMBOL_S),bake_poly();else if(0===e&&1===s&&0===o&&0===t&&0===n)p2=symbol(SYMBOL_T),bake_poly();else if(0===e&&0===s&&1===o&&0===t&&0===n)p2=symbol(SYMBOL_X),bake_poly();else if(0===e&&0===s&&0===o&&1===t&&0===n)p2=symbol(SYMBOL_Y),bake_poly();else if(0===e&&0===s&&0===o&&0===t&&1===n)p2=symbol(SYMBOL_Z),bake_poly();else if(iscons(p1)&&car(p1)!==symbol(FOR)){for(r=tos,push(car(p1)),p1=cdr(p1);iscons(p1);)push(car(p1)),bake(),p1=cdr(p1);list(tos-r)}else push(p1);return restore(),expanding--},polyform=function(){var r;if(r=0,save(),p2=pop(),p1=pop(),ispoly(p1,p2))bake_poly();else if(iscons(p1)){for(r=tos,push(car(p1)),p1=cdr(p1);iscons(p1);)push(car(p1)),push(p2),polyform(),p1=cdr(p1);list(tos-r)}else push(p1);return restore()},bake_poly=function(){var r,e,s,o,t,n;for(0,s=0,0,0,r=tos,push(p1),push(p2),o=coeff(),e=tos,s=n=o-1;n>=0;s=n+=-1)p1=stack[r+s],bake_poly_term(s);return(t=tos-e)>1&&(list(t),push(symbol(ADD)),swap(),cons()),p1=pop(),moveTos(tos-o),push(p1)},bake_poly_term=function(r){var e,s;if(0,0,!isZeroAtomOrTensor(p1)){if(0!==r){if(e=tos,car(p1)===symbol(MULTIPLY))for(p1=cdr(p1);iscons(p1);)push(car(p1)),p1=cdr(p1);else equaln(p1,1)||push(p1);return 1===r?push(p2):(push(symbol(POWER)),push(p2),push_integer(r),list(3)),(s=tos-e)>1?(list(s),push(symbol(MULTIPLY)),swap(),cons()):void 0}if(car(p1)===symbol(ADD))for(p1=cdr(p1);iscons(p1);)push(car(p1)),p1=cdr(p1);else push(p1)}},Eval_besselj=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),besselj()},besselj=function(){return save(),yybesselj(),restore()},yybesselj=function(){var r,e;if(r=0,0,p2=pop(),p1=pop(),push(p2),e=pop_integer(),isdouble(p1)&&!isNaN(e))return r=jn(e,p1.d),void push_double(r);if(isZeroAtomOrTensor(p1)&&isZeroAtomOrTensor(p2))push_integer(1);else{if(!isZeroAtomOrTensor(p1)||isNaN(e))return p2.k===NUM&&MEQUAL(p2.q.b,2)?MEQUAL(p2.q.a,1)?(evaluatingAsFloats?push_double(2/Math.PI):(push_integer(2),push_symbol(PI),divide()),push(p1),divide(),push_rational(1,2),power(),push(p1),sine(),void multiply()):MEQUAL(p2.q.a,-1)?(evaluatingAsFloats?push_double(2/Math.PI):(push_integer(2),push_symbol(PI),divide()),push(p1),divide(),push_rational(1,2),power(),push(p1),cosine(),void multiply()):(push_integer(MSIGN(p2.q.a)),p3=pop(),push_integer(2),push(p1),divide(),push(p2),push(p3),subtract(),multiply(),push(p1),push(p2),push(p3),subtract(),besselj(),multiply(),push(p1),push(p2),push_integer(2),push(p3),multiply(),subtract(),besselj(),void subtract()):isnegativeterm(p1)?(push(p1),negate(),push(p2),power(),push(p1),push(p2),negate(),power(),multiply(),push_symbol(BESSELJ),push(p1),negate(),push(p2),list(3),void multiply()):isnegativeterm(p2)?(push_integer(-1),push(p2),power(),push_symbol(BESSELJ),push(p1),push(p2),negate(),list(3),void multiply()):(push(symbol(BESSELJ)),push(p1),push(p2),list(3));push_integer(0)}},Eval_bessely=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),bessely()},bessely=function(){return save(),yybessely(),restore()},yybessely=function(){var r,e;return r=0,0,p2=pop(),p1=pop(),push(p2),e=pop_integer(),isdouble(p1)&&!isNaN(e)?(r=yn(e,p1.d),void push_double(r)):isnegativeterm(p2)?(push_integer(-1),push(p2),power(),push_symbol(BESSELY),push(p1),push(p2),negate(),list(3),void multiply()):(push_symbol(BESSELY),push(p1),push(p2),void list(3))},mint=function(r){return bigInt(r)},isSmall=function(r){return r.gt(Number.MIN_SAFE_INTEGER)&&r.lt(Number.MAX_SAFE_INTEGER)},setSignTo=function(r,e){if(r.isPositive()){if(e<0)return r.multiply(bigInt(-1))}else if(e>0)return r.multiply(bigInt(-1));return r},makeSignSameAs=function(r,e){if(r.isPositive()){if(e.isNegative())return r.multiply(bigInt(-1))}else if(e.isPositive())return r.multiply(bigInt(-1));return r},makePositive=function(r){return r.isNegative()?r.multiply(bigInt(-1)):r},add_numbers=function(){var r,e;if(r=1,e=1,!isrational(stack[tos-1])||!isrational(stack[tos-2]))return save(),p2=pop(),p1=pop(),r=isdouble(p1)?p1.d:convert_rational_to_double(p1),e=isdouble(p2)?p2.d:convert_rational_to_double(p2),push_double(r+e),restore();qadd()},subtract_numbers=function(){var r,e;if(r=0,e=0,!isrational(stack[tos-1])||!isrational(stack[tos-2]))return save(),p2=pop(),p1=pop(),r=isdouble(p1)?p1.d:convert_rational_to_double(p1),e=isdouble(p2)?p2.d:convert_rational_to_double(p2),push_double(r-e),restore();qsub()},multiply_numbers=function(){var r,e;if(r=0,e=0,!isrational(stack[tos-1])||!isrational(stack[tos-2]))return save(),p2=pop(),p1=pop(),r=isdouble(p1)?p1.d:convert_rational_to_double(p1),e=isdouble(p2)?p2.d:convert_rational_to_double(p2),push_double(r*e),restore();qmul()},divide_numbers=function(){var r,e;if(r=0,e=0,!isrational(stack[tos-1])||!isrational(stack[tos-2]))return save(),p2=pop(),p1=pop(),isZeroAtomOrTensor(p2)&&stop("divide by zero"),r=isdouble(p1)?p1.d:convert_rational_to_double(p1),e=isdouble(p2)?p2.d:convert_rational_to_double(p2),push_double(r/e),restore();qdiv()},invert_number=function(){var r,e;return save(),p1=pop(),isZeroAtomOrTensor(p1)&&stop("divide by zero"),isdouble(p1)?(push_double(1/p1.d),void restore()):(r=bigInt(p1.q.a),e=bigInt(p1.q.b),e=makeSignSameAs(e,r),r=setSignTo(r,1),(p1=new U).k=NUM,p1.q.a=e,p1.q.b=r,push(p1),restore())},compare_rationals=function(r,e){var s,o;return 0,s=mmul(r.q.a,e.q.b),o=mmul(r.q.b,e.q.a),mcmp(s,o)},compare_numbers=function(r,e){var s,o;return s=0,o=0,isrational(r)&&isrational(e)?compare_rationals(r,e):(s=isdouble(r)?r.d:convert_rational_to_double(r))<(o=isdouble(e)?e.d:convert_rational_to_double(e))?-1:s>o?1:0},negate_number=function(){if(save(),p1=pop(),isZeroAtomOrTensor(p1))return push(p1),void restore();switch(p1.k){case NUM:(p2=new U).k=NUM,p2.q.a=bigInt(p1.q.a.multiply(bigInt.minusOne)),p2.q.b=bigInt(p1.q.b),push(p2);break;case DOUBLE:push_double(-p1.d);break;default:stop("bug caught in mp_negate_number")}return restore()},bignum_truncate=function(){var r;return save(),p1=pop(),r=mdiv(p1.q.a,p1.q.b),(p1=new U).k=NUM,p1.q.a=r,p1.q.b=bigInt(1),push(p1),restore()},mp_numerator=function(){return save(),(p1=pop()).k!==NUM?(push(one),void restore()):((p2=new U).k=NUM,p2.q.a=bigInt(p1.q.a),p2.q.b=bigInt(1),push(p2),restore())},mp_denominator=function(){return save(),(p1=pop()).k!==NUM?(push(one),void restore()):((p2=new U).k=NUM,p2.q.a=bigInt(p1.q.b),p2.q.b=bigInt(1),push(p2),restore())},bignum_power_number=function(r){var e,s,o;return save(),p1=pop(),e=mpow(p1.q.a,Math.abs(r)),s=mpow(p1.q.b,Math.abs(r)),r<0&&(o=e,e=makeSignSameAs(e=s,s=o),s=setSignTo(s,1)),(p1=new U).k=NUM,p1.q.a=e,p1.q.b=s,push(p1),restore()},convert_bignum_to_double=function(r){return r.toJSNumber()},convert_rational_to_double=function(r){var e;return r.q,(e=r.q.a.divmod(r.q.b)).quotient+e.remainder/r.q.b.toJSNumber()},push_integer=function(r){return DEBUG&&console.log("pushing integer "+r),save(),(p1=new U).k=NUM,p1.q.a=bigInt(r),p1.q.b=bigInt(1),push(p1),restore()},push_double=function(r){return save(),(p1=new U).k=DOUBLE,p1.d=r,push(p1),restore()},push_rational=function(r,e){var s;return(s=new U).k=NUM,s.q.a=bigInt(r),s.q.b=bigInt(e),push(s)},pop_integer=function(){var r;switch(r=NaN,save(),(p1=pop()).k){case NUM:isinteger(p1)&&isSmall(p1.q.a)&&(r=p1.q.a.toJSNumber());break;case DOUBLE:DEBUG&&console.log("popping integer but double is found"),Math.floor(p1.d)===p1.d&&(DEBUG&&console.log("...altough it's an integer"),r=p1.d)}return restore(),r},print_double=function(r,e){var s,o;return s="",o=doubleToReasonableString(r.d),s+=print_str(1===e&&"-"===o?o+1:o)},bignum_scan_integer=function(r){var e,s,o;return save(),"+"!==(o=r[s=0])&&"-"!==o||s++,e=bigInt(r.substring(s)),(p1=new U).k=NUM,p1.q.a=e,p1.q.b=bigInt(1),push(p1),"-"===o&&negate(),restore()},bignum_scan_float=function(r){return push_double(parseFloat(r))},print_number=function(r,e){var s,o,t;switch(o="",t="","",r.k){case NUM:s=r.q.a.toString(),e||"-"===s[0]&&(s=s.substring(1)),printMode===PRINTMODE_LATEX&&isfraction(r)&&(s="\\frac{"+s+"}{"),o+=s,isfraction(r)&&(printMode!==PRINTMODE_LATEX&&(o+="/"),t=r.q.b.toString(),printMode===PRINTMODE_LATEX&&(t+="}"),o+=t);break;case DOUBLE:s=doubleToReasonableString(r.d),e||"-"===s[0]&&(s=s.substring(1)),o+=s}return o},gcd_numbers=function(){return save(),p2=pop(),p1=pop(),(p3=new U).k=NUM,p3.q.a=mgcd(p1.q.a,p2.q.a),p3.q.b=mgcd(p1.q.b,p2.q.b),p3.q.a=setSignTo(p3.q.a,1),push(p3),restore()},pop_double=function(){var r;switch(r=0,save(),(p1=pop()).k){case NUM:r=convert_rational_to_double(p1);break;case DOUBLE:r=p1.d;break;default:r=0}return restore(),r},bignum_float=function(){var r;return 0,r=convert_rational_to_double(pop()),push_double(r)},bignum_factorial=function(r){return save(),(p1=new U).k=NUM,p1.q.a=__factorial(r),p1.q.b=bigInt(1),push(p1),restore()},__factorial=function(r){var e,s,o,t,n;if(o=0,0===r||1===r)return e=bigInt(1);if(e=bigInt(2),s=bigInt(0),3<=r)for(o=t=3,n=r;3<=n?t<=n:t>=n;o=3<=n?++t:--t)s=bigInt(o),e=mmul(e,s);return e},mask=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,524288,1048576,2097152,4194304,8388608,16777216,33554432,67108864,134217728,268435456,536870912,1073741824,2147483648],mp_set_bit=function(r,e){return console.log("not implemented yet"),r[e/32]|=mask[e%32]},mp_clr_bit=function(r,e){return console.log("not implemented yet"),r[e/32]&=~mask[e%32]},mshiftright=function(r){return r.shiftRight()},Eval_binomial=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),binomial()},binomial=function(){return save(),ybinomial(),restore()},ybinomial=function(){if(p2=pop(),p1=pop(),0!==BINOM_check_args())return push(p1),factorial(),push(p2),factorial(),divide(),push(p1),push(p2),subtract(),factorial(),divide();push(zero)},BINOM_check_args=function(){return isNumericAtom(p1)&&lessp(p1,zero)?0:isNumericAtom(p2)&&lessp(p2,zero)?0:isNumericAtom(p1)&&isNumericAtom(p2)&&lessp(p1,p2)?0:1},Eval_ceiling=function(){return push(cadr(p1)),Eval(),ceiling()},ceiling=function(){return save(),yyceiling(),restore()},yyceiling=function(){var r;return r=0,p1=pop(),isNumericAtom(p1)?isdouble(p1)?(r=Math.ceil(p1.d),void push_double(r)):isinteger(p1)?void push(p1):((p3=new U).k=NUM,p3.q.a=mdiv(p1.q.a,p1.q.b),p3.q.b=mint(1),push(p3),isnegativenumber(p1)?1:(push_integer(1),add())):(push_symbol(CEILING),push(p1),void list(2))},Eval_choose=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),choose()},choose=function(){return save(),p2=pop(),p1=pop(),0===choose_check_args()?(push_integer(0),void restore()):(push(p1),factorial(),push(p2),factorial(),divide(),push(p1),push(p2),subtract(),factorial(),divide(),restore())},choose_check_args=function(){return isNumericAtom(p1)&&lessp(p1,zero)?0:isNumericAtom(p2)&&lessp(p2,zero)?0:isNumericAtom(p1)&&isNumericAtom(p2)&&lessp(p1,p2)?0:1},Eval_circexp=function(){return push(cadr(p1)),Eval(),circexp(),Eval()},circexp=function(){var r,e,s,o;if(e=0,r=0,save(),p1=pop(),car(p1)===symbol(COS))return push(cadr(p1)),expcos(),void restore();if(car(p1)===symbol(SIN))return push(cadr(p1)),expsin(),void restore();if(car(p1)===symbol(TAN))return p1=cadr(p1),push(imaginaryunit),push(p1),multiply(),exponential(),p2=pop(),push(imaginaryunit),push(p1),multiply(),negate(),exponential(),p3=pop(),push(p3),push(p2),subtract(),push(imaginaryunit),multiply(),push(p2),push(p3),add(),divide(),void restore();if(car(p1)===symbol(COSH))return p1=cadr(p1),push(p1),exponential(),push(p1),negate(),exponential(),add(),push_rational(1,2),multiply(),void restore();if(car(p1)===symbol(SINH))return p1=cadr(p1),push(p1),exponential(),push(p1),negate(),exponential(),subtract(),push_rational(1,2),multiply(),void restore();if(car(p1)===symbol(TANH))return p1=cadr(p1),push(p1),push_integer(2),multiply(),exponential(),p1=pop(),push(p1),push_integer(1),subtract(),push(p1),push_integer(1),add(),divide(),void restore();if(iscons(p1)){for(r=tos;iscons(p1);)push(car(p1)),circexp(),p1=cdr(p1);return list(tos-r),void restore()}if(p1.k===TENSOR){for(push(p1),copy_tensor(),e=s=0,o=(p1=pop()).tensor.nelem;0<=o?s<o:s>o;e=0<=o?++s:--s)push(p1.tensor.elem[e]),circexp(),p1.tensor.elem[e]=pop();return push(p1),void restore()}return push(p1),restore()},Eval_clearall=function(){return do_clearall(),push(symbol(NIL))},do_clearall=function(){return 0===test_flag&&clear_term(),do_clearPatterns(),clear_symbols(),defn(),codeGen=!1},clearall=function(){return run("clearall")},clearRenamedVariablesToAvoidBindingToExternalScope=function(){var r,e,s,o;for(o=[],r=e=0,s=symtab.length;0<=s?e<s:e>s;r=0<=s?++e:--e)-1!==symtab[r].printname.indexOf("AVOID_BINDING_TO_EXTERNAL_SCOPE_VALUE")?(symtab[r].k=SYM,symtab[r].printname="",binding[r]=symtab[r],o.push(isSymbolReclaimable[r]=!0)):o.push(void 0);return o},Eval_clear=function(){var r,e;for(p2=cdr(p1);iscons(p2);)(e=car(p2)).k!==SYM&&stop("symbol error"),r=symtab.indexOf(e),symtab[r].k=SYM,symtab[r].printname="",binding[r]=symtab[r],isSymbolReclaimable[r]=!0,p2=cdr(p2);return push(symbol(NIL))},DEBUG_CLOCKFORM=!1,Eval_clock=function(){return push(cadr(p1)),Eval(),clockform()},clockform=function(){return save(),p1=pop(),push(p1),abs(),DEBUG_CLOCKFORM&&console.log("clockform: abs of "+p1+" : "+stack[tos-1]),push_symbol(POWER),push_integer(-1),push(p1),arg(),DEBUG_CLOCKFORM&&console.log("clockform: arg of "+p1+" : "+stack[tos-1]),evaluatingAsFloats?push_double(Math.PI):push(symbol(PI)),divide(),DEBUG_CLOCKFORM&&console.log("clockform: divide : "+stack[tos-1]),list(3),DEBUG_CLOCKFORM&&console.log("clockform: power : "+stack[tos-1]),multiply(),DEBUG_CLOCKFORM&&console.log("clockform: multiply : "+stack[tos-1]),restore()},Eval_coeff=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),push(cadddr(p1)),Eval(),p3=pop(),p2=pop(),p1=pop(),p3===symbol(NIL)&&(p3=p2,p2=symbol(SYMBOL_X)),push(p1),push(p2),push(p3),power(),divide(),push(p2),filter()},coeff=function(){var r,e,s;for(save(),p2=pop(),p1=pop(),r=tos;;){if(push(p1),push(p2),push(zero),subst(),Eval(),p3=pop(),push(p3),push(p1),push(p3),subtract(),p1=pop(),equal(p1,zero))return e=tos-r,restore(),e;push(p1),push(p2),s=expanding,expanding=1,divide(),expanding=s,p1=pop()}},Eval_cofactor=function(){var r,e,s;return 0,0,0,push(cadr(p1)),Eval(),p2=pop(),istensor(p2)&&2===p2.tensor.ndim&&p2.tensor.dim[0]===p2.tensor.dim[1]?1:stop("cofactor: 1st arg: square matrix expected"),s=p2.tensor.dim[0],push(caddr(p1)),Eval(),((r=pop_integer())<1||r>s)&&stop("cofactor: 2nd arg: row index expected"),push(cadddr(p1)),Eval(),((e=pop_integer())<1||e>s)&&stop("cofactor: 3rd arg: column index expected"),cofactor(p2,s,r-1,e-1)},cofactor=function(r,e,s,o){var t,n,p,i,a,u;for(t=0,p=0,t=i=0,a=e;0<=a?i<a:i>a;t=0<=a?++i:--i)for(p=n=0,u=e;0<=u?n<u:n>u;p=0<=u?++n:--n)t!==s&&p!==o&&push(r.tensor.elem[e*t+p]);if(determinant(e-1),(s+o)%2)return negate()},Eval_condense=function(){return push(cadr(p1)),Eval(),Condense()},Condense=function(){var r;return r=expanding,expanding=0,save(),yycondense(),restore(),expanding=r},yycondense=function(){if(p1=pop(),car(p1)===symbol(ADD)){for(p3=cdr(p1),push(car(p3)),p3=cdr(p3);iscons(p3);)push(car(p3)),gcd(),p3=cdr(p3);for(inverse(),p2=pop(),push(zero),p3=cdr(p1);iscons(p3);)push(p2),push(car(p3)),multiply(),add(),p3=cdr(p3);return yyexpand(),push(p2),divide()}push(p1)},Eval_conj=function(){return push(cadr(p1)),Eval(),p1=pop(),push(p1),Find(p1,imaginaryunit)?conjugate():(polar(),conjugate(),clockform())},conjugate=function(){return push(imaginaryunit),push(imaginaryunit),negate(),subst(),Eval()},consCount=0,cons=function(){var r;return consCount++,DEBUG&&console.log("cons tos: "+tos+" # "+consCount),(r=new U).k=CONS,r.cons.cdr=pop(),r===r.cons.cdr&&console.log("something wrong p == its cdr"),r.cons.car=pop(),push(r)},Eval_contract=function(){return push(cadr(p1)),Eval(),cddr(p1)===symbol(NIL)?(push_integer(1),push_integer(2)):(push(caddr(p1)),Eval(),push(cadddr(p1)),Eval()),contract()},contract=function(){return save(),yycontract(),restore()},yycontract=function(){var r,e,s,o,t,n,p,i,a,u,l,c,d,_,m,f,h,g,b,y,E,v,x,A,T,O,I;if(t=0,n=0,i=0,u=0,l=0,d=0,0,0,g=0,e=[],s=[],p3=pop(),p2=pop(),p1=pop(),!istensor(p1))return isZeroAtomOrTensor(p1)||stop("contract: tensor expected, 1st arg is not a tensor"),void push(zero);for(push(p2),l=pop_integer(),push(p3),d=pop_integer(),h=p1.tensor.ndim,(l<1||l>h||d<1||d>h||l===d||p1.tensor.dim[l-1]!==p1.tensor.dim[d-1])&&stop("contract: index out of range"),l--,d--,m=p1.tensor.dim[l],g=1,n=b=0,E=h;0<=E?b<E:b>E;n=0<=E?++b:--b)n!==l&&n!==d&&(g*=p1.tensor.dim[n]);for((p2=alloc_tensor(g)).tensor.ndim=h-2,i=0,n=p=0,v=h;0<=v?p<v:p>v;n=0<=v?++p:--p)n!==l&&n!==d&&(p2.tensor.dim[i++]=p1.tensor.dim[n]);for(r=p1.tensor.elem,o=p2.tensor.elem,n=a=0,x=h;0<=x?a<x:a>x;n=0<=x?++a:--a)e[n]=0,s[n]=p1.tensor.dim[n];for(n=c=0,A=g;0<=A?c<A:c>A;n=0<=A?++c:--c){for(push(zero),i=_=0,T=m;0<=T?_<T:_>T;i=0<=T?++_:--_){for(e[l]=i,e[d]=i,t=0,u=f=0,O=h;0<=O?f<O:f>O;u=0<=O?++f:--f)t=t*s[u]+e[u];push(r[t]),add()}for(o[n]=pop(),i=y=I=h-1;I<=0?y<=0:y>=0;i=I<=0?++y:--y)if(i!==l&&i!==d){if(++e[i]<s[i])break;e[i]=0}}return push(1===g?o[0]:p2)},Eval_cos=function(){return push(cadr(p1)),Eval(),cosine()},cosine=function(){return save(),p1=pop(),car(p1)===symbol(ADD)?cosine_of_angle_sum():cosine_of_angle(),restore()},cosine_of_angle_sum=function(){for(p2=cdr(p1);iscons(p2);){if(p4=car(p2),isnpi(p4))return push(p1),push(p4),subtract(),p3=pop(),push(p3),cosine(),push(p4),cosine(),multiply(),push(p3),sine(),push(p4),sine(),multiply(),void subtract();p2=cdr(p2)}return cosine_of_angle()},cosine_of_angle=function(){var r,e;if(car(p1)!==symbol(ARCCOS)){if(isdouble(p1))return r=Math.cos(p1.d),Math.abs(r)<1e-10&&(r=0),void push_double(r);if(isnegative(p1)&&(push(p1),negate(),p1=pop()),car(p1)===symbol(ARCTAN))return push_integer(1),push(cadr(p1)),push_integer(2),power(),add(),push_rational(-1,2),void power();if(push(p1),push_integer(180),multiply(),evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),divide(),(e=pop_integer())<0||isNaN(e))return push(symbol(COS)),push(p1),void list(2);switch(e%360){case 90:case 270:return push_integer(0);case 60:case 300:return push_rational(1,2);case 120:case 240:return push_rational(-1,2);case 45:case 315:return push_rational(1,2),push_integer(2),push_rational(1,2),power(),multiply();case 135:case 225:return push_rational(-1,2),push_integer(2),push_rational(1,2),power(),multiply();case 30:case 330:return push_rational(1,2),push_integer(3),push_rational(1,2),power(),multiply();case 150:case 210:return push_rational(-1,2),push_integer(3),push_rational(1,2),power(),multiply();case 0:return push_integer(1);case 180:return push_integer(-1);default:return push(symbol(COS)),push(p1),list(2)}}else push(cadr(p1))},Eval_cosh=function(){return push(cadr(p1)),Eval(),ycosh()},ycosh=function(){return save(),yycosh(),restore()},yycosh=function(){var r;if(r=0,p1=pop(),car(p1)!==symbol(ARCCOSH)){if(isdouble(p1))return r=Math.cosh(p1.d),Math.abs(r)<1e-10&&(r=0),void push_double(r);if(!isZeroAtomOrTensor(p1))return push_symbol(COSH),push(p1),list(2);push(one)}else push(cadr(p1))},Eval_decomp=function(){var r;return save(),console.log("Eval_decomp is being called!!!!!!!!!!!!!!!!!!!!"),r=tos,push(symbol(NIL)),push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),(p1=pop())===symbol(NIL)?guess():push(p1),decomp(!1),list(tos-r),restore()},pushTryNotToDuplicate=function(r){if(!(tos>0&&(DEBUG&&console.log("comparing "+r+" to: "+stack[tos-1]),equal(r,stack[tos-1]))))return push(r);DEBUG&&console.log("skipping "+r+" because it's already on stack ")},decomp=function(r){if(save(),p2=pop(),p1=pop(),DEBUG&&console.log("DECOMPOSING "+p1),r){if(!iscons(p1))return DEBUG&&console.log(" ground thing: "+p1),pushTryNotToDuplicate(p1),void restore()}else if(0===Find(p1,p2))return DEBUG&&console.log(" entire expression is constant"),pushTryNotToDuplicate(p1),void restore();if(isadd(p1))return decomp_sum(r),void restore();if(ismultiply(p1))return decomp_product(r),void restore();for(DEBUG&&console.log(" naive decomp"),p3=cdr(p1),DEBUG&&console.log("startig p3: "+p3);iscons(p3);)r&&push(car(p3)),DEBUG&&console.log("recursive decomposition"),push(car(p3)),DEBUG&&console.log("car(p3): "+car(p3)),push(p2),DEBUG&&console.log("p2: "+p2),decomp(r),p3=cdr(p3);return restore()},decomp_sum=function(r){var e;for(DEBUG&&console.log(" decomposing the sum "),0,p3=cdr(p1);iscons(p3);)(Find(car(p3),p2)||r)&&(push(car(p3)),push(p2),decomp(r)),p3=cdr(p3);for(e=tos,p3=cdr(p1);iscons(p3);)0===Find(car(p3),p2)&&pushTryNotToDuplicate(car(p3)),p3=cdr(p3);if(tos-e)return add_all(tos-e),p3=pop(),pushTryNotToDuplicate(p3),push(p3),negate()},decomp_product=function(r){var e;for(DEBUG&&console.log(" decomposing the product "),0,p3=cdr(p1);iscons(p3);)(Find(car(p3),p2)||r)&&(push(car(p3)),push(p2),decomp(r)),p3=cdr(p3);for(e=tos,p3=cdr(p1);iscons(p3);)0===Find(car(p3),p2)&&pushTryNotToDuplicate(car(p3)),p3=cdr(p3);if(tos-e)return multiply_all(tos-e)},define_user_function=function(){return p3=caadr(p1),p4=cdadr(p1),p5=caddr(p1),issymbol(p3)||stop("function name?"),car(p5)===symbol(EVAL)&&(push(cadr(p5)),Eval(),p5=pop()),push_symbol(FUNCTION),push(p5),push(p4),list(3),p5=pop(),set_binding(p3,p5),push_symbol(NIL)},Eval_function_reference=function(){return push(p1)},Eval_defint=function(){for(push(cadr(p1)),Eval(),p2=pop(),p1=cddr(p1);iscons(p1);)push(car(p1)),p1=cdr(p1),Eval(),p3=pop(),push(car(p1)),p1=cdr(p1),Eval(),p4=pop(),push(car(p1)),p1=cdr(p1),Eval(),p5=pop(),push(p2),push(p3),integral(),p2=pop(),push(p2),push(p3),push(p5),subst(),Eval(),push(p2),push(p3),push(p4),subst(),Eval(),subtract(),p2=pop();return push(p2)},Eval_degree=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),(p1=pop())===symbol(NIL)?guess():push(p1),degree()},degree=function(){return save(),p2=pop(),p1=pop(),p3=zero,yydegree(p1),push(p3),restore()},yydegree=function(r){var e;if(equal(r,p2)){if(isZeroAtomOrTensor(p3))return p3=one}else if(car(r)===symbol(POWER)){if(equal(cadr(r),p2)&&isNumericAtom(caddr(r))&&lessp(p3,caddr(r)))return p3=caddr(r)}else if(iscons(r)){for(r=cdr(r),e=[];iscons(r);)yydegree(car(r)),e.push(r=cdr(r));return e}},Eval_denominator=function(){return push(cadr(p1)),Eval(),denominator()},denominator=function(){var r,e;if(r=0,e=pop(),car(e)===symbol(ADD)&&(push(e),rationalize(),e=pop()),car(e)!==symbol(MULTIPLY)||isplusone(car(cdr(e))))return isrational(e)?(push(e),mp_denominator()):car(e)===symbol(POWER)&&isnegativeterm(caddr(e))?(push(e),reciprocate()):push(one);for(r=tos,e=cdr(e);iscons(e);)push(car(e)),denominator(),e=cdr(e);return multiply_all(tos-r)},Eval_derivative=function(){var r,e,s,o,t;for(0,p1=cdr(p1),push(car(p1)),Eval(),p1=cdr(p1),push(car(p1)),Eval(),(p2=pop())===symbol(NIL)?(guess(),push(symbol(NIL))):isNumericAtom(p2)?(guess(),push(p2)):(push(p2),p1=cdr(p1),push(car(p1)),Eval()),p5=pop(),p4=pop(),p3=pop();;){if(isNumericAtom(p5)?(push(p5),e=pop_integer(),isNaN(e)&&stop("nth derivative: check n")):e=1,push(p3),e>=0)for(s=0,o=e;0<=o?s<o:s>o;0<=o?++s:--s)push(p4),derivative();else for(r=0,t=e=-e;0<=t?r<t:r>t;0<=t?++r:--r)push(p4),integral();if(p3=pop(),p5===symbol(NIL))break;if(isNumericAtom(p5)){if(p1=cdr(p1),push(car(p1)),Eval(),(p5=pop())===symbol(NIL))break;isNumericAtom(p5)?1:(p4=p5,p1=cdr(p1),push(car(p1)),Eval(),p5=pop())}else p4=p5,p1=cdr(p1),push(car(p1)),Eval(),p5=pop()}return push(p3)},derivative=function(){return save(),p2=pop(),p1=pop(),isNumericAtom(p2)&&stop("undefined function"),istensor(p1)?istensor(p2)?d_tensor_tensor():d_tensor_scalar():istensor(p2)?d_scalar_tensor():d_scalar_scalar(),restore()},d_scalar_scalar=function(){return issymbol(p2)?d_scalar_scalar_1():(push(p1),push(p2),push(symbol(SECRETX)),subst(),push(symbol(SECRETX)),derivative(),push(symbol(SECRETX)),push(p2),subst())},d_scalar_scalar_1=function(){if(equal(p1,p2))push(one);else if(iscons(p1))if(isadd(p1))dsum();else if(car(p1)!==symbol(MULTIPLY))if(car(p1)!==symbol(POWER))if(car(p1)!==symbol(DERIVATIVE))if(car(p1)!==symbol(LOG))if(car(p1)!==symbol(SIN))if(car(p1)!==symbol(COS))if(car(p1)!==symbol(TAN))if(car(p1)!==symbol(ARCSIN))if(car(p1)!==symbol(ARCCOS))if(car(p1)!==symbol(ARCTAN))if(car(p1)!==symbol(SINH))if(car(p1)!==symbol(COSH))if(car(p1)!==symbol(TANH))if(car(p1)!==symbol(ARCSINH))if(car(p1)!==symbol(ARCCOSH))if(car(p1)!==symbol(ARCTANH))if(car(p1)!==symbol(ABS))if(car(p1)!==symbol(SGN))if(car(p1)!==symbol(HERMITE))if(car(p1)!==symbol(ERF))if(car(p1)!==symbol(ERFC))if(car(p1)!==symbol(BESSELJ))if(car(p1)!==symbol(BESSELY)){if(car(p1)!==symbol(INTEGRAL)||caddr(p1)!==p2)return dfunction();derivative_of_integral()}else isZeroAtomOrTensor(caddr(p1))?dbessely0():dbesselyn();else isZeroAtomOrTensor(caddr(p1))?dbesselj0():dbesseljn();else derfc();else derf();else dhermite();else dsgn();else dabs();else darctanh();else darccosh();else darcsinh();else dtanh();else dcosh();else dsinh();else darctan();else darccos();else darcsin();else dtan();else dcos();else dsin();else dlog();else dd();else dpower();else dproduct();else push(zero)},dsum=function(){var r;for(r=tos,p1=cdr(p1);iscons(p1);)push(car(p1)),push(p2),derivative(),p1=cdr(p1);return add_all(tos-r)},dproduct=function(){var r,e,s,o,t,n,p;for(r=0,s=0,0,r=t=0,n=o=length(p1)-1;0<=n?t<n:t>n;r=0<=n?++t:--t){for(p3=cdr(p1),s=e=0,p=o;0<=p?e<p:e>p;s=0<=p?++e:--e)push(car(p3)),r===s&&(push(p2),derivative()),p3=cdr(p3);multiply_all(o)}return add_all(o)},dpower=function(){return push(caddr(p1)),push(cadr(p1)),divide(),push(cadr(p1)),push(p2),derivative(),multiply(),push(cadr(p1)),logarithm(),push(caddr(p1)),push(p2),derivative(),multiply(),add(),push(p1),multiply()},dlog=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),divide()},dd=function(){return push(cadr(p1)),push(p2),derivative(),p3=pop(),car(p3)===symbol(DERIVATIVE)?(push_symbol(DERIVATIVE),push_symbol(DERIVATIVE),push(cadr(p3)),lessp(caddr(p3),caddr(p1))?(push(caddr(p3)),list(3),push(caddr(p1))):(push(caddr(p1)),list(3),push(caddr(p3))),list(3)):(push(p3),push(caddr(p1)),derivative())},dfunction=function(){return(p3=cdr(p1))===symbol(NIL)||Find(p3,p2)?(push_symbol(DERIVATIVE),push(p1),push(p2),list(3)):push(zero)},dsin=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),cosine(),multiply()},dcos=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),sine(),multiply(),negate()},dtan=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),cosine(),push_integer(-2),power(),multiply()},darcsin=function(){return push(cadr(p1)),push(p2),derivative(),push_integer(1),push(cadr(p1)),push_integer(2),power(),subtract(),push_rational(-1,2),power(),multiply()},darccos=function(){return push(cadr(p1)),push(p2),derivative(),push_integer(1),push(cadr(p1)),push_integer(2),power(),subtract(),push_rational(-1,2),power(),multiply(),negate()},darctan=function(){return push(cadr(p1)),push(p2),derivative(),push_integer(1),push(cadr(p1)),push_integer(2),power(),add(),inverse(),multiply(),simplify()},dsinh=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),ycosh(),multiply()},dcosh=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),ysinh(),multiply()},dtanh=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),ycosh(),push_integer(-2),power(),multiply()},darcsinh=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),push_integer(2),power(),push_integer(1),add(),push_rational(-1,2),power(),multiply()},darccosh=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),push_integer(2),power(),push_integer(-1),add(),push_rational(-1,2),power(),multiply()},darctanh=function(){return push(cadr(p1)),push(p2),derivative(),push_integer(1),push(cadr(p1)),push_integer(2),power(),subtract(),inverse(),multiply()},dabs=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),sgn(),multiply()},dsgn=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),dirac(),multiply(),push_integer(2),multiply()},dhermite=function(){return push(cadr(p1)),push(p2),derivative(),push_integer(2),push(caddr(p1)),multiply(),multiply(),push(cadr(p1)),push(caddr(p1)),push_integer(-1),add(),hermite(),multiply()},derf=function(){return push(cadr(p1)),push_integer(2),power(),push_integer(-1),multiply(),exponential(),evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),push_rational(-1,2),power(),multiply(),push_integer(2),multiply(),push(cadr(p1)),push(p2),derivative(),multiply()},derfc=function(){return push(cadr(p1)),push_integer(2),power(),push_integer(-1),multiply(),exponential(),evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),push_rational(-1,2),power(),multiply(),push_integer(-2),multiply(),push(cadr(p1)),push(p2),derivative(),multiply()},dbesselj0=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),push_integer(1),besselj(),multiply(),push_integer(-1),multiply()},dbesseljn=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),push(caddr(p1)),push_integer(-1),add(),besselj(),push(caddr(p1)),push_integer(-1),multiply(),push(cadr(p1)),divide(),push(cadr(p1)),push(caddr(p1)),besselj(),multiply(),add(),multiply()},dbessely0=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),push_integer(1),besselj(),multiply(),push_integer(-1),multiply()},dbesselyn=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),push(caddr(p1)),push_integer(-1),add(),bessely(),push(caddr(p1)),push_integer(-1),multiply(),push(cadr(p1)),divide(),push(cadr(p1)),push(caddr(p1)),bessely(),multiply(),add(),multiply()},derivative_of_integral=function(){return push(cadr(p1))},DET_check_arg=function(){return istensor(p1)?2!==p1.tensor.ndim?0:p1.tensor.dim[0]!==p1.tensor.dim[1]?0:1:0},det=function(){var r,e,s,o,t,n,p;if(e=0,0,save(),p1=pop(),0===DET_check_arg())return push_symbol(DET),push(p1),list(2),void restore();for(o=p1.tensor.nelem,r=p1.tensor.elem,e=t=0,n=o;(0<=n?t<n:t>n)&&isNumericAtom(r[e]);e=0<=n?++t:--t);if(e===o)yydetg();else{for(e=s=0,p=p1.tensor.nelem;0<=p?s<p:s>p;e=0<=p?++s:--s)push(p1.tensor.elem[e]);determinant(p1.tensor.dim[0])}return restore()},determinant=function(r){var e,s,o,t,n,p,i,a,u,l,c,d,_,m;for(0,t=0,p=0,i=0,u=0,d=0,_=0,m=0,e=[],o=tos-r*r,t=a=0,l=r;0<=l?a<l:a>l;t=0<=l?++a:--a)e[t]=t,e[t+r]=0,e[t+r+r]=1;for(_=1,push(zero);;){for(push_integer(1===_?1:-1),t=n=0,c=r;0<=c?n<c:n>c;t=0<=c?++n:--n)i=r*e[t]+t,push(stack[o+i]),multiply();for(add(),p=r-1,d=0,s=!1;;)if((u=e[r+p]+e[r+r+p])<0)e[r+r+p]=-e[r+r+p],p--;else{if(u!==p+1)break;if(0===p){s=!0;break}d++,e[r+r+p]=-e[r+r+p],p--}if(s)break;m=e[p-e[r+p]+d],e[p-e[r+p]+d]=e[p-u+d],e[p-u+d]=m,e[r+p]=u,_=-_}return stack[o]=stack[tos-1],moveTos(o+1)},detg=function(){return save(),p1=pop(),0===DET_check_arg()?(push_symbol(DET),push(p1),list(2),void restore()):(yydetg(),restore())},yydetg=function(){var r,e,s,o;for(r=0,0,r=s=0,o=(e=p1.tensor.dim[0])*e;0<=o?s<o:s>o;r=0<=o?++s:--s)push(p1.tensor.elem[r]);return lu_decomp(e),moveTos(tos-e*e),push(p1)},M=function(r,e,s,o){return stack[r+e*s+o]},setM=function(r,e,s,o,t){return stack[r+e*s+o]=t},lu_decomp=function(r){var e,s,o,t,n,p,i,a,u,l,c,d,_,m,f,h,g,b;for(e=0,0,o=0,n=0,s=tos-r*r,p1=one,e=u=0,l=r-1;0<=l?u<l:u>l;e=0<=l?++u:--u){if(equal(M(s,r,e,e),zero)){for(o=t=c=e+1,d=r;(c<=d?t<d:t>d)&&equal(M(s,r,o,e),zero);o=c<=d?++t:--t);if(o===r){p1=zero;break}for(n=p=_=e,m=r;_<=m?p<m:p>m;n=_<=m?++p:--p)p2=M(s,r,e,n),setM(s,r,e,n,M(s,r,o,n)),setM(s,r,o,n,p2);push(p1),negate(),p1=pop()}for(push(p1),push(M(s,r,e,e)),multiply(),p1=pop(),o=i=f=e+1,h=r;f<=h?i<h:i>h;o=f<=h?++i:--i)for(push(M(s,r,o,e)),push(M(s,r,e,e)),divide(),negate(),p2=pop(),setM(s,r,o,e,zero),n=a=g=e+1,b=r;g<=b?a<b:a>b;n=g<=b?++a:--a)push(M(s,r,e,n)),push(p2),multiply(),push(M(s,r,o,n)),add(),setM(s,r,o,n,pop())}return push(p1),push(M(s,r,r-1,r-1)),multiply(),p1=pop()},Eval_dirac=function(){return push(cadr(p1)),Eval(),dirac()},dirac=function(){return save(),ydirac(),restore()},ydirac=function(){return p1=pop(),isdouble(p1)?0===p1.d?void push_integer(1):void push_integer(0):isrational(p1)?MZERO(mmul(p1.q.a,p1.q.b))?void push_integer(1):void push_integer(0):car(p1)===symbol(POWER)?(push_symbol(DIRAC),push(cadr(p1)),void list(2)):isnegativeterm(p1)?(push_symbol(DIRAC),push(p1),negate(),void list(2)):((isnegativeterm(p1)||car(p1)===symbol(ADD)&&isnegativeterm(cadr(p1)))&&(push(p1),negate(),p1=pop()),push_symbol(DIRAC),push(p1),list(2))},divisors=function(){var r,e,s,o,t,n;for(e=0,0,0,save(),r=tos-1,divisors_onstack(),s=tos-r,(n=stack.slice(r,r+s)).sort(cmp_expr),stack=stack.slice(0,r).concat(n).concat(stack.slice(r+s)),(p1=alloc_tensor(s)).tensor.ndim=1,p1.tensor.dim[0]=s,e=o=0,t=s;0<=t?o<t:o>t;e=0<=t?++o:--o)p1.tensor.elem[e]=stack[r+e];return moveTos(r),push(p1),restore()},divisors_onstack=function(){var r,e,s,o,t,n;if(0,e=0,0,0,save(),p1=pop(),r=tos,isNumericAtom(p1))push(p1),factor_small_number();else if(car(p1)===symbol(ADD))push(p1),__factor_add();else if(car(p1)===symbol(MULTIPLY))for(p1=cdr(p1),isNumericAtom(car(p1))&&(push(car(p1)),factor_small_number(),p1=cdr(p1));iscons(p1);)p2=car(p1),car(p2)===symbol(POWER)?(push(cadr(p2)),push(caddr(p2))):(push(p2),push(one)),p1=cdr(p1);else car(p1)===symbol(POWER)?(push(cadr(p1)),push(caddr(p1))):(push(p1),push(one));for(s=tos,push(one),gen(r,s),e=t=0,n=o=tos-s;0<=n?t<n:t>n;e=0<=n?++t:--t)stack[r+e]=stack[s+e];return moveTos(r+o),restore()},gen=function(r,e){var s,o,t,n;if(0,o=0,save(),p1=pop(),r===e)return push(p1),void restore();if(p2=stack[r+0],p3=stack[r+1],push(p3),s=pop_integer(),!isNaN(s))for(o=t=0,n=Math.abs(s);0<=n?t<=n:t>=n;o=0<=n?++t:--t)push(p1),push(p2),push_integer(sign(s)*o),power(),multiply(),gen(r+2,e);return restore()},__factor_add=function(){for(save(),p1=pop(),p3=cdr(p1),push(car(p3)),p3=cdr(p3);iscons(p3);)push(car(p3)),gcd(),p3=cdr(p3);if(p2=pop(),isplusone(p2))return push(p1),push(one),void restore();if(isNumericAtom(p2))push(p2),factor_small_number();else if(car(p2)===symbol(MULTIPLY))for(p3=cdr(p2),isNumericAtom(car(p3))?(push(car(p3)),factor_small_number()):(push(car(p3)),push(one)),p3=cdr(p3);iscons(p3);)push(car(p3)),push(one),p3=cdr(p3);else push(p2),push(one);for(push(p2),inverse(),p2=pop(),push(zero),p3=cdr(p1);iscons(p3);)push(p2),push(car(p3)),multiply(),add(),p3=cdr(p3);return push(one),restore()},dpow=function(){var r,e,s,o,t,n;return r=0,e=0,0,0,t=0,0,o=pop_double(),0===(s=pop_double())&&o<0&&stop("divide by zero"),s>=0||o%1==0?(t=Math.pow(s,o),void push_double(t)):(t=Math.pow(Math.abs(s),o),n=Math.PI*o,o%.5==0?(r=0,e=Math.sin(n)):(r=Math.cos(n),e=Math.sin(n)),push_double(r*t),push_double(e*t),push(imaginaryunit),multiply(),add())},EIG_N=0,EIG_yydd=[],EIG_yyqq=[],Eval_eigen=function(){return 0===EIG_check_arg()&&stop("eigen: argument is not a square matrix"),eigen(EIGEN),p1=usr_symbol("D"),set_binding(p1,p2),p1=usr_symbol("Q"),set_binding(p1,p3),push(symbol(NIL))},Eval_eigenval=function(){return 0===EIG_check_arg()?(push_symbol(EIGENVAL),push(p1),void list(2)):(eigen(EIGENVAL),push(p2))},Eval_eigenvec=function(){return 0===EIG_check_arg()?(push_symbol(EIGENVEC),push(p1),void list(2)):(eigen(EIGENVEC),push(p3))},EIG_check_arg=function(){var r,e,s,o,t,n,p,i,a,u,l;if(r=0,s=0,push(cadr(p1)),Eval(),yyfloat(),Eval(),p1=pop(),!istensor(p1))return 0;for(2===p1.tensor.ndim&&p1.tensor.dim[0]===p1.tensor.dim[1]||stop("eigen: argument is not a square matrix"),r=n=0,p=EIG_N=p1.tensor.dim[0];0<=p?n<p:n>p;r=0<=p?++n:--n)for(s=e=0,i=EIG_N;0<=i?e<i:e>i;s=0<=i?++e:--e)isdouble(p1.tensor.elem[EIG_N*r+s])||stop("eigen: matrix is not numerical");for(r=o=0,a=EIG_N-1;0<=a?o<a:o>a;r=0<=a?++o:--o)for(s=t=u=r+1,l=EIG_N;u<=l?t<l:t>l;s=u<=l?++t:--t)Math.abs(p1.tensor.elem[EIG_N*r+s].d-p1.tensor.elem[EIG_N*s+r].d)>1e-10&&stop("eigen: matrix is not symmetrical");return 1},eigen=function(r){var e,s,o,t,n,p,i,a,u,l,c,d,_,m,f,h,g,b,y,E,v,x,A,T;for(e=0,o=0,e=a=0,d=EIG_N*EIG_N;0<=d?a<d:a>d;e=0<=d?++a:--a)EIG_yydd[e]=0;for(e=s=0,_=EIG_N*EIG_N;0<=_?s<_:s>_;e=0<=_?++s:--s)EIG_yyqq[e]=0;for(e=t=0,f=EIG_N;0<=f?t<f:t>f;e=0<=f?++t:--t)for(EIG_yydd[EIG_N*e+e]=p1.tensor.elem[EIG_N*e+e].d,o=n=h=e+1,g=EIG_N;h<=g?n<g:n>g;o=h<=g?++n:--n)EIG_yydd[EIG_N*e+o]=p1.tensor.elem[EIG_N*e+o].d,EIG_yydd[EIG_N*o+e]=p1.tensor.elem[EIG_N*e+o].d;for(e=p=0,b=EIG_N;0<=b?p<b:p>b;e=0<=b?++p:--p)for(EIG_yyqq[EIG_N*e+e]=1,o=i=y=e+1,E=EIG_N;y<=E?i<E:i>E;o=y<=E?++i:--i)EIG_yyqq[EIG_N*e+o]=0,EIG_yyqq[EIG_N*o+e]=0;for(e=u=0;u<100&&0!==step();e=++u);if(100===e&&printstr("\nnote: eigen did not converge\n"),r===EIGEN||r===EIGENVAL)for(push(p1),copy_tensor(),p2=pop(),e=l=0,v=EIG_N;0<=v?l<v:l>v;e=0<=v?++l:--l)for(o=c=0,x=EIG_N;0<=x?c<x:c>x;o=0<=x?++c:--c)push_double(EIG_yydd[EIG_N*e+o]),p2.tensor.elem[EIG_N*e+o]=pop();if(r===EIGEN||r===EIGENVEC){for(push(p1),copy_tensor(),p3=pop(),A=[],e=T=0,m=EIG_N;0<=m?T<m:T>m;e=0<=m?++T:--T)A.push(function(){var r,s,t;for(s=[],o=t=0,r=EIG_N;0<=r?t<r:t>r;o=0<=r?++t:--t)push_double(EIG_yyqq[EIG_N*e+o]),s.push(p3.tensor.elem[EIG_N*e+o]=pop());return s}());return A}},step=function(){var r,e,s,o,t,n,p,i;for(e=0,o=0,r=0,e=t=0,n=EIG_N-1;0<=n?t<n:t>n;e=0<=n?++t:--t)for(o=s=p=e+1,i=EIG_N;p<=i?s<i:s>i;o=p<=i?++s:--s)0!==EIG_yydd[EIG_N*e+o]&&(step2(e,o),r++);return r},step2=function(r,e){var s,o,t,n,p,i,a,u,l,c,d,_,m;for(p=0,_=0,0,0,o=0,0,d=0,m=.5*(EIG_yydd[EIG_N*r+r]-EIG_yydd[EIG_N*e+e])/EIG_yydd[EIG_N*r+e],_=1/(Math.abs(m)+Math.sqrt(m*m+1)),m<0&&(_=-_),c=_*(s=1/Math.sqrt(_*_+1)),p=i=0,a=EIG_N;0<=a?i<a:i>a;p=0<=a?++i:--i)o=EIG_yydd[EIG_N*r+p],d=EIG_yydd[EIG_N*e+p],EIG_yydd[EIG_N*r+p]=s*o+c*d,EIG_yydd[EIG_N*e+p]=s*d-c*o;for(p=t=0,u=EIG_N;0<=u?t<u:t>u;p=0<=u?++t:--t)o=EIG_yydd[EIG_N*p+r],d=EIG_yydd[EIG_N*p+e],EIG_yydd[EIG_N*p+r]=s*o+c*d,EIG_yydd[EIG_N*p+e]=s*d-c*o;for(p=n=0,l=EIG_N;0<=l?n<l:n>l;p=0<=l?++n:--n)o=EIG_yyqq[EIG_N*r+p],d=EIG_yyqq[EIG_N*e+p],EIG_yyqq[EIG_N*r+p]=s*o+c*d,EIG_yyqq[EIG_N*e+p]=s*d-c*o;return EIG_yydd[EIG_N*r+e]=0,EIG_yydd[EIG_N*e+r]=0},Eval_erf=function(){return push(cadr(p1)),Eval(),yerf()},yerf=function(){return save(),yyerf(),restore()},yyerf=function(){var r;return r=0,p1=pop(),isdouble(p1)?(r=1-erfc(p1.d),void push_double(r)):isnegativeterm(p1)?(push_symbol(ERF),push(p1),negate(),list(2),void negate()):(push_symbol(ERF),push(p1),void list(2))},Eval_erfc=function(){return push(cadr(p1)),Eval(),yerfc()},yerfc=function(){return save(),yyerfc(),restore()},yyerfc=function(){var r;if(r=0,p1=pop(),isdouble(p1))return r=erfc(p1.d),void push_double(r);push_symbol(ERFC),push(p1),list(2)},erfc=function(r){var e,s,o;return 0,0,0,e=(s=1/(1+.5*(o=Math.abs(r))))*Math.exp(-o*o-1.26551223+s*(1.00002368+s*(.37409196+s*(.09678418+s*(s*(.27886807+s*(s*(1.48851587+s*(.17087277*s-.82215223))-1.13520398))-.18628806))))),r>=0?e:2-e},Eval=function(){var r;switch(check_esc_flag(),save(),p1=pop(),!evaluatingAsFloats&&isfloating(p1)&&(r=!0,evaluatingAsFloats++),p1.k){case CONS:Eval_cons();break;case NUM:evaluatingAsFloats?push_double(convert_rational_to_double(p1)):push(p1);break;case DOUBLE:case STR:push(p1);break;case TENSOR:Eval_tensor();break;case SYM:Eval_sym();break;default:stop("atom?")}return r&&evaluatingAsFloats--,restore()},Eval_sym=function(){var r,e,s,o,t,n;if(iskeyword(p1))return push(p1),push(symbol(LAST)),list(2),void Eval();if(p1===symbol(PI)&&evaluatingAsFloats)push_double(Math.PI);else if(p2=get_binding(p1),DEBUG&&console.log("looked up: "+p1+" which contains: "+p2),push(p2),p1!==p2){if(-1!==(o=chainOfUserSymbolsNotFunctionsBeingEvaluated.indexOf(p1))){for(r="",e=s=t=o,n=chainOfUserSymbolsNotFunctionsBeingEvaluated.length;t<=n?s<n:s>n;e=t<=n?++s:--s)r+=chainOfUserSymbolsNotFunctionsBeingEvaluated[e].printname+" -> ";return r+=p1.printname,void stop("recursive evaluation of symbols: "+r)}return chainOfUserSymbolsNotFunctionsBeingEvaluated.push(p1),Eval(),chainOfUserSymbolsNotFunctionsBeingEvaluated.pop()}},Eval_cons=function(){var r;if(r=car(p1),car(r)!==symbol(EVAL))switch(issymbol(r)||stop("cons?"),symnum(r)){case ABS:return Eval_abs();case ADD:return Eval_add();case ADJ:return Eval_adj();case AND:return Eval_and();case ARCCOS:return Eval_arccos();case ARCCOSH:return Eval_arccosh();case ARCSIN:return Eval_arcsin();case ARCSINH:return Eval_arcsinh();case ARCTAN:return Eval_arctan();case ARCTANH:return Eval_arctanh();case ARG:return Eval_arg();case ATOMIZE:return Eval_atomize();case BESSELJ:return Eval_besselj();case BESSELY:return Eval_bessely();case BINDING:return Eval_binding();case BINOMIAL:return Eval_binomial();case CEILING:return Eval_ceiling();case CHECK:return Eval_check();case CHOOSE:return Eval_choose();case CIRCEXP:return Eval_circexp();case CLEAR:return Eval_clear();case CLEARALL:return Eval_clearall();case CLEARPATTERNS:return Eval_clearpatterns();case CLOCK:return Eval_clock();case COEFF:return Eval_coeff();case COFACTOR:return Eval_cofactor();case CONDENSE:return Eval_condense();case CONJ:return Eval_conj();case CONTRACT:return Eval_contract();case COS:return Eval_cos();case COSH:return Eval_cosh();case DECOMP:return Eval_decomp();case DEGREE:return Eval_degree();case DEFINT:return Eval_defint();case DENOMINATOR:return Eval_denominator();case DERIVATIVE:return Eval_derivative();case DET:return Eval_det();case DIM:return Eval_dim();case DIRAC:return Eval_dirac();case DIVISORS:return Eval_divisors();case DO:return Eval_do();case DOT:return Eval_inner();case DRAW:return Eval_draw();case DSOLVE:return Eval_dsolve();case EIGEN:return Eval_eigen();case EIGENVAL:return Eval_eigenval();case EIGENVEC:return Eval_eigenvec();case ERF:return Eval_erf();case ERFC:return Eval_erfc();case EVAL:return Eval_Eval();case EXP:return Eval_exp();case EXPAND:return Eval_expand();case EXPCOS:return Eval_expcos();case EXPSIN:return Eval_expsin();case FACTOR:return Eval_factor();case FACTORIAL:return Eval_factorial();case FACTORPOLY:return Eval_factorpoly();case FILTER:return Eval_filter();case FLOATF:return Eval_float();case APPROXRATIO:return Eval_approxratio();case FLOOR:return Eval_floor();case FOR:return Eval_for();case FUNCTION:return Eval_function_reference();case GAMMA:return Eval_gamma();case GCD:return Eval_gcd();case HERMITE:return Eval_hermite();case HILBERT:return Eval_hilbert();case IMAG:return Eval_imag();case INDEX:return Eval_index();case INNER:return Eval_inner();case INTEGRAL:return Eval_integral();case INV:return Eval_inv();case INVG:return Eval_invg();case ISINTEGER:return Eval_isinteger();case ISPRIME:return Eval_isprime();case LAGUERRE:return Eval_laguerre();case LCM:return Eval_lcm();case LEADING:return Eval_leading();case LEGENDRE:return Eval_legendre();case LOG:return Eval_log();case LOOKUP:return Eval_lookup();case MOD:return Eval_mod();case MULTIPLY:return Eval_multiply();case NOT:return Eval_not();case NROOTS:return Eval_nroots();case NUMBER:return Eval_number();case NUMERATOR:return Eval_numerator();case OPERATOR:return Eval_operator();case OR:return Eval_or();case OUTER:return Eval_outer();case PATTERN:return Eval_pattern();case PATTERNSINFO:return Eval_patternsinfo();case POLAR:return Eval_polar();case POWER:return Eval_power();case PRIME:return Eval_prime();case PRINT:return Eval_print();case PRINT2DASCII:return Eval_print2dascii();case PRINTFULL:return Eval_printcomputer();case PRINTLATEX:return Eval_printlatex();case PRINTLIST:return Eval_printlist();case PRINTPLAIN:return Eval_printhuman();case PRODUCT:return Eval_product();case QUOTE:return Eval_quote();case QUOTIENT:return Eval_quotient();case RANK:return Eval_rank();case RATIONALIZE:return Eval_rationalize();case REAL:return Eval_real();case ROUND:return Eval_round();case YYRECT:return Eval_rect();case ROOTS:return Eval_roots();case SETQ:return Eval_setq();case SGN:return Eval_sgn();case SILENTPATTERN:return Eval_silentpattern();case SIMPLIFY:return Eval_simplify();case SIN:return Eval_sin();case SINH:return Eval_sinh();case SHAPE:return Eval_shape();case SQRT:return Eval_sqrt();case STOP:return Eval_stop();case SUBST:return Eval_subst();case SUM:return Eval_sum();case SYMBOLSINFO:return Eval_symbolsinfo();case TAN:return Eval_tan();case TANH:return Eval_tanh();case TAYLOR:return Eval_taylor();case TEST:return Eval_test();case TESTEQ:return Eval_testeq();case TESTGE:return Eval_testge();case TESTGT:return Eval_testgt();case TESTLE:return Eval_testle();case TESTLT:return Eval_testlt();case TRANSPOSE:return Eval_transpose();case UNIT:return Eval_unit();case ZERO:return Eval_zero();default:return Eval_user_function()}else Eval_user_function()},Eval_binding=function(){return push(get_binding(cadr(p1)))},Eval_check=function(){var r;return null==(r=isZeroLikeOrNonZeroLikeOrUndetermined(cadr(p1)))?push(p1):push_integer(r)},Eval_det=function(){return push(cadr(p1)),Eval(),det()},Eval_dim=function(){var r;return push(cadr(p1)),Eval(),p2=pop(),iscons(cddr(p1))?(push(caddr(p1)),Eval(),r=pop_integer()):r=1,istensor(p2)?r<1||r>p2.tensor.ndim?push(p1):push_integer(p2.tensor.dim[r-1]):push_integer(1)},Eval_divisors=function(){return push(cadr(p1)),Eval(),divisors()},Eval_do=function(){var r;for(push(car(p1)),p1=cdr(p1),r=[];iscons(p1);)pop(),push(car(p1)),Eval(),r.push(p1=cdr(p1));return r},Eval_dsolve=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),push(cadddr(p1)),Eval(),dsolve()},Eval_Eval=function(){for(push(cadr(p1)),Eval(),p1=cddr(p1);iscons(p1);)push(car(p1)),Eval(),push(cadr(p1)),Eval(),subst(),p1=cddr(p1);return Eval()},Eval_exp=function(){return push(cadr(p1)),Eval(),exponential()},Eval_factorial=function(){return push(cadr(p1)),Eval(),factorial()},Eval_factorpoly=function(){var r;for(p1=cdr(p1),push(car(p1)),Eval(),p1=cdr(p1),push(car(p1)),Eval(),factorpoly(),p1=cdr(p1),r=[];iscons(p1);)push(car(p1)),Eval(),factorpoly(),r.push(p1=cdr(p1));return r},Eval_hermite=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),hermite()},Eval_hilbert=function(){return push(cadr(p1)),Eval(),hilbert()},Eval_index=function(){var r,e,s;if(r=tos,e=p1,p1=cdr(p1),push(car(p1)),Eval(),s=stack[tos-1],isNumericAtom(s)&&stop("trying to access a scalar as a tensor"),!istensor(s))return moveTos(r),void push(e);for(p1=cdr(p1);iscons(p1);){if(push(car(p1)),Eval(),!isintegerorintegerfloat(stack[tos-1]))return moveTos(r),void push(e);p1=cdr(p1)}return index_function(tos-r)},Eval_inv=function(){return push(cadr(p1)),Eval(),inv()},Eval_invg=function(){return push(cadr(p1)),Eval(),invg()},Eval_isinteger=function(){if(push(cadr(p1)),Eval(),p1=pop(),isrational(p1))isinteger(p1)?push(one):push(zero);else{if(!isdouble(p1))return push_symbol(ISINTEGER),push(p1),list(2);Math.floor(p1.d)===p1.d?push(one):push(zero)}},Eval_number=function(){return push(cadr(p1)),Eval(),(p1=pop()).k===NUM||p1.k===DOUBLE?push_integer(1):push_integer(0)},Eval_operator=function(){var r;for(r=tos,push_symbol(OPERATOR),p1=cdr(p1);iscons(p1);)push(car(p1)),Eval(),p1=cdr(p1);return list(tos-r)},Eval_quote=function(){return push(cadr(p1))},Eval_rank=function(){return push(cadr(p1)),Eval(),p1=pop(),istensor(p1)?push_integer(p1.tensor.ndim):push(zero)},Eval_setq=function(){if(caadr(p1)!==symbol(INDEX)){if(!iscons(cadr(p1)))return issymbol(cadr(p1))||stop("symbol assignment: error in symbol"),push(caddr(p1)),Eval(),p2=pop(),set_binding(cadr(p1),p2),push(symbol(NIL));define_user_function()}else setq_indexed()},setq_indexed=function(){var r;for(p4=cadadr(p1),console.log("p4: "+p4),issymbol(p4)||stop("indexed assignment: expected a symbol name"),r=tos,push(caddr(p1)),Eval(),p2=cdadr(p1);iscons(p2);)push(car(p2)),Eval(),p2=cdr(p2);return set_component(tos-r),p3=pop(),set_binding(p4,p3),push(symbol(NIL))},Eval_sqrt=function(){return push(cadr(p1)),Eval(),push_rational(1,2),power()},Eval_stop=function(){return stop("user stop")},Eval_subst=function(){return push(cadddr(p1)),Eval(),push(caddr(p1)),Eval(),push(cadr(p1)),Eval(),subst(),Eval()},Eval_unit=function(){var r,e,s,o;if(r=0,0,push(cadr(p1)),Eval(),e=pop_integer(),isNaN(e))push(p1);else{if(!(e<1)){for((p1=alloc_tensor(e*e)).tensor.ndim=2,p1.tensor.dim[0]=e,p1.tensor.dim[1]=e,r=s=0,o=e;0<=o?s<o:s>o;r=0<=o?++s:--s)p1.tensor.elem[e*r+r]=one;return check_tensor_dimensions(p1),push(p1)}push(p1)}},Eval_noexpand=function(){var r;return r=expanding,expanding=0,Eval(),expanding=r},Eval_predicate=function(){return save(),p1=top(),car(p1)===symbol(SETQ)&&(pop(),push_symbol(TESTEQ),push(cadr(p1)),push(caddr(p1)),list(3)),Eval(),restore()},Eval_expand=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),(p2=pop())===symbol(NIL)?guess():push(p2),expand()},expand=function(){var r;if(save(),p9=pop(),p5=pop(),istensor(p5))return expand_tensor(),void restore();if(car(p5)!==symbol(ADD))return push(p5),numerator(),p3=pop(),push(p5),denominator(),p2=pop(),remove_negative_exponents(),push(p3),push(p2),push(p9),!isone(p3)&&!isone(p2)||ispoly(p2,p9)&&!isone(p2)?(divpoly(),p7=pop(),push(p3),push(p2),push(p7),multiply(),subtract(),p3=pop(),isZeroAtomOrTensor(p3)?(push(p7),void restore()):(push(p2),push(p9),factorpoly(),p2=pop(),expand_get_C(),expand_get_B(),expand_get_A(),istensor(p4)?(push(p4),r=expanding,expanding=1,inv(),expanding=r,push(p3),inner(),push(p2),inner()):(push(p3),push(p4),r=expanding,expanding=1,divide(),expanding=r,push(p2),multiply()),push(p7),add(),restore())):(pop(),pop(),pop(),push(p5),void restore());for(push_integer(0),p1=cdr(p5);iscons(p1);)push(car(p1)),push(p9),expand(),add(),p1=cdr(p1);restore()},expand_tensor=function(){var r,e,s;for(r=0,push(p5),copy_tensor(),r=e=0,s=(p5=pop()).tensor.nelem;0<=s?e<s:e>s;r=0<=s?++e:--e)push(p5.tensor.elem[r]),push(p9),expand(),p5.tensor.elem[r]=pop();return push(p5)},remove_negative_exponents=function(){var r,e,s,o,t,n;for(0,e=0,s=0,o=0,0,r=tos,factors(p2),factors(p3),s=0,e=t=0,n=tos-r;0<=n?t<n:t>n;e=0<=n?++t:--t)p1=stack[r+e],car(p1)===symbol(POWER)&&cadr(p1)===p9&&(push(caddr(p1)),o=pop_integer(),isNaN(o)||o<s&&(s=o));if(moveTos(r),0!==s)return push(p2),push(p9),push_integer(-s),power(),multiply(),p2=pop(),push(p3),push(p9),push_integer(-s),power(),multiply(),p3=pop()},expand_get_C=function(){var r,e,s,o,t,n,p,i,a,u;if(0,s=0,t=0,0,e=tos,car(p2)===symbol(MULTIPLY))for(p1=cdr(p2);iscons(p1);)p5=car(p1),expand_get_CF(),p1=cdr(p1);else p5=p2,expand_get_CF();if(1!==(n=tos-e)){for((p4=alloc_tensor(n*n)).tensor.ndim=2,p4.tensor.dim[0]=n,p4.tensor.dim[1]=n,r=e,s=p=0,a=n;0<=a?p<a:p>a;s=0<=a?++p:--p)for(t=o=0,u=n;0<=u?o<u:o>u;t=0<=u?++o:--o)push(stack[r+t]),push(p9),push_integer(s),power(),i=expanding,expanding=1,divide(),expanding=i,push(p9),filter(),p4.tensor.elem[n*s+t]=pop();return moveTos(tos-n)}p4=pop()},expand_get_CF=function(){var r,e,s,o,t,n,p,i;if(0,e=0,s=0,o=0,Find(p5,p9)){for(n=expanding,expanding=1,trivial_divide(),expanding=n,car(p5)===symbol(POWER)?(push(caddr(p5)),o=pop_integer(),p6=cadr(p5)):(o=1,p6=p5),push(p6),push(p9),degree(),r=pop_integer(),i=[],e=t=0,p=o;0<=p?t<p:t>p;e=0<=p?++t:--t)i.push(function(){var o,t,p;for(p=[],s=o=0,t=r;0<=t?o<t:o>t;s=0<=t?++o:--o)push(p8),push(p6),push_integer(e),power(),n=expanding,expanding=1,multiply(),expanding=n,push(p9),push_integer(s),power(),n=expanding,expanding=1,multiply(),p.push(expanding=n);return p}());return i}},trivial_divide=function(){var r;if(r=0,car(p2)===symbol(MULTIPLY)){for(r=tos,p0=cdr(p2);iscons(p0);)equal(car(p0),p5)||(push(car(p0)),Eval()),p0=cdr(p0);multiply_all(tos-r)}else push_integer(1);return p8=pop()},expand_get_B=function(){var r,e,s,o,t;if(r=0,0,istensor(p4)){for(e=p4.tensor.dim[0],(p8=alloc_tensor(e)).tensor.ndim=1,p8.tensor.dim[0]=e,r=s=0,t=e;0<=t?s<t:s>t;r=0<=t?++s:--s)push(p3),push(p9),push_integer(r),power(),o=expanding,expanding=1,divide(),expanding=o,push(p9),filter(),p8.tensor.elem[r]=pop();return p3=p8}},expand_get_A=function(){var r,e,s,o,t;if(0,e=0,0,!istensor(p4))return push(p2),reciprocate(),void(p2=pop());if(r=tos,car(p2)===symbol(MULTIPLY))for(p8=cdr(p2);iscons(p8);)p5=car(p8),expand_get_AF(),p8=cdr(p8);else p5=p2,expand_get_AF();for((p8=alloc_tensor(s=tos-r)).tensor.ndim=1,p8.tensor.dim[0]=s,e=o=0,t=s;0<=t?o<t:o>t;e=0<=t?++o:--o)p8.tensor.elem[e]=stack[r+e];return moveTos(r),p2=p8},expand_get_AF=function(){var r,e,s,o,t,n,p;if(0,e=0,s=0,o=1,Find(p5,p9)){for(car(p5)===symbol(POWER)&&(push(caddr(p5)),o=pop_integer(),p5=cadr(p5)),push(p5),push(p9),degree(),r=pop_integer(),p=[],e=t=n=o;n<=0?t<0:t>0;e=n<=0?++t:--t)p.push(function(){var o,t,n;for(n=[],s=o=0,t=r;0<=t?o<t:o>t;s=0<=t?++o:--o)push(p5),push_integer(e),power(),reciprocate(),push(p9),push_integer(s),power(),n.push(multiply());return n}());return p}},Eval_expcos=function(){return push(cadr(p1)),Eval(),expcos()},expcos=function(){return save(),p1=pop(),push(imaginaryunit),push(p1),multiply(),exponential(),push_rational(1,2),multiply(),push(imaginaryunit),negate(),push(p1),multiply(),exponential(),push_rational(1,2),multiply(),add(),restore()},Eval_expsin=function(){return push(cadr(p1)),Eval(),expsin()},expsin=function(){return save(),p1=pop(),push(imaginaryunit),push(p1),multiply(),exponential(),push(imaginaryunit),divide(),push_rational(1,2),multiply(),push(imaginaryunit),negate(),push(p1),multiply(),exponential(),push(imaginaryunit),divide(),push_rational(1,2),multiply(),subtract(),restore()},Eval_factor=function(){var r;for(push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),(p2=pop())===symbol(NIL)?guess():push(p2),factor(),p1=cdddr(p1),r=[];iscons(p1);)push(car(p1)),Eval(),factor_again(),r.push(p1=cdr(p1));return r},factor_again=function(){var r,e;if(save(),p2=pop(),p1=pop(),r=tos,car(p1)===symbol(MULTIPLY))for(p1=cdr(p1);iscons(p1);)push(car(p1)),push(p2),factor_term(),p1=cdr(p1);else push(p1),push(p2),factor_term();return(e=tos-r)>1&&multiply_all_noexpand(e),restore()},factor_term=function(){if(save(),factorpoly(),p1=pop(),car(p1)===symbol(MULTIPLY))for(p1=cdr(p1);iscons(p1);)push(car(p1)),p1=cdr(p1);else push(p1);return restore()},factor=function(){return save(),p2=pop(),p1=pop(),isinteger(p1)?(push(p1),factor_number()):(push(p1),push(p2),factorpoly()),restore()},factor_small_number=function(){var r,e,s,o,t,n;for(s=0,save(),o=pop_integer(),isNaN(o)&&stop("number too big to factor"),o<0&&(o=-o),s=t=0,n=MAXPRIMETAB;(0<=n?t<n:t>n)&&!((r=primetab[s])>o/r);s=0<=n?++t:--t){for(e=0;o%r==0;)o/=r,e++;e&&(push_integer(r),push_integer(e))}return o>1&&(push_integer(o),push_integer(1)),restore()},factorial=function(){var r;return 0,save(),p1=pop(),push(p1),(r=pop_integer())<0||isNaN(r)?(push_symbol(FACTORIAL),push(p1),list(2),void restore()):(bignum_factorial(r),restore())},simplifyfactorials=function(){var r;if(0,save(),r=expanding,expanding=0,p1=pop(),car(p1)===symbol(ADD)){for(push(zero),p1=cdr(p1);iscons(p1);)push(car(p1)),simplifyfactorials(),add(),p1=cdr(p1);return expanding=r,void restore()}return car(p1)===symbol(MULTIPLY)?(sfac_product(),expanding=r,void restore()):(push(p1),expanding=r,restore())},sfac_product=function(){var r,e,s,o,t,n,p,i,a,u,l;for(r=0,s=0,t=0,l=tos,p1=cdr(p1),t=0;iscons(p1);)push(car(p1)),p1=cdr(p1),t++;for(r=n=0,p=t-1;0<=p?n<p:n>p;r=0<=p?++n:--n)if(stack[l+r]!==symbol(NIL))for(s=e=i=r+1,a=t;i<=a?e<a:e>a;s=i<=a?++e:--e)stack[l+s]!==symbol(NIL)&&sfac_product_f(l,r,s);for(push(one),r=o=0,u=t;0<=u?o<u:o>u;r=0<=u?++o:--o)stack[l+r]!==symbol(NIL)&&(push(stack[l+r]),multiply());return p1=pop(),moveTos(tos-t),push(p1)},sfac_product_f=function(r,e,s){var o,t,n,p;if(o=0,t=0,p1=stack[r+e],p2=stack[r+s],ispower(p1)?(p3=caddr(p1),p1=cadr(p1)):p3=one,ispower(p2)?(p4=caddr(p2),p2=cadr(p2)):p4=one,isfactorial(p1)&&isfactorial(p2)){if(push(p3),push(p4),add(),yyexpand(),0!==(t=pop_integer()))return;if(push(cadr(p1)),push(cadr(p2)),subtract(),yyexpand(),0===(t=pop_integer())||isNaN(t))return;for(t<0&&(t=-t,p5=p1,p1=p2,p2=p5,p5=p3,p3=p4,p4=p5),push(one),o=n=1,p=t;1<=p?n<=p:n>=p;o=1<=p?++n:--n)push(cadr(p2)),push_integer(o),add(),push(p3),power(),multiply();return stack[r+e]=pop(),stack[r+s]=symbol(NIL)}},polycoeff=0,factpoly_expo=0,factorpoly=function(){return save(),p2=pop(),p1=pop(),Find(p1,p2)&&ispoly(p1,p2)&&issymbol(p2)?(push(p1),push(p2),yyfactorpoly(),restore()):(push(p1),void restore())},yyfactorpoly=function(){var r,e,s,o,t,n,p,i,a,u,l,c,d,_,m,f,h,g;for(0,n=0,save(),p2=pop(),p1=pop(),t=tos,isfloating(p1)&&stop("floating point numbers in polynomial"),polycoeff=tos,push(p1),push(p2),factpoly_expo=coeff()-1,rationalize_coefficients(t),g="real",h=null;factpoly_expo>0;)if(isZeroAtomOrTensor(stack[polycoeff+0])?(push_integer(1),p4=pop(),push_integer(0),p5=pop()):"real"===g?o=get_factor_from_real_root():"complex"===g&&(s=get_factor_from_complex_root(h)),"real"===g){if(0===o){g="complex";continue}for(push(p4),push(p2),multiply(),push(p5),add(),p8=pop(),DEBUG&&console.log("success\nFACTOR="+p8),push(p7),push(p8),multiply_noexpand(),p7=pop(),yydivpoly();factpoly_expo&&isZeroAtomOrTensor(stack[polycoeff+factpoly_expo]);)factpoly_expo--;for(push(zero),n=u=0,d=factpoly_expo;0<=d?u<=d:u>=d;n=0<=d?++u:--u)push(stack[polycoeff+n]),push(p2),push_integer(n),power(),multiply(),add();h=pop()}else if("complex"===g){if(0===s)break;if(push(p4),push(p2),subtract(),push(p4),conjugate(),push(p2),subtract(),multiply(),p8=pop(),DEBUG&&console.log("success\nFACTOR="+p8),push(p7),c=pop(),push(p7),push(p8),multiply_noexpand(),p7=pop(),null==h){for(push(zero),n=p=0,_=factpoly_expo;0<=_?p<=_:p>=_;n=0<=_?++p:--p)push(stack[polycoeff+n]),push(p2),push_integer(n),power(),multiply(),add();h=pop()}if(push(e=h),push(p8),push(p2),divpoly(),h=pop(),push(h),push(p8),multiply(),r=pop(),!equal(r,e))return DEBUG&&console.log("we found a polynomial based on complex root and its conj but it doesn't divide the poly, quitting"),DEBUG&&console.log("so just returning previousFactorisation times dividend: "+c+" * "+e),push(c),push(e),l=expanding,expanding=0,yycondense(),expanding=l,multiply_noexpand(),p7=pop(),stack[t]=p7,moveTos(t+1),void restore();for(n=i=0,m=factpoly_expo;0<=m?i<=m:i>=m;n=0<=m?++i:--i)pop();push(h),push(p2),coeff(),factpoly_expo-=2}for(push(zero),n=a=0,f=factpoly_expo;0<=f?a<=f:a>=f;n=0<=f?++a:--a)push(stack[polycoeff+n]),push(p2),push_integer(n),power(),multiply(),add();return p1=pop(),DEBUG&&console.log("POLY="+p1),push(p1),l=expanding,expanding=0,yycondense(),expanding=l,p1=pop(),factpoly_expo>0&&isnegativeterm(stack[polycoeff+factpoly_expo])&&(push(p1),negate(),p1=pop(),push(p7),negate_noexpand(),p7=pop()),push(p7),push(p1),multiply_noexpand(),p7=pop(),DEBUG&&console.log("RESULT="+p7),stack[t]=p7,moveTos(t+1),restore()},rationalize_coefficients=function(r){var e,s,o,t,n,p,i;for(e=0,p7=one,e=o=t=r,n=tos;t<=n?o<n:o>n;e=t<=n?++o:--o)push(stack[e]),denominator(),push(p7),lcm(),p7=pop();for(e=s=p=r,i=tos;p<=i?s<i:s>i;e=p<=i?++s:--s)push(p7),push(stack[e]),multiply(),stack[e]=pop();if(push(p7),reciprocate(),p7=pop(),DEBUG)return console.log("rationalize_coefficients result")},get_factor_from_real_root=function(){var r,e,s,o,t,n,p,i,a,u,l,c,d,_,m,f,h,g;if(o=0,0,0,0,0,0,0,DEBUG){for(push(zero),o=l=0,c=factpoly_expo;0<=c?l<=c:l>=c;o=0<=c?++l:--l)push(stack[polycoeff+o]),push(p2),push_integer(o),power(),multiply(),add();p1=pop(),console.log("POLY="+p1)}if(s=tos,e=tos,push(stack[polycoeff+factpoly_expo]),divisors_onstack(),u=tos-e,r=tos,push(stack[polycoeff+0]),divisors_onstack(),a=tos-r,DEBUG){for(console.log("divisors of base term"),o=t=0,d=a;0<=d?t<d:t>d;o=0<=d?++t:--t)console.log(", "+stack[r+o]);for(console.log("divisors of leading term"),o=n=0,_=u;0<=_?n<_:n>_;o=0<=_?++n:--n)console.log(", "+stack[e+o])}for(h=p=0,m=u;0<=m?p<m:p>m;h=0<=m?++p:--p)for(g=i=0,f=a;0<=f?i<f:i>f;g=0<=f?++i:--i){if(p4=stack[e+h],p5=stack[r+g],push(p5),push(p4),divide(),negate(),p3=pop(),Evalpoly(),DEBUG&&(console.log("try A="+p4),console.log(", B="+p5),console.log(", root "+p2),console.log("=-B/A="+p3),console.log(", POLY("+p3),console.log(")="+p6)),isZeroAtomOrTensor(p6))return moveTos(s),DEBUG&&console.log("get_factor_from_real_root returning 1"),1;if(push(p5),negate(),p5=pop(),push(p3),negate(),p3=pop(),Evalpoly(),DEBUG&&(console.log("try A="+p4),console.log(", B="+p5),console.log(", root "+p2),console.log("=-B/A="+p3),console.log(", POLY("+p3),console.log(")="+p6)),isZeroAtomOrTensor(p6))return moveTos(s),DEBUG&&console.log("get_factor_from_real_root returning 1"),1}return moveTos(s),DEBUG&&console.log("get_factor_from_real_root returning 0"),0},get_factor_from_complex_root=function(r){var e,s,o,t,n;if(0,0,0,0,0,0,0,factpoly_expo<=2)return DEBUG&&console.log("no more factoring via complex roots to be found in polynomial of degree <= 2"),0;if(p1=r,DEBUG&&console.log("complex root finding for POLY="+p1),e=tos,tos,push_integer(-1),push_rational(2,3),power(),rect(),p4=pop(),DEBUG&&console.log("complex root finding: trying with "+p4),push(p4),p3=pop(),push(p3),Evalpoly(),DEBUG&&console.log("complex root finding result: "+p6),isZeroAtomOrTensor(p6))return moveTos(e),DEBUG&&console.log("get_factor_from_complex_root returning 1"),1;if(push_integer(1),push_rational(2,3),power(),rect(),p4=pop(),DEBUG&&console.log("complex root finding: trying with "+p4),push(p4),p3=pop(),push(p3),Evalpoly(),DEBUG&&console.log("complex root finding result: "+p6),isZeroAtomOrTensor(p6))return moveTos(e),DEBUG&&console.log("get_factor_from_complex_root returning 1"),1;for(t=o=-10;o<=10;t=++o)for(n=s=1;s<=5;n=++s)if(push_integer(t),push_integer(n),push(imaginaryunit),multiply(),add(),rect(),p4=pop(),push(p4),p3=pop(),push(p3),Evalpoly(),isZeroAtomOrTensor(p6))return moveTos(e),DEBUG&&console.log("found complex root: "+p6),1;return moveTos(e),DEBUG&&console.log("get_factor_from_complex_root returning 0"),0},yydivpoly=function(){var r,e,s;for(r=0,p6=zero,r=e=s=factpoly_expo;s<=0?e<0:e>0;r=s<=0?++e:--e)push(stack[polycoeff+r]),stack[polycoeff+r]=p6,push(p4),divide(),p6=pop(),push(stack[polycoeff+r-1]),push(p6),push(p5),multiply(),subtract(),stack[polycoeff+r-1]=pop();if(stack[polycoeff+0]=p6,DEBUG)return console.log("yydivpoly Q:")},Evalpoly=function(){var r,e,s;for(r=0,push(zero),r=e=s=factpoly_expo;s<=0?e<=0:e>=0;r=s<=0?++e:--e)push(p3),multiply(),push(stack[polycoeff+r]),DEBUG&&(console.log("Evalpoly top of stack:"),console.log(print_list(stack[tos-r]))),add();return p6=pop()},factors=function(r){var e;if(e=tos,car(r)===symbol(ADD))for(r=cdr(r);iscons(r);)push_term_factors(car(r)),r=cdr(r);else push_term_factors(r);return tos-e},push_term_factors=function(r){var e;if(car(r)===symbol(MULTIPLY)){for(r=cdr(r),e=[];iscons(r);)push(car(r)),e.push(r=cdr(r));return e}return push(r)},Eval_filter=function(){var r;for(p1=cdr(p1),push(car(p1)),Eval(),p1=cdr(p1),r=[];iscons(p1);)push(car(p1)),Eval(),filter(),r.push(p1=cdr(p1));return r},filter=function(){return save(),p2=pop(),p1=pop(),filter_main(),restore()},filter_main=function(){return car(p1)===symbol(ADD)?filter_sum():istensor(p1)?filter_tensor():Find(p1,p2)?push_integer(0):push(p1)},filter_sum=function(){var r;for(push_integer(0),p1=cdr(p1),r=[];iscons(p1);)push(car(p1)),push(p2),filter(),add(),r.push(p1=cdr(p1));return r},filter_tensor=function(){var r,e,s,o,t,n;for(r=0,0,s=p1.tensor.nelem,(p3=alloc_tensor(s)).tensor.ndim=p1.tensor.ndim,r=o=0,t=p1.tensor.ndim;0<=t?o<t:o>t;r=0<=t?++o:--o)p3.tensor.dim[r]=p1.tensor.dim[r];for(r=e=0,n=s;0<=n?e<n:e>n;r=0<=n?++e:--e)push(p1.tensor.elem[r]),push(p2),filter(),p3.tensor.elem[r]=pop();return push(p3)},Eval_float=function(){return evaluatingAsFloats++,push(cadr(p1)),Eval(),yyfloat(),Eval(),evaluatingAsFloats--},checkFloatHasWorkedOutCompletely=function(r){var e,s,o,t,n;if(t=countOccurrencesOfSymbol(symbol(POWER),r),o=countOccurrencesOfSymbol(symbol(PI),r),e=countOccurrencesOfSymbol(symbol(E),r),s=countOccurrencesOfSymbol(symbol(MULTIPLY),r),n=countOccurrencesOfSymbol(symbol(ADD),r),DEBUG&&(console.log("     ... numberOfPowers: "+t),console.log("     ... numberOfPIs: "+o),console.log("     ... numberOfEs: "+e),console.log("     ... numberOfMults: "+s),console.log("     ... numberOfSums: "+n)),t>1||o>0||e>0||s>1||n>1)return stop("float: some unevalued parts in "+r)},zzfloat=function(){return save(),evaluatingAsFloats++,Eval(),yyfloat(),Eval(),evaluatingAsFloats--,restore()},yyfloat=function(){var r,e,s,o;if(e=0,r=0,evaluatingAsFloats++,save(),p1=pop(),iscons(p1)){for(r=tos;iscons(p1);)push(car(p1)),yyfloat(),p1=cdr(p1);list(tos-r)}else if(p1.k===TENSOR){for(push(p1),copy_tensor(),e=s=0,o=(p1=pop()).tensor.nelem;0<=o?s<o:s>o;e=0<=o?++s:--s)push(p1.tensor.elem[e]),yyfloat(),p1.tensor.elem[e]=pop();push(p1)}else p1.k===NUM?(push(p1),bignum_float()):p1===symbol(PI)?push_double(Math.PI):p1===symbol(E)?push_double(Math.E):push(p1);return restore(),evaluatingAsFloats--},Eval_floor=function(){return push(cadr(p1)),Eval(),yfloor()},yfloor=function(){return save(),yyfloor(),restore()},yyfloor=function(){var r;return r=0,p1=pop(),isNumericAtom(p1)?isdouble(p1)?(r=Math.floor(p1.d),void push_double(r)):isinteger(p1)?void push(p1):((p3=new U).k=NUM,p3.q.a=mdiv(p1.q.a,p1.q.b),p3.q.b=mint(1),push(p3),isnegativenumber(p1)?(push_integer(-1),add()):void 0):(push_symbol(FLOOR),push(p1),void list(2))},Eval_for=function(){var r,e,s,o,t,n,p;if(r=0,0,0,o=caddr(p1),issymbol(o)||stop("for: 2nd arg should be the variable to loop over"),push(cadddr(p1)),Eval(),e=pop_integer(),isNaN(e))push(p1);else{if(push(caddddr(p1)),Eval(),s=pop_integer(),!isNaN(s)){for(p4=get_binding(o),r=t=n=e,p=s;n<=p?t<=p:t>=p;r=n<=p?++t:--t)push_integer(r),p5=pop(),set_binding(o,p5),push(cadr(p1)),Eval(),pop();return set_binding(o,p4),push_symbol(NIL)}push(p1)}},Eval_gamma=function(){return push(cadr(p1)),Eval(),gamma()},gamma=function(){return save(),gammaf(),restore()},gammaf=function(){return p1=pop(),isrational(p1)&&MEQUAL(p1.q.a,1)&&MEQUAL(p1.q.b,2)?(evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),push_rational(1,2),void power()):isrational(p1)&&MEQUAL(p1.q.a,3)&&MEQUAL(p1.q.b,2)?(evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),push_rational(1,2),power(),push_rational(1,2),void multiply()):isnegativeterm(p1)?(evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),push_integer(-1),multiply(),evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),push(p1),multiply(),sine(),push(p1),multiply(),push(p1),negate(),gamma(),multiply(),void divide()):void(car(p1)!==symbol(ADD)?(push_symbol(GAMMA),push(p1),list(2)):gamma_of_sum())},gamma_of_sum=function(){return p3=cdr(p1),isrational(car(p3))&&MEQUAL(car(p3).q.a,1)&&MEQUAL(car(p3).q.b,1)?(push(cadr(p3)),push(cadr(p3)),gamma(),multiply()):isrational(car(p3))&&MEQUAL(car(p3).q.a,-1)&&MEQUAL(car(p3).q.b,1)?(push(cadr(p3)),gamma(),push(cadr(p3)),push_integer(-1),add(),divide()):(push_symbol(GAMMA),push(p1),void list(2))},Eval_gcd=function(){var r;for(p1=cdr(p1),push(car(p1)),Eval(),p1=cdr(p1),r=[];iscons(p1);)push(car(p1)),Eval(),gcd(),r.push(p1=cdr(p1));return r},gcd=function(){var r;return r=expanding,save(),gcd_main(),restore(),expanding=r},gcd_main=function(){if(expanding=1,p2=pop(),p1=pop(),equal(p1,p2))push(p1);else{if(isrational(p1)&&isrational(p2))return push(p1),push(p2),void gcd_numbers();if(car(p1)!==symbol(ADD)||car(p2)!==symbol(ADD))if(car(p1)===symbol(ADD)&&(gcd_expr(p1),p1=pop()),car(p2)===symbol(ADD)&&(gcd_expr(p2),p2=pop()),car(p1)!==symbol(MULTIPLY)||car(p2)!==symbol(MULTIPLY))if(car(p1)!==symbol(MULTIPLY))if(car(p2)!==symbol(MULTIPLY))if(car(p1)===symbol(POWER)?(p3=caddr(p1),p1=cadr(p1)):p3=one,car(p2)===symbol(POWER)?(p4=caddr(p2),p2=cadr(p2)):p4=one,equal(p1,p2)){if(isNumericAtom(p3)&&isNumericAtom(p4))return push(p1),lessp(p3,p4)?push(p3):push(p4),void power();if(push(p3),push(p4),divide(),p5=pop(),isNumericAtom(p5))return push(p1),p5=car(p3)===symbol(MULTIPLY)&&isNumericAtom(cadr(p3))?cadr(p3):one,p6=car(p4)===symbol(MULTIPLY)&&isNumericAtom(cadr(p4))?cadr(p4):one,lessp(p5,p6)?push(p3):push(p4),void power();if(push(p3),push(p4),subtract(),p5=pop(),isNumericAtom(p5))return push(p1),isnegativenumber(p5)?push(p3):push(p4),power();push(one)}else push(one);else gcd_factor_term();else gcd_term_factor();else gcd_term_term();else gcd_expr_expr()}},gcd_expr_expr=function(){if(length(p1)===length(p2)){for(p3=cdr(p1),push(car(p3)),p3=cdr(p3);iscons(p3);)push(car(p3)),gcd(),p3=cdr(p3);for(p3=pop(),p4=cdr(p2),push(car(p4)),p4=cdr(p4);iscons(p4);)push(car(p4)),gcd(),p4=cdr(p4);return p4=pop(),push(p1),push(p3),divide(),p5=pop(),push(p2),push(p4),divide(),p6=pop(),equal(p5,p6)?(push(p5),push(p3),push(p4),gcd(),multiply()):push(one)}push(one)},gcd_expr=function(r){var e;for(r=cdr(r),push(car(r)),r=cdr(r),e=[];iscons(r);)push(car(r)),gcd(),e.push(r=cdr(r));return e},gcd_term_term=function(){var r;for(push(one),p3=cdr(p1),r=[];iscons(p3);){for(p4=cdr(p2);iscons(p4);)push(car(p3)),push(car(p4)),gcd(),multiply(),p4=cdr(p4);r.push(p3=cdr(p3))}return r},gcd_term_factor=function(){var r;for(push(one),p3=cdr(p1),r=[];iscons(p3);)push(car(p3)),push(p2),gcd(),multiply(),r.push(p3=cdr(p3));return r},gcd_factor_term=function(){var r;for(push(one),p4=cdr(p2),r=[];iscons(p4);)push(p1),push(car(p4)),gcd(),multiply(),r.push(p4=cdr(p4));return r},guess=function(){var r;return r=pop(),push(r),Find(r,symbol(SYMBOL_X))?push_symbol(SYMBOL_X):Find(r,symbol(SYMBOL_Y))?push_symbol(SYMBOL_Y):Find(r,symbol(SYMBOL_Z))?push_symbol(SYMBOL_Z):Find(r,symbol(SYMBOL_T))?push_symbol(SYMBOL_T):Find(r,symbol(SYMBOL_S))?push_symbol(SYMBOL_S):push_symbol(SYMBOL_X)},hermite=function(){return save(),yyhermite(),restore()},yyhermite=function(){var r;return 0,p2=pop(),p1=pop(),push(p2),(r=pop_integer())<0||isNaN(r)?(push_symbol(HERMITE),push(p1),push(p2),void list(3)):issymbol(p1)?yyhermite2(r):(p3=p1,p1=symbol(SECRETX),yyhermite2(r),p1=p3,push(symbol(SECRETX)),push(p1),subst(),Eval())},yyhermite2=function(r){var e,s,o,t;for(e=0,push_integer(1),push_integer(0),p4=pop(),t=[],e=s=0,o=r;0<=o?s<o:s>o;e=0<=o?++s:--s)p5=p4,p4=pop(),push(p1),push(p4),multiply(),push_integer(e),push(p5),multiply(),subtract(),push_integer(2),t.push(multiply());return t},hilbert=function(){var r,e,s,o,t,n,p;if(r=0,s=0,0,save(),p2=pop(),push(p2),(o=pop_integer())<2)return push_symbol(HILBERT),push(p2),list(2),void restore();for(push_zero_matrix(o,o),p1=pop(),r=t=0,n=o;0<=n?t<n:t>n;r=0<=n?++t:--t)for(s=e=0,p=o;0<=p?e<p:e>p;s=0<=p?++e:--e)push_integer(r+s+1),inverse(),p1.tensor.elem[r*o+s]=pop();return push(p1),restore()},DEBUG_IMAG=!1,Eval_imag=function(){return push(cadr(p1)),Eval(),imag()},imag=function(){return save(),rect(),p1=pop(),DEBUG_IMAG&&console.log("IMAGE of "+p1),push(p1),push(p1),conjugate(),DEBUG_IMAG&&console.log(" image: conjugate result: "+stack[tos-1]),subtract(),push_integer(2),divide(),DEBUG_IMAG&&console.log(" image: 1st divide result: "+stack[tos-1]),push(imaginaryunit),divide(),DEBUG_IMAG&&console.log(" image: 2nd divide result: "+stack[tos-1]),restore()},index_function=function(r){var e,s,o,t,n,p,i,a,u,l,c,d,_,m,f,h,g,b,y,E;for(e=0,t=0,0,0,u=0,E=0,save(),(p=r-1)>(a=(p1=stack[y=tos-r]).tensor.ndim)&&stop("too many indices for tensor"),t=0,e=l=0,c=p;0<=c?l<c:l>c;e=0<=c?++l:--l)push(stack[y+e+1]),((E=pop_integer())<1||E>p1.tensor.dim[e])&&stop("index out of range"),t=t*p1.tensor.dim[e]+E-1;if(a===p)return moveTos(tos-r),push(p1.tensor.elem[t]),void restore();for(e=s=d=p,_=a;d<=_?s<_:s>_;e=d<=_?++s:--s)t=t*p1.tensor.dim[e]+0;for(u=1,e=o=m=p,f=a;m<=f?o<f:o>f;e=m<=f?++o:--o)u*=p1.tensor.dim[e];for((p2=alloc_tensor(u)).tensor.ndim=a-p,e=n=h=p,g=a;h<=g?n<g:n>g;e=h<=g?++n:--n)p2.tensor.dim[e-p]=p1.tensor.dim[e];for(e=i=0,b=u;0<=b?i<b:i>b;e=0<=b?++i:--i)p2.tensor.elem[e]=p1.tensor.elem[t+e];return check_tensor_dimensions(p1),check_tensor_dimensions(p2),moveTos(tos-r),push(p2),restore()},set_component=function(r){var e,s,o,t,n,p,i,a,u,l,c,d,_,m,f,h,g,b,y;for(e=0,t=0,0,0,y=0,save(),r<3&&stop("error in indexed assign"),p2=stack[b=tos-r],p1=stack[b+1],istensor(p1)||stop("error in indexed assign: assigning to something that is not a tensor"),(p=r-2)>(u=p1.tensor.ndim)&&stop("error in indexed assign"),t=0,e=l=0,c=p;0<=c?l<c:l>c;e=0<=c?++l:--l)push(stack[b+e+2]),((y=pop_integer())<1||y>p1.tensor.dim[e])&&stop("error in indexed assign\n"),t=t*p1.tensor.dim[e]+y-1;for(e=s=d=p,_=u;d<=_?s<_:s>_;e=d<=_?++s:--s)t=t*p1.tensor.dim[e]+0;for((p3=alloc_tensor(p1.tensor.nelem)).tensor.ndim=p1.tensor.ndim,e=o=0,m=p1.tensor.ndim;0<=m?o<m:o>m;e=0<=m?++o:--o)p3.tensor.dim[e]=p1.tensor.dim[e];for(e=n=0,f=p1.tensor.nelem;0<=f?n<f:n>f;e=0<=f?++n:--n)p3.tensor.elem[e]=p1.tensor.elem[e];if(check_tensor_dimensions(p1),check_tensor_dimensions(p3),p1=p3,u===p)return istensor(p2)&&stop("error in indexed assign"),p1.tensor.elem[t]=p2,check_tensor_dimensions(p1),moveTos(tos-r),push(p1),void restore();for(istensor(p2)||stop("error in indexed assign"),u-p!==p2.tensor.ndim&&stop("error in indexed assign"),e=i=0,h=p2.tensor.ndim;0<=h?i<h:i>h;e=0<=h?++i:--i)p1.tensor.dim[p+e]!==p2.tensor.dim[e]&&stop("error in indexed assign");for(e=a=0,g=p2.tensor.nelem;0<=g?a<g:a>g;e=0<=g?++a:--a)p1.tensor.elem[t+e]=p2.tensor.elem[e];return check_tensor_dimensions(p1),check_tensor_dimensions(p2),moveTos(tos-r),push(p1),restore()},Eval_inner=function(){var r,e,s,o,t,n,p,i,a,u,l,c,d,_,m,f;for((f=[]).push(car(cdr(p1))),car(cdr(cdr(p1)))===symbol(NIL)&&stop("pattern needs at least a template and a transformed version"),n=cdr(cdr(p1));n!==symbol(NIL);)f.push(car(n)),n=cdr(n);if(f.length>2){for(push_symbol(INNER),push(f[f.length-2]),push(f[f.length-1]),list(3),e=p=2,a=f.length;2<=a?p<a:p>a;e=2<=a?++p:--p)push_symbol(INNER),swap(),push(f[f.length-e-1]),swap(),list(3);return p1=pop(),void Eval_inner()}for(get_innerprod_factors(p1,i=[]),d=[],e=s=0,u=i.length;0<=u?s<u:s>u;e=0<=u?++s:--s)i[e]!==symbol(SYMBOL_IDENTITY_MATRIX)&&d.push(i[e]);if(i=d,d=[],i.length>1){for(m=0,e=o=0,l=i.length;(0<=l?o<l:o>l)&&e+m+1<=i.length-1&&(isNumericAtomOrTensor(i[e+m])||isNumericAtomOrTensor(i[e+m+1])?d.push(i[e+m]):(push(i[e+m]),Eval(),inv(),push(i[e+m+1]),Eval(),subtract(),r=pop(),isZeroAtomOrTensor(r)?m+=1:d.push(i[e+m])),e+m===i.length-2&&d.push(i[i.length-1]),!(e+m>=i.length-1));e=0<=l?++o:--o);i=d}if(push(symbol(INNER)),!(i.length>0))return pop(),void push(symbol(SYMBOL_IDENTITY_MATRIX));for(e=t=0,c=i.length;0<=c?t<c:t>c;e=0<=c?++t:--t)push(i[e]);for(list(i.length+1),p1=pop(),p1=cdr(p1),push(car(p1)),Eval(),p1=cdr(p1),_=[];iscons(p1);)push(car(p1)),Eval(),inner(),_.push(p1=cdr(p1));return _},inner=function(){var r,e,s,o;if(save(),p2=pop(),p1=pop(),isnegativeterm(p2)&&isnegativeterm(p1)&&(push(p2),negate(),p2=pop(),push(p1),negate(),p1=pop()),isinnerordot(p1)&&(r=car(cdr(p1)),e=car(cdr(cdr(p1))),s=p2,p1=r,push(e),push(s),inner(),p2=pop()),p1===symbol(SYMBOL_IDENTITY_MATRIX))return push(p2),void restore();if(p2===symbol(SYMBOL_IDENTITY_MATRIX))return push(p1),void restore();if(istensor(p1)&&istensor(p2))inner_f();else{if(!isNumericAtomOrTensor(p1)&&!isNumericAtomOrTensor(p2)&&(push(p1),push(p2),inv(),subtract(),o=pop(),isZeroAtomOrTensor(o)))return push_symbol(SYMBOL_IDENTITY_MATRIX),void restore();if(expanding&&isadd(p1)){for(p1=cdr(p1),push(zero);iscons(p1);)push(car(p1)),push(p2),inner(),add(),p1=cdr(p1);return void restore()}if(expanding&&isadd(p2)){for(p2=cdr(p2),push(zero);iscons(p2);)push(p1),push(car(p2)),inner(),add(),p2=cdr(p2);return void restore()}if(push(p1),push(p2),istensor(p1)&&isNumericAtom(p2))tensor_times_scalar();else if(isNumericAtom(p1)&&istensor(p2))scalar_times_tensor();else{if(!isNumericAtom(p1)&&!isNumericAtom(p2))return pop(),pop(),push_symbol(INNER),push(p1),push(p2),list(3),void restore();multiply()}}return restore()},inner_f=function(){var r,e,s,o,t,n,p,i,a,u,l,c,d,_,m,f,h,g,b,y,E,v,x,A;for(n=0,(d=p1.tensor.dim[p1.tensor.ndim-1])!==p2.tensor.dim[0]&&stop("inner: tensor dimension check"),(m=p1.tensor.ndim+p2.tensor.ndim-2)>MAXDIM&&stop("inner: rank of result exceeds maximum"),r=p1.tensor.elem,s=p2.tensor.elem,e=1,n=f=0,g=p1.tensor.ndim-1;0<=g?f<g:f>g;n=0<=g?++f:--f)e*=p1.tensor.dim[n];for(o=1,n=p=1,b=p2.tensor.ndim;1<=b?p<b:p>b;n=1<=b?++p:--p)o*=p2.tensor.dim[n];for(t=(p3=alloc_tensor(e*o)).tensor.elem,n=a=0,y=e;0<=y?a<y:a>y;n=0<=y?++a:--a)for(i=l=0,E=d;0<=E?l<E:l>E;i=0<=E?++l:--l)if(!isZeroAtomOrTensor(r[n*d+i]))for(u=c=0,v=o;0<=v?c<v:c>v;u=0<=v?++c:--c)push(r[n*d+i]),push(s[i*o+u]),multiply(),push(t[n*o+u]),add(),t[n*o+u]=pop();if(0===m)return push(p3.tensor.elem[0]);for(p3.tensor.ndim=m,i=0,n=_=0,x=p1.tensor.ndim-1;0<=x?_<x:_>x;n=0<=x?++_:--_)p3.tensor.dim[n]=p1.tensor.dim[n];for(i=p1.tensor.ndim-1,n=h=0,A=p2.tensor.ndim-1;0<=A?h<A:h>A;n=0<=A?++h:--h)p3.tensor.dim[i+n]=p2.tensor.dim[n+1];return push(p3)},get_innerprod_factors=function(r,e){if(iscons(r)){if(cdr(r)!==symbol(NIL))return isinnerordot(r)?(get_innerprod_factors(car(cdr(r)),e),void get_innerprod_factors(cdr(cdr(r)),e)):add_factor_to_accumulator(r,e);r=get_innerprod_factors(car(r),e)}else add_factor_to_accumulator(r,e)},add_factor_to_accumulator=function(r,e){if(r!==symbol(NIL))return e.push(r)},itab=["f(a,a*x)","f(1/x,log(x))","f(x^a,x^(a+1)/(a+1))","f(exp(a*x),1/a*exp(a*x))","f(exp(a*x+b),1/a*exp(a*x+b))","f(x*exp(a*x^2),exp(a*x^2)/(2*a))","f(x*exp(a*x^2+b),exp(a*x^2+b)/(2*a))","f(log(a*x),x*log(a*x)-x)","f(a^x,a^x/log(a),or(not(number(a)),a>0))","f(1/(a+x^2),1/sqrt(a)*arctan(x/sqrt(a)),or(not(number(a)),a>0))","f(1/(a-x^2),1/sqrt(a)*arctanh(x/sqrt(a)))","f(1/sqrt(a-x^2),arcsin(x/(sqrt(a))))","f(1/sqrt(a+x^2),log(x+sqrt(a+x^2)))","f(1/(a+b*x),1/b*log(a+b*x))","f(1/(a+b*x)^2,-1/(b*(a+b*x)))","f(1/(a+b*x)^3,-1/(2*b)*1/(a+b*x)^2)","f(x/(a+b*x),x/b-a*log(a+b*x)/b/b)","f(x/(a+b*x)^2,1/b^2*(log(a+b*x)+a/(a+b*x)))","f(x^2/(a+b*x),1/b^2*(1/2*(a+b*x)^2-2*a*(a+b*x)+a^2*log(a+b*x)))","f(x^2/(a+b*x)^2,1/b^3*(a+b*x-2*a*log(a+b*x)-a^2/(a+b*x)))","f(x^2/(a+b*x)^3,1/b^3*(log(a+b*x)+2*a/(a+b*x)-1/2*a^2/(a+b*x)^2))","f(1/x*1/(a+b*x),-1/a*log((a+b*x)/x))","f(1/x*1/(a+b*x)^2,1/a*1/(a+b*x)-1/a^2*log((a+b*x)/x))","f(1/x*1/(a+b*x)^3,1/a^3*(1/2*((2*a+b*x)/(a+b*x))^2+log(x/(a+b*x))))","f(1/x^2*1/(a+b*x),-1/(a*x)+b/a^2*log((a+b*x)/x))","f(1/x^3*1/(a+b*x),(2*b*x-a)/(2*a^2*x^2)+b^2/a^3*log(x/(a+b*x)))","f(1/x^2*1/(a+b*x)^2,-(a+2*b*x)/(a^2*x*(a+b*x))+2*b/a^3*log((a+b*x)/x))","f(1/(a+b*x^2),1/sqrt(a*b)*arctan(x*sqrt(a*b)/a),or(not(number(a*b)),a*b>0))","f(1/(a+b*x^2),1/(2*sqrt(-a*b))*log((a+x*sqrt(-a*b))/(a-x*sqrt(-a*b))),or(not(number(a*b)),a*b<0))","f(x/(a+b*x^2),1/2*1/b*log(a+b*x^2))","f(x^2/(a+b*x^2),x/b-a/b*integral(1/(a+b*x^2),x))","f(1/(a+b*x^2)^2,x/(2*a*(a+b*x^2))+1/2*1/a*integral(1/(a+b*x^2),x))","f(1/x*1/(a+b*x^2),1/2*1/a*log(x^2/(a+b*x^2)))","f(1/x^2*1/(a+b*x^2),-1/(a*x)-b/a*integral(1/(a+b*x^2),x))","f(1/(a+b*x^3),1/3*1/a*(a/b)^(1/3)*(1/2*log(((a/b)^(1/3)+x)^3/(a+b*x^3))+sqrt(3)*arctan((2*x-(a/b)^(1/3))*(a/b)^(-1/3)/sqrt(3))))","f(x^2/(a+b*x^3),1/3*1/b*log(a+b*x^3))","f(x/(a+b*x^4),1/2*sqrt(b/a)/b*arctan(x^2*sqrt(b/a)),or(not(number(a*b)),a*b>0))","f(x/(a+b*x^4),1/4*sqrt(-b/a)/b*log((x^2-sqrt(-a/b))/(x^2+sqrt(-a/b))),or(not(number(a*b)),a*b<0))","f(x^3/(a+b*x^4),1/4*1/b*log(a+b*x^4))","f(sqrt(a+b*x),2/3*1/b*sqrt((a+b*x)^3))","f(x*sqrt(a+b*x),-2*(2*a-3*b*x)*sqrt((a+b*x)^3)/15/b^2)","f(x^2*sqrt(a+b*x),2*(8*a^2-12*a*b*x+15*b^2*x^2)*sqrt((a+b*x)^3)/105/b^3)","f(sqrt(a+b*x)/x,2*sqrt(a+b*x)+a*integral(1/x*1/sqrt(a+b*x),x))","f(sqrt(a+b*x)/x^2,-sqrt(a+b*x)/x+b/2*integral(1/x*1/sqrt(a+b*x),x))","f(1/sqrt(a+b*x),2*sqrt(a+b*x)/b)","f(x/sqrt(a+b*x),-2/3*(2*a-b*x)*sqrt(a+b*x)/b^2)","f(x^2/sqrt(a+b*x),2/15*(8*a^2-4*a*b*x+3*b^2*x^2)*sqrt(a+b*x)/b^3)","f(1/x*1/sqrt(a+b*x),1/sqrt(a)*log((sqrt(a+b*x)-sqrt(a))/(sqrt(a+b*x)+sqrt(a))),or(not(number(a)),a>0))","f(1/x*1/sqrt(a+b*x),2/sqrt(-a)*arctan(sqrt(-(a+b*x)/a)),or(not(number(a)),a<0))","f(1/x^2*1/sqrt(a+b*x),-sqrt(a+b*x)/a/x-1/2*b/a*integral(1/x*1/sqrt(a+b*x),x))","f(sqrt(x^2+a),1/2*(x*sqrt(x^2+a)+a*log(x+sqrt(x^2+a))))","f(1/sqrt(x^2+a),log(x+sqrt(x^2+a)))","f(1/x*1/sqrt(x^2+a),arcsec(x/sqrt(-a))/sqrt(-a),or(not(number(a)),a<0))","f(1/x*1/sqrt(x^2+a),-1/sqrt(a)*log((sqrt(a)+sqrt(x^2+a))/x),or(not(number(a)),a>0))","f(sqrt(x^2+a)/x,sqrt(x^2+a)-sqrt(a)*log((sqrt(a)+sqrt(x^2+a))/x),or(not(number(a)),a>0))","f(sqrt(x^2+a)/x,sqrt(x^2+a)-sqrt(-a)*arcsec(x/sqrt(-a)),or(not(number(a)),a<0))","f(x/sqrt(x^2+a),sqrt(x^2+a))","f(x*sqrt(x^2+a),1/3*sqrt((x^2+a)^3))","f(sqrt(a+x^6+3*a^(1/3)*x^4+3*a^(2/3)*x^2),1/4*(x*sqrt((x^2+a^(1/3))^3)+3/2*a^(1/3)*x*sqrt(x^2+a^(1/3))+3/2*a^(2/3)*log(x+sqrt(x^2+a^(1/3)))))","f(sqrt(-a+x^6-3*a^(1/3)*x^4+3*a^(2/3)*x^2),1/4*(x*sqrt((x^2-a^(1/3))^3)-3/2*a^(1/3)*x*sqrt(x^2-a^(1/3))+3/2*a^(2/3)*log(x+sqrt(x^2-a^(1/3)))))","f(1/sqrt(a+x^6+3*a^(1/3)*x^4+3*a^(2/3)*x^2),x/a^(1/3)/sqrt(x^2+a^(1/3)))","f(x/sqrt(a+x^6+3*a^(1/3)*x^4+3*a^(2/3)*x^2),-1/sqrt(x^2+a^(1/3)))","f(x*sqrt(a+x^6+3*a^(1/3)*x^4+3*a^(2/3)*x^2),1/5*sqrt((x^2+a^(1/3))^5))","f(x^2*sqrt(x^2+a),1/4*x*sqrt((x^2+a)^3)-1/8*a*x*sqrt(x^2+a)-1/8*a^2*log(x+sqrt(x^2+a)))","f(x^3*sqrt(x^2+a),(1/5*x^2-2/15*a)*sqrt((x^2+a)^3),and(number(a),a>0))","f(x^3*sqrt(x^2+a),sqrt((x^2+a)^5)/5-a*sqrt((x^2+a)^3)/3,and(number(a),a<0))","f(x^2/sqrt(x^2+a),1/2*x*sqrt(x^2+a)-1/2*a*log(x+sqrt(x^2+a)))","f(x^3/sqrt(x^2+a),1/3*sqrt((x^2+a)^3)-a*sqrt(x^2+a))","f(1/x^2*1/sqrt(x^2+a),-sqrt(x^2+a)/a/x)","f(1/x^3*1/sqrt(x^2+a),-1/2*sqrt(x^2+a)/a/x^2+1/2*log((sqrt(a)+sqrt(x^2+a))/x)/a^(3/2),or(not(number(a)),a>0))","f(1/x^3*1/sqrt(x^2-a),1/2*sqrt(x^2-a)/a/x^2+1/2*1/(a^(3/2))*arcsec(x/(a^(1/2))),or(not(number(a)),a>0))","f(x^2*sqrt(a+x^6+3*a^(1/3)*x^4+3*a^(2/3)*x^2),1/6*x*sqrt((x^2+a^(1/3))^5)-1/24*a^(1/3)*x*sqrt((x^2+a^(1/3))^3)-1/16*a^(2/3)*x*sqrt(x^2+a^(1/3))-1/16*a*log(x+sqrt(x^2+a^(1/3))),or(not(number(a)),a>0))","f(x^2*sqrt(-a-3*a^(1/3)*x^4+3*a^(2/3)*x^2+x^6),1/6*x*sqrt((x^2-a^(1/3))^5)+1/24*a^(1/3)*x*sqrt((x^2-a^(1/3))^3)-1/16*a^(2/3)*x*sqrt(x^2-a^(1/3))+1/16*a*log(x+sqrt(x^2-a^(1/3))),or(not(number(a)),a>0))","f(x^3*sqrt(a+x^6+3*a^(1/3)*x^4+3*a^(2/3)*x^2),1/7*sqrt((x^2+a^(1/3))^7)-1/5*a^(1/3)*sqrt((x^2+a^(1/3))^5),or(not(number(a)),a>0))","f(x^3*sqrt(-a-3*a^(1/3)*x^4+3*a^(2/3)*x^2+x^6),1/7*sqrt((x^2-a^(1/3))^7)+1/5*a^(1/3)*sqrt((x^2-a^(1/3))^5),or(not(number(a)),a>0))","f(1/(x-a)/sqrt(x^2-a^2),-sqrt(x^2-a^2)/a/(x-a))","f(1/(x+a)/sqrt(x^2-a^2),sqrt(x^2-a^2)/a/(x+a))","f(sqrt(a-x^2),1/2*(x*sqrt(a-x^2)+a*arcsin(x/sqrt(abs(a)))))","f(1/x*1/sqrt(a-x^2),-1/sqrt(a)*log((sqrt(a)+sqrt(a-x^2))/x),or(not(number(a)),a>0))","f(sqrt(a-x^2)/x,sqrt(a-x^2)-sqrt(a)*log((sqrt(a)+sqrt(a-x^2))/x),or(not(number(a)),a>0))","f(x/sqrt(a-x^2),-sqrt(a-x^2))","f(x*sqrt(a-x^2),-1/3*sqrt((a-x^2)^3))","f(x^2*sqrt(a-x^2),-x/4*sqrt((a-x^2)^3)+1/8*a*(x*sqrt(a-x^2)+a*arcsin(x/sqrt(a))),or(not(number(a)),a>0))","f(x^3*sqrt(a-x^2),(-1/5*x^2-2/15*a)*sqrt((a-x^2)^3),or(not(number(a)),a>0))","f(x^2/sqrt(a-x^2),-x/2*sqrt(a-x^2)+a/2*arcsin(x/sqrt(a)),or(not(number(a)),a>0))","f(1/x^2*1/sqrt(a-x^2),-sqrt(a-x^2)/a/x,or(not(number(a)),a>0))","f(sqrt(a-x^2)/x^2,-sqrt(a-x^2)/x-arcsin(x/sqrt(a)),or(not(number(a)),a>0))","f(sqrt(a-x^2)/x^3,-1/2*sqrt(a-x^2)/x^2+1/2*log((sqrt(a)+sqrt(a-x^2))/x)/sqrt(a),or(not(number(a)),a>0))","f(sqrt(a-x^2)/x^4,-1/3*sqrt((a-x^2)^3)/a/x^3,or(not(number(a)),a>0))","f(sqrt(a*x^2+b),x*sqrt(a*x^2+b)/2+b*log(x*sqrt(a)+sqrt(a*x^2+b))/2/sqrt(a),and(number(a),a>0))","f(sqrt(a*x^2+b),x*sqrt(a*x^2+b)/2+b*arcsin(x*sqrt(-a/b))/2/sqrt(-a),and(number(a),a<0))","f(sin(a*x),-cos(a*x)/a)","f(cos(a*x),sin(a*x)/a)","f(tan(a*x),-log(cos(a*x))/a)","f(1/tan(a*x),log(sin(a*x))/a)","f(1/cos(a*x),log(tan(pi/4+a*x/2))/a)","f(1/sin(a*x),log(tan(a*x/2))/a)","f(sin(a*x)^2,x/2-sin(2*a*x)/(4*a))","f(sin(a*x)^3,-cos(a*x)*(sin(a*x)^2+2)/(3*a))","f(sin(a*x)^4,3/8*x-sin(2*a*x)/(4*a)+sin(4*a*x)/(32*a))","f(cos(a*x)^2,x/2+sin(2*a*x)/(4*a))","f(cos(a*x)^3,sin(a*x)*(cos(a*x)^2+2)/(3*a))","f(cos(a*x)^4,3/8*x+sin(2*a*x)/(4*a)+sin(4*a*x)/(32*a))","f(1/sin(a*x)^2,-1/(a*tan(a*x)))","f(1/cos(a*x)^2,tan(a*x)/a)","f(sin(a*x)*cos(a*x),sin(a*x)^2/(2*a))","f(sin(a*x)^2*cos(a*x)^2,-sin(4*a*x)/(32*a)+x/8)","f(sin(a*x)/cos(a*x)^2,1/(a*cos(a*x)))","f(sin(a*x)^2/cos(a*x),(log(tan(pi/4+a*x/2))-sin(a*x))/a)","f(cos(a*x)/sin(a*x)^2,-1/(a*sin(a*x)))","f(1/(sin(a*x)*cos(a*x)),log(tan(a*x))/a)","f(1/(sin(a*x)*cos(a*x)^2),(1/cos(a*x)+log(tan(a*x/2)))/a)","f(1/(sin(a*x)^2*cos(a*x)),(log(tan(pi/4+a*x/2))-1/sin(a*x))/a)","f(1/(sin(a*x)^2*cos(a*x)^2),-2/(a*tan(2*a*x)))","f(sin(a+b*x),-cos(a+b*x)/b)","f(cos(a+b*x),sin(a+b*x)/b)","f(1/(b+b*sin(a*x)),-tan(pi/4-a*x/2)/a/b)","f(1/(b-b*sin(a*x)),tan(pi/4+a*x/2)/a/b)","f(1/(b+b*cos(a*x)),tan(a*x/2)/a/b)","f(1/(b-b*cos(a*x)),-1/tan(a*x/2)/a/b)","f(1/(a+b*sin(x)),1/sqrt(b^2-a^2)*log((a*tan(x/2)+b-sqrt(b^2-a^2))/(a*tan(x/2)+b+sqrt(b^2-a^2))),b^2-a^2)","f(1/(a+b*cos(x)),1/sqrt(b^2-a^2)*log((sqrt(b^2-a^2)*tan(x/2)+a+b)/(sqrt(b^2-a^2)*tan(x/2)-a-b)),b^2-a^2)","f(x*sin(a*x),sin(a*x)/a^2-x*cos(a*x)/a)","f(x^2*sin(a*x),2*x*sin(a*x)/a^2-(a^2*x^2-2)*cos(a*x)/a^3)","f(x*cos(a*x),cos(a*x)/a^2+x*sin(a*x)/a)","f(x^2*cos(a*x),2*x*cos(a*x)/a^2+(a^2*x^2-2)*sin(a*x)/a^3)","f(arcsin(a*x),x*arcsin(a*x)+sqrt(1-a^2*x^2)/a)","f(arccos(a*x),x*arccos(a*x)-sqrt(1-a^2*x^2)/a)","f(arctan(a*x),x*arctan(a*x)-1/2*log(1+a^2*x^2)/a)","f(log(a*x),x*log(a*x)-x)","f(x*log(a*x),x^2*log(a*x)/2-x^2/4)","f(x^2*log(a*x),x^3*log(a*x)/3-1/9*x^3)","f(log(x)^2,x*log(x)^2-2*x*log(x)+2*x)","f(1/x*1/(a+log(x)),log(a+log(x)))","f(log(a*x+b),(a*x+b)*log(a*x+b)/a-x)","f(log(a*x+b)/x^2,a/b*log(x)-(a*x+b)*log(a*x+b)/b/x)","f(sinh(x),cosh(x))","f(cosh(x),sinh(x))","f(tanh(x),log(cosh(x)))","f(x*sinh(x),x*cosh(x)-sinh(x))","f(x*cosh(x),x*sinh(x)-cosh(x))","f(sinh(x)^2,sinh(2*x)/4-x/2)","f(tanh(x)^2,x-tanh(x))","f(cosh(x)^2,sinh(2*x)/4+x/2)","f(x^3*exp(a*x^2),exp(a*x^2)*(x^2/a-1/(a^2))/2)","f(x^3*exp(a*x^2+b),exp(a*x^2)*exp(b)*(x^2/a-1/(a^2))/2)","f(exp(a*x^2),-i*sqrt(pi)*erf(i*sqrt(a)*x)/sqrt(a)/2)","f(erf(a*x),x*erf(a*x)+exp(-a^2*x^2)/a/sqrt(pi))","f(x^2*(1-x^2)^(3/2),(x*sqrt(1-x^2)*(-8*x^4+14*x^2-3)+3*arcsin(x))/48)","f(x^2*(1-x^2)^(5/2),(x*sqrt(1-x^2)*(48*x^6-136*x^4+118*x^2-15)+15*arcsin(x))/384)","f(x^4*(1-x^2)^(3/2),(-x*sqrt(1-x^2)*(16*x^6-24*x^4+2*x^2+3)+3*arcsin(x))/128)","f(x*exp(a*x),exp(a*x)*(a*x-1)/(a^2))","f(x*exp(a*x+b),exp(a*x+b)*(a*x-1)/(a^2))","f(x^2*exp(a*x),exp(a*x)*(a^2*x^2-2*a*x+2)/(a^3))","f(x^2*exp(a*x+b),exp(a*x+b)*(a^2*x^2-2*a*x+2)/(a^3))","f(x^3*exp(a*x),exp(a*x)*x^3/a-3/a*integral(x^2*exp(a*x),x))","f(x^3*exp(a*x+b),exp(a*x+b)*x^3/a-3/a*integral(x^2*exp(a*x+b),x))",0],Eval_integral=function(){var r,e,s,o,t;for(0,e=0,p1=cdr(p1),push(car(p1)),Eval(),p1=cdr(p1),push(car(p1)),Eval(),(p2=pop())===symbol(NIL)?(guess(),push(symbol(NIL))):isNumericAtom(p2)?(guess(),push(p2)):(push(p2),p1=cdr(p1),push(car(p1)),Eval()),p5=pop(),p4=pop(),p3=pop();;){if(isNumericAtom(p5)?(push(p5),e=pop_integer(),isNaN(e)&&stop("nth integral: check n")):e=1,push(p3),e>=0)for(s=0,o=e;0<=o?s<o:s>o;0<=o?++s:--s)push(p4),integral();else for(r=0,t=e=-e;0<=t?r<t:r>t;0<=t?++r:--r)push(p4),derivative();if(p3=pop(),p5===symbol(NIL))break;if(isNumericAtom(p5)){if(p1=cdr(p1),push(car(p1)),Eval(),(p5=pop())===symbol(NIL))break;isNumericAtom(p5)?1:(p4=p5,p1=cdr(p1),push(car(p1)),Eval(),p5=pop())}else p4=p5,p1=cdr(p1),push(car(p1)),Eval(),p5=pop()}return push(p3)},integral=function(){return save(),p2=pop(),p1=pop(),car(p1)===symbol(ADD)?integral_of_sum():car(p1)===symbol(MULTIPLY)?integral_of_product():integral_of_form(),p1=pop(),Find(p1,symbol(INTEGRAL))&&stop("integral: sorry, could not find a solution"),push(p1),simplify(),Eval(),restore()},integral_of_sum=function(){var r;for(p1=cdr(p1),push(car(p1)),push(p2),integral(),p1=cdr(p1),r=[];iscons(p1);)push(car(p1)),push(p2),integral(),add(),r.push(p1=cdr(p1));return r},integral_of_product=function(){return push(p1),push(p2),partition(),p1=pop(),integral_of_form(),multiply()},integral_of_form=function(){return push(p1),push(p2),transform(itab,!1),(p3=pop())===symbol(NIL)?(push_symbol(INTEGRAL),push(p1),push(p2),list(3)):push(p3)},INV_check_arg=function(){return istensor(p1)?2!==p1.tensor.ndim?0:p1.tensor.dim[0]!==p1.tensor.dim[1]?0:1:0},inv=function(){var r,e,s,o;if(0,0,save(),p1=pop(),isinv(p1))return push(car(cdr(p1))),void restore();if(isidentitymatrix(p1))return push(p1),void restore();if(!expanding||!isinnerordot(p1))return 0===INV_check_arg()?(push_symbol(INV),push(p1),list(2),void restore()):(isNumericAtomOrTensor(p1)?yyinvg():(push(p1),adj(),push(p1),det(),p2=pop(),isZeroAtomOrTensor(p2)&&stop("inverse of singular matrix"),push(p2),divide()),restore());for(p1=cdr(p1),r=[];iscons(p1);)r.push(car(p1)),p1=cdr(p1);for(e=s=o=r.length-1;o<=0?s<=0:s>=0;e=o<=0?++s:--s)push(r[e]),inv(),e!==r.length-1&&inner();restore()},invg=function(){return save(),p1=pop(),0===INV_check_arg()?(push_symbol(INVG),push(p1),list(2),void restore()):(yyinvg(),restore())},yyinvg=function(){var r,e,s,o,t,n,p,i,a,u,l,c;for(0,e=0,o=0,0,p=p1.tensor.dim[0],r=tos,e=i=0,a=p;0<=a?i<a:i>a;e=0<=a?++i:--i)for(o=s=0,u=p;0<=u?s<u:s>u;o=0<=u?++s:--s)push(e===o?one:zero);for(e=t=0,l=p*p;0<=l?t<l:t>l;e=0<=l?++t:--t)push(p1.tensor.elem[e]);for(INV_decomp(p),(p1=alloc_tensor(p*p)).tensor.ndim=2,p1.tensor.dim[0]=p,p1.tensor.dim[1]=p,e=n=0,c=p*p;0<=c?n<c:n>c;e=0<=c?++n:--n)p1.tensor.elem[e]=stack[r+e];return moveTos(tos-2*p*p),push(p1)},INV_decomp=function(r){var e,s,o,t,n,p,i,a,u,l,c,d,_,m,f;for(0,s=0,o=0,n=0,0,f=(e=tos-r*r)-r*r,m=[],s=a=0,u=r;0<=u?a<u:a>u;s=0<=u?++a:--a){if(equal(stack[e+r*s+s],zero)){for(o=t=l=s+1,c=r;(l<=c?t<c:t>c)&&equal(stack[e+r*o+s],zero);o=l<=c?++t:--t);for(o===r&&stop("inverse of singular matrix"),n=p=0,d=r;0<=d?p<d:p>d;n=0<=d?++p:--p)p2=stack[e+r*s+n],stack[e+r*s+n]=stack[e+r*o+n],stack[e+r*o+n]=p2,p2=stack[f+r*s+n],stack[f+r*s+n]=stack[f+r*o+n],stack[f+r*o+n]=p2}for(p2=stack[e+r*s+s],n=i=0,_=r;0<=_?i<_:i>_;n=0<=_?++i:--i)n>s&&(push(stack[e+r*s+n]),push(p2),divide(),stack[e+r*s+n]=pop()),push(stack[f+r*s+n]),push(p2),divide(),stack[f+r*s+n]=pop();m.push(function(){var t,p,i;for(i=[],o=t=0,p=r;0<=p?t<p:t>p;o=0<=p?++t:--t)o!==s&&(p2=stack[e+r*o+s],i.push(function(){var t,p,i;for(i=[],n=t=0,p=r;0<=p?t<p:t>p;n=0<=p?++t:--t)n>s&&(push(stack[e+r*o+n]),push(stack[e+r*s+n]),push(p2),multiply(),subtract(),stack[e+r*o+n]=pop()),push(stack[f+r*o+n]),push(stack[f+r*s+n]),push(p2),multiply(),subtract(),i.push(stack[f+r*o+n]=pop());return i}()));return i}())}return m},DEBUG_IS=!1,isZeroAtomOrTensor=function(r){var e,s,o;switch(e=0,r.k){case NUM:if(MZERO(r.q.a))return 1;break;case DOUBLE:if(0===r.d)return 1;break;case TENSOR:for(e=s=0,o=r.tensor.nelem;0<=o?s<o:s>o;e=0<=o?++s:--s)if(!isZeroAtomOrTensor(r.tensor.elem[e]))return 0;return 1}return 0},isZeroLikeOrNonZeroLikeOrUndetermined=function(r){var e;if(push(r),Eval_predicate(),e=pop(),isZeroAtomOrTensor(e))return 0;if(isNumericAtomOrTensor(e))return 1;if(push(e),zzfloat(),e=pop(),isZeroAtomOrTensor(e))return 0;if(isNumericAtomOrTensor(e))return 1;if(Find(e,imaginaryunit)){if(push(e),absValFloat(),Eval_predicate(),e=pop(),isZeroAtomOrTensor(e))return 0;if(isNumericAtomOrTensor(e))return 1}return null},isnegativenumber=function(r){switch(r.k){case NUM:if(-1===MSIGN(r.q.a))return 1;break;case DOUBLE:if(r.d<0)return 1}return 0},ispositivenumber=function(r){switch(r.k){case NUM:if(1===MSIGN(r.q.a))return 1;break;case DOUBLE:if(r.d>0)return 1}return 0},isplustwo=function(r){switch(r.k){case NUM:if(MEQUAL(r.q.a,2)&&MEQUAL(r.q.b,1))return 1;break;case DOUBLE:if(2===r.d)return 1}return 0},isplusone=function(r){switch(r.k){case NUM:if(MEQUAL(r.q.a,1)&&MEQUAL(r.q.b,1))return 1;break;case DOUBLE:if(1===r.d)return 1}return 0},isminusone=function(r){switch(r.k){case NUM:if(MEQUAL(r.q.a,-1)&&MEQUAL(r.q.b,1))return 1;break;case DOUBLE:if(-1===r.d)return 1}return 0},isone=function(r){return isplusone(r)||isminusone(r)},isinteger=function(r){return r.k===NUM&&MEQUAL(r.q.b,1)?1:0},isintegerorintegerfloat=function(r){return r.k===DOUBLE?r.d===Math.round(r.d)?1:0:isinteger(r)},isnonnegativeinteger=function(r){return isrational(r)&&MEQUAL(r.q.b,1)&&1===MSIGN(r.q.a)?1:0},isposint=function(r){return isinteger(r)&&1===MSIGN(r.q.a)?1:0},ispoly=function(r,e){return Find(r,e)?ispoly_expr(r,e):0},ispoly_expr=function(r,e){if(car(r)===symbol(ADD)){for(r=cdr(r);iscons(r);){if(!ispoly_term(car(r),e))return 0;r=cdr(r)}return 1}return ispoly_term(r,e)},ispoly_term=function(r,e){if(car(r)===symbol(MULTIPLY)){for(r=cdr(r);iscons(r);){if(!ispoly_factor(car(r),e))return 0;r=cdr(r)}return 1}return ispoly_factor(r,e)},ispoly_factor=function(r,e){return equal(r,e)?1:car(r)===symbol(POWER)&&equal(cadr(r),e)?isposint(caddr(r))?1:0:Find(r,e)?0:1},isnegativeterm=function(r){return isnegativenumber(r)?1:car(r)===symbol(MULTIPLY)&&isnegativenumber(cadr(r))?1:0},hasNegativeRationalExponent=function(r){return car(r)===symbol(POWER)&&isrational(car(cdr(cdr(r))))&&isnegativenumber(car(cdr(r)))?(DEBUG_IS&&console.log("hasNegativeRationalExponent: "+r.toString()+" has imaginary component"),1):(DEBUG_IS&&console.log("hasNegativeRationalExponent: "+r.toString()+" has NO imaginary component"),0)},isimaginarynumberdouble=function(r){return car(r)===symbol(MULTIPLY)&&3===length(r)&&isdouble(cadr(r))&&hasNegativeRationalExponent(caddr(r))||equal(r,imaginaryunit)?1:0},isimaginarynumber=function(r){return car(r)===symbol(MULTIPLY)&&3===length(r)&&isNumericAtom(cadr(r))&&equal(caddr(r),imaginaryunit)||equal(r,imaginaryunit)||hasNegativeRationalExponent(caddr(r))?(DEBUG_IS&&console.log("isimaginarynumber: "+r.toString()+" is imaginary number"),1):(DEBUG_IS&&console.log("isimaginarynumber: "+r.toString()+" isn't an imaginary number"),0)},iscomplexnumberdouble=function(r){return car(r)===symbol(ADD)&&3===length(r)&&isdouble(cadr(r))&&isimaginarynumberdouble(caddr(r))||isimaginarynumberdouble(r)?1:0},iscomplexnumber=function(r){return car(r)===symbol(ADD)&&3===length(r)&&isNumericAtom(cadr(r))&&isimaginarynumber(caddr(r))||isimaginarynumber(r)?(DEBUG&&console.log("iscomplexnumber: "+r.toString()+" is imaginary number"),1):(DEBUG&&console.log("iscomplexnumber: "+r.toString()+" is imaginary number"),0)},iseveninteger=function(r){return isinteger(r)&&r.q.a.isEven()?1:0},isnegative=function(r){return car(r)===symbol(ADD)&&isnegativeterm(cadr(r))?1:isnegativeterm(r)?1:0},issymbolic=function(r){if(issymbol(r))return 1;for(;iscons(r);){if(issymbolic(car(r)))return 1;r=cdr(r)}return 0},isintegerfactor=function(r){return isinteger(r)||car(r)===symbol(POWER)&&isinteger(cadr(r))&&isinteger(caddr(r))?1:0},isNumberOneOverSomething=function(r){return isfraction(r)&&1===Math.abs(r.q.a.value)?1:0},isoneover=function(r){return car(r)===symbol(POWER)&&isminusone(caddr(r))?1:0},isfraction=function(r){return r.k!==NUM||MEQUAL(r.q.b,1)?0:1},equaln=function(r,e){switch(r.k){case NUM:if(MEQUAL(r.q.a,e)&&MEQUAL(r.q.b,1))return 1;break;case DOUBLE:if(r.d===e)return 1}return 0},equalq=function(r,e,s){switch(r.k){case NUM:if(MEQUAL(r.q.a,e)&&MEQUAL(r.q.b,s))return 1;break;case DOUBLE:if(r.d===e/s)return 1}return 0},isoneovertwo=function(r){return equalq(r,1,2)?1:0},isminusoneovertwo=function(r){return equalq(r,-1,2)?1:0},isoneoversqrttwo=function(r){return car(r)===symbol(POWER)&&equaln(cadr(r),2)&&equalq(caddr(r),-1,2)?1:0},isminusoneoversqrttwo=function(r){return car(r)===symbol(MULTIPLY)&&equaln(cadr(r),-1)&&isoneoversqrttwo(caddr(r))&&3===length(r)?1:0},isfloating=function(r){if(r.k===DOUBLE||r===symbol(FLOATF))return 1;for(;iscons(r);){if(isfloating(car(r)))return 1;r=cdr(r)}return 0},isimaginaryunit=function(r){return equal(r,imaginaryunit)?1:0},isquarterturn=function(r){var e,s;if(s=0,e=0,car(r)!==symbol(MULTIPLY))return 0;if(equal(cadr(r),imaginaryunit))return caddr(r)!==symbol(PI)?0:3!==length(r)?0:2;if(!isNumericAtom(cadr(r)))return 0;if(!equal(caddr(r),imaginaryunit))return 0;if(cadddr(r)!==symbol(PI))return 0;if(4!==length(r))return 0;if(push(cadr(r)),push_integer(2),multiply(),s=pop_integer(),isNaN(s))return 0;switch(s<1&&(e=1,s=-s),s%4){case 0:s=1;break;case 1:s=e?4:3;break;case 2:s=2;break;case 3:s=e?3:4}return s},isnpi=function(r){var e;return e=0,r===symbol(PI)?2:car(r)===symbol(MULTIPLY)&&isNumericAtom(cadr(r))&&caddr(r)===symbol(PI)&&3===length(r)?(0,push(cadr(r)),push_integer(2),multiply(),e=pop_integer(),isNaN(e)?0:e=e<0?4- -e%4:1+(e-1)%4):0},$.isZeroAtomOrTensor=isZeroAtomOrTensor,$.isnegativenumber=isnegativenumber,$.isplusone=isplusone,$.isminusone=isminusone,$.isinteger=isinteger,$.isnonnegativeinteger=isnonnegativeinteger,$.isposint=isposint,$.isnegativeterm=isnegativeterm,$.isimaginarynumber=isimaginarynumber,$.iscomplexnumber=iscomplexnumber,$.iseveninteger=iseveninteger,$.isnegative=isnegative,$.issymbolic=issymbolic,$.isintegerfactor=isintegerfactor,$.isoneover=isoneover,$.isfraction=isfraction,$.isoneoversqrttwo=isoneoversqrttwo,$.isminusoneoversqrttwo=isminusoneoversqrttwo,$.isfloating=isfloating,$.isimaginaryunit=isimaginaryunit,$.isquarterturn=isquarterturn,$.isnpi=isnpi,Eval_isprime=function(){return push(cadr(p1)),Eval(),p1=pop(),isnonnegativeinteger(p1)&&mprime(p1.q.a)?push_integer(1):push_integer(0)},Eval_laguerre=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),push(cadddr(p1)),Eval(),(p2=pop())===symbol(NIL)?push_integer(0):push(p2),laguerre()},laguerre=function(){var r;return 0,save(),p3=pop(),p2=pop(),p1=pop(),push(p2),(r=pop_integer())<0||isNaN(r)?(push_symbol(LAGUERRE),push(p1),push(p2),push(p3),list(4),void restore()):(issymbol(p1)?laguerre2(r):(p4=p1,p1=symbol(SECRETX),laguerre2(r),p1=p4,push(symbol(SECRETX)),push(p1),subst(),Eval()),restore())},laguerre2=function(r){var e,s,o,t;for(e=0,push_integer(1),push_integer(0),p6=pop(),t=[],e=s=0,o=r;0<=o?s<o:s>o;e=0<=o?++s:--s)p5=p6,p6=pop(),push_integer(2*e+1),push(p1),subtract(),push(p3),add(),push(p6),multiply(),push_integer(e),push(p3),add(),push(p5),multiply(),subtract(),push_integer(e+1),t.push(divide());return t},Eval_lcm=function(){var r;for(p1=cdr(p1),push(car(p1)),Eval(),p1=cdr(p1),r=[];iscons(p1);)push(car(p1)),Eval(),lcm(),r.push(p1=cdr(p1));return r},lcm=function(){var r;return r=expanding,save(),yylcm(),restore(),expanding=r},yylcm=function(){return expanding=1,p2=pop(),p1=pop(),push(p1),push(p2),gcd(),push(p1),divide(),push(p2),divide(),inverse()},Eval_leading=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),(p1=pop())===symbol(NIL)?guess():push(p1),leading()},leading=function(){return save(),p2=pop(),p1=pop(),push(p1),push(p2),degree(),p3=pop(),push(p1),push(p2),push(p3),power(),divide(),push(p2),filter(),restore()},Eval_legendre=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),push(cadddr(p1)),Eval(),(p2=pop())===symbol(NIL)?push_integer(0):push(p2),legendre()},legendre=function(){return save(),__legendre(),restore()},__legendre=function(){var r,e;return 0,0,p3=pop(),p2=pop(),p1=pop(),push(p2),e=pop_integer(),push(p3),r=pop_integer(),e<0||isNaN(e)||r<0||isNaN(r)?(push_symbol(LEGENDRE),push(p1),push(p2),push(p3),void list(4)):(issymbol(p1)?__legendre2(e,r):(p4=p1,p1=symbol(SECRETX),__legendre2(e,r),p1=p4,push(symbol(SECRETX)),push(p1),subst(),Eval()),__legendre3(r))},__legendre2=function(r,e){var s,o,t,n,p,i;for(s=0,push_integer(1),push_integer(0),p6=pop(),s=t=0,n=r;0<=n?t<n:t>n;s=0<=n?++t:--t)p5=p6,p6=pop(),push_integer(2*s+1),push(p1),multiply(),push(p6),multiply(),push_integer(s),push(p5),multiply(),subtract(),push_integer(s+1),divide();for(i=[],s=o=0,p=e;0<=p?o<p:o>p;s=0<=p?++o:--o)push(p1),i.push(derivative());return i},__legendre3=function(r){if(0!==r)return car(p1)===symbol(COS)?(push(cadr(p1)),sine(),square()):car(p1)===symbol(SIN)?(push(cadr(p1)),cosine(),square()):(push_integer(1),push(p1),square(),subtract()),push_integer(r),push_rational(1,2),multiply(),power(),multiply(),r%2?negate():void 0},list=function(r){var e,s,o;for(0,push(symbol(NIL)),o=[],e=0,s=r;0<=s?e<s:e>s;0<=s?++e:--e)o.push(cons());return o},Eval_log=function(){return push(cadr(p1)),Eval(),logarithm()},logarithm=function(){return save(),yylog(),restore()},yylog=function(){var r;if(r=0,(p1=pop())!==symbol(E))if(equaln(p1,1))push_integer(0);else{if(isnegativenumber(p1))return push(p1),negate(),logarithm(),push(imaginaryunit),evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),multiply(),void add();if(isdouble(p1))return r=Math.log(p1.d),void push_double(r);if(isfraction(p1))return push(p1),numerator(),logarithm(),push(p1),denominator(),logarithm(),void subtract();if(car(p1)===symbol(POWER))return push(caddr(p1)),push(cadr(p1)),logarithm(),void multiply();if(car(p1)!==symbol(MULTIPLY))return push_symbol(LOG),push(p1),list(2);for(push_integer(0),p1=cdr(p1);iscons(p1);)push(car(p1)),logarithm(),add(),p1=cdr(p1)}else push_integer(1)},Eval_lookup=function(){return p1=cadr(p1),iscons(p1)||cadr(p1).k!==SYM||(p1=get_binding(p1)),push(p1)},madd=function(r,e){return r.add(e)},msub=function(r,e){return r.subtract(e)},addf=function(r,e){return r.add(e)},subf=function(r,e){return r.subtract(e)},ucmp=function(r,e){return r.compareAbs(e)},mgcd=function(r,e){return bigInt.gcd(r,e)},new_string=function(r){return save(),(p1=new U).k=STR,p1.str=r,push(p1),restore()},out_of_memory=function(){return stop("out of memory")},push_zero_matrix=function(r,e){return push(alloc_tensor(r*e)),stack[tos-1].tensor.ndim=2,stack[tos-1].tensor.dim[0]=r,stack[tos-1].tensor.dim[1]=e},push_identity_matrix=function(r){var e,s,o;for(push_zero_matrix(r,r),e=0,e=s=0,o=r;0<=o?s<o:s>o;e=0<=o?++s:--s)stack[tos-1].tensor.elem[e*r+e]=one;return check_tensor_dimensions(stack[tos-1])},push_cars=function(r){var e;for(e=[];iscons(r);)push(car(r)),e.push(r=cdr(r));return e},peek=function(){return save(),p1=pop(),push(p1),restore()},equal=function(r,e){return 0===cmp_expr(r,e)?1:0},lessp=function(r,e){return cmp_expr(r,e)<0?1:0},sign=function(r){return r<0?-1:r>0?1:0},cmp_expr=function(r,e){var s;if(s=0,r===e)return 0;if(r===symbol(NIL))return-1;if(e===symbol(NIL))return 1;if(isNumericAtom(r)&&isNumericAtom(e))return sign(compare_numbers(r,e));if(isNumericAtom(r))return-1;if(isNumericAtom(e))return 1;if(isstr(r)&&isstr(e))return sign(strcmp(r.str,e.str));if(isstr(r))return-1;if(isstr(e))return 1;if(issymbol(r)&&issymbol(e))return sign(strcmp(get_printname(r),get_printname(e)));if(issymbol(r))return-1;if(issymbol(e))return 1;if(istensor(r)&&istensor(e))return compare_tensors(r,e);if(istensor(r))return-1;if(istensor(e))return 1;for(;iscons(r)&&iscons(e);){if(0!==(s=cmp_expr(car(r),car(e))))return s;r=cdr(r),e=cdr(e)}return iscons(e)?-1:iscons(r)?1:0},length=function(r){var e;for(e=0;iscons(r);)r=cdr(r),e++;return e},unique=function(r){return save(),p1=symbol(NIL),p2=symbol(NIL),unique_f(r),p2!==symbol(NIL)&&(p1=symbol(NIL)),r=p1,restore(),r},unique_f=function(r){if(isstr(r))p1===symbol(NIL)?p1=r:r!==p1&&(p2=r);else for(;iscons(r);){if(unique_f(car(r)),p2!==symbol(NIL))return;r=cdr(r)}},ssqrt=function(){return push_rational(1,2),power()},yyexpand=function(){var r;return r=expanding,expanding=1,Eval(),expanding=r},exponential=function(){return push_symbol(E),swap(),power()},square=function(){return push_integer(2),power()},sort_stack=function(r){var e,s;return e=tos-r,(s=stack.slice(e,e+r)).sort(cmp_expr),stack=stack.slice(0,e).concat(s).concat(stack.slice(e+r))},$.equal=equal,$.length=length,mmul=function(r,e){return r.multiply(e)},mdiv=function(r,e){return r.divide(e)},mmod=function(r,e){return r.mod(e)},mdivrem=function(r,e){var s;return[(s=r.divmod(e)).quotient,s.remainder]},Eval_mod=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),mod()},mod=function(){var r;return r=0,save(),p2=pop(),p1=pop(),isZeroAtomOrTensor(p2)&&stop("mod function: divide by zero"),isNumericAtom(p1)&&isNumericAtom(p2)?(isdouble(p1)&&(push(p1),r=pop_integer(),isNaN(r)&&stop("mod function: cannot convert float value to integer"),push_integer(r),p1=pop()),isdouble(p2)&&(push(p2),r=pop_integer(),isNaN(r)&&stop("mod function: cannot convert float value to integer"),push_integer(r),p2=pop()),isinteger(p1)&&isinteger(p2)||stop("mod function: integer arguments expected"),(p3=new U).k=NUM,p3.q.a=mmod(p1.q.a,p2.q.a),p3.q.b=mint(1),push(p3),restore()):(push_symbol(MOD),push(p1),push(p2),list(3),void restore())},mpow=function(r,e){return r.pow(e)},mprime=function(r){return r.isProbablePrime()},mroot=function(r,e){var s,o,t,n,p,i,a;for(r=r.abs(),s=0,0,t=0,0===e&&stop("root index is zero"),t=0;r.shiftRight(t)>0;)t++;if(0===t)return mint(0);for(t=Math.floor((t-1)/e),o=Math.floor(t/32+1),i=bigInt(o),s=n=0,p=o;0<=p?n<p:n>p;s=0<=p?++n:--n)i=i.and(bigInt(1).shiftLeft(s).not());for(;t>=0;){switch(i=i.or(bigInt(1).shiftLeft(t)),a=mpow(i,e),mcmp(a,r)){case 0:return i;case 1:i=i.and(bigInt(1).shiftLeft(t).not())}t--}return 0},Eval_multiply=function(){var r;for(push(cadr(p1)),Eval(),p1=cddr(p1),r=[];iscons(p1);)push(car(p1)),Eval(),multiply(),r.push(p1=cdr(p1));return r},multiply=function(){return esc_flag&&stop("escape key stop"),isNumericAtom(stack[tos-2])&&isNumericAtom(stack[tos-1])?multiply_numbers():(save(),yymultiply(),restore())},yymultiply=function(){var r,e,s,o,t,n;if(0,e=0,0,p2=pop(),p1=pop(),r=tos,isZeroAtomOrTensor(p1)||isZeroAtomOrTensor(p2))evaluatingAsFloats?push_double(0):push(zero);else if(expanding&&isadd(p1))for(p1=cdr(p1),evaluatingAsFloats?push_double(0):push(zero);iscons(p1);)push(car(p1)),push(p2),multiply(),add(),p1=cdr(p1);else if(expanding&&isadd(p2))for(p2=cdr(p2),evaluatingAsFloats?push_double(0):push(zero);iscons(p2);)push(p1),push(car(p2)),multiply(),add(),p2=cdr(p2);else{if(!istensor(p1)&&istensor(p2))return push(p1),push(p2),void scalar_times_tensor();if(istensor(p1)&&!istensor(p2))return push(p1),push(p2),void tensor_times_scalar();for(car(p1)===symbol(MULTIPLY)?p1=cdr(p1):(push(p1),list(1),p1=pop()),car(p2)===symbol(MULTIPLY)?p2=cdr(p2):(push(p2),list(1),p2=pop()),isNumericAtom(car(p1))&&isNumericAtom(car(p2))?(push(car(p1)),push(car(p2)),multiply_numbers(),p1=cdr(p1),p2=cdr(p2)):isNumericAtom(car(p1))?(push(car(p1)),p1=cdr(p1)):isNumericAtom(car(p2))?(push(car(p2)),p2=cdr(p2)):evaluatingAsFloats?push_double(1):push(one),parse_p1(),parse_p2();iscons(p1)&&iscons(p2);)if(caar(p1)!==symbol(OPERATOR)||caar(p2)!==symbol(OPERATOR))switch(cmp_expr(p3,p4)){case-1:push(car(p1)),p1=cdr(p1),parse_p1();break;case 1:push(car(p2)),p2=cdr(p2),parse_p2();break;case 0:combine_factors(r),p1=cdr(p1),p2=cdr(p2),parse_p1(),parse_p2();break;default:stop("internal error 2")}else push_symbol(OPERATOR),push(cdar(p1)),push(cdar(p2)),append(),cons(),p1=cdr(p1),p2=cdr(p2),parse_p1(),parse_p2();for(;iscons(p1);)push(car(p1)),p1=cdr(p1);for(;iscons(p2);)push(car(p2)),p2=cdr(p2);if(__normalize_radical_factors(r),expanding)for(e=o=t=r,n=tos;t<=n?o<n:o>n;e=t<=n?++o:--o)if(isadd(stack[e]))return void multiply_all(tos-r);if(1!==(s=tos-r)){if(!isrational(stack[r])||!equaln(stack[r],1))return list(s),p7=pop(),push_symbol(MULTIPLY),push(p7),cons();2===s?(p7=pop(),pop(),push(p7)):(stack[r]=symbol(MULTIPLY),list(s))}}},parse_p1=function(){if(p3=car(p1),p5=evaluatingAsFloats?one_as_double:one,car(p3)===symbol(POWER))return p5=caddr(p3),p3=cadr(p3)},parse_p2=function(){if(p4=car(p2),p6=evaluatingAsFloats?one_as_double:one,car(p4)===symbol(POWER))return p6=caddr(p4),p4=cadr(p4)},combine_factors=function(r){return push(p4),push(p5),push(p6),add(),power(),p7=pop(),isNumericAtom(p7)?(push(stack[r]),push(p7),multiply_numbers(),stack[r]=pop()):car(p7)===symbol(MULTIPLY)&&isNumericAtom(cadr(p7))&&cdddr(p7)===symbol(NIL)?(push(stack[r]),push(cadr(p7)),multiply_numbers(),stack[r]=pop(),push(caddr(p7))):push(p7)},gp=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,-6,-7,-8,-3,-4,-5,13,14,15,-16,9,10,11,-12],[0,0,6,-1,-11,10,-2,-15,14,12,-5,4,-9,16,-8,7,-13],[0,0,7,11,-1,-9,15,-2,-13,5,12,-3,-10,8,16,-6,-14],[0,0,8,-10,9,-1,-14,13,-2,-4,3,12,-11,-7,6,16,-15],[0,0,3,2,15,-14,1,11,-10,16,-8,7,13,12,-5,4,9],[0,0,4,-15,2,13,-11,1,9,8,16,-6,14,5,12,-3,10],[0,0,5,14,-13,2,10,-9,1,-7,6,16,15,-4,3,12,11],[0,0,13,12,-5,4,16,-8,7,-1,-11,10,-3,-2,-15,14,-6],[0,0,14,5,12,-3,8,16,-6,11,-1,-9,-4,15,-2,-13,-7],[0,0,15,-4,3,12,-7,6,16,-10,9,-1,-5,-14,13,-2,-8],[0,0,16,-9,-10,-11,-13,-14,-15,-3,-4,-5,1,-6,-7,-8,2],[0,0,9,-16,8,-7,-12,5,-4,-2,-15,14,6,-1,-11,10,3],[0,0,10,-8,-16,6,-5,-12,3,15,-2,-13,7,11,-1,-9,4],[0,0,11,7,-6,-16,4,-3,-12,-14,13,-2,8,-10,9,-1,5],[0,0,12,13,14,15,9,10,11,-6,-7,-8,-2,-3,-4,-5,-1]],combine_gammas=function(r){var e;if((e=gp[Math.floor(p1.gamma)][Math.floor(p2.gamma)])<0&&(e=-e,push(stack[r]),negate(),stack[r]=pop()),e>1)return push(_gamma[e])},multiply_noexpand=function(){var r;return r=expanding,expanding=0,multiply(),expanding=r},multiply_all=function(r){var e,s,o,t;if(s=0,1!==r){if(0!==r){for(push(stack[e=tos-r]),s=o=1,t=r;1<=t?o<t:o>t;s=1<=t?++o:--o)push(stack[e+s]),multiply();return stack[e]=pop(),moveTos(e+1)}push(evaluatingAsFloats?one_as_double:one)}},multiply_all_noexpand=function(r){var e;return e=expanding,expanding=0,multiply_all(r),expanding=e},divide=function(){return isNumericAtom(stack[tos-2])&&isNumericAtom(stack[tos-1])?divide_numbers():(inverse(),multiply())},inverse=function(){return isNumericAtom(stack[tos-1])?invert_number():(push_integer(-1),power())},reciprocate=function(){return inverse()},negate=function(){return isNumericAtom(stack[tos-1])?negate_number():(evaluatingAsFloats?push_double(-1):push_integer(-1),multiply())},negate_expand=function(){var r;return r=expanding,expanding=1,negate(),expanding=r},negate_noexpand=function(){var r;return r=expanding,expanding=0,negate(),expanding=r},__normalize_radical_factors=function(r){var e,s,o,t,n,p,i,a,u,l;if(e=0,!(isplusone(stack[r])||isminusone(stack[r])||isdouble(stack[r]))){for(e=t=n=r+1,p=tos;(n<=p?t<p:t>p)&&!__is_radical_number(stack[e]);e=n<=p?++t:--t);if(e!==tos){for(save(),push(stack[r]),mp_numerator(),p1=pop(),e=s=i=r+1,a=tos;(i<=a?s<a:s>a)&&(!isplusone(p1)&&!isminusone(p1));e=i<=a?++s:--s)__is_radical_number(stack[e])&&(p3=cadr(stack[e]),p4=caddr(stack[e]),isnegativenumber(p4)&&(push(p1),push(p3),divide(),p5=pop(),isinteger(p5)&&(p1=p5,push_symbol(POWER),push(p3),push(evaluatingAsFloats?one_as_double:one),push(p4),add(),list(3),stack[e]=pop())));for(push(stack[r]),mp_denominator(),p2=pop(),e=o=u=r+1,l=tos;(u<=l?o<l:o>l)&&!isplusone(p2);e=u<=l?++o:--o)if(__is_radical_number(stack[e])&&(p3=cadr(stack[e]),p4=caddr(stack[e]),!isnegativenumber(p4)&&(push(p2),push(p3),divide(),p5=pop(),isinteger(p5)))){if(p2=p5,push_symbol(POWER),push(p3),push(p4),push(one),subtract(),dontCreateNewRadicalsInDenominatorWhenEvalingMultiplication&&isinteger(p3)&&!isinteger(stack[tos-1])&&isnegativenumber(stack[tos-1])){pop(),pop(),pop(),push(p1),push(p3),divide(),p1=pop();break}list(3),stack[e]=pop()}return push(p1),push(p2),divide(),stack[r]=pop(),restore()}}},__is_radical_number=function(r){return car(r)===symbol(POWER)&&isNumericAtom(cadr(r))&&isNumericAtom(caddr(r))&&!isminusone(cadr(r))?1:0},NROOTS_YMAX=101,NROOTS_DELTA=1e-6,NROOTS_EPSILON=1e-9,NROOTS_ABS=function(r){return Math.sqrt(r.r*r.r+r.i*r.i)},theRandom=0,NROOTS_RANDOM=function(){return 4*Math.random()-2},numericRootOfPolynomial=function(){class r{}return r.prototype.r=0,r.prototype.i=0,r}.call(this),nroots_a=new numericRootOfPolynomial,nroots_b=new numericRootOfPolynomial,nroots_x=new numericRootOfPolynomial,nroots_y=new numericRootOfPolynomial,nroots_fa=new numericRootOfPolynomial,nroots_fb=new numericRootOfPolynomial,nroots_dx=new numericRootOfPolynomial,nroots_df=new numericRootOfPolynomial,nroots_c=[],initNRoots=o=0,ref=NROOTS_YMAX;0<=ref?o<ref:o>ref;initNRoots=0<=ref?++o:--o)nroots_c[initNRoots]=new numericRootOfPolynomial;for(Eval_nroots=function(){var r,e,s,o,t,n,p,i,a;for(0,e=0,t=0,p=0,push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),(p2=pop())===symbol(NIL)?guess():push(p2),p2=pop(),p1=pop(),ispoly(p1,p2)||stop("nroots: polynomial?"),r=tos,push(p1),push(p2),(p=coeff())>NROOTS_YMAX&&stop("nroots: degree?"),e=s=0,i=p;0<=i?s<i:s>i;e=0<=i?++s:--s)push(stack[r+e]),real(),yyfloat(),Eval(),p1=pop(),push(stack[r+e]),imag(),yyfloat(),Eval(),p2=pop(),isdouble(p1)&&isdouble(p2)||stop("nroots: coefficients?"),nroots_c[e].r=p1.d,nroots_c[e].i=p2.d;for(moveTos(r),monic(p),t=o=p;o>1;t=o+=-1)findroot(t),Math.abs(nroots_a.r)<NROOTS_DELTA&&(nroots_a.r=0),Math.abs(nroots_a.i)<NROOTS_DELTA&&(nroots_a.i=0),push_double(nroots_a.r),push_double(nroots_a.i),push(imaginaryunit),multiply(),add(),NROOTS_divpoly(t);if((p=tos-r)>1){for(sort_stack(p),(p1=alloc_tensor(p)).tensor.ndim=1,p1.tensor.dim[0]=p,e=n=0,a=p;0<=a?n<a:n>a;e=0<=a?++n:--n)p1.tensor.elem[e]=stack[r+e];return moveTos(r),push(p1)}},monic=function(r){var e,s,o,t;for(s=0,0,nroots_y.r=nroots_c[r-1].r,nroots_y.i=nroots_c[r-1].i,t=nroots_y.r*nroots_y.r+nroots_y.i*nroots_y.i,s=e=0,o=r-1;0<=o?e<o:e>o;s=0<=o?++e:--e)nroots_c[s].r=(nroots_c[s].r*nroots_y.r+nroots_c[s].i*nroots_y.i)/t,nroots_c[s].i=(nroots_c[s].i*nroots_y.r-nroots_c[s].r*nroots_y.i)/t;return nroots_c[r-1].r=1,nroots_c[r-1].i=0},findroot=function(r){var e,s,o,t;if(0,0,t=0,NROOTS_ABS(nroots_c[0])<NROOTS_DELTA)return nroots_a.r=0,void(nroots_a.i=0);for(e=0;e<100;++e)for(nroots_a.r=NROOTS_RANDOM(),nroots_a.i=NROOTS_RANDOM(),compute_fa(r),nroots_b.r=nroots_a.r,nroots_b.i=nroots_a.i,nroots_fb.r=nroots_fa.r,nroots_fb.i=nroots_fa.i,nroots_a.r=NROOTS_RANDOM(),nroots_a.i=NROOTS_RANDOM(),s=0;s<1e3;++s){if(compute_fa(r),o=NROOTS_ABS(nroots_fa),DEBUG&&console.log("nrabs: "+o),o<NROOTS_EPSILON)return;if(NROOTS_ABS(nroots_fa)<NROOTS_ABS(nroots_fb)&&(nroots_x.r=nroots_a.r,nroots_x.i=nroots_a.i,nroots_a.r=nroots_b.r,nroots_a.i=nroots_b.i,nroots_b.r=nroots_x.r,nroots_b.i=nroots_x.i,nroots_x.r=nroots_fa.r,nroots_x.i=nroots_fa.i,nroots_fa.r=nroots_fb.r,nroots_fa.i=nroots_fb.i,nroots_fb.r=nroots_x.r,nroots_fb.i=nroots_x.i),nroots_dx.r=nroots_b.r-nroots_a.r,nroots_dx.i=nroots_b.i-nroots_a.i,nroots_df.r=nroots_fb.r-nroots_fa.r,nroots_df.i=nroots_fb.i-nroots_fa.i,0===(t=nroots_df.r*nroots_df.r+nroots_df.i*nroots_df.i))break;nroots_y.r=(nroots_dx.r*nroots_df.r+nroots_dx.i*nroots_df.i)/t,nroots_y.i=(nroots_dx.i*nroots_df.r-nroots_dx.r*nroots_df.i)/t,nroots_a.r=nroots_b.r-(nroots_y.r*nroots_fb.r-nroots_y.i*nroots_fb.i),nroots_a.i=nroots_b.i-(nroots_y.r*nroots_fb.i+nroots_y.i*nroots_fb.r)}return stop("nroots: convergence error")},compute_fa=function(r){var e,s,o,t,n;for(s=0,n=0,nroots_x.r=nroots_a.r,nroots_x.i=nroots_a.i,nroots_fa.r=nroots_c[0].r+nroots_c[1].r*nroots_x.r-nroots_c[1].i*nroots_x.i,nroots_fa.i=nroots_c[0].i+nroots_c[1].r*nroots_x.i+nroots_c[1].i*nroots_x.r,t=[],s=e=2,o=r;2<=o?e<o:e>o;s=2<=o?++e:--e)n=nroots_a.r*nroots_x.r-nroots_a.i*nroots_x.i,nroots_x.i=nroots_a.r*nroots_x.i+nroots_a.i*nroots_x.r,nroots_x.r=n,nroots_fa.r+=nroots_c[s].r*nroots_x.r-nroots_c[s].i*nroots_x.i,t.push(nroots_fa.i+=nroots_c[s].r*nroots_x.i+nroots_c[s].i*nroots_x.r);return t},NROOTS_divpoly=function(r){var e,s,o,t,n,p;for(o=0,o=e=t=r-1;t<=0?e<0:e>0;o=t<=0?++e:--e)nroots_c[o-1].r+=nroots_c[o].r*nroots_a.r-nroots_c[o].i*nroots_a.i,nroots_c[o-1].i+=nroots_c[o].i*nroots_a.r+nroots_c[o].r*nroots_a.i;for(NROOTS_ABS(nroots_c[0])>NROOTS_DELTA&&stop("nroots: residual error"),p=[],o=s=0,n=r-1;0<=n?s<n:s>n;o=0<=n?++s:--s)nroots_c[o].r=nroots_c[o+1].r,p.push(nroots_c[o].i=nroots_c[o+1].i);return p},Eval_numerator=function(){return push(cadr(p1)),Eval(),numerator()},numerator=function(){var r,e;if(r=0,e=pop(),car(e)===symbol(ADD)&&(push(e),rationalize(),e=pop()),car(e)!==symbol(MULTIPLY)||isplusone(car(cdr(e))))return isrational(e)?(push(e),mp_numerator()):car(e)===symbol(POWER)&&isnegativeterm(caddr(e))?push(one):push(e);for(r=tos,e=cdr(e);iscons(e);)push(car(e)),numerator(),e=cdr(e);return multiply_all(tos-r)},Eval_outer=function(){var r;for(p1=cdr(p1),push(car(p1)),Eval(),p1=cdr(p1),r=[];iscons(p1);)push(car(p1)),Eval(),outer(),r.push(p1=cdr(p1));return r},outer=function(){return save(),p2=pop(),p1=pop(),istensor(p1)&&istensor(p2)?yyouter():(push(p1),push(p2),istensor(p1)?tensor_times_scalar():istensor(p2)?scalar_times_tensor():multiply()),restore()},yyouter=function(){var r,e,s,o,t,n,p,i,a,u,l,c,d;for(r=0,s=0,t=0,0,0,(i=p1.tensor.ndim+p2.tensor.ndim)>MAXDIM&&stop("outer: rank of result exceeds maximum"),a=p1.tensor.nelem*p2.tensor.nelem,(p3=alloc_tensor(a)).tensor.ndim=i,r=e=0,u=p1.tensor.ndim;0<=u?e<u:e>u;r=0<=u?++e:--e)p3.tensor.dim[r]=p1.tensor.dim[r];for(s=r,r=o=0,l=p2.tensor.ndim;0<=l?o<l:o>l;r=0<=l?++o:--o)p3.tensor.dim[s+r]=p2.tensor.dim[r];for(t=0,r=n=0,c=p1.tensor.nelem;0<=c?n<c:n>c;r=0<=c?++n:--n)for(s=p=0,d=p2.tensor.nelem;0<=d?p<d:p>d;s=0<=d?++p:--p)push(p1.tensor.elem[r]),push(p2.tensor.elem[s]),multiply(),p3.tensor.elem[t++]=pop();return push(p3)},partition=function(){for(save(),p2=pop(),p1=pop(),push_integer(1),p3=pop(),p4=p3,p1=cdr(p1);iscons(p1);)Find(car(p1),p2)?(push(p4),push(car(p1)),multiply(),p4=pop()):(push(p3),push(car(p1)),multiply(),p3=pop()),p1=cdr(p1);return push(p3),push(p4),restore()},Eval_silentpattern=function(){return Eval_pattern(),pop(),push_symbol(NIL)},Eval_pattern=function(){var r,e,s,o,t;return iscons(cdr(p1))||stop("pattern needs at least a template and a transformed version"),r=car(cdr(p1)),(s=car(cdr(cdr(p1))))===symbol(NIL)&&stop("pattern needs at least a template and a transformed version"),t=iscons(cdr(cdr(p1)))?car(cdr(cdr(cdr(p1)))):symbol(NIL),equal(r,s)&&stop("recursive pattern"),o="template: "+print_list(r),o+=" tests: "+print_list(t),DEBUG&&console.log("pattern stringkey: "+o),-1===(e=userSimplificationsInStringForm.indexOf(o))?(userSimplificationsInStringForm.push(o),userSimplificationsInListForm.push(cdr(p1))):(DEBUG&&console.log("pattern already exists, replacing. "+cdr(p1)),userSimplificationsInStringForm[e]=o,userSimplificationsInListForm[e]=cdr(p1)),push_symbol(PATTERN),push(cdr(p1)),list(2)},do_clearPatterns=function(){return userSimplificationsInListForm=[],userSimplificationsInStringForm=[]},Eval_clearpatterns=function(){return do_clearPatterns(),push_symbol(NIL)},Eval_patternsinfo=function(){var r;return""!==(r=patternsinfo())?new_string(r):push_symbol(NIL)},patternsinfo=function(){var r,e,s;for(s="",r=0,e=userSimplificationsInListForm.length;r<e;r++)userSimplificationsInListForm[r],s+=userSimplificationsInListForm+"\n";return s},Eval_polar=function(){return push(cadr(p1)),Eval(),polar()},polar=function(){return evaluatingPolar++,save(),p1=pop(),push(p1),abs(),push(imaginaryunit),push(p1),arg(),multiply(),exponential(),multiply(),evaluatingPolar--,restore()},n_factor_number=0,factor_number=function(){var r;return 0,save(),p1=pop(),equaln(p1,0)||equaln(p1,1)||equaln(p1,-1)?(push(p1),void restore()):(n_factor_number=p1.q.a,r=tos,factor_a(),tos-r>1&&(list(tos-r),push_symbol(MULTIPLY),swap(),cons()),restore())},factor_a=function(){var r,e;for(e=0,n_factor_number.isNegative()&&(n_factor_number=setSignTo(n_factor_number,1),push_integer(-1)),e=r=0;r<1e4;e=++r)if(try_kth_prime(e),0===n_factor_number.compare(1))return;return factor_b()},try_kth_prime=function(r){var e,s,o,t;for(e=0,s=mint(primetab[r]),e=0;;){if(0===n_factor_number.compare(1))return void(e&&push_factor(s,e));if([o,t]=mdivrem(n_factor_number,s),!t.isZero())break;e++,n_factor_number=o}if(e&&push_factor(s,e),-1===mcmp(o,s))return push_factor(n_factor_number,1),n_factor_number=mint(1)},factor_b=function(){var r,e,s,o,t,n,p;for(s=0,o=0,r=mint(1),n=mint(5),p=mint(2),s=1,o=1;;){if(mprime(n_factor_number))return push_factor(n_factor_number,1),0;for(;;){if(esc_flag&&stop("esc"),t=msub(p,n),t=setSignTo(t,1),e=mgcd(t,n_factor_number),!MEQUAL(e,1)){if(push_factor(e,1),0===mcmp(e,n_factor_number))return-1;t=mdiv(n_factor_number,e),n=t=mmod(n,n_factor_number=t),p=t=mmod(p,n_factor_number);break}0==--s&&(p=n,s=o*=2),t=mmul(n,n),n=madd(t,r),n=t=mmod(n,n_factor_number)}}},push_factor=function(r,e){if((p1=new U).k=NUM,p1.q.a=r,p1.q.b=mint(1),push(p1),e>1)return push_symbol(POWER),swap(),(p1=new U).k=NUM,p1.q.a=mint(e),p1.q.b=mint(1),push(p1),list(3)},DEBUG_POWER=!1,Eval_power=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),power()},power=function(){return save(),yypower(),restore()},yypower=function(){var r,e,s,o,t,n,p;if(p=0,p2=pop(),p1=pop(),o=p2,s=p1,DEBUG_POWER&&console.log("POWER: "+p1+" ^ "+p2),equal(p1,one)||isZeroAtomOrTensor(p2))return evaluatingAsFloats?push_double(1):push(one),void(DEBUG_POWER&&console.log("   power of "+s+" ^ "+o+": "+stack[tos-1]));if(equal(p2,one))return push(p1),void(DEBUG_POWER&&console.log("   power of "+s+" ^ "+o+": "+stack[tos-1]));if(isminusone(p1)&&isminusone(p2))return evaluatingAsFloats?push_double(1):push(one),negate(),void(DEBUG_POWER&&console.log("   power of "+s+" ^ "+o+": "+stack[tos-1]));if(isminusone(p1)&&isoneovertwo(p2))return push(imaginaryunit),void(DEBUG_POWER&&console.log("   power of "+s+" ^ "+o+": "+stack[tos-1]));if(isminusone(p1)&&isminusoneovertwo(p2))return push(imaginaryunit),negate(),void(DEBUG_POWER&&console.log("   power of "+s+" ^ "+o+": "+stack[tos-1]));if(isminusone(p1)&&!isdouble(p1)&&isrational(p2)&&!isinteger(p2)&&ispositivenumber(p2)&&!evaluatingAsFloats)return DEBUG_POWER&&console.log("   power: -1 ^ rational"),DEBUG_POWER&&console.log(" trick: p2.q.a , p2.q.b "+p2.q.a+" , "+p2.q.b),p2.q.a<p2.q.b?(push_symbol(POWER),push(p1),push(p2),list(3)):(push_symbol(MULTIPLY),push(p1),push_symbol(POWER),push(p1),push_rational(p2.q.a.mod(p2.q.b),p2.q.b),list(3),list(3),DEBUG_POWER&&console.log(" trick applied : "+stack[tos-1])),rect(),void(DEBUG_POWER&&console.log("   power of "+s+" ^ "+o+": "+stack[tos-1]));if(isrational(p1)&&isrational(p2))return DEBUG_POWER&&console.log("   power: isrational(p1) && isrational(p2)"),push(p1),push(p2),qpow(),void(DEBUG_POWER&&console.log("   power of "+s+" ^ "+o+": "+stack[tos-1]));if(isNumericAtom(p1)&&isNumericAtom(p2))return DEBUG_POWER&&console.log("   power: both base and exponent are either rational or double "),DEBUG_POWER&&console.log("POWER - isNumericAtom(p1) && isNumericAtom(p2)"),push(p1),push(p2),dpow(),void(DEBUG_POWER&&console.log("   power of "+s+" ^ "+o+": "+stack[tos-1]));if(istensor(p1))return DEBUG_POWER&&console.log("   power: istensor(p1) "),power_tensor(),void(DEBUG_POWER&&console.log("   power of "+s+" ^ "+o+": "+stack[tos-1]));if(car(p1)===symbol(ABS)&&iseveninteger(p2)&&!isZeroAtomOrTensor(get_binding(symbol(ASSUME_REAL_VARIABLES))))return DEBUG_POWER&&console.log("   power: even power of absolute of real value "),push(cadr(p1)),push(p2),power(),void(DEBUG_POWER&&console.log("   power of "+s+" ^ "+o+": "+stack[tos-1]));if(p1===symbol(E)&&car(p2)===symbol(LOG))return push(cadr(p2)),void(DEBUG_POWER&&console.log("   power of "+s+" ^ "+o+": "+stack[tos-1]));if(p1===symbol(E)&&isdouble(p2))return DEBUG_POWER&&console.log("   power: p1 == symbol(E) && isdouble(p2) "),push_double(Math.exp(p2.d)),void(DEBUG_POWER&&console.log("   power of "+s+" ^ "+o+": "+stack[tos-1]));if(p1===symbol(E)&&0!==Find(p2,imaginaryunit)&&0!==Find(p2,symbol(PI))&&!evaluatingPolar&&(push_symbol(POWER),push(p1),push(p2),list(3),DEBUG_POWER&&console.log("   power: turning complex exponential to rect: "+stack[tos-1]),rect(),e=pop(),0===Find(e,symbol(PI))))return DEBUG_POWER&&console.log("   power: turned complex exponential to rect: "+e),void push(e);if(car(p1)===symbol(MULTIPLY)&&isinteger(p2)){for(DEBUG_POWER&&console.log("   power: (a * b) ^ c  ->  (a ^ c) * (b ^ c) "),p1=cdr(p1),push(car(p1)),push(p2),power(),p1=cdr(p1);iscons(p1);)push(car(p1)),push(p2),power(),multiply(),p1=cdr(p1);DEBUG_POWER&&console.log("   power of "+s+" ^ "+o+": "+stack[tos-1])}else{if(n=!1,isNumericAtom(cadr(p1))&&(n=sign(compare_numbers(cadr(p1),zero))),car(p1)===symbol(POWER)&&(isinteger(p2)||n))return push(cadr(p1)),push(caddr(p1)),push(p2),multiply(),power(),void(DEBUG_POWER&&console.log("   power of "+s+" ^ "+o+": "+stack[tos-1]));if(r=!1,iseveninteger(caddr(p1))&&(push(caddr(p1)),push(p2),multiply(),t=pop(),isone(t)&&(r=!0)),car(p1)===symbol(POWER)&&r)return DEBUG_POWER&&console.log("   power: car(p1) == symbol(POWER) && b_isEven_and_c_isItsInverse "),push(cadr(p1)),abs(),void(DEBUG_POWER&&console.log("   power of "+s+" ^ "+o+": "+stack[tos-1]));if(expanding&&isadd(p1)&&isNumericAtom(p2)&&(push(p2),(p=pop_integer())>1&&!isNaN(p)))return DEBUG_POWER&&console.log("   power: expanding && isadd(p1) && isNumericAtom(p2) "),power_sum(p),void(DEBUG_POWER&&console.log("   power of "+s+" ^ "+o+": "+stack[tos-1]));if(1===trigmode&&car(p1)===symbol(SIN)&&iseveninteger(p2))return DEBUG_POWER&&console.log("   power: trigmode == 1 && car(p1) == symbol(SIN) && iseveninteger(p2) "),push_integer(1),push(cadr(p1)),cosine(),push_integer(2),power(),subtract(),push(p2),push_rational(1,2),multiply(),power(),void(DEBUG_POWER&&console.log("   power of "+s+" ^ "+o+": "+stack[tos-1]));if(2===trigmode&&car(p1)===symbol(COS)&&iseveninteger(p2))return DEBUG_POWER&&console.log("   power: trigmode == 2 && car(p1) == symbol(COS) && iseveninteger(p2) "),push_integer(1),push(cadr(p1)),sine(),push_integer(2),power(),subtract(),push(p2),push_rational(1,2),multiply(),power(),void(DEBUG_POWER&&console.log("   power of "+s+" ^ "+o+": "+stack[tos-1]));if(iscomplexnumber(p1)){if(DEBUG_POWER&&console.log(" power - handling the case (a + ib) ^ n"),isinteger(p2))return push(p1),conjugate(),p3=pop(),push(p3),push(p3),push(p1),multiply(),divide(),isone(p2)||(push(p2),negate(),power()),void(DEBUG_POWER&&console.log("   power of "+s+" ^ "+o+": "+stack[tos-1]));if(isNumericAtom(p2))return push(p1),abs(),push(p2),power(),push_integer(-1),push(p1),arg(),push(p2),multiply(),evaluatingAsFloats||iscomplexnumberdouble(p1)&&isdouble(p2)?push_double(Math.PI):push(symbol(PI)),divide(),power(),multiply(),avoidCalculatingPowersIntoArctans&&Find(stack[tos-1],symbol(ARCTAN))&&(pop(),push_symbol(POWER),push(p1),push(p2),list(3)),void(DEBUG_POWER&&console.log("   power of "+s+" ^ "+o+": "+stack[tos-1]))}if(!simplify_polar())return DEBUG_POWER&&console.log("   power: nothing can be done "),push_symbol(POWER),push(p1),push(p2),list(3),DEBUG_POWER?console.log("   power of "+s+" ^ "+o+": "+stack[tos-1]):void 0;DEBUG_POWER&&console.log("   power: using simplify_polar")}},power_sum=function(r){var e,s,o,t,n,p,i,a,u,l;for(e=[],s=0,t=0,0,p=length(p1)-1,push_frame(p*(r+1)),p1=cdr(p1),s=o=0,a=p;0<=a?o<a:o>a;s=0<=a?++o:--o){for(t=n=0,u=r;0<=u?n<=u:n>=u;t=0<=u?++n:--n)push(car(p1)),push_integer(t),power(),stack[frame+s*(r+1)+t]=pop();p1=cdr(p1)}for(push_integer(r),factorial(),p1=pop(),s=i=0,l=p;0<=l?i<l:i>l;s=0<=l?++i:--i)e[s]=0;return push(zero),multinomial_sum(p,r,e,0,r),pop_frame(p*(r+1))},multinomial_sum=function(r,e,s,o,t){var n,p,i,a,u,l,c;if(p=0,!(o<r-1)){for(s[o]=t,push(p1),p=i=0,l=r;0<=l?i<l:i>l;p=0<=l?++i:--i)push_integer(s[p]),factorial(),divide();for(p=a=0,c=r;0<=c?a<c:a>c;p=0<=c?++a:--a)push(stack[frame+p*(e+1)+s[p]]),multiply();return add()}for(p=n=0,u=t;0<=u?n<=u:n>=u;p=0<=u?++n:--n)s[o]=p,multinomial_sum(r,e,s,o+1,t-p)},simplify_polar=function(){var r;switch(r=0,r=isquarterturn(p2)){case 0:1;break;case 1:return push_integer(1),1;case 2:return push_integer(-1),1;case 3:return push(imaginaryunit),1;case 4:return push(imaginaryunit),negate(),1}if(car(p2)===symbol(ADD)){for(p3=cdr(p2);iscons(p3)&&!(r=isquarterturn(car(p3)));)p3=cdr(p3);switch(r){case 0:return 0;case 1:push_integer(1);break;case 2:push_integer(-1);break;case 3:push(imaginaryunit);break;case 4:push(imaginaryunit),negate()}return push(p2),push(car(p3)),subtract(),exponential(),multiply(),1}return 0},Eval_prime=function(){return push(cadr(p1)),Eval(),prime()},prime=function(){var r;return r=0,((r=pop_integer())<1||r>MAXPRIMETAB)&&stop("prime: Argument out of range."),r=primetab[r-1],push_integer(r)},power_str="^",codeGen=!1,Eval_print=function(){return stringsEmittedByUserPrintouts+=_print(cdr(p1),printMode),push(symbol(NIL))},Eval_print2dascii=function(){return stringsEmittedByUserPrintouts+=_print(cdr(p1),PRINTMODE_2DASCII),push(symbol(NIL))},Eval_printcomputer=function(){return stringsEmittedByUserPrintouts+=_print(cdr(p1),PRINTMODE_COMPUTER),push(symbol(NIL))},Eval_printlatex=function(){return stringsEmittedByUserPrintouts+=_print(cdr(p1),PRINTMODE_LATEX),push(symbol(NIL))},Eval_printhuman=function(){var r;return r=test_flag,test_flag=0,stringsEmittedByUserPrintouts+=_print(cdr(p1),PRINTMODE_HUMAN),test_flag=r,push(symbol(NIL))},Eval_printlist=function(){var r;return r=_print(cdr(p1),PRINTMODE_LIST),stringsEmittedByUserPrintouts+=r,push(symbol(NIL))},_print=function(r,e){var s,o;for(s="";iscons(r);)push(car(r)),Eval(),p2=pop(),o=printMode,e===PRINTMODE_COMPUTER?(printMode=PRINTMODE_COMPUTER,s=printline(p2),rememberPrint(s,LAST_FULL_PRINT)):e===PRINTMODE_HUMAN?(printMode=PRINTMODE_HUMAN,s=printline(p2),rememberPrint(s,LAST_PLAIN_PRINT)):e===PRINTMODE_2DASCII?(printMode=PRINTMODE_2DASCII,s=print2dascii(p2),rememberPrint(s,LAST_2DASCII_PRINT)):e===PRINTMODE_LATEX?(printMode=PRINTMODE_LATEX,s=printline(p2),rememberPrint(s,LAST_LATEX_PRINT)):e===PRINTMODE_LIST&&(printMode=PRINTMODE_LIST,s=print_list(p2),rememberPrint(s,LAST_LIST_PRINT)),printMode=o,r=cdr(r);return DEBUG&&console.log("emttedString from display: "+stringsEmittedByUserPrintouts),s},rememberPrint=function(r,e){var s;return scan('"'+r+'"'),s=pop(),set_binding(symbol(e),s)},print_str=function(r){return DEBUG&&console.log("emttedString from print_str: "+stringsEmittedByUserPrintouts),r},print_char=function(r){return r},collectLatexStringFromReturnValue=function(r){var e,s,o;return e=printMode,printMode=PRINTMODE_LATEX,s=codeGen,codeGen=!1,o=(o=print_expr(r)).replace(/_/g,"\\_"),printMode=e,codeGen=s,DEBUG&&console.log("emttedString from collectLatexStringFromReturnValue: "+stringsEmittedByUserPrintouts),o},printline=function(r){var e;return e="",e+=print_expr(r)},print_base_of_denom=function(r){var e;return e="",isfraction(r)||car(r)===symbol(ADD)||car(r)===symbol(MULTIPLY)||car(r)===symbol(POWER)||lessp(r,zero)?(e+=print_char("("),e+=print_expr(r),e+=print_char(")")):e+=print_expr(r),e},print_expo_of_denom=function(r){var e;return e="",isfraction(r)||car(r)===symbol(ADD)||car(r)===symbol(MULTIPLY)||car(r)===symbol(POWER)?(e+=print_char("("),e+=print_expr(r),e+=print_char(")")):e+=print_expr(r),e},print_denom=function(r,e){var s;return s="",save(),p1=cadr(r),p2=caddr(r),isminusone(p2)?(s+=print_base_of_denom(p1),restore(),s):(1===e&&(s+=print_char("(")),push(p2),negate(),p2=pop(),s+=print_power(p1,p2),1===e&&(s+=print_char(")")),restore(),s)},print_a_over_b=function(r){var e,s,o;for(e="",flag=0,o=0,s=0,save(),o=0,s=0,p1=cdr(r),p2=car(p1),isrational(p2)?(push(p2),mp_numerator(),absval(),p3=pop(),push(p2),mp_denominator(),p4=pop(),isplusone(p3)||o++,isplusone(p4)||s++,p1=cdr(p1)):(p3=one,p4=one);iscons(p1);)p2=car(p1),is_denominator(p2)?s++:o++,p1=cdr(p1);if(printMode===PRINTMODE_LATEX&&(e+=print_str("\\frac{")),0===o)e+=print_char("1");else for(flag=0,p1=cdr(r),isrational(car(p1))&&(p1=cdr(p1)),isplusone(p3)||(e+=print_factor(p3),flag=1);iscons(p1);)p2=car(p1),is_denominator(p2)?1:(flag&&(e+=print_multiply_sign()),e+=print_factor(p2),flag=1),p1=cdr(p1);for(e+=print_str(printMode===PRINTMODE_LATEX?"}{":printMode!==PRINTMODE_HUMAN||test_flag?"/":" / "),s>1&&printMode!==PRINTMODE_LATEX&&(e+=print_char("(")),flag=0,p1=cdr(r),isrational(car(p1))&&(p1=cdr(p1)),isplusone(p4)||(e+=print_factor(p4),flag=1);iscons(p1);)p2=car(p1),is_denominator(p2)&&(flag&&(e+=print_multiply_sign()),e+=print_denom(p2,s),flag=1),p1=cdr(p1);return s>1&&printMode!==PRINTMODE_LATEX&&(e+=print_char(")")),printMode===PRINTMODE_LATEX&&(e+=print_str("}")),restore(),e},print_expr=function(r){var e;if(e="",isadd(r))for(r=cdr(r),"-"===sign_of_term(car(r))&&(e+=print_str("-")),e+=print_term(car(r)),r=cdr(r);iscons(r);)"+"===sign_of_term(car(r))?e+=print_str(printMode!==PRINTMODE_HUMAN||test_flag?"+":" + "):e+=print_str(printMode!==PRINTMODE_HUMAN||test_flag?"-":" - "),e+=print_term(car(r)),r=cdr(r);else"-"===sign_of_term(r)&&(e+=print_str("-")),e+=print_term(r);return e},sign_of_term=function(r){var e;return e="",car(r)===symbol(MULTIPLY)&&isNumericAtom(cadr(r))&&lessp(cadr(r),zero)?e+="-":isNumericAtom(r)&&lessp(r,zero)?e+="-":e+="+",e},print_term=function(r){var e,s,o,t,n;if(e="",car(r)===symbol(MULTIPLY)&&any_denominators(r))return e+=print_a_over_b(r);if(car(r)===symbol(MULTIPLY)){for(r=cdr(r),isminusone(car(r))&&(r=cdr(r)),n=!1,isNumericAtom(car(r))&&(n=!0),o=!1,printMode===PRINTMODE_LATEX&&iscons(cdr(r))&&isNumberOneOverSomething(car(r))&&(o=!0,s=car(r).q.b.toString()),o?(t=e,e=""):e+=print_factor(car(r)),r=cdr(r);iscons(r);)printMode===PRINTMODE_LATEX&&n&&caar(r)===symbol(POWER)&&isNumericAtom(car(cdr(car(r))))&&(isfraction(car(cdr(cdr(car(r)))))||(e+=" \\cdot ")),e+=print_multiply_sign(),e+=print_factor(car(r)),n=!1,isNumericAtom(car(r))&&(n=!0),r=cdr(r);o&&(e=t+"\\frac{"+e+"}{"+s+"}")}else e+=print_factor(r);return e},print_subexpr=function(r){var e;return e="",e+=print_char("("),e+=print_expr(r),e+=print_char(")")},print_factorial_function=function(r){var e;return e="",r=cadr(r),car(r)===symbol(ADD)||car(r)===symbol(MULTIPLY)||car(r)===symbol(POWER)||car(r)===symbol(FACTORIAL)?e+=print_subexpr(r):e+=print_expr(r),e+=print_char("!")},print_ABS_latex=function(r){var e;return e="",e+=print_str("\\left |"),e+=print_expr(cadr(r)),e+=print_str(" \\right |")},print_BINOMIAL_latex=function(r){var e;return e="",e+=print_str("\\binom{"),e+=print_expr(cadr(r)),e+=print_str("}{"),e+=print_expr(caddr(r)),e+=print_str("} ")},print_DOT_latex=function(r){var e;return e="",e+=print_expr(cadr(r)),e+=print_str(" \\cdot "),e+=print_expr(caddr(r))},print_DOT_codegen=function(r){var e;return e="dot(",e+=print_expr(cadr(r)),e+=", ",e+=print_expr(caddr(r)),e+=")"},print_SIN_codegen=function(r){var e;return e="Math.sin(",e+=print_expr(cadr(r)),e+=")"},print_COS_codegen=function(r){var e;return e="Math.cos(",e+=print_expr(cadr(r)),e+=")"},print_TAN_codegen=function(r){var e;return e="Math.tan(",e+=print_expr(cadr(r)),e+=")"},print_ARCSIN_codegen=function(r){var e;return e="Math.asin(",e+=print_expr(cadr(r)),e+=")"},print_ARCCOS_codegen=function(r){var e;return e="Math.acos(",e+=print_expr(cadr(r)),e+=")"},print_ARCTAN_codegen=function(r){var e;return e="Math.atan(",e+=print_expr(cadr(r)),e+=")"},print_SQRT_latex=function(r){var e;return e="",e+=print_str("\\sqrt{"),e+=print_expr(cadr(r)),e+=print_str("} ")},print_TRANSPOSE_latex=function(r){var e;return e="",e+=print_str("{"),iscons(cadr(r))&&(e+=print_str("(")),e+=print_expr(cadr(r)),iscons(cadr(r))&&(e+=print_str(")")),e+=print_str("}"),e+=print_str("^T")},print_TRANSPOSE_codegen=function(r){var e;return e="",e+=print_str("transpose("),e+=print_expr(cadr(r)),e+=print_str(")")},print_UNIT_codegen=function(r){var e;return e="",e+=print_str("identity("),e+=print_expr(cadr(r)),e+=print_str(")")},print_INV_latex=function(r){var e;return e="",e+=print_str("{"),iscons(cadr(r))&&(e+=print_str("(")),e+=print_expr(cadr(r)),iscons(cadr(r))&&(e+=print_str(")")),e+=print_str("}"),e+=print_str("^{-1}")},print_INV_codegen=function(r){var e;return e="",e+=print_str("inv("),e+=print_expr(cadr(r)),e+=print_str(")")},print_DEFINT_latex=function(r){var e,s,o,t,n,p,i,a,u;for(e="",s=car(cdr(r)),p=r=cdr(r),n=0;iscons(cdr(cdr(r)));)n++,a=cdr(cdr(r)),e+=print_str("\\int^{"),e+=print_expr(car(cdr(a))),e+=print_str("}_{"),e+=print_expr(car(a)),e+=print_str("} \\! "),r=cdr(a);for(e+=print_expr(s),e+=print_str(" \\,"),r=p,o=t=1,i=n;1<=i?t<=i:t>=i;o=1<=i?++t:--t)u=cdr(r),e+=print_str(" \\mathrm{d} "),e+=print_expr(car(u)),o<n&&(e+=print_str(" \\, ")),r=cdr(cdr(u));return e},print_tensor=function(r){var e;return e="",e+=print_tensor_inner(r,0,0)[1]},print_tensor_inner=function(r,e,s){var o,t,n,p,i,a,u;if(o="",o+=print_str("["),e<r.tensor.ndim-1)for(t=n=0,i=r.tensor.dim[e];0<=i?n<i:n>i;t=0<=i?++n:--n)[s,u]=print_tensor_inner(r,e+1,s),o+=u,t!==r.tensor.dim[e]-1&&(o+=print_str(","));else for(t=p=0,a=r.tensor.dim[e];0<=a?p<a:p>a;t=0<=a?++p:--p)o+=print_expr(r.tensor.elem[s]),t!==r.tensor.dim[e]-1&&(o+=print_str(",")),s++;return[s,o+=print_str("]")]},print_tensor_latex=function(r){var e;return e="",r.tensor.ndim<=2&&(e+=print_tensor_inner_latex(!0,r,0,0)[1]),e},print_tensor_inner_latex=function(r,e,s,o){var t,n,p,i,a,u,l;if(t="",r&&(t+="\\begin{bmatrix} "),s<e.tensor.ndim-1)for(n=p=0,a=e.tensor.dim[s];0<=a?p<a:p>a;n=0<=a?++p:--p)[o,l]=print_tensor_inner_latex(0,e,s+1,o),t+=l,n!==e.tensor.dim[s]-1&&(t+=print_str(" \\\\ "));else for(n=i=0,u=e.tensor.dim[s];0<=u?i<u:i>u;n=0<=u?++i:--i)t+=print_expr(e.tensor.elem[o]),n!==e.tensor.dim[s]-1&&(t+=print_str(" & ")),o++;return r&&(t+=" \\end{bmatrix}"),[o,t]},print_SUM_latex=function(r){var e;return e="\\sum_{",e+=print_expr(caddr(r)),e+="=",e+=print_expr(cadddr(r)),e+="}^{",e+=print_expr(caddddr(r)),e+="}{",e+=print_expr(cadr(r)),e+="}"},print_SUM_codegen=function(r){var e,s,o,t;return e=cadr(r),t=caddr(r),s=cadddr(r),o=caddddr(r),"(function(){ var "+t+";  var holderSum = 0;  var lowerlimit = "+print_expr(s)+";  var upperlimit = "+print_expr(o)+";  for ("+t+" = lowerlimit; "+t+" < upperlimit; "+t+"++) {    holderSum += "+print_expr(e)+"; }  return holderSum;})()"},print_TEST_latex=function(r){var e;for(e="\\left\\{ \\begin{array}{ll}",r=cdr(r);iscons(r);){if(cdr(r)===symbol(NIL)){e+="{",e+=print_expr(car(r)),e+="} & otherwise ",e+=" \\\\\\\\";break}e+="{",e+=print_expr(cadr(r)),e+="} & if & ",e+=print_expr(car(r)),e+=" \\\\\\\\",r=cddr(r)}return(e=e.substring(0,e.length-4))+"\\end{array} \\right."},print_TEST_codegen=function(r){var e,s;for(e="(function(){",r=cdr(r),s=0;iscons(r);){if(cdr(r)===symbol(NIL)){e+="else {",e+="return ("+print_expr(car(r))+");",e+="}";break}s&&(e+=" else "),e+="if ("+print_expr(car(r))+"){",e+="return ("+print_expr(cadr(r))+");",e+="}",s++,r=cddr(r)}return e+="})()"},print_TESTLT_latex=function(r){var e;return e="{",e+=print_expr(cadr(r)),e+="}",e+=" < ",e+="{",(e+=print_expr(caddr(r)))+"}"},print_TESTLE_latex=function(r){var e;return e="{",e+=print_expr(cadr(r)),e+="}",e+=" \\leq ",e+="{",(e+=print_expr(caddr(r)))+"}"},print_TESTGT_latex=function(r){var e;return e="{",e+=print_expr(cadr(r)),e+="}",e+=" > ",e+="{",(e+=print_expr(caddr(r)))+"}"},print_TESTGE_latex=function(r){var e;return e="{",e+=print_expr(cadr(r)),e+="}",e+=" \\geq ",e+="{",(e+=print_expr(caddr(r)))+"}"},print_TESTEQ_latex=function(r){var e;return e="{",e+=print_expr(cadr(r)),e+="}",e+=" = ",e+="{",(e+=print_expr(caddr(r)))+"}"},print_FOR_codegen=function(r){var e,s,o,t;return e=cadr(r),t=caddr(r),s=cadddr(r),o=caddddr(r),"(function(){ var "+t+";  var lowerlimit = "+print_expr(s)+";  var upperlimit = "+print_expr(o)+";  for ("+t+" = lowerlimit; "+t+" < upperlimit; "+t+"++) {    "+print_expr(e)+" } })()"},print_DO_codegen=function(r){var e;for(e="",r=cdr(r);iscons(r);)e+=print_expr(car(r)),r=cdr(r);return e},print_SETQ_codegen=function(r){var e;return e="",e+=print_expr(cadr(r)),e+=" = ",e+=print_expr(caddr(r)),e+="; "},print_PRODUCT_latex=function(r){var e;return e="\\prod_{",e+=print_expr(caddr(r)),e+="=",e+=print_expr(cadddr(r)),e+="}^{",e+=print_expr(caddddr(r)),e+="}{",e+=print_expr(cadr(r)),e+="}"},print_PRODUCT_codegen=function(r){var e,s,o,t;return e=cadr(r),t=caddr(r),s=cadddr(r),o=caddddr(r),"(function(){ var "+t+";  var holderProduct = 1;  var lowerlimit = "+print_expr(s)+";  var upperlimit = "+print_expr(o)+";  for ("+t+" = lowerlimit; "+t+" < upperlimit; "+t+"++) {    holderProduct *= "+print_expr(e)+"; }  return holderProduct;})()"},print_base=function(r){var e;return e="",isadd(cadr(r))||caadr(r)===symbol(MULTIPLY)||caadr(r)===symbol(POWER)||isnegativenumber(cadr(r))?(e+=print_str("("),e+=print_expr(cadr(r)),e+=print_str(")")):isNumericAtom(cadr(r))&&(lessp(cadr(r),zero)||isfraction(cadr(r)))?(e+=print_str("("),e+=print_factor(cadr(r)),e+=print_str(")")):e+=print_factor(cadr(r)),e},print_exponent=function(r){var e;return e="",iscons(caddr(r))||isfraction(caddr(r))||isNumericAtom(caddr(r))&&lessp(caddr(r),zero)?(e+=print_str("("),e+=print_expr(caddr(r)),e+=print_str(")")):e+=print_factor(caddr(r)),e},print_power=function(r,e){var s,o,t,n;if(s="",DEBUG&&console.log("power base: "+r+"  exponent: "+e),isoneovertwo(e))if(equaln(r,2)){if(codeGen)return s+=print_str("Math.SQRT2")}else{if(printMode===PRINTMODE_LATEX)return s+=print_str("\\sqrt{"),s+=print_expr(r),s+=print_str("}");if(codeGen)return s+=print_str("Math.sqrt("),s+=print_expr(r),s+=print_str(")")}if(equaln(get_binding(symbol(PRINT_LEAVE_E_ALONE)),1)&&r===symbol(E))return codeGen?(s+=print_str("Math.exp("),s+=print_expo_of_denom(e),s+=print_str(")")):(printMode===PRINTMODE_LATEX?(s+=print_str("e^{"),s+=print_expr(e),s+=print_str("}")):(s+=print_str("exp("),s+=print_expr(e),s+=print_str(")")),s);if(codeGen)return s+=print_str("Math.pow("),s+=print_base_of_denom(r),s+=print_str(", "),s+=print_expo_of_denom(e),s+=print_str(")");if(equaln(get_binding(symbol(PRINT_LEAVE_X_ALONE)),0)||"x"!==r.printname){if(r!==symbol(E)){if(isminusone(e))return s+=print_str(printMode===PRINTMODE_LATEX?"\\frac{1}{":printMode!==PRINTMODE_HUMAN||test_flag?"1/":"1 / "),iscons(r)&&printMode!==PRINTMODE_LATEX?(s+=print_str("("),s+=print_expr(r),s+=print_str(")")):s+=print_expr(r),printMode===PRINTMODE_LATEX&&(s+=print_str("}")),s;if(isnegativeterm(e))return s+=print_str(printMode===PRINTMODE_LATEX?"\\frac{1}{":printMode!==PRINTMODE_HUMAN||test_flag?"1/":"1 / "),push(e),push_integer(-1),multiply(),t=pop(),iscons(r)&&printMode!==PRINTMODE_LATEX?(s+=print_str("("),s+=print_power(r,t),s+=print_str(")")):s+=print_power(r,t),printMode===PRINTMODE_LATEX&&(s+=print_str("}")),s}if(isfraction(e)&&printMode===PRINTMODE_LATEX)return s+=print_str("\\sqrt"),push(e),denominator(),o=pop(),isplustwo(o)||(s+=print_str("["),s+=print_expr(o),s+=print_str("]")),s+=print_str("{"),push(e),numerator(),n=pop(),s+=print_power(r,e=n),s+=print_str("}")}return printMode===PRINTMODE_LATEX&&isplusone(e)?s+=print_expr(r):(isadd(r)||isnegativenumber(r)?(s+=print_str("("),s+=print_expr(r),s+=print_str(")")):car(r)===symbol(MULTIPLY)||car(r)===symbol(POWER)?(printMode!==PRINTMODE_LATEX&&(s+=print_str("(")),s+=print_factor(r,!0),printMode!==PRINTMODE_LATEX&&(s+=print_str(")"))):isNumericAtom(r)&&(lessp(r,zero)||isfraction(r))?(s+=print_str("("),s+=print_factor(r),s+=print_str(")")):s+=print_factor(r),s+=print_str(printMode!==PRINTMODE_HUMAN||test_flag?"^":power_str),printMode===PRINTMODE_LATEX?print_expr(e).length>1?(s+=print_str("{"),s+=print_expr(e),s+=print_str("}")):s+=print_expr(e):iscons(e)||isfraction(e)||isNumericAtom(e)&&lessp(e,zero)?(s+=print_str("("),s+=print_expr(e),s+=print_str(")")):s+=print_factor(e)),s},print_index_function=function(r){var e;if(e="",r=cdr(r),caar(r)===symbol(ADD)||caar(r)===symbol(MULTIPLY)||caar(r)===symbol(POWER)||caar(r)===symbol(FACTORIAL)?e+=print_subexpr(car(r)):e+=print_expr(car(r)),e+=print_str("["),r=cdr(r),iscons(r))for(e+=print_expr(car(r)),r=cdr(r);iscons(r);)e+=print_str(","),e+=print_expr(car(r)),r=cdr(r);return e+=print_str("]")},print_factor=function(r,e){var s,o,t,n,p;if(s="",isNumericAtom(r))return s+=print_number(r,!1);if(isstr(r))return s+=print_str('"'),s+=print_str(r.str),s+=print_str('"');if(istensor(r))return s+=printMode===PRINTMODE_LATEX?print_tensor_latex(r):print_tensor(r);if(car(r)===symbol(MULTIPLY))return e||"-"!==sign_of_term(r)&&printMode===PRINTMODE_LATEX||(s+=print_str(printMode===PRINTMODE_LATEX?" \\left (":"(")),s+=print_expr(r),e||"-"!==sign_of_term(r)&&printMode===PRINTMODE_LATEX||(s+=print_str(printMode===PRINTMODE_LATEX?" \\right ) ":")")),s;if(isadd(r))return e||(s+=print_str("(")),s+=print_expr(r),e||(s+=print_str(")")),s;if(car(r)===symbol(POWER))return o=cadr(r),t=caddr(r),s+=print_power(o,t);if(car(r)===symbol(FUNCTION))return n=cadr(r),codeGen||(p=caddr(r),s+=print_str("function "),DEBUG&&console.log("emittedString from print_factor "+stringsEmittedByUserPrintouts),s+=print_list(p),s+=print_str(" -> ")),s+=print_expr(n);if(car(r)===symbol(PATTERN))return s+=print_expr(caadr(r)),s+=print_str(printMode===PRINTMODE_LATEX?" \\rightarrow ":printMode!==PRINTMODE_HUMAN||test_flag?"->":" -> "),s+=print_expr(car(cdr(cadr(r))));if(car(r)===symbol(INDEX)&&issymbol(cadr(r)))return s+=print_index_function(r);if(car(r)===symbol(FACTORIAL))return s+=print_factorial_function(r);if(car(r)===symbol(ABS)&&printMode===PRINTMODE_LATEX)return s+=print_ABS_latex(r);if(car(r)===symbol(SQRT)&&printMode===PRINTMODE_LATEX)return s+=print_SQRT_latex(r);if(car(r)===symbol(TRANSPOSE)){if(printMode===PRINTMODE_LATEX)return s+=print_TRANSPOSE_latex(r);if(codeGen)return s+=print_TRANSPOSE_codegen(r)}else if(car(r)===symbol(UNIT)){if(codeGen)return s+=print_UNIT_codegen(r)}else if(car(r)===symbol(INV)){if(printMode===PRINTMODE_LATEX)return s+=print_INV_latex(r);if(codeGen)return s+=print_INV_codegen(r)}else{if(car(r)===symbol(BINOMIAL)&&printMode===PRINTMODE_LATEX)return s+=print_BINOMIAL_latex(r);if(car(r)===symbol(DEFINT)&&printMode===PRINTMODE_LATEX)return s+=print_DEFINT_latex(r);if(isinnerordot(r)){if(printMode===PRINTMODE_LATEX)return s+=print_DOT_latex(r);if(codeGen)return s+=print_DOT_codegen(r)}else if(car(r)===symbol(SIN)){if(codeGen)return s+=print_SIN_codegen(r)}else if(car(r)===symbol(COS)){if(codeGen)return s+=print_COS_codegen(r)}else if(car(r)===symbol(TAN)){if(codeGen)return s+=print_TAN_codegen(r)}else if(car(r)===symbol(ARCSIN)){if(codeGen)return s+=print_ARCSIN_codegen(r)}else if(car(r)===symbol(ARCCOS)){if(codeGen)return s+=print_ARCCOS_codegen(r)}else if(car(r)===symbol(ARCTAN)){if(codeGen)return s+=print_ARCTAN_codegen(r)}else if(car(r)===symbol(SUM)){if(printMode===PRINTMODE_LATEX)return s+=print_SUM_latex(r);if(codeGen)return s+=print_SUM_codegen(r)}else if(car(r)===symbol(PRODUCT)){if(printMode===PRINTMODE_LATEX)return s+=print_PRODUCT_latex(r);if(codeGen)return s+=print_PRODUCT_codegen(r)}else if(car(r)===symbol(FOR)){if(codeGen)return s+=print_FOR_codegen(r)}else if(car(r)===symbol(DO)){if(codeGen)return s+=print_DO_codegen(r)}else if(car(r)===symbol(TEST)){if(codeGen)return s+=print_TEST_codegen(r);if(printMode===PRINTMODE_LATEX)return s+=print_TEST_latex(r)}else if(car(r)===symbol(TESTLT)){if(codeGen)return s+="(("+print_expr(cadr(r))+") < ("+print_expr(caddr(r))+"))";if(printMode===PRINTMODE_LATEX)return s+=print_TESTLT_latex(r)}else if(car(r)===symbol(TESTLE)){if(codeGen)return s+="(("+print_expr(cadr(r))+") <= ("+print_expr(caddr(r))+"))";if(printMode===PRINTMODE_LATEX)return s+=print_TESTLE_latex(r)}else if(car(r)===symbol(TESTGT)){if(codeGen)return s+="(("+print_expr(cadr(r))+") > ("+print_expr(caddr(r))+"))";if(printMode===PRINTMODE_LATEX)return s+=print_TESTGT_latex(r)}else if(car(r)===symbol(TESTGE)){if(codeGen)return s+="(("+print_expr(cadr(r))+") >= ("+print_expr(caddr(r))+"))";if(printMode===PRINTMODE_LATEX)return s+=print_TESTGE_latex(r)}else if(car(r)===symbol(TESTEQ)){if(codeGen)return s+="(("+print_expr(cadr(r))+") === ("+print_expr(caddr(r))+"))";if(printMode===PRINTMODE_LATEX)return s+=print_TESTEQ_latex(r)}else if(car(r)===symbol(FLOOR)){if(codeGen)return s+="Math.floor("+print_expr(cadr(r))+")";if(printMode===PRINTMODE_LATEX)return s+=" \\lfloor {"+print_expr(cadr(r))+"} \\rfloor "}else if(car(r)===symbol(CEILING)){if(codeGen)return s+="Math.ceiling("+print_expr(cadr(r))+")";if(printMode===PRINTMODE_LATEX)return s+=" \\lceil {"+print_expr(cadr(r))+"} \\rceil "}else if(car(r)===symbol(ROUND)){if(codeGen)return s+="Math.round("+print_expr(cadr(r))+")"}else if(car(r)===symbol(SETQ))return codeGen?s+=print_SETQ_codegen(r):(s+=print_expr(cadr(r)),s+=print_str("="),s+=print_expr(caddr(r)))}if(iscons(r)){if(s+=print_factor(car(r)),r=cdr(r),e||(s+=print_str("(")),iscons(r))for(s+=print_expr(car(r)),r=cdr(r);iscons(r);)s+=print_str(","),s+=print_expr(car(r)),r=cdr(r);return e||(s+=print_str(")")),s}return r===symbol(DERIVATIVE)?s+=print_char("d"):r===symbol(E)?s+=print_str(codeGen?"Math.E":"e"):r===symbol(PI)?s+=print_str(printMode===PRINTMODE_LATEX?"\\pi":"pi"):s+=print_str(get_printname(r)),s},print_list=function(r){var e;switch(e="",r.k){case CONS:for(e+="(",e+=print_list(car(r)),r===cdr(r)&&r!==symbol(NIL)&&console.log("oh no recursive!"),r=cdr(r);iscons(r);)e+=" ",e+=print_list(car(r)),(r=cdr(r))===cdr(r)&&r!==symbol(NIL)&&console.log("oh no recursive!");r!==symbol(NIL)&&(e+=" . ",e+=print_list(r)),e+=")";break;case STR:e+=r.str;break;case NUM:case DOUBLE:e+=print_number(r,!0);break;case SYM:e+=get_printname(r);break;default:e+="<tensor>"}return e},print_multiply_sign=function(){var r;if(r="",printMode===PRINTMODE_LATEX){if(printMode!==PRINTMODE_HUMAN||test_flag)return r;r+=print_str(" ")}return r+=print_str(printMode!==PRINTMODE_HUMAN||test_flag||codeGen?"*":" ")},is_denominator=function(r){return car(r)===symbol(POWER)&&cadr(r)!==symbol(E)&&isnegativeterm(caddr(r))?1:0},any_denominators=function(r){var e;for(r=cdr(r);iscons(r);){if(e=car(r),is_denominator(e))return 1;r=cdr(r)}return 0},YMAX=1e4,glyph=function(){class r{}return r.prototype.c=0,r.prototype.x=0,r.prototype.y=0,r}.call(this),chartab=[],charTabIndex=i1=0,ref1=YMAX;0<=ref1?i1<ref1:i1>ref1;charTabIndex=0<=ref1?++i1:--i1)chartab[charTabIndex]=new glyph;for(yindex=0,level=0,emit_x=0,expr_level=0,display_flag=0,printchar_nowrap=function(r){var e;return e="",e+=r},printchar=function(r){return printchar_nowrap(r)},print2dascii=function(r){var e,s,o,t;return s=0,o=0,t=0,save(),yindex=0,level=0,emit_x=0,emit_top_expr(r),[s,o,t]=get_size(0,yindex),o>100?(printline(r),void restore()):(e=print_glyphs(),restore(),e)},emit_top_expr=function(r){return car(r)===symbol(SETQ)?(emit_expr(cadr(r)),__emit_str(" = "),void emit_expr(caddr(r))):istensor(r)?emit_tensor(r):emit_expr(r)},will_be_displayed_as_fraction=function(r){if(level>0)return 0;if(isfraction(r))return 1;if(car(r)!==symbol(MULTIPLY))return 0;if(isfraction(cadr(r)))return 1;for(;iscons(r);){if(isdenominator(car(r)))return 1;r=cdr(r)}return 0},emit_expr=function(r){if(expr_level++,car(r)===symbol(ADD))for(r=cdr(r),__is_negative(car(r))&&(__emit_char("-"),will_be_displayed_as_fraction(car(r))&&__emit_char(" ")),emit_term(car(r)),r=cdr(r);iscons(r);)__is_negative(car(r))?(__emit_char(" "),__emit_char("-"),__emit_char(" ")):(__emit_char(" "),__emit_char("+"),__emit_char(" ")),emit_term(car(r)),r=cdr(r);else __is_negative(r)&&(__emit_char("-"),will_be_displayed_as_fraction(r)&&__emit_char(" ")),emit_term(r);return expr_level--},emit_unsigned_expr=function(r){var e;if(car(r)===symbol(ADD)){for(r=cdr(r),emit_term(car(r)),r=cdr(r),e=[];iscons(r);)__is_negative(car(r))?(__emit_char(" "),__emit_char("-"),__emit_char(" ")):(__emit_char(" "),__emit_char("+"),__emit_char(" ")),emit_term(car(r)),e.push(r=cdr(r));return e}return emit_term(r)},__is_negative=function(r){return isnegativenumber(r)?1:car(r)===symbol(MULTIPLY)&&isnegativenumber(cadr(r))?1:0},emit_term=function(r){var e;return car(r)===symbol(MULTIPLY)?(e=count_denominators(r))&&0===level?emit_fraction(r,e):emit_multiply(r,e):emit_factor(r)},isdenominator=function(r){return car(r)===symbol(POWER)&&cadr(r)!==symbol(E)&&__is_negative(caddr(r))?1:0},count_denominators=function(r){var e,s;for(e=0,r=cdr(r);iscons(r);)s=car(r),isdenominator(s)&&e++,r=cdr(r);return e},emit_multiply=function(r,e){var s;if(0===e){for(r=cdr(r),(isplusone(car(r))||isminusone(car(r)))&&(r=cdr(r)),emit_factor(car(r)),r=cdr(r),s=[];iscons(r);)__emit_char(" "),emit_factor(car(r)),s.push(r=cdr(r));return s}return emit_numerators(r),__emit_char("/"),e>1||isfraction(cadr(r))?(__emit_char("("),emit_denominators(r),__emit_char(")")):emit_denominators(r)},emit_fraction=function(r,e){var s,o,t,n,p;for(s=0,0,0,n=0,0,save(),p3=one,p4=one,isrational(cadr(r))&&(push(cadr(r)),mp_numerator(),absval(),p3=pop(),push(cadr(r)),mp_denominator(),p4=pop()),isdouble(cadr(r))&&(push(cadr(r)),absval(),p3=pop()),n=isplusone(p3)?0:1,p1=cdr(r),isNumericAtom(car(p1))&&(p1=cdr(p1));iscons(p1);)p2=car(p1),isdenominator(p2)?1:n++,p1=cdr(p1);for(p=emit_x,o=yindex,s=0,isplusone(p3)||(emit_number(p3,0),s++),p1=cdr(r),isNumericAtom(car(p1))&&(p1=cdr(p1));iscons(p1);)p2=car(p1),isdenominator(p2)?1:(s>0&&__emit_char(" "),1===n?emit_expr(p2):emit_factor(p2),s++),p1=cdr(p1);for(0===s&&__emit_char("1"),t=yindex,s=0,isplusone(p4)||(emit_number(p4,0),s++,e++),p1=cdr(r),isrational(car(p1))&&(p1=cdr(p1));iscons(p1);)p2=car(p1),isdenominator(p2)&&(s>0&&__emit_char(" "),emit_denominator(p2,e),s++),p1=cdr(p1);return fixup_fraction(p,o,t),restore()},emit_numerators=function(r){var e;for(save(),e=0,p1=one,r=cdr(r),isrational(car(r))?(push(car(r)),mp_numerator(),absval(),p1=pop(),r=cdr(r)):isdouble(car(r))&&(push(car(r)),absval(),p1=pop(),r=cdr(r)),e=0,isplusone(p1)||(emit_number(p1,0),e++);iscons(r);)isdenominator(car(r))?1:(e>0&&__emit_char(" "),emit_factor(car(r)),e++),r=cdr(r);return 0===e&&__emit_char("1"),restore()},emit_denominators=function(r){var e;for(save(),e=0,r=cdr(r),isfraction(car(r))&&(push(car(r)),mp_denominator(),p1=pop(),emit_number(p1,0),e++,r=cdr(r));iscons(r);)isdenominator(car(r))&&(e>0&&__emit_char(" "),emit_denominator(car(r),0),e++),r=cdr(r);return restore()},emit_factor=function(r){istensor(r)?emit_flat_tensor(r):isdouble(r)?emit_number(r,0):car(r)!==symbol(ADD)&&car(r)!==symbol(MULTIPLY)?car(r)!==symbol(POWER)?iscons(r)?emit_function(r):isNumericAtom(r)?0===level?emit_numerical_fraction(r):emit_number(r,0):issymbol(r)?emit_symbol(r):isstr(r)&&emit_string(r):emit_power(r):emit_subexpr(r)},emit_numerical_fraction=function(r){var e,s,o;return 0,0,0,save(),push(r),mp_numerator(),absval(),p3=pop(),push(r),mp_denominator(),p4=pop(),isplusone(p4)?(emit_number(p3,0),void restore()):(o=emit_x,e=yindex,emit_number(p3,0),s=yindex,emit_number(p4,0),fixup_fraction(o,e,s),restore())},isfactor=function(r){return iscons(r)&&car(r)!==symbol(ADD)&&car(r)!==symbol(MULTIPLY)&&car(r)!==symbol(POWER)?1:issymbol(r)?1:isfraction(r)?0:isnegativenumber(r)?0:isNumericAtom(r)?1:0},emit_power=function(r){var e,s,o;return e=0,s=0,o=0,cadr(r)===symbol(E)?(__emit_str("exp("),emit_expr(caddr(r)),void __emit_char(")")):level>0?void(isminusone(caddr(r))?(__emit_char("1"),__emit_char("/"),isfactor(cadr(r))?emit_factor(cadr(r)):emit_subexpr(cadr(r))):(isfactor(cadr(r))?emit_factor(cadr(r)):emit_subexpr(cadr(r)),__emit_char("^"),isfactor(caddr(r))?emit_factor(caddr(r)):emit_subexpr(caddr(r)))):__is_negative(caddr(r))?(o=emit_x,e=yindex,__emit_char("1"),s=yindex,emit_denominator(r,1),void fixup_fraction(o,e,s)):(e=yindex,isfactor(cadr(r))?emit_factor(cadr(r)):emit_subexpr(cadr(r)),s=yindex,level++,emit_expr(caddr(r)),level--,fixup_power(e,s))},emit_denominator=function(r,e){var s,o;if(0,0,!isminusone(caddr(r)))return s=yindex,isfactor(cadr(r))?emit_factor(cadr(r)):emit_subexpr(cadr(r)),o=yindex,level++,emit_unsigned_expr(caddr(r)),level--,fixup_power(s,o);1===e?emit_expr(cadr(r)):emit_factor(cadr(r))},emit_function=function(r){if(car(r)===symbol(INDEX)&&issymbol(cadr(r)))emit_index_function(r);else{if(car(r)!==symbol(FACTORIAL)){if(car(r)===symbol(DERIVATIVE)?__emit_char("d"):emit_symbol(car(r)),__emit_char("("),r=cdr(r),iscons(r))for(emit_expr(car(r)),r=cdr(r);iscons(r);)__emit_char(","),emit_expr(car(r)),r=cdr(r);return __emit_char(")")}emit_factorial_function(r)}},emit_index_function=function(r){if(r=cdr(r),caar(r)===symbol(ADD)||caar(r)===symbol(MULTIPLY)||caar(r)===symbol(POWER)||caar(r)===symbol(FACTORIAL)?emit_subexpr(car(r)):emit_expr(car(r)),__emit_char("["),r=cdr(r),iscons(r))for(emit_expr(car(r)),r=cdr(r);iscons(r);)__emit_char(","),emit_expr(car(r)),r=cdr(r);return __emit_char("]")},emit_factorial_function=function(r){return r=cadr(r),car(r)===symbol(ADD)||car(r)===symbol(MULTIPLY)||car(r)===symbol(POWER)||car(r)===symbol(FACTORIAL)?emit_subexpr(r):emit_expr(r),__emit_char("!")},emit_subexpr=function(r){return __emit_char("("),emit_expr(r),__emit_char(")")},emit_symbol=function(r){var e,s,o,t,n;if(e=0,r!==symbol(E)){for(n=[],e=s=0,t=(o=get_printname(r)).length;0<=t?s<t:s>t;e=0<=t?++s:--s)n.push(__emit_char(o[e]));return n}__emit_str("exp(1)")},emit_string=function(r){var e,s,o,t;for(e=0,o=r.str,__emit_char('"'),e=s=0,t=o.length;0<=t?s<t:s>t;e=0<=t?++s:--s)__emit_char(o[e]);return __emit_char('"')},fixup_fraction=function(r,e,s){var o,t,n,p,i,a,u,l,c,d,_;for(o=0,0,0,u=0,0,t=0,l=0,d=0,n=0,c=0,_=0,[t,l,d]=get_size(e,s),[n,c,_]=get_size(s,yindex),o=c>l?(c-l)/2:0,move(e,s,++o,-(d+t-1)-1),o=c>l?-l:(l-c)/2-l,move(s,yindex,++o,1-_),u=c>l?c:l,emit_x=r,a=[],p=0,i=u+=2;0<=i?p<i:p>i;0<=i?++p:--p)a.push(__emit_char("-"));return a},fixup_power=function(r,e){var s,o,t,n,p,i,a;return s=0,o=0,n=0,i=0,t=0,p=0,a=0,[o,n,i]=get_size(r,e),[t,p,a]=get_size(e,yindex),s=-a-t+1,move(e,yindex,0,s+=i-1)},move=function(r,e,s,o){var t,n,p,i,a;for(t=0,a=[],t=n=p=r,i=e;p<=i?n<i:n>i;t=p<=i?++n:--n)chartab[t].x+=s,a.push(chartab[t].y+=o);return a},get_size=function(r,e){var s,o,t,n,p,i,a,u;for(s=0,p=chartab[r].x,t=chartab[r].x,i=chartab[r].y,n=chartab[r].y,s=o=a=r+1,u=e;a<=u?o<u:o>u;s=a<=u?++o:--o)chartab[s].x<p&&(p=chartab[s].x),chartab[s].x>t&&(t=chartab[s].x),chartab[s].y<i&&(i=chartab[s].y),chartab[s].y>n&&(n=chartab[s].y);return[n-i+1,t-p+1,i]},displaychar=function(r){return __emit_char(r)},__emit_char=function(r){if(yindex!==YMAX)return chartab[yindex],chartab[yindex].c=r,chartab[yindex].x=emit_x,chartab[yindex].y=0,yindex++,emit_x++},__emit_str=function(r){var e,s,o,t;for(e=0,t=[],e=s=0,o=r.length;0<=o?s<o:s>o;e=0<=o?++s:--s)t.push(__emit_char(r[e]));return t},emit_number=function(r,e){var s,o,t,n,p,i,a,u,l,c;switch(c="",s=0,r.k){case NUM:for("-"===(c=r.q.a.toString())[0]&&0===e&&(c=c.substring(1)),s=o=0,p=c.length;0<=p?o<p:o>p;s=0<=p?++o:--o)__emit_char(c[s]);if("1"===(c=r.q.b.toString()))break;for(__emit_char("/"),u=[],s=t=0,i=c.length;0<=i?t<i:t>i;s=0<=i?++t:--t)u.push(__emit_char(c[s]));return u;case DOUBLE:for("-"===(c=doubleToReasonableString(r.d))[0]&&0===e&&(c=c.substring(1)),l=[],s=n=0,a=c.length;0<=a?n<a:n>a;s=0<=a?++n:--n)l.push(__emit_char(c[s]));return l}},cmpGlyphs=function(r,e){return r.y<e.y?-1:r.y>e.y?1:r.x<e.x?-1:r.x>e.x?1:0},print_glyphs=function(){var r,e,s,o,t,n,p;for(e=0,r="",(t=chartab.slice(0,yindex)).sort(cmpGlyphs),n=0,p=(chartab=[].concat(t).concat(chartab.slice(yindex)))[0].y,e=s=0,o=yindex;0<=o?s<o:s>o;e=0<=o?++s:--s){for(;chartab[e].y>p;)r+=printchar("\n"),n=0,p++;for(;chartab[e].x>n;)r+=printchar_nowrap(" "),n++;r+=printchar_nowrap(chartab[e].c),n++}return r},buffer="",getdisplaystr=function(){return yindex=0,level=0,emit_x=0,emit_expr(pop()),fill_buf(),buffer},fill_buf=function(){var r,e,s,o,t,n,p,i;for(n=buffer,o=0,r=0,(t=chartab.slice(0,yindex)).sort(cmpGlyphs),p=0,i=(chartab=[].concat(t).concat(chartab.slice(yindex)))[0].y,r=e=0,s=yindex;0<=s?e<s:e>s;r=0<=s?++e:--e){for(;chartab[r].y>i;)n[o++]="\n",p=0,i++;for(;chartab[r].x>p;)n[o++]=" ",p++;n[o++]=chartab[r].c,p++}return n[o++]="\n"},N=100,oneElement=function(){class r{}return r.prototype.x=0,r.prototype.y=0,r.prototype.h=0,r.prototype.w=0,r.prototype.index=0,r.prototype.count=0,r}.call(this),elem=[],elelmIndex=j1=0;j1<1e4;elelmIndex=++j1)elem[elelmIndex]=new oneElement;SPACE_BETWEEN_COLUMNS=3,SPACE_BETWEEN_ROWS=1,emit_tensor=function(r){var e,s,o,t,n,p,i,a,u,l,c,d,_,m,f,h,g,b,y,E,v;if(p=0,0,0,c=0,0,0,0,0,s=0,o=0,t=0,n=0,b=0,e=0,r.tensor.ndim>2)emit_flat_tensor(r);else{if(!((u=(d=r.tensor.dim[0])*(c=2===r.tensor.ndim?r.tensor.dim[1]:1))>N)){for(E=emit_x,p=i=0,m=u;0<=m?i<m:i>m;p=0<=m?++i:--i)elem[p].index=yindex,elem[p].x=emit_x,emit_expr(r.tensor.elem[p]),elem[p].count=yindex-elem[p].index,[elem[p].h,elem[p].w,elem[p].y]=get_size(elem[p].index,yindex);for(t=0,n=0,p=a=0,f=u;0<=f?a<f:a>f;p=0<=f?++a:--a)elem[p].h>t&&(t=elem[p].h),elem[p].w>n&&(n=elem[p].w);for(y=c*n+(c-1)*SPACE_BETWEEN_COLUMNS,v=-(d*t+(d-1)*SPACE_BETWEEN_ROWS)/2,b=l=0,h=d;0<=h?l<h:l>h;b=0<=h?++l:--l)for(e=_=0,g=c;0<=g?_<g:_>g;e=0<=g?++_:--_)s=E-elem[p=b*c+e].x,o=v-elem[p].y,move(elem[p].index,elem[p].index+elem[p].count,s,o),s=0,e>0&&(s=e*(n+SPACE_BETWEEN_COLUMNS)),o=0,b>0&&(o=b*(t+SPACE_BETWEEN_ROWS)),s+=(n-elem[p].w)/2,o+=(t-elem[p].h)/2,move(elem[p].index,elem[p].index+elem[p].count,s,o);return emit_x=E+y}emit_flat_tensor(r)}},emit_flat_tensor=function(r){return emit_tensor_inner(r,0,0)},emit_tensor_inner=function(r,e,s){var o,t,n;for(o=0,__emit_char("("),o=t=0,n=r.tensor.dim[e];0<=n?t<n:t>n;o=0<=n?++t:--t)e+1===r.tensor.ndim?(emit_expr(r.tensor.elem[s]),s+=1):s=emit_tensor_inner(r,e+1,s),o+1<r.tensor.dim[e]&&__emit_char(",");return __emit_char(")"),s},Eval_product=function(){var r,e,s,o,t,n,p,i,a;if(e=0,0,0,r=cadr(p1),s=caddr(p1),issymbol(s)||stop("sum: 2nd arg?"),push(cadddr(p1)),Eval(),o=pop_integer(),isNaN(o))push(p1);else{if(push(caddddr(p1)),Eval(),t=pop_integer(),!isNaN(t)){for(p=get_binding(s),push_integer(1),e=n=i=o,a=t;i<=a?n<=a:n>=a;e=i<=a?++n:--n)push_integer(e),p5=pop(),set_binding(s,p5),push(r),Eval(),DEBUG&&(console.log("product - factor 1: "+stack[tos-1].toString()),console.log("product - factor 2: "+stack[tos-2].toString())),multiply(),DEBUG&&console.log("product - result: "+stack[tos-1].toString());return set_binding(s,p)}push(p1)}},qadd=function(){var r,e,s,o,t,n,p,i;if(n=pop(),t=pop(),e=mmul(t.q.a,n.q.b),s=mmul(t.q.b,n.q.a),p=madd(e,s),!MZERO(p))return o=mmul(t.q.b,n.q.b),r=mgcd(p,o),r=makeSignSameAs(r,o),(i=new U).k=NUM,i.q.a=mdiv(p,r),i.q.b=mdiv(o,r),push(i);push(zero)},qdiv=function(){var r,e,s;return save(),p2=pop(),p1=pop(),MZERO(p2.q.a)&&stop("divide by zero"),MZERO(p1.q.a)?(push(zero),void restore()):(r=mmul(p1.q.a,p2.q.b),e=mmul(p1.q.b,p2.q.a),s=mgcd(r,e),s=makeSignSameAs(s,e),(p1=new U).k=NUM,p1.q.a=mdiv(r,s),p1.q.b=mdiv(e,s),push(p1),restore())},qmul=function(){var r,e,s;return save(),p2=pop(),p1=pop(),MZERO(p1.q.a)||MZERO(p2.q.a)?(push(zero),void restore()):(r=mmul(p1.q.a,p2.q.a),e=mmul(p1.q.b,p2.q.b),s=mgcd(r,e),s=makeSignSameAs(s,e),(p1=new U).k=NUM,p1.q.a=mdiv(r,s),p1.q.b=mdiv(e,s),push(p1),restore())},qpow=function(){return save(),qpowf(),restore()},qpowf=function(){var r,e,s,o,t,n;if(s=0,p2=pop(),p1=pop(),isplusone(p1)||isZeroAtomOrTensor(p2))push_integer(1);else if(isminusone(p1)&&isoneovertwo(p2))push(imaginaryunit);else{if(isZeroAtomOrTensor(p1))return isnegativenumber(p2)&&stop("divide by zero"),void push(zero);if(!isplusone(p2))return isinteger(p2)?(push(p2),s=pop_integer(),isNaN(s)?(push_symbol(POWER),push(p1),push(p2),void list(3)):(t=mpow(p1.q.a,Math.abs(s)),n=mpow(p1.q.b,Math.abs(s)),s<0&&(o=t,t=makeSignSameAs(t=n,n=o),n=makePositive(n)),(p3=new U).k=NUM,p3.q.a=t,p3.q.b=n,void push(p3))):isminusone(p1)?(push(p2),void normalize_angle()):isnegativenumber(p1)?(push(p1),negate(),push(p2),qpow(),push_integer(-1),push(p2),qpow(),void multiply()):isinteger(p1)?is_small_integer(p1)?(push(p1),push(p2),void quickfactor()):isSmall(p2.q.a)&&isSmall(p2.q.b)?(r=p2.q.a,e=p2.q.b,0===(t=mroot(p1.q.a,e))?(push_symbol(POWER),push(p1),push(p2),void list(3)):(n=mpow(t,r),(p3=new U).k=NUM,p2.q.a.isNegative()?(p3.q.a=bigInt(1),p3.q.b=n):(p3.q.a=n,p3.q.b=bigInt(1)),push(p3))):(push_symbol(POWER),push(p1),push(p2),void list(3)):(push(p1),mp_numerator(),push(p2),qpow(),push(p1),mp_denominator(),push(p2),negate(),qpow(),void multiply());push(p1)}},normalize_angle=function(){return save(),p1=pop(),isinteger(p1)?(p1.q.a.isOdd()?push_integer(-1):push_integer(1),void restore()):(push(p1),bignum_truncate(),p2=pop(),isnegativenumber(p1)&&(push(p2),push_integer(-1),add(),p2=pop()),push(p1),push(p2),subtract(),p3=pop(),push_symbol(POWER),push_integer(-1),push(p3),list(3),p2.q.a.isOdd()&&negate(),restore())},is_small_integer=function(r){return isSmall(r.q.a)},quickfactor=function(){var r,e,s,o,t,n;for(e=0,save(),p2=pop(),p1=pop(),r=tos,push(p1),factor_small_number(),n=r,e=s=0,t=o=tos-r;s<t;e=s+=2)push(stack[n+e]),push(stack[n+e+1]),push(p2),multiply(),quickpower();return multiply_all(tos-r-o),p1=pop(),moveTos(r),push(p1),restore()},quickpower=function(){var r;return 0,save(),p2=pop(),p1=pop(),push(p2),bignum_truncate(),p3=pop(),push(p2),push(p3),subtract(),p4=pop(),isZeroAtomOrTensor(p4)||(push_symbol(POWER),push(p1),push(p4),list(3)),push(p3),r=pop_integer(),isNaN(r)?(push_symbol(POWER),push(p1),push(p3),list(3),void restore()):0!==r?(push(p1),bignum_power_number(r),restore()):void restore()},Eval_quotient=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),push(cadddr(p1)),Eval(),(p1=pop())===symbol(NIL)&&(p1=symbol(SYMBOL_X)),push(p1),divpoly()},divpoly=function(){var r,e,s,o,t,n,p,i,a;for(0,o=0,n=0,0,a=0,save(),p3=pop(),p2=pop(),p1=pop(),s=tos,r=tos,push(p1),push(p3),n=coeff()-1,e=tos,push(p2),push(p3),a=n-(p=coeff()-1),push_integer(0),p5=pop();a>=0;){for(push(stack[r+n]),push(stack[e+p]),divide(),p4=pop(),o=t=0,i=p;0<=i?t<=i:t>=i;o=0<=i?++t:--t)push(stack[r+a+o]),push(stack[e+o]),push(p4),multiply(),subtract(),stack[r+a+o]=pop();push(p5),push(p4),push(p3),push_integer(a),power(),multiply(),add(),p5=pop(),n--,a--}return moveTos(s),push(p5),restore()},Eval_rationalize=function(){return push(cadr(p1)),Eval(),rationalize()},rationalize=function(){var r;return r=expanding,yyrationalize(),expanding=r},yyrationalize=function(){var r,e,s;if(s=pop(),istensor(s))__rationalize_tensor(s);else{if(expanding=0,car(s)===symbol(ADD)){for(DEBUG&&(printf("rationalize: this is the input expr:\n"),printline(s)),push(one),multiply_denominators(s),r=pop(),DEBUG&&(printf("rationalize: this is the common denominator:\n"),printline(r)),push(zero),e=cdr(s);iscons(e);)push(r),push(car(e)),multiply(),add(),e=cdr(e);return DEBUG&&(printf("rationalize: original expr times common denominator:\n"),printline(stack[tos-1])),Condense(),DEBUG&&(printf("rationalize: after factoring:\n"),printline(stack[tos-1])),push(r),divide(),DEBUG?(printf("rationalize: after dividing by common denom. (and we're done):\n"),printline(stack[tos-1])):void 0}push(s)}},multiply_denominators=function(r){var e;if(car(r)===symbol(ADD)){for(r=cdr(r),e=[];iscons(r);)multiply_denominators_term(car(r)),e.push(r=cdr(r));return e}return multiply_denominators_term(r)},multiply_denominators_term=function(r){var e;if(car(r)===symbol(MULTIPLY)){for(r=cdr(r),e=[];iscons(r);)multiply_denominators_factor(car(r)),e.push(r=cdr(r));return e}return multiply_denominators_factor(r)},multiply_denominators_factor=function(r){if(car(r)===symbol(POWER))return push(r),r=caddr(r),isnegativenumber(r)?(inverse(),void __lcm()):car(r)===symbol(MULTIPLY)&&isnegativenumber(cadr(r))?(inverse(),void __lcm()):pop()},__rationalize_tensor=function(r){var e,s,o;if(e=0,push(r),Eval(),r=pop(),istensor(r)){for(e=s=0,o=r.tensor.nelem;0<=o?s<o:s>o;e=0<=o?++s:--s)push(r.tensor.elem[e]),rationalize(),r.tensor.elem[e]=pop();return check_tensor_dimensions(r),push(r)}push(r)},__lcm=function(){return save(),p1=pop(),p2=pop(),push(p1),push(p2),multiply(),push(p1),push(p2),gcd(),divide(),restore()},Eval_real=function(){return push(cadr(p1)),Eval(),real()},real=function(){return save(),rect(),p1=pop(),push(p1),push(p1),conjugate(),add(),push_integer(2),divide(),restore()},DEBUG_RECT=!1,Eval_rect=function(){return push(cadr(p1)),Eval(),rect()},rect=function(){var r;if(save(),r=p1=pop(),DEBUG_RECT&&console.log("RECT of "+r),DEBUG_RECT&&console.log("any clock forms in : "+r+" ? "+findPossibleClockForm(r)),issymbol(p1))DEBUG_RECT&&console.log(" rect: simple symbol: "+r),isZeroAtomOrTensor(get_binding(symbol(ASSUME_REAL_VARIABLES)))?(push_symbol(YYRECT),push(p1),list(2)):push(p1);else if(isZeroAtomOrTensor(get_binding(symbol(ASSUME_REAL_VARIABLES)))||findPossibleExponentialForm(p1)||findPossibleClockForm(p1)||Find(p1,symbol(SIN))&&Find(p1,symbol(COS))&&Find(p1,imaginaryunit))if(car(p1)===symbol(MULTIPLY)&&isimaginaryunit(cadr(p1))&&!isZeroAtomOrTensor(get_binding(symbol(ASSUME_REAL_VARIABLES))))push(p1);else if(car(p1)===symbol(ADD))for(DEBUG_RECT&&console.log(" rect - "+r+" is a sum "),push_integer(0),p1=cdr(p1);iscons(p1);)push(car(p1)),rect(),add(),p1=cdr(p1);else DEBUG_RECT&&console.log(" rect - "+r+" is NOT a sum "),push(p1),abs(),DEBUG_RECT&&console.log(" rect - "+r+" abs: "+stack[tos-1].toString()),push(p1),arg(),DEBUG_RECT&&console.log(" rect - "+r+" arg of "+p1+" : "+stack[tos-1].toString()),p1=pop(),push(p1),cosine(),DEBUG_RECT&&console.log(" rect - "+r+" cosine: "+stack[tos-1].toString()),push(imaginaryunit),push(p1),sine(),DEBUG_RECT&&console.log(" rect - "+r+" sine: "+stack[tos-1].toString()),multiply(),DEBUG_RECT&&console.log(" rect - "+r+" i * sine: "+stack[tos-1].toString()),add(),DEBUG_RECT&&console.log(" rect - "+r+" cos + i * sine: "+stack[tos-1].toString()),multiply();else DEBUG_RECT&&console.log(" rect: simple symbol: "+r),push(p1);if(restore(),DEBUG_RECT)return console.log("rect of "+r+" : "+stack[tos-1])},show_power_debug=!1,performing_roots=!1,Eval_roots=function(){return p2=cadr(p1),car(p2)===symbol(SETQ)||car(p2)===symbol(TESTEQ)?(push(cadr(p2)),Eval(),push(caddr(p2)),Eval(),subtract()):(push(p2),Eval(),p2=pop(),car(p2)===symbol(SETQ)||car(p2)===symbol(TESTEQ)?(push(cadr(p2)),Eval(),push(caddr(p2)),Eval(),subtract()):push(p2)),push(caddr(p1)),Eval(),(p2=pop())===symbol(NIL)?guess():push(p2),p2=pop(),p1=pop(),ispoly(p1,p2)||stop("roots: 1st argument is not a polynomial"),push(p1),push(p2),roots()},hasImaginaryCoeff=function(r){var e,s,o;for(s=!1,tos,e=o=r;o>0;e=o+=-1)if(iscomplexnumber(stack[tos-e])){s=!0;break}return s},isSimpleRoot=function(r){var e,s,o;if(r>2){for(s=!0,tos,isZeroAtomOrTensor(stack[tos-r])&&(s=!1),e=o=r-1;o>1;e=o+=-1)if(!isZeroAtomOrTensor(stack[tos-e])){s=!1;break}}else s=!1;return s},normalisedCoeff=function(){var r,e,s,o,t,n,p,i;for(s=coeff(),r=stack[tos-1],n=[],e=o=1,p=s;1<=p?o<=p:o>=p;e=1<=p?++o:--o)n.push(pop());for(e=t=i=s-1;i<=0?t<=0:t>=0;e=i<=0?++t:--t)push(n[e]),push(r),divide();return s},roots=function(){var r,e,s,o,t,n,p,i;if(0,e=0,0,save(),recursionLevelNestedRadicalsRemoval>1)return pop(),pop(),push(symbol(NIL)),void restore();if(performing_roots=!0,r=tos-2,DEBUG&&console.log("checking if "+stack[tos-1].toString()+" is a case of simple roots"),p2=pop(),p1=pop(),push(p1),push(p2),push(p1),push(p2),s=normalisedCoeff(),isSimpleRoot(s)?(DEBUG&&console.log("yes, "+stack[tos-1].toString()+" is a case of simple roots"),t=stack[tos-s],n=stack[tos-1],moveTos(tos-s),pop(),pop(),getSimpleRoots(s,n,t)):(moveTos(tos-s),roots2()),0===(p=tos-r)&&stop("roots: the polynomial is not factorable, try nroots"),1===p)return performing_roots=!1,void restore();for(sort_stack(p),(p1=alloc_tensor(p)).tensor.ndim=1,p1.tensor.dim[0]=p,e=o=0,i=p;0<=i?o<i:o>i;e=0<=i?++o:--o)p1.tensor.elem[e]=stack[r+e];return moveTos(r),push(p1),restore(),performing_roots=!1},getSimpleRoots=function(r,e,s){var o,t,n,p,i,a,u;if(DEBUG&&console.log("getSimpleRoots"),save(),r-=1,push(s),push_rational(1,r),power(),push(e),push_rational(1,r),power(),divide(),t=pop(),r%2==0)for(u=n=1,i=r;n<=i;u=n+=2)push(t),push_integer(-1),push_rational(u,r),power(),multiply(),o=pop(),push(o),push(o),negate();else for(u=p=1,a=r;1<=a?p<=a:p>=a;u=1<=a?++p:--p)push(t),push_integer(-1),push_rational(u,r),power(),multiply(),u%2==0&&negate();return restore()},roots2=function(){var r;if(save(),p2=pop(),p1=pop(),push(p1),push(p2),push(p1),push(p2),r=normalisedCoeff(),hasImaginaryCoeff(r)?(moveTos(tos-r),pop(),pop()):(moveTos(tos-r),factorpoly(),p1=pop()),car(p1)===symbol(MULTIPLY))for(p1=cdr(p1);iscons(p1);)push(car(p1)),push(p2),roots3(),p1=cdr(p1);else push(p1),push(p2),roots3();return restore()},roots3=function(){var r;return save(),p2=pop(),p1=pop(),car(p1)===symbol(POWER)&&ispoly(cadr(p1),p2)&&isposint(caddr(p1))?(push(cadr(p1)),push(p2),r=normalisedCoeff(),mini_solve(r)):ispoly(p1,p2)&&(push(p1),push(p2),r=normalisedCoeff(),mini_solve(r)),restore()},mini_solve=function(r){var e,s,o,t,n,p,i,a,u,l,c,d,_,m,f,h,g,b,y,E,v,x,A,T,O,I,N,S,R,M,L,k,D,U,P,B,q,G,w,C,F,Y,X,W,z,V,Z,$,H,Q,j,J,K,rr,er,sr,or,tr,nr,pr,ir,ar,ur,lr,cr,dr;if(save(),2===r)return p3=pop(),p4=pop(),push(p4),push(p3),divide(),negate(),void restore();if(3===r)return p3=pop(),p4=pop(),p5=pop(),push(p4),push_integer(2),power(),push_integer(4),push(p3),multiply(),push(p5),multiply(),subtract(),push_rational(1,2),power(),p6=pop(),push(p6),push(p4),subtract(),push(p3),push_integer(2),multiply(),divide(),push(p6),push(p4),add(),negate(),push(p3),divide(),push_rational(1,2),multiply(),void restore();if(4===r||5===r){if(p3=pop(),p4=pop(),p5=pop(),p6=pop(),push(p5),push(p5),multiply(),S=pop(),push(S),push(p5),multiply(),R=pop(),push(p4),push(p4),multiply(),T=pop(),push(T),push(p4),multiply(),I=pop(),push(I),push(p6),multiply(),N=pop(),push(N),push_integer(-4),multiply(),q=pop(),push(I),push_integer(2),multiply(),t=pop(),push(p3),push(p3),multiply(),g=pop(),push(g),push(p3),multiply(),E=pop(),push_integer(3),push(p3),multiply(),n=pop(),push(g),push(p6),multiply(),b=pop(),push(b),push(p6),multiply(),y=pop(),push(b),push_integer(27),multiply(),o=pop(),push(y),push_integer(-27),multiply(),P=pop(),push(n),push_integer(2),multiply(),pop(),push(p3),push(p5),multiply(),A=pop(),push(A),push(p4),multiply(),v=pop(),push(v),push(p6),multiply(),x=pop(),push(A),push_integer(3),multiply(),i=pop(),push_integer(-4),push(p3),push(R),multiply(),multiply(),B=pop(),push(v),push_integer(9),multiply(),negate(),G=pop(),push(x),push_integer(18),multiply(),s=pop(),push(T),push(i),subtract(),_=pop(),push(T),push(S),multiply(),O=pop(),push(p4),negate(),push(n),divide(),w=pop(),4===r){if(DEBUG&&console.log(">>>>>>>>>>>>>>>> actually using cubic formula <<<<<<<<<<<<<<< "),DEBUG&&console.log("cubic: D0: "+_.toString()),push(_),push_integer(3),power(),push_integer(4),multiply(),a=pop(),push(_),simplify(),absValFloat(),m=pop(),DEBUG&&console.log("cubic: D0 as float: "+m.toString()),push(s),push(q),push(O),push(B),push(P),add(),add(),add(),add(),simplify(),absValFloat(),L=pop(),DEBUG&&console.log("cubic: DETERMINANT: "+L.toString()),push(t),push(G),push(o),add(),add(),f=pop(),DEBUG&&console.log("cubic: D1: "+f.toString()),push(f),push_integer(2),power(),push(a),subtract(),push_rational(1,2),power(),simplify(),h=pop(),isZeroAtomOrTensor(L))return isZeroAtomOrTensor(m)?(DEBUG&&console.log(" cubic: DETERMINANT IS ZERO and delta0 is zero"),push(w),void restore()):(DEBUG&&console.log(" cubic: DETERMINANT IS ZERO and delta0 is not zero"),push(p3),push(p6),push_integer(9),multiply(),multiply(),push(p4),push(p5),multiply(),subtract(),push(_),push_integer(2),multiply(),divide(),lr=pop(),push(lr),push(lr),push(v),push_integer(4),multiply(),push(p3),push(p3),push(p6),push_integer(9),multiply(),multiply(),multiply(),negate(),push(I),negate(),add(),add(),push(p3),push(_),multiply(),divide(),void restore());for(e=!1,Q=!1;!e;)push(h),Q&&negate(),push(f),add(),push_rational(1,2),multiply(),push_rational(1,3),power(),simplify(),l=pop(),DEBUG&&console.log("cubic: C: "+l.toString()),push(l),simplify(),absValFloat(),d=pop(),DEBUG&&console.log("cubic: C as absval and float: "+d.toString()),isZeroAtomOrTensor(d)?(DEBUG&&console.log(" cubic: C IS ZERO flipping the sign"),Q=!0):e=!0;return push(l),push(n),multiply(),p=pop(),push(p),push_integer(2),multiply(),u=pop(),push(imaginaryunit),push_integer(3),push_rational(1,2),power(),multiply(),j=pop(),push_integer(1),push(j),add(),nr=pop(),push_integer(1),push(j),subtract(),tr=pop(),push(l),push(n),divide(),c=pop(),push(w),push(c),negate(),push(_),push(p),divide(),negate(),add(),add(),simplify(),push(w),push(c),push(nr),multiply(),push_integer(2),divide(),push(tr),push(_),multiply(),push(u),divide(),add(),add(),simplify(),push(w),push(c),push(tr),multiply(),push_integer(2),divide(),push(nr),push(_),multiply(),push(u),divide(),add(),add(),simplify(),void restore()}if(5===r){if(DEBUG&&console.log(">>>>>>>>>>>>>>>> actually using quartic formula <<<<<<<<<<<<<<< "),p7=pop(),isZeroAtomOrTensor(p4)&&isZeroAtomOrTensor(p6)&&!isZeroAtomOrTensor(p5)&&!isZeroAtomOrTensor(p7)){for(DEBUG&&console.log("biquadratic case"),push(p3),push(symbol(SECRETX)),push_integer(2),power(),multiply(),push(p5),push(symbol(SECRETX)),multiply(),push(p7),add(),add(),push(symbol(SECRETX)),roots(),J=0,K=(pr=pop().tensor.elem).length;J<K;J++)H=pr[J],push(H),push_rational(1,2),power(),simplify(),push(H),push_rational(1,2),power(),negate(),simplify();return void restore()}if(push(p6),push(p6),multiply(),M=pop(),push(p7),push(p7),multiply(),k=pop(),push(k),push(p7),multiply(),D=pop(),push_integer(256),push(E),push(D),multiply(),multiply(),push_integer(-192),push(b),push(k),push(p4),multiply(),multiply(),multiply(),push_integer(-128),push(g),push(S),push(k),multiply(),multiply(),multiply(),push_integer(144),push(y),push(p5),push(p7),multiply(),multiply(),multiply(),push(P),push(M),multiply(),push_integer(144),push(v),push(p4),push(k),multiply(),multiply(),multiply(),push_integer(-6),push(p3),push(T),push(M),push(p7),multiply(),multiply(),multiply(),multiply(),push_integer(-80),push(x),push(p5),push(p7),multiply(),multiply(),multiply(),push_integer(18),push(x),push(M),multiply(),multiply(),push_integer(16),push(A),push(R),push(p7),multiply(),multiply(),multiply(),push_integer(-4),push(A),push(S),push(M),multiply(),multiply(),multiply(),push_integer(-27),push(I),push(p4),push(k),multiply(),multiply(),multiply(),push_integer(18),push(N),push(p5),push(p7),multiply(),multiply(),multiply(),push(q),push(M),multiply(),push_integer(-4),push(O),push(p5),push(p7),multiply(),multiply(),multiply(),push(O),push(M),multiply(),add(),add(),add(),add(),add(),add(),add(),add(),add(),add(),add(),add(),add(),add(),add(),L=pop(),DEBUG&&console.log("R_determinant: "+L.toString()),push(S),push_integer(-3),push(p4),push(p6),multiply(),multiply(),push_integer(12),push(p3),push(p7),multiply(),multiply(),add(),add(),_=pop(),DEBUG&&console.log("R_DELTA0: "+_.toString()),push_integer(2),push(R),multiply(),push_integer(-9),push(p4),push(p5),push(p6),multiply(),multiply(),multiply(),push_integer(27),push(T),push(p7),multiply(),multiply(),push_integer(27),push(p3),push(M),multiply(),multiply(),push_integer(-72),push(A),push(p7),multiply(),multiply(),add(),add(),add(),add(),f=pop(),DEBUG&&console.log("R_DELTA1: "+f.toString()),push_integer(8),push(A),multiply(),push_integer(-3),push(T),multiply(),add(),push_integer(8),push(g),multiply(),divide(),C=pop(),DEBUG&&console.log("p: "+C.toString()),push(I),push_integer(-4),push(v),multiply(),push_integer(8),push(b),multiply(),add(),add(),push_integer(8),push(E),multiply(),divide(),F=pop(),DEBUG&&console.log("q: "+F.toString()),DEBUG&&console.log("tos 1 "+tos),isZeroAtomOrTensor(p4)){for(C=p5,F=p6,Y=p7,push_rational(5,2),push(C),multiply(),z=pop(),push_integer(2),push(C),push_integer(2),power(),multiply(),push(Y),subtract(),V=pop(),push(C),push_integer(3),power(),push_integer(2),divide(),push_rational(-1,2),push(C),push(Y),multiply(),multiply(),push_rational(-1,8),push(F),push_integer(2),power(),multiply(),add(),add(),Z=pop(),push(symbol(SECRETX)),push_integer(3),power(),push(z),push(symbol(SECRETX)),push_integer(2),power(),multiply(),push(V),push(symbol(SECRETX)),multiply(),push(Z),add(),add(),add(),DEBUG&&console.log("resolventCubic: "+stack[tos-1].toString()),push(symbol(SECRETX)),roots(),ur=pop(),DEBUG&&console.log("resolventCubicSolutions: "+ur),U=null,or=0,er=(ar=ur.tensor.elem).length;or<er;or++)if(H=ar[or],DEBUG&&console.log("examining solution: "+H),push(H),push_integer(2),multiply(),push(C),add(),absValFloat(),dr=pop(),DEBUG&&console.log("abs value is: "+H),!isZeroAtomOrTensor(dr)){U=H;break}return DEBUG&&console.log("chosen solution: "+U),push(U),push_integer(2),multiply(),push(C),add(),push_rational(1,2),power(),simplify(),cr=pop(),push(F),push_integer(2),multiply(),push(cr),divide(),simplify(),W=pop(),push(C),push_integer(3),multiply(),push(U),push_integer(2),multiply(),add(),X=pop(),push(cr),push(X),push(W),add(),negate(),push_rational(1,2),power(),simplify(),add(),push_integer(2),divide(),push(cr),push(X),push(W),add(),negate(),push_rational(1,2),power(),simplify(),subtract(),push_integer(2),divide(),push(cr),negate(),push(X),push(W),subtract(),negate(),push_rational(1,2),power(),simplify(),add(),push_integer(2),divide(),push(cr),negate(),push(X),push(W),subtract(),negate(),push_rational(1,2),power(),simplify(),subtract(),push_integer(2),divide(),void restore()}for(DEBUG&&console.log("tos 2 "+tos),push_integer(8),push(p5),push(p3),multiply(),multiply(),push_integer(-3),push(p4),push_integer(2),power(),multiply(),add(),push_integer(8),push(p3),push_integer(2),power(),multiply(),divide(),C=pop(),DEBUG&&console.log("p for depressed quartic: "+C.toString()),push(p4),push_integer(3),power(),push_integer(-4),push(p3),push(p4),push(p5),multiply(),multiply(),multiply(),push_integer(8),push(p6),push(p3),push_integer(2),power(),multiply(),multiply(),add(),add(),push_integer(8),push(p3),push_integer(3),power(),multiply(),divide(),F=pop(),DEBUG&&console.log("q for depressed quartic: "+F.toString()),push(p4),push_integer(4),power(),push_integer(-3),multiply(),push_integer(256),push(E),push(p7),multiply(),multiply(),push_integer(-64),push(b),push(p4),multiply(),multiply(),push_integer(16),push(T),push(p3),push(p5),multiply(),multiply(),multiply(),add(),add(),add(),push_integer(256),push(p3),push_integer(4),power(),multiply(),divide(),Y=pop(),DEBUG&&console.log("r for depressed quartic: "+Y.toString()),DEBUG&&console.log("tos 4 "+tos),push(symbol(SECRETX)),push_integer(4),power(),DEBUG&&console.log("4 * x^4: "+stack[tos-1].toString()),push(C),push(symbol(SECRETX)),push_integer(2),power(),multiply(),DEBUG&&console.log("R_p * x^2: "+stack[tos-1].toString()),push(F),push(symbol(SECRETX)),multiply(),DEBUG&&console.log("R_q * x: "+stack[tos-1].toString()),push(Y),DEBUG&&console.log("R_r: "+stack[tos-1].toString()),add(),add(),add(),simplify(),DEBUG&&console.log("solving depressed quartic: "+stack[tos-1].toString()),push(symbol(SECRETX)),roots(),$=pop(),DEBUG&&console.log("depressedSolutions: "+$),sr=0,rr=(ir=$.tensor.elem).length;sr<rr;sr++)H=ir[sr],push(H),push(p4),push_integer(4),push(p3),multiply(),divide(),subtract(),simplify(),DEBUG&&console.log("solution from depressed: "+stack[tos-1].toString());return void restore()}}return moveTos(tos-r),restore()},Eval_round=function(){return push(cadr(p1)),Eval(),yround()},yround=function(){return save(),yyround(),restore()},yyround=function(){var r;return r=0,p1=pop(),isNumericAtom(p1)?isdouble(p1)?(r=Math.round(p1.d),void push_double(r)):isinteger(p1)?void push(p1):(push(p1),yyfloat(),p1=pop(),push_integer(Math.round(p1.d))):(push_symbol(ROUND),push(p1),void list(2))},T_INTEGER=1001,T_DOUBLE=1002,T_SYMBOL=1003,T_FUNCTION=1004,T_NEWLINE=1006,T_STRING=1007,T_GTEQ=1008,T_LTEQ=1009,T_EQ=1010,T_NEQ=1011,T_QUOTASSIGN=1012,token="",newline_flag=0,meta_mode=0,input_str=0,scan_str=0,token_str=0,token_buf=0,lastFoundSymbol=null,symbolsRightOfAssignment=null,symbolsLeftOfAssignment=null,isSymbolLeftOfAssignment=null,scanningParameters=null,functionInvokationsScanningStack=null,skipRootVariableToBeSolved=!1,assignmentFound=null,scanned="",scan=function(r){return DEBUG&&console.log("#### scanning "+r),lastFoundSymbol=null,symbolsRightOfAssignment=[],symbolsLeftOfAssignment=[],isSymbolLeftOfAssignment=!0,scanningParameters=[],functionInvokationsScanningStack=[""],assignmentFound=!1,scanned=r,meta_mode=0,expanding++,input_str=0,scan_str=0,get_next_token(),""===token?(push(symbol(NIL)),expanding--,0):(scan_stmt(),expanding--,assignmentFound||(symbolsInExpressionsWithoutAssignments=symbolsInExpressionsWithoutAssignments.concat(symbolsLeftOfAssignment)),token_str-input_str)},scan_meta=function(r){return scanned=r,meta_mode=1,expanding++,input_str=0,scan_str=0,get_next_token(),""===token?(push(symbol(NIL)),expanding--,0):(scan_stmt(),expanding--,token_str-input_str)},scan_stmt=function(){var r,e,s,o,t,n,p,i,a;if(scan_relation(),r=!1,token===T_QUOTASSIGN&&(r=!0),(token===T_QUOTASSIGN||"="===token)&&(a=lastFoundSymbol,DEBUG&&console.log("assignment!"),assignmentFound=!0,isSymbolLeftOfAssignment=!1,get_next_token(),push_symbol(SETQ),swap(),r&&push_symbol(QUOTE),scan_relation(),r&&list(2),list(3),isSymbolLeftOfAssignment=!0,codeGen)){if(-1!==(o=symbolsRightOfAssignment.indexOf(a))&&(symbolsRightOfAssignment.splice(o,1),symbolsHavingReassignments.push(a)),DEBUG)for(console.log("locally, "+a+" depends on: "),t=0,n=symbolsRightOfAssignment.length;t<n;t++)s=symbolsRightOfAssignment[t],console.log("  "+s);for(null==symbolsDependencies[a]&&(symbolsDependencies[a]=[]),e=symbolsDependencies[a],i=0,p=symbolsRightOfAssignment.length;i<p;i++)s=symbolsRightOfAssignment[i],-1===e.indexOf(s)&&e.push(s);return symbolsRightOfAssignment=[]}},scan_relation=function(){switch(scan_expression(),token){case T_EQ:return push_symbol(TESTEQ),swap(),get_next_token(),scan_expression(),list(3);case T_NEQ:return push_symbol(NOT),swap(),push_symbol(TESTEQ),swap(),get_next_token(),scan_expression(),list(3),list(2);case T_LTEQ:return push_symbol(TESTLE),swap(),get_next_token(),scan_expression(),list(3);case T_GTEQ:return push_symbol(TESTGE),swap(),get_next_token(),scan_expression(),list(3);case"<":return push_symbol(TESTLT),swap(),get_next_token(),scan_expression(),list(3);case">":return push_symbol(TESTGT),swap(),get_next_token(),scan_expression(),list(3)}},scan_expression=function(){var r;switch(r=tos,token){case"+":get_next_token(),scan_term();break;case"-":get_next_token(),scan_term(),negate();break;default:scan_term()}for(;0===newline_flag&&("+"===token||"-"===token);)"+"===token?(get_next_token(),scan_term()):(get_next_token(),scan_term(),negate());if(tos-r>1)return list(tos-r),push_symbol(ADD),swap(),cons()},is_factor=function(){if(("function"==typeof token.charCodeAt?token.charCodeAt(0):void 0)===dotprod_unicode)return 1;switch(token){case"*":case"/":return 1;case"(":case T_SYMBOL:case T_FUNCTION:case T_INTEGER:case T_DOUBLE:case T_STRING:return newline_flag?(scan_str=token_str,0):1}return 0},simplify_1_in_products=function(r,e){if(r>e&&isrational(stack[r-1])&&equaln(stack[r-1],1))return pop()},multiply_consecutive_constants=function(r,e){if(r>e+1&&isNumericAtom(stack[r-2])&&isNumericAtom(stack[r-1]))return multiply()},scan_term=function(){var r;for(r=tos,scan_factor(),parse_time_simplifications&&simplify_1_in_products(tos,r);is_factor();)"*"===token?(get_next_token(),scan_factor()):"/"===token?(simplify_1_in_products(tos,r),get_next_token(),scan_factor(),inverse()):("function"==typeof token.charCodeAt?token.charCodeAt(0):void 0)===dotprod_unicode?(get_next_token(),push_symbol(INNER),swap(),scan_factor(),list(3)):scan_factor(),parse_time_simplifications&&(multiply_consecutive_constants(tos,r),simplify_1_in_products(tos,r));return r===tos?push_integer(1):tos-r>1?(list(tos-r),push_symbol(MULTIPLY),swap(),cons()):void 0},scan_power=function(){if("^"===token)return get_next_token(),push_symbol(POWER),swap(),scan_factor(),list(3)},scan_index=function(r){for(get_next_token(),push_symbol(INDEX),swap(),scan_expression();","===token;)get_next_token(),scan_expression();return"]"!==token&&scan_error("] expected"),get_next_token(),list(tos-r)},scan_factor=function(){var r,e;for(e=tos,r=!1,"("===token?scan_subexpr():token===T_SYMBOL?scan_symbol():token===T_FUNCTION?scan_function_call_with_function_name():"["===token?scan_tensor():token===T_INTEGER?(r=!0,bignum_scan_integer(token_buf),get_next_token()):token===T_DOUBLE?(r=!0,bignum_scan_float(token_buf),get_next_token()):token===T_STRING?scan_string():scan_error("syntax error");"["===token||"("===token&&0===newline_flag&&!r;)"["===token?scan_index(e):"("===token&&scan_function_call_without_function_name();for(;"!"===token;)get_next_token(),push_symbol(FACTORIAL),swap(),list(2);for(;("function"==typeof token.charCodeAt?token.charCodeAt(0):void 0)===transpose_unicode;)get_next_token(),push_symbol(TRANSPOSE),swap(),list(2);return scan_power()},addSymbolRightOfAssignment=function(r){var e,s,o,t;if(-1===predefinedSymbolsInGlobalScope_doNotTrackInDependencies.indexOf(r)&&-1===symbolsRightOfAssignment.indexOf(r)&&-1===symbolsRightOfAssignment.indexOf("'"+r)&&!skipRootVariableToBeSolved){for(DEBUG&&console.log("... adding symbol: "+r+" to the set of the symbols right of assignment"),o="",e=s=1,t=functionInvokationsScanningStack.length;1<=t?s<t:s>t;e=1<=t?++s:--s)""!==functionInvokationsScanningStack[e]&&(o+=functionInvokationsScanningStack[e]+"_"+e+"_");return r=o+r,symbolsRightOfAssignment.push(r)}},addSymbolLeftOfAssignment=function(r){var e,s,o,t;if(-1===predefinedSymbolsInGlobalScope_doNotTrackInDependencies.indexOf(r)&&-1===symbolsLeftOfAssignment.indexOf(r)&&-1===symbolsLeftOfAssignment.indexOf("'"+r)&&!skipRootVariableToBeSolved){for(DEBUG&&console.log("... adding symbol: "+r+" to the set of the symbols left of assignment"),o="",e=s=1,t=functionInvokationsScanningStack.length;1<=t?s<t:s>t;e=1<=t?++s:--s)""!==functionInvokationsScanningStack[e]&&(o+=functionInvokationsScanningStack[e]+"_"+e+"_");return r=o+r,symbolsLeftOfAssignment.push(r)}},scan_symbol=function(){if(token!==T_SYMBOL&&scan_error("symbol expected"),meta_mode&&1===token_buf.length)switch(token_buf[0]){case"a":push(symbol(METAA));break;case"b":push(symbol(METAB));break;case"x":push(symbol(METAX));break;default:push(usr_symbol(token_buf))}else push(usr_symbol(token_buf));return 0===scanningParameters.length?(DEBUG&&console.log("out of scanning parameters, processing "+token_buf),lastFoundSymbol=token_buf,isSymbolLeftOfAssignment&&addSymbolLeftOfAssignment(token_buf)):(DEBUG&&console.log("still scanning parameters, skipping "+token_buf),isSymbolLeftOfAssignment&&addSymbolRightOfAssignment("'"+token_buf)),DEBUG&&console.log("found symbol: "+token_buf+" left of assignment: "+isSymbolLeftOfAssignment),isSymbolLeftOfAssignment||addSymbolRightOfAssignment(token_buf),get_next_token()},scan_string=function(){return new_string(token_buf),get_next_token()},scan_function_call_with_function_name=function(){var r,e,s,o,t,n;if(DEBUG&&console.log("-- scan_function_call_with_function_name start"),o=1,new U,t=usr_symbol(token_buf),push(t),"roots"!==(r=token_buf)&&"defint"!==r&&"sum"!==r&&"product"!==r&&"for"!==r||functionInvokationsScanningStack.push(token_buf),lastFoundSymbol=token_buf,isSymbolLeftOfAssignment||addSymbolRightOfAssignment(token_buf),get_next_token(),get_next_token(),scanningParameters.push(!0),")"!==token){for(scan_stmt(),o++;","===token;)get_next_token(),2===o&&-1!==functionInvokationsScanningStack[functionInvokationsScanningStack.length-1].indexOf("roots")&&(symbolsRightOfAssignment=symbolsRightOfAssignment.filter(function(r){return!new RegExp("roots_"+(functionInvokationsScanningStack.length-1)+"_"+token_buf).test(r)}),skipRootVariableToBeSolved=!0),2===o&&-1!==functionInvokationsScanningStack[functionInvokationsScanningStack.length-1].indexOf("sum")&&(symbolsRightOfAssignment=symbolsRightOfAssignment.filter(function(r){return!new RegExp("sum_"+(functionInvokationsScanningStack.length-1)+"_"+token_buf).test(r)}),skipRootVariableToBeSolved=!0),2===o&&-1!==functionInvokationsScanningStack[functionInvokationsScanningStack.length-1].indexOf("product")&&(symbolsRightOfAssignment=symbolsRightOfAssignment.filter(function(r){return!new RegExp("product_"+(functionInvokationsScanningStack.length-1)+"_"+token_buf).test(r)}),skipRootVariableToBeSolved=!0),2===o&&-1!==functionInvokationsScanningStack[functionInvokationsScanningStack.length-1].indexOf("for")&&(symbolsRightOfAssignment=symbolsRightOfAssignment.filter(function(r){return!new RegExp("for_"+(functionInvokationsScanningStack.length-1)+"_"+token_buf).test(r)}),skipRootVariableToBeSolved=!0),-1!==functionInvokationsScanningStack[functionInvokationsScanningStack.length-1].indexOf("defint")&&(2===o||o>2&&(o-2)%3==0)&&(symbolsRightOfAssignment=symbolsRightOfAssignment.filter(function(r){return!new RegExp("defint_"+(functionInvokationsScanningStack.length-1)+"_"+token_buf).test(r)}),skipRootVariableToBeSolved=!0),scan_stmt(),skipRootVariableToBeSolved=!1,o++;2===o&&-1!==functionInvokationsScanningStack[functionInvokationsScanningStack.length-1].indexOf("roots")&&(symbolsRightOfAssignment=symbolsRightOfAssignment.filter(function(r){return!new RegExp("roots_"+(functionInvokationsScanningStack.length-1)+"_x").test(r)}))}for(scanningParameters.pop(),e=s=0,n=symbolsRightOfAssignment.length;0<=n?s<=n:s>=n;e=0<=n?++s:--s)null!=symbolsRightOfAssignment[e]&&("roots"===r&&(symbolsRightOfAssignment[e]=symbolsRightOfAssignment[e].replace(new RegExp("roots_"+(functionInvokationsScanningStack.length-1)+"_"),"")),"defint"===r&&(symbolsRightOfAssignment[e]=symbolsRightOfAssignment[e].replace(new RegExp("defint_"+(functionInvokationsScanningStack.length-1)+"_"),"")),"sum"===r&&(symbolsRightOfAssignment[e]=symbolsRightOfAssignment[e].replace(new RegExp("sum_"+(functionInvokationsScanningStack.length-1)+"_"),"")),"product"===r&&(symbolsRightOfAssignment[e]=symbolsRightOfAssignment[e].replace(new RegExp("product_"+(functionInvokationsScanningStack.length-1)+"_"),"")),"for"===r&&(symbolsRightOfAssignment[e]=symbolsRightOfAssignment[e].replace(new RegExp("for_"+(functionInvokationsScanningStack.length-1)+"_"),"")));if(")"!==token&&scan_error(") expected"),get_next_token(),list(o),"roots"!==r&&"defint"!==r&&"sum"!==r&&"product"!==r&&"for"!==r||functionInvokationsScanningStack.pop(),r===symbol(PATTERN).printname&&(patternHasBeenFound=!0),DEBUG)return console.log("-- scan_function_call_with_function_name end")},scan_function_call_without_function_name=function(){var r;if(DEBUG&&console.log("-- scan_function_call_without_function_name start"),push_symbol(EVAL),swap(),list(2),r=1,get_next_token(),scanningParameters.push(!0),")"!==token)for(scan_stmt(),r++;","===token;)get_next_token(),scan_stmt(),r++;if(scanningParameters.pop(),")"!==token&&scan_error(") expected"),get_next_token(),list(r),DEBUG)return console.log("-- scan_function_call_without_function_name end: "+stack[tos-1])},scan_subexpr=function(){return 0,"("!==token&&scan_error("( expected"),get_next_token(),scan_stmt(),")"!==token&&scan_error(") expected"),get_next_token()},scan_tensor=function(){var r;for(r=0,"["!==token&&scan_error("[ expected"),get_next_token(),scan_stmt(),r=1;","===token;)get_next_token(),scan_stmt(),r++;return build_tensor(r),"]"!==token&&scan_error("] expected"),get_next_token()},scan_error=function(r){for(errorMessage="";input_str!==scan_str&&("\n"!==scanned[input_str]&&"\r"!==scanned[input_str]||input_str+1!==scan_str);)errorMessage+=scanned[input_str++];for(errorMessage+=" ? ";scanned[input_str]&&"\n"!==scanned[input_str]&&"\r"!==scanned[input_str];)errorMessage+=scanned[input_str++];return errorMessage+="\n",stop(r)},build_tensor=function(r){var e,s,o;for(e=0,save(),(p2=alloc_tensor(r)).tensor.ndim=1,p2.tensor.dim[0]=r,e=s=0,o=r;0<=o?s<o:s>o;e=0<=o?++s:--s)p2.tensor.elem[e]=stack[tos-r+e];return check_tensor_dimensions(p2),moveTos(tos-r),push(p2),restore()},get_next_token=function(){for(newline_flag=0;get_token(),token===T_NEWLINE;)newline_flag=1;if(DEBUG)return console.log("get_next_token token: "+token)},get_token=function(){for(;isspace(scanned[scan_str]);){if("\n"===scanned[scan_str]||"\r"===scanned[scan_str])return token=T_NEWLINE,void scan_str++;scan_str++}if(token_str=scan_str,scan_str!==scanned.length){if(!isdigit(scanned[scan_str])&&"."!==scanned[scan_str]){if(isalpha(scanned[scan_str])){for(;isalnumorunderscore(scanned[scan_str]);)scan_str++;return token="("===scanned[scan_str]?T_FUNCTION:T_SYMBOL,void update_token_buf(token_str,scan_str)}if('"'===scanned[scan_str]){for(scan_str++;'"'!==scanned[scan_str];)scan_str===scanned.length-1&&(scan_str++,scan_error("runaway string"),scan_str--),scan_str++;return token=T_STRING,void update_token_buf(token_str+1,++scan_str-1)}if("#"===scanned[scan_str]||"-"===scanned[scan_str]&&"-"===scanned[scan_str+1]){for(;scanned[scan_str]&&"\n"!==scanned[scan_str]&&"\r"!==scanned[scan_str];)scan_str++;return scanned[scan_str]&&scan_str++,void(token=T_NEWLINE)}return":"===scanned[scan_str]&&"="===scanned[scan_str+1]?(scan_str+=2,void(token=T_QUOTASSIGN)):"="===scanned[scan_str]&&"="===scanned[scan_str+1]?(scan_str+=2,void(token=T_EQ)):"!"===scanned[scan_str]&&"="===scanned[scan_str+1]?(scan_str+=2,void(token=T_NEQ)):"<"===scanned[scan_str]&&"="===scanned[scan_str+1]?(scan_str+=2,void(token=T_LTEQ)):">"===scanned[scan_str]&&"="===scanned[scan_str+1]?(scan_str+=2,void(token=T_GTEQ)):token=scanned[scan_str++]}for(;isdigit(scanned[scan_str]);)scan_str++;if("."===scanned[scan_str]){for(scan_str++;isdigit(scanned[scan_str]);)scan_str++;if("e"===scanned[scan_str]&&("+"===scanned[scan_str+1]||"-"===scanned[scan_str+1]||isdigit(scanned[scan_str+1])))for(scan_str+=2;isdigit(scanned[scan_str]);)scan_str++;token=T_DOUBLE}else token=T_INTEGER;update_token_buf(token_str,scan_str)}else token=""},update_token_buf=function(r,e){return token_buf=scanned.substring(r,e)},$.scan=scan,Eval_sgn=function(){return push(cadr(p1)),Eval(),sgn()},sgn=function(){return save(),yysgn(),restore()},yysgn=function(){return p1=pop(),isdouble(p1)?p1.d>0?void push_integer(1):0===p1.d?void push_integer(1):void push_integer(-1):isrational(p1)?-1===MSIGN(mmul(p1.q.a,p1.q.b))?void push_integer(-1):MZERO(mmul(p1.q.a,p1.q.b))?void push_integer(0):void push_integer(1):iscomplexnumber(p1)?(push_integer(-1),push(p1),absval(),power(),push(p1),void multiply()):isnegativeterm(p1)?(push_symbol(SGN),push(p1),negate(),list(2),push_integer(-1),void multiply()):(push_symbol(SGN),push(p1),list(2))},Eval_shape=function(){return push(cadr(p1)),Eval(),shape()},shape=function(){var r,e,s,o,t,n,p,i;for(s=0,0,0,r=[],e=[],s=o=0,p=MAXDIM;0<=p?o<p:o>p;s=0<=p?++o:--o)r[s]=0,e[s]=0;if(save(),p1=pop(),!istensor(p1))return isZeroAtomOrTensor(p1)||stop("transpose: tensor expected, 1st arg is not a tensor"),push(zero),void restore();for(n=p1.tensor.ndim,(p2=alloc_tensor(n)).tensor.ndim=1,p2.tensor.dim[0]=n,s=t=0,i=n;0<=i?t<i:t>i;s=0<=i?++t:--t)push_integer(p1.tensor.dim[s]),p2.tensor.elem[s]=pop();return push(p2),restore()},Eval_simfac=function(){return push(cadr(p1)),Eval(),simfac()},simfac=function(){var r;if(r=0,save(),p1=pop(),car(p1)===symbol(ADD)){for(r=tos,p1=cdr(p1);p1!==symbol(NIL);)push(car(p1)),simfac_term(),p1=cdr(p1);add_all(tos-r)}else push(p1),simfac_term();return restore()},simfac_term=function(){var r;if(0,save(),p1=pop(),car(p1)!==symbol(MULTIPLY))return push(p1),void restore();for(r=tos,p1=cdr(p1);p1!==symbol(NIL);)push(car(p1)),p1=cdr(p1);for(;yysimfac(r);)1;return multiply_all_noexpand(tos-r),restore()},yysimfac=function(r){var e,s,o,t,n,p,i,a;for(e=0,s=0,e=o=n=r,p=tos;n<=p?o<p:o>p;e=n<=p?++o:--o)for(p1=stack[e],s=t=i=r,a=tos;i<=a?t<a:t>a;s=i<=a?++t:--t)if(e!==s){if(p2=stack[s],car(p1)===symbol(FACTORIAL)&&car(p2)===symbol(POWER)&&isminusone(caddr(p2))&&equal(cadr(p1),cadr(p2)))return push(cadr(p1)),push(one),subtract(),factorial(),stack[e]=pop(),stack[s]=one,1;if(car(p2)===symbol(POWER)&&isminusone(caddr(p2))&&caadr(p2)===symbol(FACTORIAL)&&equal(p1,cadadr(p2)))return push(p1),push_integer(-1),add(),factorial(),reciprocate(),stack[e]=pop(),stack[s]=one,1;if(car(p2)===symbol(FACTORIAL)&&(push(p1),push(cadr(p2)),subtract(),p3=pop(),isplusone(p3)))return push(p1),factorial(),stack[e]=pop(),stack[s]=one,1;if(car(p1)===symbol(POWER)&&isminusone(caddr(p1))&&car(p2)===symbol(POWER)&&isminusone(caddr(p2))&&caadr(p2)===symbol(FACTORIAL)&&(push(cadr(p1)),push(cadr(cadr(p2))),subtract(),p3=pop(),isplusone(p3)))return push(cadr(p1)),factorial(),reciprocate(),stack[e]=pop(),stack[s]=one,1;if(car(p1)===symbol(FACTORIAL)&&car(p2)===symbol(POWER)&&isminusone(caddr(p2))&&caadr(p2)===symbol(FACTORIAL)){if(push(cadr(p1)),push(cadr(cadr(p2))),subtract(),p3=pop(),isplusone(p3))return stack[e]=cadr(p1),stack[s]=one,1;if(isminusone(p3))return push(cadr(cadr(p2))),reciprocate(),stack[e]=pop(),stack[s]=one,1;if(equaln(p3,2))return stack[e]=cadr(p1),push(cadr(p1)),push_integer(-1),add(),stack[s]=pop(),1;if(equaln(p3,-2))return push(cadr(cadr(p2))),reciprocate(),stack[e]=pop(),push(cadr(cadr(p2))),push_integer(-1),add(),reciprocate(),stack[s]=pop(),1}}return 0},Eval_simplify=function(){return push(cadr(p1)),runUserDefinedSimplifications(),Eval(),simplify()},runUserDefinedSimplifications=function(){var r,e,s,o,t,n,p,i,a,u;if(0!==userSimplificationsInListForm.length&&!Find(cadr(p1),symbol(INTEGRAL))){for(a=expanding,expanding=!1,DEBUG&&console.log("runUserDefinedSimplifications passed: "+stack[tos-1].toString()),Eval(),DEBUG&&console.log("runUserDefinedSimplifications after eval no expanding: "+stack[tos-1].toString()),expanding=a,p1=stack[tos-1],DEBUG&&console.log("patterns to be checked: "),o=0,t=userSimplificationsInListForm.length;o<t;o++)s=userSimplificationsInListForm[o],DEBUG&&console.log("..."+s);for(r=!0,i=0;r&&i<MAX_CONSECUTIVE_APPLICATIONS_OF_ALL_RULES;)for(r=!1,i++,p=0,n=userSimplificationsInListForm.length;p<n;p++){for(s=userSimplificationsInListForm[p],u=!0,e=0;u&&e<MAX_CONSECUTIVE_APPLICATIONS_OF_SINGLE_RULE;)e++,DEBUG&&console.log("simplify - tos: "+tos+" checking pattern: "+s+" on: "+p1),push_symbol(NIL),(u=transform(s,!0))&&(r=!0),p1=stack[tos-1],DEBUG&&console.log("p1 at this stage of simplification: "+p1);e===MAX_CONSECUTIVE_APPLICATIONS_OF_SINGLE_RULE&&stop("maximum application of single transformation rule exceeded: "+s)}if(i===MAX_CONSECUTIVE_APPLICATIONS_OF_ALL_RULES&&stop("maximum application of all transformation rules exceeded "),DEBUG)return console.log("METAX = "+get_binding(symbol(METAX))),console.log("METAA = "+get_binding(symbol(METAA))),console.log("METAB = "+get_binding(symbol(METAB)))}},simplifyForCodeGeneration=function(){return save(),runUserDefinedSimplifications(),codeGen=!0,simplify_main(),codeGen=!1,restore()},simplify=function(){return save(),simplify_main(),restore()},simplify_main=function(){var args,fbody;if(p1=pop(),codeGen&&car(p1)===symbol(FUNCTION)&&(fbody=cadr(p1),push(fbody),eval(),simplify(),p3=pop(),args=caddr(p1),push_symbol(FUNCTION),push(p3),push(args),list(3),p1=pop()),!istensor(p1))return Find(p1,symbol(FACTORIAL))&&(push(p1),simfac(),p2=pop(),push(p1),rationalize(),simfac(),p3=pop(),p1=count(p2)<count(p3)?p2:p3),f10(),f1(),f2(),f3(),f4(),f5(),f9(),simplify_polarRect(),do_simplify_nested_radicals&&simplify_nested_radicals()?(DEBUG&&console.log("de-nesting successful into: "+p1.toString()),push(p1),void simplify()):(simplify_rectToClock(),push(p1));simplify_tensor()},simplify_tensor=function(){var r,e,s,o,t;for(r=0,(p2=alloc_tensor(p1.tensor.nelem)).tensor.ndim=p1.tensor.ndim,r=e=0,o=p1.tensor.ndim;0<=o?e<o:e>o;r=0<=o?++e:--e)p2.tensor.dim[r]=p1.tensor.dim[r];for(r=s=0,t=p1.tensor.nelem;0<=t?s<t:s>t;r=0<=t?++s:--s)push(p1.tensor.elem[r]),simplify(),p2.tensor.elem[r]=pop();return check_tensor_dimensions(p2),isZeroAtomOrTensor(p2)&&(p2=zero),push(p2)},f1=function(){if(car(p1)===symbol(ADD))return push(p1),rationalize(),p2=pop(),count(p2)<count(p1)?p1=p2:void 0},f2=function(){if(car(p1)===symbol(ADD))return push(p1),Condense(),p2=pop(),count(p2)<=count(p1)?p1=p2:void 0},f3=function(){if(push(p1),rationalize(),negate(),rationalize(),negate(),rationalize(),p2=pop(),count(p2)<count(p1))return p1=p2},f10=function(){var r,e,s,o;if(s=car(p1),cdr(p1),(s===symbol(MULTIPLY)||isinnerordot(p1))&&car(car(cdr(p1)))===symbol(TRANSPOSE)&&car(car(cdr(cdr(p1))))===symbol(TRANSPOSE)&&(DEBUG&&console.log("maybe collecting a transpose "+p1),r=cadr(car(cdr(p1))),e=cadr(car(cdr(cdr(p1)))),s===symbol(MULTIPLY)?(push(r),push(e),multiply()):isinnerordot(p1)&&(push(e),push(r),inner()),push_integer(1),push_integer(2),o=expanding,expanding=!1,transpose(),expanding=o,p2=pop(),count(p2)<count(p1)&&(p1=p2),DEBUG))return console.log("collecting a transpose "+p2)},f4=function(){if(!isZeroAtomOrTensor(p1))return push(p1),rationalize(),inverse(),rationalize(),inverse(),rationalize(),p2=pop(),count(p2)<count(p1)?p1=p2:void 0},simplify_trig=function(){return save(),p1=pop(),f5(),push(p1),restore()},f5=function(){if(0!==Find(p1,symbol(SIN))||0!==Find(p1,symbol(COS)))return trigmode=1,push(p2=p1),Eval(),p3=pop(),trigmode=2,push(p2),Eval(),p4=pop(),trigmode=0,(count(p4)<count(p3)||nterms(p4)<nterms(p3))&&(p3=p4),count(p3)<count(p1)||nterms(p3)<nterms(p1)?p1=p3:void 0},f9=function(){if(car(p1)===symbol(ADD)){for(push_integer(0),p2=cdr(p1);iscons(p2);)push(car(p2)),simplify(),add(),p2=cdr(p2);return p2=pop(),count(p2)<count(p1)?p1=p2:void 0}},simplify_rectToClock=function(){if(0!==Find(p1,symbol(SIN))||0!==Find(p1,symbol(COS)))return push(p1),Eval(),clockform(),p2=pop(),DEBUG&&console.log("before simplification clockform: "+p1+" after: "+p2),count(p2)<count(p1)?p1=p2:void 0},simplify_polarRect=function(){if(push(p1),polarRectAMinusOneBase(),Eval(),p2=pop(),count(p2)<count(p1))return p1=p2},polarRectAMinusOneBase=function(){var r;if(save(),p1=pop(),isimaginaryunit(p1))return push(p1),void restore();if(equal(car(p1),symbol(POWER))&&isminusone(cadr(p1)))push(one),negate(),push(caddr(p1)),polarRectAMinusOneBase(),power(),polar(),rect();else if(iscons(p1)){for(r=tos;iscons(p1);)push(car(p1)),polarRectAMinusOneBase(),p1=cdr(p1);list(tos-r)}else push(p1);restore()},nterms=function(r){return car(r)!==symbol(ADD)?1:length(r)-1},simplify_nested_radicals=function(){var r,e,s,o;return recursionLevelNestedRadicalsRemoval>0?(DEBUG&&console.log("denesting bailing out because of too much recursion"),!1):(push(p1),o=take_care_of_nested_radicals(),s=stack[tos-1],r=expanding,expanding=0,yycondense(),expanding=r,e=pop(),countOccurrencesOfSymbol(symbol(POWER),s)<countOccurrencesOfSymbol(symbol(POWER),e)?push(s):push(e),p1=pop(),o)},take_care_of_nested_radicals=function(){var r,e,s,o,t,n,p,i,a,u,l,c,d,_,m,f,h,g,b,y,E,v,x,A,T,O,I,N,S,R,M,L,k,D,U,P,B,q;if(recursionLevelNestedRadicalsRemoval>0)return DEBUG&&console.log("denesting bailing out because of too much recursion"),!1;if(save(),p1=pop(),equal(car(p1),symbol(POWER))){if(n=cadr(p1),c=caddr(p1),!isminusone(c)&&equal(car(n),symbol(ADD))&&isfraction(c)&&(equalq(c,1,3)||equalq(c,1,2))){for(d=cadr(n),push(d),take_care_of_nested_radicals(),pop(),P=caddr(n),push(P),take_care_of_nested_radicals(),pop(),I=0,u=n;cdr(u)!==symbol(NIL);)I++,u=cdr(u);if(I>2)return push(p1),restore(),!1;if(a=null,i=[],q=[],car(P)===symbol(MULTIPLY)){if(B=cdr(P),iscons(B))for(;iscons(B);)k=car(B),car(k)===symbol(POWER)?(f=cadr(k),h=caddr(k),equalq(h,1,2)&&(null==a?(a=h,i.push(f)):equal(h,a)&&i.push(f))):q.push(k),B=cdr(B)}else car(P)===symbol(POWER)&&(f=cadr(P),h=caddr(P),null==a&&equalq(h,1,2)&&(a=h,i.push(f)));if(0===i.length)return push(p1),restore(),!1;for(r=d,push_integer(1),g=0,b=i.length;g<b;g++)m=i[g],push(m),multiply();for(s=pop(),push_integer(1),T=0,y=q.length;T<y;T++)m=q[T],push(m),multiply();if(e=pop(),equalq(c,1,3)){if(push(r),negate(),push(s),multiply(),push(e),divide(),p=pop(),push(p),real(),yyfloat(),Math.abs(pop().d)>Math.pow(2,32))return push(p1),restore(),!1;if(push(p),push_integer(3),push(s),multiply(),p=pop(),push(p),real(),yyfloat(),Math.abs(pop().d)>Math.pow(2,32))return pop(),push(p1),restore(),!1;if(push(p),push(symbol(SECRETX)),multiply(),push_integer(-3),push(r),multiply(),push(e),divide(),p=pop(),push(p),real(),yyfloat(),Math.abs(pop().d)>Math.pow(2,32))return pop(),pop(),push(p1),restore(),!1;push(p),push(symbol(SECRETX)),push_integer(2),power(),multiply(),push_integer(1),push(symbol(SECRETX)),push_integer(3),power(),multiply(),add(),add(),add()}else if(equalq(c,1,2)){if(push(s),p=pop(),push(p),real(),yyfloat(),Math.abs(pop().d)>Math.pow(2,32))return push(p1),restore(),!1;if(push(p),push_integer(-2),push(r),multiply(),push(e),divide(),p=pop(),push(p),real(),yyfloat(),Math.abs(pop().d)>Math.pow(2,32))return pop(),push(p1),restore(),!1;push(p),push(symbol(SECRETX)),multiply(),push_integer(1),push(symbol(SECRETX)),push_integer(2),power(),multiply(),add(),add()}if(push(symbol(SECRETX)),recursionLevelNestedRadicalsRemoval++,roots(),recursionLevelNestedRadicalsRemoval--,equal(stack[tos-1],symbol(NIL)))return DEBUG&&console.log("roots bailed out because of too much recursion"),pop(),push(p1),restore(),!1;for(L=[],O=0,E=(U=stack[tos-1].tensor.elem).length;O<E;O++)l=U[O],Find(l,symbol(POWER))||L.push(l);if(pop(),0===L.length)return push(p1),restore(),!1;for(M=[],D=[],N=0,v=L.length;N<v;N++)m=L[N],push(m),real(),yyfloat(),M.push(m),D.push(pop().d);return o=M[D.indexOf(Math.max.apply(Math,D))],equalq(c,1,3)?(push(r),push(o),push_integer(3),power(),push_integer(3),push(s),multiply(),push(o),multiply(),add(),divide(),push_rational(1,3),power()):equalq(c,1,2)&&(push(r),push(o),push_integer(2),power(),push(s),add(),divide(),push_rational(1,2),power()),null==(A=pop())?(push(p1),restore(),!1):(push(A),push(o),multiply(),equalq(c,1,3)?(x=pop(),push(A),push(s),push_rational(1,2),power(),multiply(),push(x),add(),simplify()):equalq(c,1,2)&&(x=pop(),push(A),push(s),push_rational(1,2),power(),multiply(),push(x),add(),simplify(),S=pop(),push(S),real(),yyfloat(),R=pop(),isnegativenumber(R)?(push(A),negate(),A=pop(),push(x),negate(),x=pop(),push(A),push(s),push_rational(1,2),power(),multiply(),push(x),add(),simplify()):push(S)),p1=pop(),push(p1),restore(),!0)}return push(p1),restore(),!1}if(iscons(p1)){for(_=tos,t=!1;iscons(p1);)push(car(p1)),t=t||take_care_of_nested_radicals(),p1=cdr(p1);return list(tos-_),restore(),t}return push(p1),restore(),!1},Eval_sin=function(){return push(cadr(p1)),Eval(),sine()},sine=function(){return save(),p1=pop(),car(p1)===symbol(ADD)?sine_of_angle_sum():sine_of_angle(),restore()},sine_of_angle_sum=function(){for(p2=cdr(p1);iscons(p2);){if(p4=car(p2),isnpi(p4))return push(p1),push(p4),subtract(),p3=pop(),push(p3),sine(),push(p4),cosine(),multiply(),push(p3),cosine(),push(p4),sine(),multiply(),void add();p2=cdr(p2)}return sine_of_angle()},sine_of_angle=function(){var r,e;if(car(p1)!==symbol(ARCSIN)){if(isdouble(p1))return r=Math.sin(p1.d),Math.abs(r)<1e-10&&(r=0),void push_double(r);if(isnegative(p1))return push(p1),negate(),sine(),void negate();if(car(p1)===symbol(ARCTAN))return push(cadr(p1)),push_integer(1),push(cadr(p1)),push_integer(2),power(),add(),push_rational(-1,2),power(),void multiply();if(push(p1),push_integer(180),multiply(),evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),divide(),(e=pop_integer())<0||isNaN(e))return push(symbol(SIN)),push(p1),void list(2);switch(e%360){case 0:case 180:return push_integer(0);case 30:case 150:return push_rational(1,2);case 210:case 330:return push_rational(-1,2);case 45:case 135:return push_rational(1,2),push_integer(2),push_rational(1,2),power(),multiply();case 225:case 315:return push_rational(-1,2),push_integer(2),push_rational(1,2),power(),multiply();case 60:case 120:return push_rational(1,2),push_integer(3),push_rational(1,2),power(),multiply();case 240:case 300:return push_rational(-1,2),push_integer(3),push_rational(1,2),power(),multiply();case 90:return push_integer(1);case 270:return push_integer(-1);default:return push(symbol(SIN)),push(p1),list(2)}}else push(cadr(p1))},Eval_sinh=function(){return push(cadr(p1)),Eval(),ysinh()},ysinh=function(){return save(),yysinh(),restore()},yysinh=function(){var r;if(r=0,p1=pop(),car(p1)!==symbol(ARCSINH)){if(isdouble(p1))return r=Math.sinh(p1.d),Math.abs(r)<1e-10&&(r=0),void push_double(r);if(!isZeroAtomOrTensor(p1))return push_symbol(SINH),push(p1),list(2);push(zero)}else push(cadr(p1))},subst=function(){var r,e,s,o,t;if(r=0,save(),p3=pop(),(p2=pop())!==symbol(NIL)&&p3!==symbol(NIL)){if(p1=pop(),istensor(p1)){for((p4=alloc_tensor(p1.tensor.nelem)).tensor.ndim=p1.tensor.ndim,r=e=0,o=p1.tensor.ndim;0<=o?e<o:e>o;r=0<=o?++e:--e)p4.tensor.dim[r]=p1.tensor.dim[r];for(r=s=0,t=p1.tensor.nelem;0<=t?s<t:s>t;r=0<=t?++s:--s)push(p1.tensor.elem[r]),push(p2),push(p3),subst(),p4.tensor.elem[r]=pop(),check_tensor_dimensions(p4);push(p4)}else equal(p1,p2)?push(p3):iscons(p1)?(push(car(p1)),push(p2),push(p3),subst(),push(cdr(p1)),push(p2),push(p3),subst(),cons()):push(p1);return restore()}restore()},Eval_sum=function(){var r,e,s,o,t,n,p,i;if(e=0,0,0,r=cadr(p1),s=caddr(p1),issymbol(s)||stop("sum: 2nd arg?"),push(cadddr(p1)),Eval(),o=pop_integer(),isNaN(o))push(p1);else{if(push(caddddr(p1)),Eval(),t=pop_integer(),!isNaN(t)){for(p4=get_binding(s),push_integer(0),e=n=p=o,i=t;p<=i?n<=i:n>=i;e=p<=i?++n:--n)push_integer(e),p5=pop(),set_binding(s,p5),push(r),Eval(),add();return set_binding(s,p4)}push(p1)}},Eval_tan=function(){return push(cadr(p1)),Eval(),tangent()},tangent=function(){return save(),yytangent(),restore()},yytangent=function(){var r,e;if(0,r=0,p1=pop(),car(p1)!==symbol(ARCTAN)){if(isdouble(p1))return r=Math.tan(p1.d),Math.abs(r)<1e-10&&(r=0),void push_double(r);if(isnegative(p1))return push(p1),negate(),tangent(),void negate();if(push(p1),push_integer(180),multiply(),evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),divide(),(e=pop_integer())<0||isNaN(e))return push(symbol(TAN)),push(p1),void list(2);switch(e%360){case 0:case 180:return push_integer(0);case 30:case 210:return push_rational(1,3),push_integer(3),push_rational(1,2),power(),multiply();case 150:case 330:return push_rational(-1,3),push_integer(3),push_rational(1,2),power(),multiply();case 45:case 225:return push_integer(1);case 135:case 315:return push_integer(-1);case 60:case 240:return push_integer(3),push_rational(1,2),power();case 120:case 300:return push_integer(3),push_rational(1,2),power(),negate();default:return push(symbol(TAN)),push(p1),list(2)}}else push(cadr(p1))},Eval_tanh=function(){var r;if(r=0,push(cadr(p1)),Eval(),p1=pop(),car(p1)!==symbol(ARCTANH)){if(isdouble(p1))return r=Math.tanh(p1.d),Math.abs(r)<1e-10&&(r=0),void push_double(r);if(!isZeroAtomOrTensor(p1))return push_symbol(TANH),push(p1),list(2);push(zero)}else push(cadr(p1))},Eval_taylor=function(){return p1=cdr(p1),push(car(p1)),Eval(),p1=cdr(p1),push(car(p1)),Eval(),(p2=pop())===symbol(NIL)?guess():push(p2),p1=cdr(p1),push(car(p1)),Eval(),(p2=pop())===symbol(NIL)?push_integer(24):push(p2),p1=cdr(p1),push(car(p1)),Eval(),(p2=pop())===symbol(NIL)?push_integer(0):push(p2),taylor()},taylor=function(){var r,e,s,o;if(r=0,0,save(),p4=pop(),p3=pop(),p2=pop(),p1=pop(),push(p3),e=pop_integer(),isNaN(e))return push_symbol(TAYLOR),push(p1),push(p2),push(p3),push(p4),list(5),void restore();for(push(p1),push(p2),push(p4),subst(),Eval(),push_integer(1),p5=pop(),r=s=1,o=e;(1<=o?s<=o:s>=o)&&(push(p1),push(p2),derivative(),p1=pop(),!isZeroAtomOrTensor(p1));r=1<=o?++s:--s)push(p5),push(p2),push(p4),subtract(),multiply(),p5=pop(),push(p1),push(p2),push(p4),subst(),Eval(),push(p5),multiply(),push_integer(r),factorial(),divide(),add();return restore()},Eval_tensor=function(){var r,e,s,o,t,n,p,i,a;for(s=0,0,0,check_tensor_dimensions(p1),p=p1.tensor.nelem,n=p1.tensor.ndim,(p2=alloc_tensor(p)).tensor.ndim=n,s=o=0,i=n;0<=i?o<i:o>i;s=0<=i?++o:--o)p2.tensor.dim[s]=p1.tensor.dim[s];for(r=p1.tensor.elem,e=p2.tensor.elem,check_tensor_dimensions(p2),s=t=0,a=p;0<=a?t<a:t>a;s=0<=a?++t:--t)push(r[s]),Eval(),e[s]=pop();return check_tensor_dimensions(p1),check_tensor_dimensions(p2),push(p2),promote_tensor()},tensor_plus_tensor=function(){var r,e,s,o,t,n,p,i,a,u,l,c;if(o=0,0,0,save(),p2=pop(),(i=(p1=pop()).tensor.ndim)!==p2.tensor.ndim)return push(symbol(NIL)),void restore();for(o=t=0,u=i;0<=u?t<u:t>u;o=0<=u?++t:--t)if(p1.tensor.dim[o]!==p2.tensor.dim[o])return push(symbol(NIL)),void restore();for(a=p1.tensor.nelem,(p3=alloc_tensor(a)).tensor.ndim=i,o=n=0,l=i;0<=l?n<l:n>l;o=0<=l?++n:--n)p3.tensor.dim[o]=p1.tensor.dim[o];for(r=p1.tensor.elem,e=p2.tensor.elem,s=p3.tensor.elem,o=p=0,c=a;0<=c?p<c:p>c;o=0<=c?++p:--p)push(r[o]),push(e[o]),add(),s[o]=pop();return push(p3),restore()},tensor_times_scalar=function(){var r,e,s,o,t,n,p,i,a;for(s=0,0,0,save(),p2=pop(),n=(p1=pop()).tensor.ndim,p=p1.tensor.nelem,(p3=alloc_tensor(p)).tensor.ndim=n,s=o=0,i=n;0<=i?o<i:o>i;s=0<=i?++o:--o)p3.tensor.dim[s]=p1.tensor.dim[s];for(r=p1.tensor.elem,e=p3.tensor.elem,s=t=0,a=p;0<=a?t<a:t>a;s=0<=a?++t:--t)push(r[s]),push(p2),multiply(),e[s]=pop();return push(p3),restore()},scalar_times_tensor=function(){var r,e,s,o,t,n,p,i,a;for(s=0,0,0,save(),p2=pop(),p1=pop(),n=p2.tensor.ndim,p=p2.tensor.nelem,(p3=alloc_tensor(p)).tensor.ndim=n,s=o=0,i=n;0<=i?o<i:o>i;s=0<=i?++o:--o)p3.tensor.dim[s]=p2.tensor.dim[s];for(r=p2.tensor.elem,e=p3.tensor.elem,s=t=0,a=p;0<=a?t<a:t>a;s=0<=a?++t:--t)push(p1),push(r[s]),multiply(),e[s]=pop();return push(p3),restore()},check_tensor_dimensions=function(r){r.tensor.nelem!==r.tensor.elem.length&&console.log("something wrong in tensor dimensions")},is_square_matrix=function(r){return istensor(r)&&2===r.tensor.ndim&&r.tensor.dim[0]===r.tensor.dim[1]?1:0},d_tensor_tensor=function(){var r,e,s,o,t,n,p,i,a,u,l,c,d;if(o=0,t=0,0,0,a=p1.tensor.ndim,u=p1.tensor.nelem,a+1>=MAXDIM)return push_symbol(DERIVATIVE),push(p1),push(p2),void list(3);for((p3=alloc_tensor(u*p2.tensor.nelem)).tensor.ndim=a+1,o=n=0,l=a;0<=l?n<l:n>l;o=0<=l?++n:--n)p3.tensor.dim[o]=p1.tensor.dim[o];for(p3.tensor.dim[a]=p2.tensor.dim[0],r=p1.tensor.elem,e=p2.tensor.elem,s=p3.tensor.elem,o=p=0,c=u;0<=c?p<c:p>c;o=0<=c?++p:--p)for(t=i=0,d=p2.tensor.nelem;0<=d?i<d:i>d;t=0<=d?++i:--i)push(r[o]),push(e[t]),derivative(),s[o*p2.tensor.nelem+t]=pop();return push(p3)},d_scalar_tensor=function(){var r,e,s,o,t;for((p3=alloc_tensor(p2.tensor.nelem)).tensor.ndim=1,p3.tensor.dim[0]=p2.tensor.dim[0],r=p2.tensor.elem,e=p3.tensor.elem,s=o=0,t=p2.tensor.nelem;0<=t?o<t:o>t;s=0<=t?++o:--o)push(p1),push(r[s]),derivative(),e[s]=pop();return push(p3)},d_tensor_scalar=function(){var r,e,s,o,t,n,p;for(s=0,(p3=alloc_tensor(p1.tensor.nelem)).tensor.ndim=p1.tensor.ndim,s=o=0,n=p1.tensor.ndim;0<=n?o<n:o>n;s=0<=n?++o:--o)p3.tensor.dim[s]=p1.tensor.dim[s];for(r=p1.tensor.elem,e=p3.tensor.elem,s=t=0,p=p1.tensor.nelem;0<=p?t<p:t>p;s=0<=p?++t:--t)push(r[s]),push(p2),derivative(),e[s]=pop();return push(p3)},compare_tensors=function(r,e){var s,o,t,n,p;if(s=0,r.tensor.ndim<e.tensor.ndim)return-1;if(r.tensor.ndim>e.tensor.ndim)return 1;for(s=o=0,n=r.tensor.ndim;0<=n?o<n:o>n;s=0<=n?++o:--o){if(r.tensor.dim[s]<e.tensor.dim[s])return-1;if(r.tensor.dim[s]>e.tensor.dim[s])return 1}for(s=t=0,p=r.tensor.nelem;0<=p?t<p:t>p;s=0<=p?++t:--t)if(!equal(r.tensor.elem[s],e.tensor.elem[s]))return lessp(r.tensor.elem[s],e.tensor.elem[s])?-1:1;return 0},power_tensor=function(){var r,e,s,o,t,n,p,i;if(r=0,0,t=0,e=p1.tensor.ndim-1,p1.tensor.dim[0]!==p1.tensor.dim[e])return push_symbol(POWER),push(p1),push(p2),void list(3);if(push(p2),t=pop_integer(),isNaN(t))return push_symbol(POWER),push(p1),push(p2),void list(3);if(0===t){for(2!==p1.tensor.ndim&&stop("power(tensor,0) with tensor rank not equal to 2"),t=p1.tensor.dim[0],(p1=alloc_tensor(t*t)).tensor.ndim=2,p1.tensor.dim[0]=t,p1.tensor.dim[1]=t,r=s=0,n=t;0<=n?s<n:s>n;r=0<=n?++s:--s)p1.tensor.elem[t*r+r]=one;return check_tensor_dimensions(p1),void push(p1)}for(t<0&&(t=-t,push(p1),inv(),p1=pop()),push(p1),i=[],r=o=1,p=t;(1<=p?o<p:o>p)&&(push(p1),inner(),!isZeroAtomOrTensor(stack[tos-1]));r=1<=p?++o:--o)i.push(void 0);return i},copy_tensor=function(){var r,e,s,o,t;for(r=0,save(),p1=pop(),(p2=alloc_tensor(p1.tensor.nelem)).tensor.ndim=p1.tensor.ndim,r=e=0,o=p1.tensor.ndim;0<=o?e<o:e>o;r=0<=o?++e:--e)p2.tensor.dim[r]=p1.tensor.dim[r];for(r=s=0,t=p1.tensor.nelem;0<=t?s<t:s>t;r=0<=t?++s:--s)p2.tensor.elem[r]=p1.tensor.elem[r];return check_tensor_dimensions(p1),check_tensor_dimensions(p2),push(p2),restore()},promote_tensor=function(){var r,e,s,o,t,n,p,i,a,u,l,c,d,_,m;if(r=0,e=0,s=0,0,0,save(),p1=pop(),!istensor(p1))return push(p1),void restore();for(p2=p1.tensor.elem[0],r=o=1,l=p1.tensor.nelem;1<=l?o<l:o>l;r=1<=l?++o:--o)compatible(p2,p1.tensor.elem[r])||stop("Cannot promote tensor due to inconsistent tensor components.");if(!istensor(p2))return push(p1),void restore();for((p=p1.tensor.ndim+p2.tensor.ndim)>MAXDIM&&stop("tensor rank > "+MAXDIM),i=p1.tensor.nelem*p2.tensor.nelem,(p3=alloc_tensor(i)).tensor.ndim=p,r=t=0,c=p1.tensor.ndim;0<=c?t<c:t>c;r=0<=c?++t:--t)p3.tensor.dim[r]=p1.tensor.dim[r];for(e=n=0,d=p2.tensor.ndim;0<=d?n<d:n>d;e=0<=d?++n:--n)p3.tensor.dim[r+e]=p2.tensor.dim[e];for(s=0,r=a=0,_=p1.tensor.nelem;0<=_?a<_:a>_;r=0<=_?++a:--a)for(e=u=0,m=(p2=p1.tensor.elem[r]).tensor.nelem;0<=m?u<m:u>m;e=0<=m?++u:--u)p3.tensor.elem[s++]=p2.tensor.elem[e];return check_tensor_dimensions(p2),check_tensor_dimensions(p3),push(p3),restore()},compatible=function(r,e){var s,o,t;if(!istensor(r)&&!istensor(e))return 1;if(!istensor(r)||!istensor(e))return 0;if(r.tensor.ndim!==e.tensor.ndim)return 0;for(s=o=0,t=r.tensor.ndim;0<=t?o<t:o>t;s=0<=t?++o:--o)if(r.tensor.dim[s]!==e.tensor.dim[s])return 0;return 1},Eval_test=function(){var r,e;for(e=p1,p1=cdr(p1);iscons(p1);){if(cdr(p1)===symbol(NIL))return push(car(p1)),void Eval();if(null==(r=isZeroLikeOrNonZeroLikeOrUndetermined(car(p1))))return void push(e);if(r)return push(cadr(p1)),void Eval();p1=cddr(p1)}return push_integer(0)},Eval_testeq=function(){var r,e,s;if(e=p1,push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),subtract(),s=pop(),r=isZeroLikeOrNonZeroLikeOrUndetermined(s))push_integer(0);else if(null==r||r)if(push(cadr(p1)),Eval(),simplify(),push(caddr(p1)),Eval(),simplify(),subtract(),s=pop(),r=isZeroLikeOrNonZeroLikeOrUndetermined(s))push_integer(0);else{if(null==r||r)return push(e);push_integer(1)}else push_integer(1)},Eval_testge=function(){var r,e;if(e=p1,null!=(r=cmp_args()))return push_integer(r>=0?1:0);push(e)},Eval_testgt=function(){var r,e;if(e=p1,null!=(r=cmp_args()))return push_integer(r>0?1:0);push(e)},Eval_testle=function(){var r,e;if(e=p1,null!=(r=cmp_args()))return push_integer(r<=0?1:0);push(e)},Eval_testlt=function(){var r,e;if(e=p1,null!=(r=cmp_args()))return push_integer(r<0?1:0);push(e)},Eval_not=function(){var r,e;return e=p1,null==(r=isZeroLikeOrNonZeroLikeOrUndetermined(cadr(p1)))?push(e):push_integer(r?0:1)},Eval_and=function(){var r,e,s,o;for(r=cdr(o=p1),s=!1;iscons(r);)if(null==(e=isZeroLikeOrNonZeroLikeOrUndetermined(car(r))))s=!0,r=cdr(r);else if(e)r=cdr(r);else if(!e)return void push_integer(0);return s?push(o):push_integer(1)},Eval_or=function(){var r,e,s,o;for(e=cdr(o=p1),s=!1;iscons(e);)if(null==(r=isZeroLikeOrNonZeroLikeOrUndetermined(car(e))))s=!0,e=cdr(e);else{if(r)return void push_integer(1);r||(e=cdr(e))}return s?push(o):push_integer(0)},cmp_args=function(){var r;if(r=0,push(cadr(p1)),Eval(),simplify(),push(caddr(p1)),Eval(),simplify(),subtract(),(p1=pop()).k!==NUM&&p1.k!==DOUBLE&&(push(p1),yyfloat(),Eval(),p1=pop()),isZeroAtomOrTensor(p1))return 0;switch(p1.k){case NUM:r=-1===MSIGN(p1.q.a)?-1:1;break;case DOUBLE:r=p1.d<0?-1:1;break;default:r=null}return r},transform=function(r,e){var s,o,t,n,p,i,a,u,l,c,d,_,m,f,h,g,b;if(0,save(),p1=null,p4=pop(),p3=pop(),DEBUG&&console.log("         !!!!!!!!!   transform on: "+p3),saveMetaBindings(),set_binding(symbol(METAX),p4),h=tos,push_integer(1),push(p3),push(p4),polyform(),push(p4),s=tos-2,decomp(e),l=tos-s,DEBUG)for(console.log("  "+l+" decomposed elements ====== "),t=n=0,c=l;0<=c?n<c:n>c;t=0<=c?++n:--n)console.log("  decomposition element "+t+": "+stack[tos-1-t]);if(g=!1,e){if(!isNumericAtom(p3))if(f=r,DEBUG&&console.log("applying transform: "+f),DEBUG&&console.log("scanning table entry "+f),push(f),push(symbol(SYMBOL_A_UNDERSCORE)),push(symbol(METAA)),subst(),push(symbol(SYMBOL_B_UNDERSCORE)),push(symbol(METAB)),subst(),push(symbol(SYMBOL_X_UNDERSCORE)),push(symbol(METAX)),subst(),p1=pop(),p5=car(p1),DEBUG&&console.log("template expression: "+p5),p6=cadr(p1),p7=cddr(p1),f_equals_a(h,e))g=!0;else{for(DEBUG&&console.log("p3 at this point: "+p3),b=[],DEBUG&&console.log("car(p3): "+car(p3)),iscons(d=p3)&&(b.push(car(p3)),d=cdr(p3));iscons(d);)_=car(d),d=cdr(d),DEBUG&&console.log("tos before recursive transform: "+tos),push(_),push_symbol(NIL),DEBUG&&console.log("testing: "+_),DEBUG&&console.log("about to try to simplify other term: "+_),m=transform(r,e),g=g||m,b.push(pop()),DEBUG&&console.log("tried to simplify other term: "+_+" ...successful?: "+m+" ...transformed: "+b[b.length-1]);if(0!==b.length){for(a=0,p=b.length;a<p;a++)t=b[a],push(t);list(b.length),p6=pop()}}}else for(u=0,i=r.length;u<i;u++)if(o=r[u],DEBUG&&(console.log("scanning table entry "+o),(o+"").indexOf("f(sqrt(a+b*x),2/3*1/b*sqrt((a+b*x)^3))")),o&&(scan_meta(o),p1=pop(),p5=cadr(p1),p6=caddr(p1),p7=cdddr(p1),f_equals_a(h,e))){g=!0;break}return moveTos(h),g?(push(p6),Eval(),p1=pop(),g=!0):p1=e?p3:symbol(NIL),restoreMetaBindings(),push(p1),restore(),g},saveMetaBindings=function(){return push(get_binding(symbol(METAA))),push(get_binding(symbol(METAB))),push(get_binding(symbol(METAX)))},restoreMetaBindings=function(){return set_binding(symbol(METAX),pop()),set_binding(symbol(METAB),pop()),set_binding(symbol(METAA),pop())},f_equals_a=function(r,e){var s,o,t,n,p,i,a,u,l;for(s=0,o=0,s=t=i=r,a=tos;i<=a?t<a:t>a;s=i<=a?++t:--t)for(set_binding(symbol(METAA),stack[s]),DEBUG&&console.log("  binding METAA to "+get_binding(symbol(METAA))),o=n=u=r,l=tos;u<=l?n<l:n>l;o=u<=l?++n:--n){for(set_binding(symbol(METAB),stack[o]),DEBUG&&console.log("  binding METAB to "+get_binding(symbol(METAB))),p1=p7;iscons(p1)&&(push(car(p1)),Eval(),p2=pop(),!isZeroAtomOrTensor(p2));)p1=cdr(p1);if(!iscons(p1)&&(push(p3),DEBUG&&console.log("about to evaluate template expression: "+p5+" binding METAA to "+get_binding(symbol(METAA))+" and binding METAB to "+get_binding(symbol(METAB))+" and binding METAX to "+get_binding(symbol(METAX))),push(p5),e&&(p=expanding,expanding=!1),Eval(),e&&(expanding=p),DEBUG&&console.log("  comparing "+stack[tos-1]+" to: "+stack[tos-2]),subtract(),p1=pop(),isZeroAtomOrTensor(p1)))return DEBUG&&(console.log("binding METAA to "+get_binding(symbol(METAA))),console.log("binding METAB to "+get_binding(symbol(METAB))),console.log("binding METAX to "+get_binding(symbol(METAX))),console.log("comparing "+p3+" to: "+p5)),1}return 0},Eval_transpose=function(){return push(cadr(p1)),Eval(),cddr(p1)===symbol(NIL)?(push_integer(1),push_integer(2)):(push(caddr(p1)),Eval(),push(cadddr(p1)),Eval()),transpose()},transpose=function(){var r,e,s,o,t,n,p,i,a,u,l,c,d,_,m,f,h,g,b,y,E,v,x,A,T,O,I,N,S,R;for(p=0,u=0,l=0,c=0,_=0,0,0,R=0,s=[],o=[],p=d=0,v=MAXDIM;0<=v?d<v:d>v;p=0<=v?++d:--d)s[p]=0,o[p]=0;if(save(),p3=pop(),p2=pop(),p1=pop(),isNumericAtom(p1))return push(p1),void restore();if((isplusone(p2)&&isplustwo(p3)||isplusone(p3)&&isplustwo(p2))&&isidentitymatrix(p1))return push(p1),void restore();if(istranspose(p1)&&(i=car(cdr(cdr(p1))),a=car(cdr(cdr(cdr(p1)))),equal(i,p3)&&equal(a,p2)||equal(a,p3)&&equal(i,p2)||equal(i,symbol(NIL))&&equal(a,symbol(NIL))&&(isplusone(p3)&&isplustwo(p2)||isplusone(p2)&&isplustwo(p3))))return push(car(cdr(p1))),void restore();if(expanding&&isadd(p1)){for(p1=cdr(p1),push(zero);iscons(p1);)push(car(p1)),push(p2),push(p3),transpose(),add(),p1=cdr(p1);restore()}else if(expanding&&ismultiply(p1)){for(p1=cdr(p1),push(one);iscons(p1);)push(car(p1)),push(p2),push(p3),transpose(),multiply(),p1=cdr(p1);restore()}else{if(!expanding||!isinnerordot(p1)){if(!istensor(p1))return isZeroAtomOrTensor(p1)?(push(zero),void restore()):(push_symbol(TRANSPOSE),push(p1),isplusone(p2)&&isplustwo(p3)||isplusone(p3)&&isplustwo(p2)?list(2):(push(p2),push(p3),list(4)),void restore());if(h=p1.tensor.ndim,g=p1.tensor.nelem,1===h)return push(p1),void restore();for(push(p2),c=pop_integer(),push(p3),_=pop_integer(),(c<1||c>h||_<1||_>h)&&stop("transpose: index out of range"),c--,_--,(p2=alloc_tensor(g)).tensor.ndim=h,p=f=0,A=h;0<=A?f<A:f>A;p=0<=A?++f:--f)p2.tensor.dim[p]=p1.tensor.dim[p];for(p2.tensor.dim[c]=p1.tensor.dim[_],p2.tensor.dim[_]=p1.tensor.dim[c],r=p1.tensor.elem,t=p2.tensor.elem,p=b=0,T=h;0<=T?b<T:b>T;p=0<=T?++b:--b)s[p]=0,o[p]=p1.tensor.dim[p];for(p=y=0,O=g;0<=O?y<O:y>O;p=0<=O?++y:--y){for(R=s[c],s[c]=s[_],s[_]=R,R=o[c],o[c]=o[_],o[_]=R,l=0,u=E=0,I=h;0<=I?E<I:E>I;u=0<=I?++E:--E)l=l*o[u]+s[u];for(R=s[c],s[c]=s[_],s[_]=R,R=o[c],o[c]=o[_],o[_]=R,t[l]=r[p],u=S=N=h-1;(N<=0?S<=0:S>=0)&&!(++s[u]<o[u]);u=N<=0?++S:--S)s[u]=0}return push(p2),restore()}for(p1=cdr(p1),e=[];iscons(p1);)e.push([car(p1),p2,p3]),p1=cdr(p1);for(n=m=x=e.length-1;x<=0?m<=0:m>=0;n=x<=0?++m:--m)push(e[n][0]),push(e[n][1]),push(e[n][2]),transpose(),n!==e.length-1&&inner();restore()}},Eval_user_function=function(){var r,e;if(DEBUG&&console.log("Eval_user_function evaluating: "+car(p1)),car(p1)!==symbol(SYMBOL_D)||get_binding(symbol(SYMBOL_D))!==symbol(SYMBOL_D)){if(push(car(p1)),Eval(),r=pop(),isNumericAtom(r)?stop("expected function invocation, found multiplication instead. Use '*' symbol explicitly for multiplication."):istensor(r)?stop("expected function invocation, found tensor product instead. Use 'dot/inner' explicitly."):isstr(r)&&stop("expected function, found string instead."),p3=car(cdr(r)),p4=car(cdr(cdr(r))),p5=cdr(p1),car(r)===symbol(FUNCTION)&&r!==car(p1)){for(p1=p4,p2=p5,e=tos;iscons(p1)&&iscons(p2);)push(car(p1)),push(car(p2)),p1=cdr(p1),p2=cdr(p2);return list(tos-e),p6=pop(),push(p3),iscons(p6)&&(push(p6),rewrite_args()),Eval()}for(e=tos,push(r),p1=p5;iscons(p1);)push(car(p1)),Eval(),p1=cdr(p1);list(tos-e)}else Eval_derivative()},rewrite_args=function(){var r,e;if(e=0,save(),p2=pop(),p1=pop(),istensor(p1))return e=rewrite_args_tensor(),restore(),e;if(iscons(p1)){for(r=tos,car(p1)===car(p2)?(push_symbol(EVAL),push(car(cdr(p2))),list(2)):push(car(p1)),p1=cdr(p1);iscons(p1);)push(car(p1)),push(p2),e+=rewrite_args(),p1=cdr(p1);return list(tos-r),restore(),e}if(!issymbol(p1))return push(p1),restore(),0;for(p3=p2;iscons(p3);){if(p1===car(p3))return push(cadr(p3)),restore(),1;p3=cddr(p3)}return p3=get_binding(p1),push(p3),p1!==p3&&(push(p2),0===(e=rewrite_args())&&(pop(),push(p1))),restore(),e},rewrite_args_tensor=function(){var r,e,s,o;for(s=0,r=0,push(p1),copy_tensor(),r=e=0,o=(p1=pop()).tensor.nelem;0<=o?e<o:e>o;r=0<=o?++e:--e)push(p1.tensor.elem[r]),push(p2),s+=rewrite_args(),p1.tensor.elem[r]=pop();return check_tensor_dimensions(p1),push(p1),s},Eval_zero=function(){var r,e,s,o,t,n,p,i;for(r=0,e=[],o=0,n=0,r=s=0,p=MAXDIM;0<=p?s<p:s>p;r=0<=p?++s:--s)e[r]=0;for(o=1,n=0,p2=cdr(p1);iscons(p2);){if(push(car(p2)),Eval(),(r=pop_integer())<1||isNaN(r))return void push(zero);o*=r,e[n++]=r,p2=cdr(p2)}if(0!==n){for((p1=alloc_tensor(o)).tensor.ndim=n,r=t=0,i=n;0<=i?t<i:t>i;r=0<=i?++t:--t)p1.tensor.dim[r]=e[r];return push(p1)}push(zero)},allocatedId=0,alloc_tensor=function(r){var e,s,o,t;for(e=0,(o=new U).k=TENSOR,o.tensor=new tensor,o.tensor.nelem=r,e=s=0,t=r;0<=t?s<t:s>t;e=0<=t?++s:--s)o.tensor.elem[e]=zero;return o.tensor.allocatedId=allocatedId,allocatedId++,check_tensor_dimensions(o),o},Find=function(r,e){var s,o,t;if(s=0,equal(r,e))return 1;if(istensor(r)){for(s=o=0,t=r.tensor.nelem;0<=t?o<t:o>t;s=0<=t?++o:--o)if(Find(r.tensor.elem[s],e))return 1;return 0}for(;iscons(r);){if(Find(car(r),e))return 1;r=cdr(r)}return 0},findPossibleClockForm=function(r){var e,s,o;if(e=0,isimaginaryunit(r))return 0;if(car(r)===symbol(POWER)&&!isinteger(caddr(p1))&&Find(cadr(r),imaginaryunit))return 1;if(car(r)===symbol(POWER)&&equaln(cadr(r),-1)&&!isinteger(caddr(p1)))return 1;if(istensor(r)){for(e=s=0,o=r.tensor.nelem;0<=o?s<o:s>o;e=0<=o?++s:--s)if(findPossibleClockForm(r.tensor.elem[e]))return 1;return 0}for(;iscons(r);){if(findPossibleClockForm(car(r)))return 1;r=cdr(r)}return 0},findPossibleExponentialForm=function(r){var e,s,o;if(e=0,car(r)===symbol(POWER)&&cadr(r)===symbol(E))return Find(caddr(r),imaginaryunit);if(istensor(r)){for(e=s=0,o=r.tensor.nelem;0<=o?s<o:s>o;e=0<=o?++s:--s)if(findPossibleExponentialForm(r.tensor.elem[e]))return 1;return 0}for(;iscons(r);){if(findPossibleExponentialForm(car(r)))return 1;r=cdr(r)}return 0},$.Find=Find,init=function(){var r,e,s;if(r=0,flag=0,reset_after_error(),chainOfUserSymbolsNotFunctionsBeingEvaluated=[],!flag){for(flag=1,r=e=0,s=NSYM;0<=s?e<s:e>s;r=0<=s?++e:--e)symtab[r]=new U,symtab[r].k=SYM,binding[r]=symtab[r],isSymbolReclaimable[r]=!1;return defn()}},defn_str=['version="'+version+'"',"e=exp(1)","i=sqrt(-1)","autoexpand=1","assumeRealVariables=1","trange=[-pi,pi]","xrange=[-10,10]","yrange=[-10,10]","last=0","trace=0","printLeaveEAlone=1","printLeaveXAlone=0","cross(u,v)=[u[2]*v[3]-u[3]*v[2],u[3]*v[1]-u[1]*v[3],u[1]*v[2]-u[2]*v[1]]","curl(v)=[d(v[3],y)-d(v[2],z),d(v[1],z)-d(v[3],x),d(v[2],x)-d(v[1],y)]","div(v)=d(v[1],x)+d(v[2],y)+d(v[3],z)","ln(x)=log(x)"],defn=function(){var r,e,s,o,t;for(p0=symbol(NIL),p1=symbol(NIL),p2=symbol(NIL),p3=symbol(NIL),p4=symbol(NIL),p5=symbol(NIL),p6=symbol(NIL),p7=symbol(NIL),p8=symbol(NIL),p9=symbol(NIL),std_symbol("abs",ABS),std_symbol("add",ADD),std_symbol("adj",ADJ),std_symbol("and",AND),std_symbol("approxratio",APPROXRATIO),std_symbol("arccos",ARCCOS),std_symbol("arccosh",ARCCOSH),std_symbol("arcsin",ARCSIN),std_symbol("arcsinh",ARCSINH),std_symbol("arctan",ARCTAN),std_symbol("arctanh",ARCTANH),std_symbol("arg",ARG),std_symbol("atomize",ATOMIZE),std_symbol("besselj",BESSELJ),std_symbol("bessely",BESSELY),std_symbol("binding",BINDING),std_symbol("binomial",BINOMIAL),std_symbol("ceiling",CEILING),std_symbol("check",CHECK),std_symbol("choose",CHOOSE),std_symbol("circexp",CIRCEXP),std_symbol("clear",CLEAR),std_symbol("clearall",CLEARALL),std_symbol("clearpatterns",CLEARPATTERNS),std_symbol("clock",CLOCK),std_symbol("coeff",COEFF),std_symbol("cofactor",COFACTOR),std_symbol("condense",CONDENSE),std_symbol("conj",CONJ),std_symbol("contract",CONTRACT),std_symbol("cos",COS),std_symbol("cosh",COSH),std_symbol("decomp",DECOMP),std_symbol("defint",DEFINT),std_symbol("deg",DEGREE),std_symbol("denominator",DENOMINATOR),std_symbol("det",DET),std_symbol("derivative",DERIVATIVE),std_symbol("dim",DIM),std_symbol("dirac",DIRAC),std_symbol("divisors",DIVISORS),std_symbol("do",DO),std_symbol("dot",DOT),std_symbol("draw",DRAW),std_symbol("dsolve",DSOLVE),std_symbol("erf",ERF),std_symbol("erfc",ERFC),std_symbol("eigen",EIGEN),std_symbol("eigenval",EIGENVAL),std_symbol("eigenvec",EIGENVEC),std_symbol("eval",EVAL),std_symbol("exp",EXP),std_symbol("expand",EXPAND),std_symbol("expcos",EXPCOS),std_symbol("expsin",EXPSIN),std_symbol("factor",FACTOR),std_symbol("factorial",FACTORIAL),std_symbol("factorpoly",FACTORPOLY),std_symbol("filter",FILTER),std_symbol("float",FLOATF),std_symbol("floor",FLOOR),std_symbol("for",FOR),std_symbol("function",FUNCTION),std_symbol("Gamma",GAMMA),std_symbol("gcd",GCD),std_symbol("hermite",HERMITE),std_symbol("hilbert",HILBERT),std_symbol("imag",IMAG),std_symbol("component",INDEX),std_symbol("inner",INNER),std_symbol("integral",INTEGRAL),std_symbol("inv",INV),std_symbol("invg",INVG),std_symbol("isinteger",ISINTEGER),std_symbol("isprime",ISPRIME),std_symbol("laguerre",LAGUERRE),std_symbol("lcm",LCM),std_symbol("leading",LEADING),std_symbol("legendre",LEGENDRE),std_symbol("log",LOG),std_symbol("lookup",LOOKUP),std_symbol("mod",MOD),std_symbol("multiply",MULTIPLY),std_symbol("not",NOT),std_symbol("nroots",NROOTS),std_symbol("number",NUMBER),std_symbol("numerator",NUMERATOR),std_symbol("operator",OPERATOR),std_symbol("or",OR),std_symbol("outer",OUTER),std_symbol("pattern",PATTERN),std_symbol("patternsinfo",PATTERNSINFO),std_symbol("polar",POLAR),std_symbol("power",POWER),std_symbol("prime",PRIME),std_symbol("print",PRINT),std_symbol("print2dascii",PRINT2DASCII),std_symbol("printcomputer",PRINTFULL),std_symbol("printlatex",PRINTLATEX),std_symbol("printlist",PRINTLIST),std_symbol("printhuman",PRINTPLAIN),std_symbol("printLeaveEAlone",PRINT_LEAVE_E_ALONE),std_symbol("printLeaveXAlone",PRINT_LEAVE_X_ALONE),std_symbol("product",PRODUCT),std_symbol("quote",QUOTE),std_symbol("quotient",QUOTIENT),std_symbol("rank",RANK),std_symbol("rationalize",RATIONALIZE),std_symbol("real",REAL),std_symbol("rect",YYRECT),std_symbol("roots",ROOTS),std_symbol("round",ROUND),std_symbol("equals",SETQ),std_symbol("sgn",SGN),std_symbol("silentpattern",SILENTPATTERN),std_symbol("simplify",SIMPLIFY),std_symbol("sin",SIN),std_symbol("sinh",SINH),std_symbol("shape",SHAPE),std_symbol("sqrt",SQRT),std_symbol("stop",STOP),std_symbol("subst",SUBST),std_symbol("sum",SUM),std_symbol("symbolsinfo",SYMBOLSINFO),std_symbol("tan",TAN),std_symbol("tanh",TANH),std_symbol("taylor",TAYLOR),std_symbol("test",TEST),std_symbol("testeq",TESTEQ),std_symbol("testge",TESTGE),std_symbol("testgt",TESTGT),std_symbol("testle",TESTLE),std_symbol("testlt",TESTLT),std_symbol("transpose",TRANSPOSE),std_symbol("unit",UNIT),std_symbol("zero",ZERO),std_symbol("nil",NIL),std_symbol("autoexpand",AUTOEXPAND),std_symbol("bake",BAKE),std_symbol("assumeRealVariables",ASSUME_REAL_VARIABLES),std_symbol("last",LAST),std_symbol("lastprint",LAST_PRINT),std_symbol("last2dasciiprint",LAST_2DASCII_PRINT),std_symbol("lastfullprint",LAST_FULL_PRINT),std_symbol("lastlatexprint",LAST_LATEX_PRINT),std_symbol("lastlistprint",LAST_LIST_PRINT),std_symbol("lastplainprint",LAST_PLAIN_PRINT),std_symbol("trace",TRACE),std_symbol("~",YYE),std_symbol("$DRAWX",DRAWX),std_symbol("$METAA",METAA),std_symbol("$METAB",METAB),std_symbol("$METAX",METAX),std_symbol("$SECRETX",SECRETX),std_symbol("version",VERSION),std_symbol("pi",PI),std_symbol("a",SYMBOL_A),std_symbol("b",SYMBOL_B),std_symbol("c",SYMBOL_C),std_symbol("d",SYMBOL_D),std_symbol("i",SYMBOL_I),std_symbol("j",SYMBOL_J),std_symbol("n",SYMBOL_N),std_symbol("r",SYMBOL_R),std_symbol("s",SYMBOL_S),std_symbol("t",SYMBOL_T),std_symbol("x",SYMBOL_X),std_symbol("y",SYMBOL_Y),std_symbol("z",SYMBOL_Z),std_symbol("I",SYMBOL_IDENTITY_MATRIX),std_symbol("a_",SYMBOL_A_UNDERSCORE),std_symbol("b_",SYMBOL_B_UNDERSCORE),std_symbol("x_",SYMBOL_X_UNDERSCORE),std_symbol("$C1",C1),std_symbol("$C2",C2),std_symbol("$C3",C3),std_symbol("$C4",C4),std_symbol("$C5",C5),std_symbol("$C6",C6),defineSomeHandyConstants(),o=codeGen,codeGen=!1,e=s=0,t=defn_str.length;0<=t?s<t:s>t;e=0<=t?++s:--s)r=defn_str[e],scan(r),DEBUG&&(console.log("... evaling "+r),console.log("top of stack:"),console.log(print_list(stack[tos-1]))),Eval(),pop();return codeGen=o},defineSomeHandyConstants=function(){return push_integer(0),zero=pop(),push_integer(1),one=pop(),push_double(1),one_as_double=pop(),push_symbol(POWER),DEBUG&&console.log(print_list(stack[tos-1])),push_integer(-1),DEBUG&&console.log(print_list(stack[tos-1])),push_rational(1,2),DEBUG&&console.log(print_list(stack[tos-1])),list(3),DEBUG&&console.log(print_list(stack[tos-1])),imaginaryunit=pop()},mcmp=function(r,e){return r.compare(e)},mcmpint=function(r,e){var s;return s=bigInt(e),mcmp(r,s)},strcmp=function(r,e){return r===e?0:r>e?1:-1},doubleToReasonableString=function(r){var e;return codeGen?r+"":(-1===(e=""+parseFloat(r.toFixed(6))).indexOf(".")&&(e+=".0"),e)},clear_term=function(){},isspace=function(r){return null!=r&&(" "===r||"\t"===r||"\n"===r||"\v"===r||"\f"===r||"\r"===r)},isdigit=function(r){return null!=r&&/^\d+$/.test(r)},isalpha=function(r){return null!=r&&-1===r.search(/[^A-Za-z]/)},isalphaOrUnderscore=function(r){return null!=r&&-1===r.search(/[^A-Za-z_]/)},isunderscore=function(r){return null!=r&&-1===r.search(/_/)},isalnumorunderscore=function(r){return null!=r&&(isalphaOrUnderscore(r)||isdigit(r))},count=function(r){var e;if(iscons(r))for(e=0;iscons(r);)e+=count(car(r))+1,r=cdr(r);else e=1;return e},countOccurrencesOfSymbol=function(r,e){var s;if(s=0,iscons(e))for(;iscons(e);)s+=countOccurrencesOfSymbol(r,car(e)),e=cdr(e);else equal(r,e)&&(s=1);return s},countsize=function(r){var e,s,o,t;if(o=0,istensor(r))for(e=s=0,t=r.tensor.nelem;0<=t?s<t:s>t;e=0<=t?++s:--s)o+=r.tensor.elem[e];else if(iscons(r))for(;iscons(r);)o+=count(car(r))+1,r=cdr(r);else o=1;return o},stop=function(r){var e;throw errorMessage+="Stop: ",e=errorMessage+=r,errorMessage="",moveTos(0),new Error(e)},findDependenciesInScript=function(r,e){var s,o,t,n,p,i,a,u,l,c,d,_,m,f,h,g,b,y,E,v,x,A,T,O,I,N,S,R,M,L,k,D,U,P,B,q,G,w,C,F,Y,X,W,z,V,Z,$;for(DEBUG&&console.log("stringToBeParsed: "+r),X=(new Date).getTime(),!0,codeGen=!0,symbolsDependencies={},symbolsHavingReassignments=[],symbolsInExpressionsWithoutAssignments=[],patternHasBeenFound=!1,d=0,"","",T=0,n={affectsVariables:[],affectedBy:[]},C=r;;){try{errorMessage="",check_stack(),DEBUG&&console.log("findDependenciesInScript: scanning"),T=scan(r.substring(d)),DEBUG&&console.log("scanned"),pop(),check_stack()}catch(r){i=r,PRINTOUTRESULT&&console.log(i),errorMessage=i+"",reset_after_error();break}if(0===T)break;d+=T}for(_ in Y="",DEBUG&&console.log("all local dependencies ----------------"),Y+="All local dependencies: ",symbolsDependencies){for(Z=symbolsDependencies[_],DEBUG&&console.log("variable "+_+" depends on: "),n.affectsVariables.push(_),Y+=" variable "+_+" depends on: ",m=0,f=Z.length;m<f;m++)l=Z[m],DEBUG&&console.log("    "+l),"'"!==l[0]&&n.affectedBy.push(l),Y+=l+", ";Y+="; "}for(Y+=". ",DEBUG&&console.log("Symbols with reassignments ----------------"),Y+="Symbols with reassignments: ",A=0,h=symbolsHavingReassignments.length;A<h;A++)_=symbolsHavingReassignments[A],-1===n.affectedBy.indexOf(_)&&(n.affectedBy.push(_),Y+=_+", ");for(Y+=". ",DEBUG&&console.log("Symbols in expressions without assignments ----------------"),Y+="Symbols in expressions without assignments: ",O=0,g=symbolsInExpressionsWithoutAssignments.length;O<g;O++)_=symbolsInExpressionsWithoutAssignments[O],-1===n.affectedBy.indexOf(_)&&(n.affectedBy.push(_),Y+=_+", ");if(Y+=". ",n.affectedBy.push("PATTERN_DEPENDENCY"),patternHasBeenFound&&(n.affectsVariables.push("PATTERN_DEPENDENCY"),Y+=" - PATTERN_DEPENDENCY inserted - "),DEBUG&&console.log("All dependencies recursively ----------------"),Y+="All dependencies recursively: ",w=["",""],u="",D="",""===errorMessage&&!e){try{"","",w=run(r,!0),"",""}catch(r){i=r,PRINTOUTRESULT&&console.log(i),errorMessage=i+"",init()}if(""===errorMessage)for(_ in symbolsDependencies){for(codeGen=!0,DEBUG&&console.log("  variable "+_+" is: "+get_binding(usr_symbol(_)).toString()),codeGen=!1,DEBUG&&console.log("  variable "+_+" depends on: "),Y+=" variable "+_+" depends on: ",recursiveDependencies(_,U=[],[],$=[],[],o=[]),N=0,b=$.length;N<b;N++)l=$[N],DEBUG&&console.log("    --\x3e cycle through "+l);for(L=0,y=U.length;L<y;L++)l=U[L],DEBUG&&console.log("    "+l),Y+=l+", ";for(Y+="; ",k=0,E=o.length;k<E;k++)Y+=" "+(l=o[k])+", ";for(DEBUG&&console.log("  code generation:"+_+" is: "+get_binding(usr_symbol(_)).toString()),push(get_binding(usr_symbol(_))),B=[],q=[],G=0,v=U.length;G<v;G++)"'"===(p=U[G])[0]&&(t=p.substring(1),R=usr_symbol(t),I=usr_symbol("AVOID_BINDING_TO_EXTERNAL_SCOPE_VALUE"+t),B.push(R),q.push(I),push(R),push(I),subst(),DEBUG&&console.log("after substitution: "+stack[tos-1]));try{simplifyForCodeGeneration()}catch(r){i=r,PRINTOUTRESULT&&console.log(i),errorMessage=i+"",init()}for(c=F=0,P=B.length;0<=P?F<P:F>P;c=0<=P?++F:--F)push(q[c]),push(B[c]),subst();if(clearRenamedVariablesToAvoidBindingToExternalScope(),""===errorMessage){if(W=pop(),collectUserSymbols(W,V=[]),"","",codeGen=!0,a=W.toString(),codeGen=!1,S=printMode,printMode=PRINTMODE_LATEX,s=W.toString(),printMode=S,-1!==$.indexOf(_))u+="// "+_+" is part of a cyclic dependency, no code generated.",D+="#"+_+" is part of a cyclic dependency, no code generated.";else if(0!==(V=(V=V.filter(function(r){return-1===predefinedSymbolsInGlobalScope_doNotTrackInDependencies.indexOf(r+"")})).filter(function(r){return-1!==U.indexOf(r+"")||-1!==U.indexOf("'"+r)})).length){for(M="(",z=0,x=V.length;z<x;z++)(l=V[z]).printname!==_&&(M+=l.printname+", ");M=M.replace(/, $/gm,""),u+=_+" = function "+(M+=")")+" { return ( "+a+" ); }",D+=_+M+" = "+s}else u+=_+" = "+a+";",D+=_+" = "+s;u+="\n",D+="\n",DEBUG&&console.log("    "+u)}}}return u=u.replace(/\n$/gm,""),D=D.replace(/\n$/gm,""),symbolsDependencies={},symbolsHavingReassignments=[],patternHasBeenFound=!1,symbolsInExpressionsWithoutAssignments=[],DEBUG&&console.log("testable string: "+Y),TIMING_DEBUGS&&console.log("findDependenciesInScript time for: "+C+" : "+((new Date).getTime()-X)+"ms"),[Y,w[0],u,D,w[1],errorMessage,n]},recursiveDependencies=function(r,e,s,o,t,n){var p,i,a,u,l,c,d,_;if(s.push(r),null!=symbolsDependencies[t[t.length-1]]&&-1!==symbolsDependencies[t[t.length-1]].indexOf("'"+r))return DEBUG&&console.log("can't keep following the chain of "+r+" because it's actually a variable bound to a parameter"),-1===e.indexOf("'"+r)&&-1===e.indexOf(r)&&e.push(r),e;if(t.push(r),null==symbolsDependencies[r])return-1===e.indexOf(r)&&e.push(r),e;for(u=0,l=(_=symbolsDependencies[r]).length;u<l;u++)if(i=_[u],-1!==t.indexOf(i)){for(DEBUG&&console.log("  found cycle:"),p="",d=0,c=t.length;d<c;d++)a=t[d],-1===o.indexOf(a)&&o.push(a),DEBUG&&console.log(a+" --\x3e "),p+=a+" --\x3e ";DEBUG&&console.log(" ... then "+i+" again"),p+=" ... then "+i+" again",n.push(p),-1===o.indexOf(i)&&o.push(i)}else recursiveDependencies(i,e,s,o,t,n),t.pop();return e},inited=!1,latexErrorSign="\\rlap{\\large\\color{red}\\bigtriangleup}{\\ \\ \\tiny\\color{red}!}",turnErrorMessageToLatex=function(r){return r="$$\\text{"+(r=(r=(r=(r=(r=(r=(r=r.replace(/\n/g,"")).replace(/_/g,"} \\_ \\text{")).replace(new RegExp(String.fromCharCode(transpose_unicode),"g"),"}{}^{T}\\text{")).replace(new RegExp(String.fromCharCode(dotprod_unicode),"g"),"}\\cdot \\text{")).replace("Stop:","}  \\quad \\text{Stop:")).replace("->","}  \\rightarrow \\text{")).replace("?","}\\enspace "+latexErrorSign+" \\enspace  \\text{")).replace(/\n/g,"")+"}$$"},normaliseDots=function(r){return r=(r=(r=(r=(r=r.replace(new RegExp(String.fromCharCode(8901),"g"),String.fromCharCode(dotprod_unicode))).replace(new RegExp(String.fromCharCode(8226),"g"),String.fromCharCode(dotprod_unicode))).replace(new RegExp(String.fromCharCode(12539),"g"),String.fromCharCode(dotprod_unicode))).replace(new RegExp(String.fromCharCode(55296),"g"),String.fromCharCode(dotprod_unicode))).replace(new RegExp(String.fromCharCode(65381),"g"),String.fromCharCode(dotprod_unicode))},TIMING_DEBUGS=!1,run=function(r,e=!1){var s,o,t,n,p,i,a,u,l,c;if(l=(new Date).getTime(),"selftest"!==(r=normaliseDots(r))){for(inited||(inited=!0,init()),0,a=0,i=0,o="",s="";;){try{errorMessage="",check_stack(),a=scan(r.substring(i)),p1=pop(),check_stack()}catch(r){p=r,PRINTOUTRESULT&&console.log(p),o+=p.message,e&&(s+=turnErrorMessageToLatex(p.message)),reset_after_error();break}if(0===a)break;i+=a,push(p1),!1;try{stringsEmittedByUserPrintouts="",top_level_eval(),p2=pop(),check_stack(),isstr(p2)&&(DEBUG&&console.log(p2.str),DEBUG&&console.log("\n")),p2===symbol(NIL)?(n=stringsEmittedByUserPrintouts,e&&(t="$$"+stringsEmittedByUserPrintouts+"$$")):(n=print_expr(p2),n+="\n",e&&(t="$$"+collectLatexStringFromReturnValue(p2)+"$$",DEBUG&&console.log("collectedLatexResult: "+t))),o+=n,e&&(s+=t),PRINTOUTRESULT&&(DEBUG&&console.log("printline"),DEBUG&&console.log(n)),PRINTOUTRESULT&&(DEBUG&&console.log("display:"),print2dascii(p2)),e&&(s+="\n")}catch(r){!0,n=(p=r).message,e&&(t=turnErrorMessageToLatex(p.message)),PRINTOUTRESULT&&console.log(n),o+=n,""!==n&&(o+="\n"),e&&(s+=t,s+="\n"),init()}}return"\n"===o[o.length-1]&&(o=o.substring(0,o.length-1)),e&&"\n"===s[s.length-1]&&(s=s.substring(0,s.length-1)),e?(DEBUG&&console.log("allReturnedLatexStrings: "+s),u=[o,s]):u=o,TIMING_DEBUGS&&(c="run time on: "+r+" : "+((new Date).getTime()-l)+"ms",console.log(c)),o="",s="",u}selftest()},check_stack=function(){if(0!==tos&&stop("stack error"),frame!==TOS&&stop("frame error"),0!==chainOfUserSymbolsNotFunctionsBeingEvaluated.length&&stop("symbols evaluation still ongoing?"),0!==evaluatingAsFloats&&stop("numeric evaluation still ongoing?"),0!==evaluatingPolar)return stop("evaluation of polar still ongoing?")},top_level_eval=function(){var r,e,s;if(DEBUG&&console.log("#### top level eval"),trigmode=0,s=symbol(AUTOEXPAND),expanding=isZeroAtomOrTensor(get_binding(s))?0:1,e=top(),Eval(),(r=top())!==symbol(NIL))if(set_binding(symbol(LAST),r),isZeroAtomOrTensor(get_binding(symbol(BAKE)))||(bake(),r=top()),e!==symbol(SYMBOL_I)&&e!==symbol(SYMBOL_J)||!isimaginaryunit(r)){if(isimaginaryunit(get_binding(symbol(SYMBOL_J))))return push(imaginaryunit),push_symbol(SYMBOL_J),subst();if(isimaginaryunit(get_binding(symbol(SYMBOL_I))))return push(imaginaryunit),push_symbol(SYMBOL_I),subst()}else;},check_esc_flag=function(){if(esc_flag)return stop("esc key")},clearAlgebraEnvironment=function(){return do_clearall()},computeDependenciesFromAlgebra=function(r){var e,s,o;if(DEBUG&&console.log("computeDependenciesFromAlgebra!!!"),r,!0,called_from_Algebra_block=!0,r=normaliseDots(r),DEBUG){for(console.log("computeDependenciesFromAlgebra: patterns in the list --------------- "),o=0,s=userSimplificationsInListForm.length;o<s;o++)e=userSimplificationsInListForm[o],console.log(car(e)+","+cdr(e)+")");console.log("...end of list --------------- ")}return called_from_Algebra_block=!1,findDependenciesInScript(r,!0)[6]},computeResultsAndJavaScriptFromAlgebra=function(r){var e,s,o,t,n,p,i,a,u,l,c;if(r,!0,called_from_Algebra_block=!0,c=(new Date).getTime(),TIMING_DEBUGS&&console.log(" --------- computeResultsAndJavaScriptFromAlgebra input: "+r+" at: "+new Date),u=r=normaliseDots(r),DEBUG){for(console.log("computeResultsAndJavaScriptFromAlgebra: patterns in the list --------------- "),t=0,p=userSimplificationsInListForm.length;t<p;t++)o=userSimplificationsInListForm[t],console.log(car(o)+","+cdr(o)+")");console.log("...end of list --------------- ")}return[l,a,e,i,n,errorMessage,s]=findDependenciesInScript(r),called_from_Algebra_block=!1,""===i&&""===errorMessage||(a+="\n"+i,""!==errorMessage&&(a+="\n"+errorMessage),a=a.replace(/\n/g,"\n\n"),n+="\n$$"+i+"$$",""!==errorMessage&&(n+=turnErrorMessageToLatex(errorMessage)),n=n.replace(/\n/g,"\n\n")),n=(n=n.replace(/\n*/,"")).replace(/\$\$\$\$\n*/g,""),e=(e=e.replace(/Math\./g,"")).replace(/\n/g,"\n\n"),TIMING_DEBUGS&&console.log("computeResultsAndJavaScriptFromAlgebra time (total time from notebook and back) for: "+u+" : "+((new Date).getTime()-c)+"ms"),{code:e,result:n,latexResult:n,dependencyInfo:s}},("undefined"!=typeof exports&&null!==exports?exports:this).run=run,("undefined"!=typeof exports&&null!==exports?exports:this).findDependenciesInScript=findDependenciesInScript,("undefined"!=typeof exports&&null!==exports?exports:this).computeDependenciesFromAlgebra=computeDependenciesFromAlgebra,("undefined"!=typeof exports&&null!==exports?exports:this).computeResultsAndJavaScriptFromAlgebra=computeResultsAndJavaScriptFromAlgebra,("undefined"!=typeof exports&&null!==exports?exports:this).clearAlgebraEnvironment=clearAlgebraEnvironment,tos=0,nil_symbols=0,push=function(r){return r.isZero,r===symbol(NIL)&&(nil_symbols++,DEBUG&&console.log("pushing symbol(NIL) #"+nil_symbols)),tos>=frame&&stop("stack overflow"),stack[tos++]=r},moveTos=function(r){if(tos<=r)tos=r;else for(;tos>r;)stack[tos]=null,tos--},top=function(){return stack[tos-1]},pop=function(){var r;return 0===tos&&stop("stack underflow"),stack[tos-1],r=stack[--tos],stack[tos]=null,r},push_frame=function(r){var e,s,o,t;for(e=0,(frame-=r)<tos&&stop("frame overflow, circular reference?"),t=[],e=s=0,o=r;0<=o?s<o:s>o;e=0<=o?++s:--s)t.push(stack[frame+e]=symbol(NIL));return t},pop_frame=function(r){if((frame+=r)>TOS)return stop("frame underflow")},save=function(){return(frame-=10)<tos&&stop("frame overflow, circular reference?"),stack[frame+0]=p0,stack[frame+1]=p1,stack[frame+2]=p2,stack[frame+3]=p3,stack[frame+4]=p4,stack[frame+5]=p5,stack[frame+6]=p6,stack[frame+7]=p7,stack[frame+8]=p8,stack[frame+9]=p9},restore=function(){return frame>TOS-10&&stop("frame underflow"),p0=stack[frame+0],p1=stack[frame+1],p2=stack[frame+2],p3=stack[frame+3],p4=stack[frame+4],p5=stack[frame+5],p6=stack[frame+6],p7=stack[frame+7],p8=stack[frame+8],p9=stack[frame+9],frame+=10},swap=function(){var r,e;return r=pop(),e=pop(),push(r),push(e)},dupl=function(){var r;return r=pop(),push(r),push(r)},$.dupl=dupl,$.swap=swap,$.restore=restore,$.save=save,$.push=push,$.pop=pop,Eval_symbolsinfo=function(){var r;return""!==(r=symbolsinfo())?new_string(r):push_symbol(NIL)},symbolsinfo=function(){var r,e,s,o,t,n,p;for(n="",e=s=o=NIL+1,t=symtab.length;o<=t?s<t:s>t;e=o<=t?++s:--s)if(""!==symtab[e].printname)p=symtab[e]+"",r=(binding[e]+"").substring(0,4),n+="symbol: "+p+" size: "+countsize(binding[e])+" value: "+r+"...\n";else if(!1===isSymbolReclaimable[e])break;return n},std_symbol=function(r,e,s){var o;return(o=symtab[e]).printname=r,o.latexPrint=null!=s?s:r},usr_symbol=function(r){var e,s,o;for(e=0,e=s=0,o=NSYM;0<=o?s<o:s>o;e=0<=o?++s:--s){if(r===symtab[e].printname)return symtab[e];if(""===symtab[e].printname)break}return e===NSYM&&stop("symbol table overflow"),symtab[e]=new U,symtab[e].k=SYM,symtab[e].printname=r,binding[e]=symtab[e],isSymbolReclaimable[e]=!1,symtab[e]},get_printname=function(r){return r.k!==SYM&&stop("symbol error"),r.printname},set_binding=function(r,e){var s;return r.k!==SYM&&stop("symbol error"),s=symtab.indexOf(r),-1!==symtab.indexOf(r,s+1)&&console.log("ops, more than one element!"),DEBUG&&console.log("lookup >> set_binding lookup "+s),isSymbolReclaimable[s]=!1,binding[s]=e},get_binding=function(r){var e;return r.k!==SYM&&stop("symbol error"),e=symtab.indexOf(r),-1!==symtab.indexOf(r,e+1)&&console.log("ops, more than one element!"),DEBUG&&console.log("lookup >> get_binding lookup "+e),binding[e]},is_usr_symbol=function(r){var e;return r.k===SYM&&((e=symnum(r))>PI&&e!==SYMBOL_I&&e!==SYMBOL_IDENTITY_MATRIX)},lookupsTotal=0,symnum=function(r){var e;return lookupsTotal++,r.k!==SYM&&stop("symbol error"),e=symtab.indexOf(r),-1!==symtab.indexOf(r,e+1)&&console.log("ops, more than one element!"),DEBUG&&console.log("lookup >> symnum lookup "+e+" lookup # "+lookupsTotal),e},push_symbol=function(r){return push(symtab[r])},clear_symbols=function(){var r,e,s,o,t;for(t=[],r=e=s=NIL+1,o=NSYM;s<=o?e<o:e>o;r=s<=o?++e:--e)if(""!==symtab[r].printname)symtab[r]=new U,symtab[r].k=SYM,binding[r]=symtab[r],t.push(isSymbolReclaimable[r]=!1);else if(!1===isSymbolReclaimable[r])break;return t},collectUserSymbols=function(r,e=[]){var s,o,t;if(is_usr_symbol(r)&&-1===e.indexOf(r))e.push(r);else if(istensor(r))for(s=o=0,t=r.tensor.nelem;0<=t?o<t:o>t;s=0<=t?++o:--o)collectUserSymbols(r.tensor.elem[s],e);else for(;iscons(r);)collectUserSymbols(car(r),e),r=cdr(r)},$.get_binding=get_binding,$.set_binding=set_binding,$.usr_symbol=usr_symbol,$.symbolsinfo=symbolsinfo,$.collectUserSymbols=collectUserSymbols,inited||(inited=!0,init()),$.init=init,parse_internal=function(r){return"string"==typeof r?scan(r):"number"==typeof r?r%1==0?push_integer(r):push_double(r):r instanceof U?push(r):(console.warn("unknown argument type",r),push(symbol(NIL)))},parse=function(r){var e,s;try{parse_internal(r),e=pop(),check_stack()}catch(r){throw s=r,reset_after_error(),s}return e},exec=function(r,...e){var s,o,t,n,p,i;for(t=get_binding(usr_symbol(r)),check_stack(),push(t),n=0,p=e.length;n<p;n++)s=e[n],parse_internal(s);list(1+e.length),p1=pop(),push(p1);try{top_level_eval(),i=pop(),check_stack()}catch(r){throw o=r,reset_after_error(),o}return i},$.exec=exec,$.parse=parse,function(){var r,e,s,o,t;for(t=[],s=0,o=(r=["abs","add","adj","and","approxratio","arccos","arccosh","arcsin","arcsinh","arctan","arctanh","arg","atomize","besselj","bessely","binding","binomial","ceiling","check","choose","circexp","clear","clearall","clearpatterns","clock","coeff","cofactor","condense","conj","contract","cos","cosh","decomp","defint","deg","denominator","det","derivative","dim","dirac","divisors","do","dot","draw","dsolve","eigen","eigenval","eigenvec","erf","erfc","eval","exp","expand","expcos","expsin","factor","factorial","factorpoly","filter","float","floor","for","Gamma","gcd","hermite","hilbert","imag","component","inner","integral","inv","invg","isinteger","isprime","laguerre","lcm","leading","legendre","log","mod","multiply","not","nroots","number","numerator","operator","or","outer","pattern","patternsinfo","polar","power","prime","print","print2dascii","printcomputer","printlatex","printlist","printhuman","product","quote","quotient","rank","rationalize","real","rect","roots","round","equals","shape","sgn","silentpattern","simplify","sin","sinh","sqrt","stop","subst","sum","symbolsinfo","tan","tanh","taylor","test","testeq","testge","testgt","testle","testlt","transpose","unit","zero"]).length;s<o;s++)e=r[s],t.push($[e]=exec.bind(this,e))}(),freeze=function(){var r,e,s,o,t;for(e=[],r=[],[],"",s=o=0,t=symtab.length;0<=t?o<t:o>t;s=0<=t?++o:--o)!1===isSymbolReclaimable[s]&&(e.push(symtab[s]),r.push(binding[s]));return[e,r,userSimplificationsInListForm.slice(0),zero,one,imaginaryunit,getStateHash()]},unfreeze=function(r){var e,s,o,t,n,p;for([o,e,s,zero,one,imaginaryunit]=r,t=n=0,p=o.length;0<=p?n<p:n>p;t=0<=p?++n:--n)symtab[t]=o[t],binding[t]=e[t];return userSimplificationsInListForm=s.slice(0)},compareState=function(r){return getStateHash()===r},getStateHash=function(){var r,e,s,o,t,n,p;for(r="",e=s=n=NIL+1,p=symtab.length;n<=p?s<p:s>p;e=n<=p?++s:--s)if(""!==symtab[e].printname)r+=" //"+print_list(symtab[e])+" : "+print_list(binding[e]);else if(!1===isSymbolReclaimable[e])break;for(t=0,o=userSimplificationsInListForm.length;t<o;t++)r+=" pattern: "+(e=userSimplificationsInListForm[t]);return DEBUG&&console.log("frozenHash: "+r),r}}).call(this);

},{"big-integer":3}],3:[function(require,module,exports){
<<<<<<< HEAD
var bigInt=function(t){"use strict";var e=1e7,r=7,o=9007199254740992,n=v(o),i="0123456789abcdefghijklmnopqrstuvwxyz",u="function"==typeof BigInt;function p(t,e,r,o){return void 0===t?p[0]:void 0!==e&&(10!=+e||r)?_(t,e,r,o):K(t)}function a(t,e){this.value=t,this.sign=e,this.isSmall=!1}function s(t){this.value=t,this.sign=t<0,this.isSmall=!0}function l(t){this.value=t}function f(t){return-o<t&&t<o}function v(t){return t<1e7?[t]:t<1e14?[t%1e7,Math.floor(t/1e7)]:[t%1e7,Math.floor(t/1e7)%1e7,Math.floor(t/1e14)]}function h(t){y(t);var r=t.length;if(r<4&&A(t,n)<0)switch(r){case 0:return 0;case 1:return t[0];case 2:return t[0]+t[1]*e;default:return t[0]+(t[1]+t[2]*e)*e}return t}function y(t){for(var e=t.length;0===t[--e];);t.length=e+1}function g(t){for(var e=new Array(t),r=-1;++r<t;)e[r]=0;return e}function c(t){return t>0?Math.floor(t):Math.ceil(t)}function m(t,r){var o,n,i=t.length,u=r.length,p=new Array(i),a=0,s=e;for(n=0;n<u;n++)a=(o=t[n]+r[n]+a)>=s?1:0,p[n]=o-a*s;for(;n<i;)a=(o=t[n]+a)===s?1:0,p[n++]=o-a*s;return a>0&&p.push(a),p}function d(t,e){return t.length>=e.length?m(t,e):m(e,t)}function b(t,r){var o,n,i=t.length,u=new Array(i),p=e;for(n=0;n<i;n++)o=t[n]-p+r,r=Math.floor(o/p),u[n]=o-r*p,r+=1;for(;r>0;)u[n++]=r%p,r=Math.floor(r/p);return u}function w(t,r){var o,n,i=t.length,u=r.length,p=new Array(i),a=0,s=e;for(o=0;o<u;o++)(n=t[o]-a-r[o])<0?(n+=s,a=1):a=0,p[o]=n;for(o=u;o<i;o++){if(!((n=t[o]-a)<0)){p[o++]=n;break}n+=s,p[o]=n}for(;o<i;o++)p[o]=t[o];return y(p),p}function S(t,r,o){var n,i,u=t.length,p=new Array(u),l=-r,f=e;for(n=0;n<u;n++)i=t[n]+l,l=Math.floor(i/f),i%=f,p[n]=i<0?i+f:i;return"number"==typeof(p=h(p))?(o&&(p=-p),new s(p)):new a(p,o)}function I(t,r){var o,n,i,u,p=t.length,a=r.length,s=g(p+a),l=e;for(i=0;i<p;++i){u=t[i];for(var f=0;f<a;++f)o=u*r[f]+s[i+f],n=Math.floor(o/l),s[i+f]=o-n*l,s[i+f+1]+=n}return y(s),s}function q(t,r){var o,n,i=t.length,u=new Array(i),p=e,a=0;for(n=0;n<i;n++)o=t[n]*r+a,a=Math.floor(o/p),u[n]=o-a*p;for(;a>0;)u[n++]=a%p,a=Math.floor(a/p);return u}function M(t,e){for(var r=[];e-- >0;)r.push(0);return r.concat(t)}function N(t,r,o){return new a(t<e?q(r,t):I(r,v(t)),o)}function E(t){var r,o,n,i,u=t.length,p=g(u+u),a=e;for(n=0;n<u;n++){o=0-(i=t[n])*i;for(var s=n;s<u;s++)r=i*t[s]*2+p[n+s]+o,o=Math.floor(r/a),p[n+s]=r-o*a;p[n+u]=o}return y(p),p}function O(t,r){var o,n,i,u,p=t.length,a=g(p),s=e;for(i=0,o=p-1;o>=0;--o)i=(u=i*s+t[o])-(n=c(u/r))*r,a[o]=0|n;return[a,0|i]}function B(t,r){var o,n=K(r);if(u)return[new l(t.value/n.value),new l(t.value%n.value)];var i,f=t.value,m=n.value;if(0===m)throw new Error("Cannot divide by zero");if(t.isSmall)return n.isSmall?[new s(c(f/m)),new s(f%m)]:[p[0],t];if(n.isSmall){if(1===m)return[t,p[0]];if(-1==m)return[t.negate(),p[0]];var d=Math.abs(m);if(d<e){i=h((o=O(f,d))[0]);var b=o[1];return t.sign&&(b=-b),"number"==typeof i?(t.sign!==n.sign&&(i=-i),[new s(i),new s(b)]):[new a(i,t.sign!==n.sign),new s(b)]}m=v(d)}var S=A(f,m);if(-1===S)return[p[0],t];if(0===S)return[p[t.sign===n.sign?1:-1],p[0]];i=(o=f.length+m.length<=200?function(t,r){var o,n,i,u,p,a,s,l=t.length,f=r.length,v=e,y=g(r.length),c=r[f-1],m=Math.ceil(v/(2*c)),d=q(t,m),b=q(r,m);for(d.length<=l&&d.push(0),b.push(0),c=b[f-1],n=l-f;n>=0;n--){for(o=v-1,d[n+f]!==c&&(o=Math.floor((d[n+f]*v+d[n+f-1])/c)),i=0,u=0,a=b.length,p=0;p<a;p++)i+=o*b[p],s=Math.floor(i/v),u+=d[n+p]-(i-s*v),i=s,u<0?(d[n+p]=u+v,u=-1):(d[n+p]=u,u=0);for(;0!==u;){for(o-=1,i=0,p=0;p<a;p++)(i+=d[n+p]-v+b[p])<0?(d[n+p]=i+v,i=0):(d[n+p]=i,i=1);u+=i}y[n]=o}return d=O(d,m)[0],[h(y),h(d)]}(f,m):function(t,r){for(var o,n,i,u,p,a=t.length,s=r.length,l=[],f=[],v=e;a;)if(f.unshift(t[--a]),y(f),A(f,r)<0)l.push(0);else{i=f[(n=f.length)-1]*v+f[n-2],u=r[s-1]*v+r[s-2],n>s&&(i=(i+1)*v),o=Math.ceil(i/u);do{if(A(p=q(r,o),f)<=0)break;o--}while(o);l.push(o),f=w(f,p)}return l.reverse(),[h(l),h(f)]}(f,m))[0];var I=t.sign!==n.sign,M=o[1],N=t.sign;return"number"==typeof i?(I&&(i=-i),i=new s(i)):i=new a(i,I),"number"==typeof M?(N&&(M=-M),M=new s(M)):M=new a(M,N),[i,M]}function A(t,e){if(t.length!==e.length)return t.length>e.length?1:-1;for(var r=t.length-1;r>=0;r--)if(t[r]!==e[r])return t[r]>e[r]?1:-1;return 0}function P(t){var e=t.abs();return!e.isUnit()&&(!!(e.equals(2)||e.equals(3)||e.equals(5))||!(e.isEven()||e.isDivisibleBy(3)||e.isDivisibleBy(5))&&(!!e.lesser(49)||void 0))}function Z(t,e){for(var r,o,n,i=t.prev(),u=i,p=0;u.isEven();)u=u.divide(2),p++;t:for(o=0;o<e.length;o++)if(!t.lesser(e[o])&&!(n=bigInt(e[o]).modPow(u,t)).isUnit()&&!n.equals(i)){for(r=p-1;0!=r;r--){if((n=n.square().mod(t)).isUnit())return!1;if(n.equals(i))continue t}return!1}return!0}a.prototype=Object.create(p.prototype),s.prototype=Object.create(p.prototype),l.prototype=Object.create(p.prototype),a.prototype.add=function(t){var e=K(t);if(this.sign!==e.sign)return this.subtract(e.negate());var r=this.value,o=e.value;return e.isSmall?new a(b(r,Math.abs(o)),this.sign):new a(d(r,o),this.sign)},a.prototype.plus=a.prototype.add,s.prototype.add=function(t){var e=K(t),r=this.value;if(r<0!==e.sign)return this.subtract(e.negate());var o=e.value;if(e.isSmall){if(f(r+o))return new s(r+o);o=v(Math.abs(o))}return new a(b(o,Math.abs(r)),r<0)},s.prototype.plus=s.prototype.add,l.prototype.add=function(t){return new l(this.value+K(t).value)},l.prototype.plus=l.prototype.add,a.prototype.subtract=function(t){var e=K(t);if(this.sign!==e.sign)return this.add(e.negate());var r=this.value,o=e.value;return e.isSmall?S(r,Math.abs(o),this.sign):function(t,e,r){var o;return A(t,e)>=0?o=w(t,e):(o=w(e,t),r=!r),"number"==typeof(o=h(o))?(r&&(o=-o),new s(o)):new a(o,r)}(r,o,this.sign)},a.prototype.minus=a.prototype.subtract,s.prototype.subtract=function(t){var e=K(t),r=this.value;if(r<0!==e.sign)return this.add(e.negate());var o=e.value;return e.isSmall?new s(r-o):S(o,Math.abs(r),r>=0)},s.prototype.minus=s.prototype.subtract,l.prototype.subtract=function(t){return new l(this.value-K(t).value)},l.prototype.minus=l.prototype.subtract,a.prototype.negate=function(){return new a(this.value,!this.sign)},s.prototype.negate=function(){var t=this.sign,e=new s(-this.value);return e.sign=!t,e},l.prototype.negate=function(){return new l(-this.value)},a.prototype.abs=function(){return new a(this.value,!1)},s.prototype.abs=function(){return new s(Math.abs(this.value))},l.prototype.abs=function(){return new l(this.value>=0?this.value:-this.value)},a.prototype.multiply=function(t){var r,o,n,i=K(t),u=this.value,s=i.value,l=this.sign!==i.sign;if(i.isSmall){if(0===s)return p[0];if(1===s)return this;if(-1===s)return this.negate();if((r=Math.abs(s))<e)return new a(q(u,r),l);s=v(r)}return o=u.length,n=s.length,new a(-.012*o-.012*n+15e-6*o*n>0?function t(e,r){var o=Math.max(e.length,r.length);if(o<=30)return I(e,r);o=Math.ceil(o/2);var n=e.slice(o),i=e.slice(0,o),u=r.slice(o),p=r.slice(0,o),a=t(i,p),s=t(n,u),l=d(d(a,M(w(w(t(d(i,n),d(p,u)),a),s),o)),M(s,2*o));return y(l),l}(u,s):I(u,s),l)},a.prototype.times=a.prototype.multiply,s.prototype._multiplyBySmall=function(t){return f(t.value*this.value)?new s(t.value*this.value):N(Math.abs(t.value),v(Math.abs(this.value)),this.sign!==t.sign)},a.prototype._multiplyBySmall=function(t){return 0===t.value?p[0]:1===t.value?this:-1===t.value?this.negate():N(Math.abs(t.value),this.value,this.sign!==t.sign)},s.prototype.multiply=function(t){return K(t)._multiplyBySmall(this)},s.prototype.times=s.prototype.multiply,l.prototype.multiply=function(t){return new l(this.value*K(t).value)},l.prototype.times=l.prototype.multiply,a.prototype.square=function(){return new a(E(this.value),!1)},s.prototype.square=function(){var t=this.value*this.value;return f(t)?new s(t):new a(E(v(Math.abs(this.value))),!1)},l.prototype.square=function(t){return new l(this.value*this.value)},a.prototype.divmod=function(t){var e=B(this,t);return{quotient:e[0],remainder:e[1]}},l.prototype.divmod=s.prototype.divmod=a.prototype.divmod,a.prototype.divide=function(t){return B(this,t)[0]},l.prototype.over=l.prototype.divide=function(t){return new l(this.value/K(t).value)},s.prototype.over=s.prototype.divide=a.prototype.over=a.prototype.divide,a.prototype.mod=function(t){return B(this,t)[1]},l.prototype.mod=l.prototype.remainder=function(t){return new l(this.value%K(t).value)},s.prototype.remainder=s.prototype.mod=a.prototype.remainder=a.prototype.mod,a.prototype.pow=function(t){var e,r,o,n=K(t),i=this.value,u=n.value;if(0===u)return p[1];if(0===i)return p[0];if(1===i)return p[1];if(-1===i)return n.isEven()?p[1]:p[-1];if(n.sign)return p[0];if(!n.isSmall)throw new Error("The exponent "+n.toString()+" is too large.");if(this.isSmall&&f(e=Math.pow(i,u)))return new s(c(e));for(r=this,o=p[1];!0&u&&(o=o.times(r),--u),0!==u;)u/=2,r=r.square();return o},s.prototype.pow=a.prototype.pow,l.prototype.pow=function(t){var e=K(t),r=this.value,o=e.value,n=BigInt(0),i=BigInt(1),u=BigInt(2);if(o===n)return p[1];if(r===n)return p[0];if(r===i)return p[1];if(r===BigInt(-1))return e.isEven()?p[1]:p[-1];if(e.isNegative())return new l(n);for(var a=this,s=p[1];(o&i)===i&&(s=s.times(a),--o),o!==n;)o/=u,a=a.square();return s},a.prototype.modPow=function(t,e){if(t=K(t),(e=K(e)).isZero())throw new Error("Cannot take modPow with modulus 0");for(var r=p[1],o=this.mod(e);t.isPositive();){if(o.isZero())return p[0];t.isOdd()&&(r=r.multiply(o).mod(e)),t=t.divide(2),o=o.square().mod(e)}return r},l.prototype.modPow=s.prototype.modPow=a.prototype.modPow,a.prototype.compareAbs=function(t){var e=K(t),r=this.value,o=e.value;return e.isSmall?1:A(r,o)},s.prototype.compareAbs=function(t){var e=K(t),r=Math.abs(this.value),o=e.value;return e.isSmall?r===(o=Math.abs(o))?0:r>o?1:-1:-1},l.prototype.compareAbs=function(t){var e=this.value,r=K(t).value;return(e=e>=0?e:-e)===(r=r>=0?r:-r)?0:e>r?1:-1},a.prototype.compare=function(t){if(t===1/0)return-1;if(t===-1/0)return 1;var e=K(t),r=this.value,o=e.value;return this.sign!==e.sign?e.sign?1:-1:e.isSmall?this.sign?-1:1:A(r,o)*(this.sign?-1:1)},a.prototype.compareTo=a.prototype.compare,s.prototype.compare=function(t){if(t===1/0)return-1;if(t===-1/0)return 1;var e=K(t),r=this.value,o=e.value;return e.isSmall?r==o?0:r>o?1:-1:r<0!==e.sign?r<0?-1:1:r<0?1:-1},s.prototype.compareTo=s.prototype.compare,l.prototype.compare=function(t){if(t===1/0)return-1;if(t===-1/0)return 1;var e=this.value,r=K(t).value;return e===r?0:e>r?1:-1},l.prototype.compareTo=l.prototype.compare,a.prototype.equals=function(t){return 0===this.compare(t)},l.prototype.eq=l.prototype.equals=s.prototype.eq=s.prototype.equals=a.prototype.eq=a.prototype.equals,a.prototype.notEquals=function(t){return 0!==this.compare(t)},l.prototype.neq=l.prototype.notEquals=s.prototype.neq=s.prototype.notEquals=a.prototype.neq=a.prototype.notEquals,a.prototype.greater=function(t){return this.compare(t)>0},l.prototype.gt=l.prototype.greater=s.prototype.gt=s.prototype.greater=a.prototype.gt=a.prototype.greater,a.prototype.lesser=function(t){return this.compare(t)<0},l.prototype.lt=l.prototype.lesser=s.prototype.lt=s.prototype.lesser=a.prototype.lt=a.prototype.lesser,a.prototype.greaterOrEquals=function(t){return this.compare(t)>=0},l.prototype.geq=l.prototype.greaterOrEquals=s.prototype.geq=s.prototype.greaterOrEquals=a.prototype.geq=a.prototype.greaterOrEquals,a.prototype.lesserOrEquals=function(t){return this.compare(t)<=0},l.prototype.leq=l.prototype.lesserOrEquals=s.prototype.leq=s.prototype.lesserOrEquals=a.prototype.leq=a.prototype.lesserOrEquals,a.prototype.isEven=function(){return 0==(1&this.value[0])},s.prototype.isEven=function(){return 0==(1&this.value)},l.prototype.isEven=function(){return(this.value&BigInt(1))===BigInt(0)},a.prototype.isOdd=function(){return 1==(1&this.value[0])},s.prototype.isOdd=function(){return 1==(1&this.value)},l.prototype.isOdd=function(){return(this.value&BigInt(1))===BigInt(1)},a.prototype.isPositive=function(){return!this.sign},s.prototype.isPositive=function(){return this.value>0},l.prototype.isPositive=s.prototype.isPositive,a.prototype.isNegative=function(){return this.sign},s.prototype.isNegative=function(){return this.value<0},l.prototype.isNegative=s.prototype.isNegative,a.prototype.isUnit=function(){return!1},s.prototype.isUnit=function(){return 1===Math.abs(this.value)},l.prototype.isUnit=function(){return this.abs().value===BigInt(1)},a.prototype.isZero=function(){return!1},s.prototype.isZero=function(){return 0===this.value},l.prototype.isZero=function(){return this.value===BigInt(0)},a.prototype.isDivisibleBy=function(t){var e=K(t);return!e.isZero()&&(!!e.isUnit()||(0===e.compareAbs(2)?this.isEven():this.mod(e).isZero()))},l.prototype.isDivisibleBy=s.prototype.isDivisibleBy=a.prototype.isDivisibleBy,a.prototype.isPrime=function(t){var e=P(this);if(void 0!==e)return e;var r=this.abs(),o=r.bitLength();if(o<=64)return Z(r,[2,3,5,7,11,13,17,19,23,29,31,37]);for(var n=Math.log(2)*o.toJSNumber(),i=Math.ceil(!0===t?2*Math.pow(n,2):n),u=[],p=0;p<i;p++)u.push(bigInt(p+2));return Z(r,u)},l.prototype.isPrime=s.prototype.isPrime=a.prototype.isPrime,a.prototype.isProbablePrime=function(t){var e=P(this);if(void 0!==e)return e;for(var r=this.abs(),o=void 0===t?5:t,n=[],i=0;i<o;i++)n.push(bigInt.randBetween(2,r.minus(2)));return Z(r,n)},l.prototype.isProbablePrime=s.prototype.isProbablePrime=a.prototype.isProbablePrime,a.prototype.modInv=function(t){for(var e,r,o,n=bigInt.zero,i=bigInt.one,u=K(t),p=this.abs();!p.isZero();)e=u.divide(p),r=n,o=u,n=i,u=p,i=r.subtract(e.multiply(i)),p=o.subtract(e.multiply(p));if(!u.isUnit())throw new Error(this.toString()+" and "+t.toString()+" are not co-prime");return-1===n.compare(0)&&(n=n.add(t)),this.isNegative()?n.negate():n},l.prototype.modInv=s.prototype.modInv=a.prototype.modInv,a.prototype.next=function(){var t=this.value;return this.sign?S(t,1,this.sign):new a(b(t,1),this.sign)},s.prototype.next=function(){var t=this.value;return t+1<o?new s(t+1):new a(n,!1)},l.prototype.next=function(){return new l(this.value+BigInt(1))},a.prototype.prev=function(){var t=this.value;return this.sign?new a(b(t,1),!0):S(t,1,this.sign)},s.prototype.prev=function(){var t=this.value;return t-1>-o?new s(t-1):new a(n,!0)},l.prototype.prev=function(){return new l(this.value-BigInt(1))};for(var x=[1];2*x[x.length-1]<=e;)x.push(2*x[x.length-1]);var J=x.length,L=x[J-1];function U(t){return Math.abs(t)<=e}function T(t,e,r){e=K(e);for(var o=t.isNegative(),n=e.isNegative(),i=o?t.not():t,u=n?e.not():e,p=0,a=0,s=null,l=null,f=[];!i.isZero()||!u.isZero();)p=(s=B(i,L))[1].toJSNumber(),o&&(p=L-1-p),a=(l=B(u,L))[1].toJSNumber(),n&&(a=L-1-a),i=s[0],u=l[0],f.push(r(p,a));for(var v=0!==r(o?1:0,n?1:0)?bigInt(-1):bigInt(0),h=f.length-1;h>=0;h-=1)v=v.multiply(L).add(bigInt(f[h]));return v}a.prototype.shiftLeft=function(t){var e=K(t).toJSNumber();if(!U(e))throw new Error(String(e)+" is too large for shifting.");if(e<0)return this.shiftRight(-e);var r=this;if(r.isZero())return r;for(;e>=J;)r=r.multiply(L),e-=J-1;return r.multiply(x[e])},l.prototype.shiftLeft=s.prototype.shiftLeft=a.prototype.shiftLeft,a.prototype.shiftRight=function(t){var e,r=K(t).toJSNumber();if(!U(r))throw new Error(String(r)+" is too large for shifting.");if(r<0)return this.shiftLeft(-r);for(var o=this;r>=J;){if(o.isZero()||o.isNegative()&&o.isUnit())return o;o=(e=B(o,L))[1].isNegative()?e[0].prev():e[0],r-=J-1}return(e=B(o,x[r]))[1].isNegative()?e[0].prev():e[0]},l.prototype.shiftRight=s.prototype.shiftRight=a.prototype.shiftRight,a.prototype.not=function(){return this.negate().prev()},l.prototype.not=s.prototype.not=a.prototype.not,a.prototype.and=function(t){return T(this,t,function(t,e){return t&e})},l.prototype.and=s.prototype.and=a.prototype.and,a.prototype.or=function(t){return T(this,t,function(t,e){return t|e})},l.prototype.or=s.prototype.or=a.prototype.or,a.prototype.xor=function(t){return T(this,t,function(t,e){return t^e})},l.prototype.xor=s.prototype.xor=a.prototype.xor;var j=1<<30,C=(e&-e)*(e&-e)|j;function D(t){var r=t.value,o="number"==typeof r?r|j:"bigint"==typeof r?r|BigInt(j):r[0]+r[1]*e|C;return o&-o}function z(t,e){return t=K(t),e=K(e),t.greater(e)?t:e}function R(t,e){return t=K(t),e=K(e),t.lesser(e)?t:e}function k(t,e){if(t=K(t).abs(),e=K(e).abs(),t.equals(e))return t;if(t.isZero())return e;if(e.isZero())return t;for(var r,o,n=p[1];t.isEven()&&e.isEven();)r=R(D(t),D(e)),t=t.divide(r),e=e.divide(r),n=n.multiply(r);for(;t.isEven();)t=t.divide(D(t));do{for(;e.isEven();)e=e.divide(D(e));t.greater(e)&&(o=e,e=t,t=o),e=e.subtract(t)}while(!e.isZero());return n.isUnit()?t:t.multiply(n)}a.prototype.bitLength=function(){var t=this;return t.compareTo(bigInt(0))<0&&(t=t.negate().subtract(bigInt(1))),0===t.compareTo(bigInt(0))?bigInt(0):bigInt(function t(e,r){if(r.compareTo(e)<=0){var o=t(e,r.square(r)),n=o.p,i=o.e,u=n.multiply(r);return u.compareTo(e)<=0?{p:u,e:2*i+1}:{p:n,e:2*i}}return{p:bigInt(1),e:0}}(t,bigInt(2)).e).add(bigInt(1))},l.prototype.bitLength=s.prototype.bitLength=a.prototype.bitLength;var _=function(t,e,r,o){r=r||i,t=String(t),o||(t=t.toLowerCase(),r=r.toLowerCase());var n,u=t.length,p=Math.abs(e),a={};for(n=0;n<r.length;n++)a[r[n]]=n;for(n=0;n<u;n++){if("-"!==(f=t[n])&&(f in a&&a[f]>=p)){if("1"===f&&1===p)continue;throw new Error(f+" is not a valid digit in base "+e+".")}}e=K(e);var s=[],l="-"===t[0];for(n=l?1:0;n<t.length;n++){var f;if((f=t[n])in a)s.push(K(a[f]));else{if("<"!==f)throw new Error(f+" is not a valid character");var v=n;do{n++}while(">"!==t[n]&&n<t.length);s.push(K(t.slice(v+1,n)))}}return $(s,e,l)};function $(t,e,r){var o,n=p[0],i=p[1];for(o=t.length-1;o>=0;o--)n=n.add(t[o].times(i)),i=i.times(e);return r?n.negate():n}function F(t,e){if((e=bigInt(e)).isZero()){if(t.isZero())return{value:[0],isNegative:!1};throw new Error("Cannot convert nonzero numbers to base 0.")}if(e.equals(-1)){if(t.isZero())return{value:[0],isNegative:!1};if(t.isNegative())return{value:[].concat.apply([],Array.apply(null,Array(-t.toJSNumber())).map(Array.prototype.valueOf,[1,0])),isNegative:!1};var r=Array.apply(null,Array(t.toJSNumber()-1)).map(Array.prototype.valueOf,[0,1]);return r.unshift([1]),{value:[].concat.apply([],r),isNegative:!1}}var o=!1;if(t.isNegative()&&e.isPositive()&&(o=!0,t=t.abs()),e.isUnit())return t.isZero()?{value:[0],isNegative:!1}:{value:Array.apply(null,Array(t.toJSNumber())).map(Number.prototype.valueOf,1),isNegative:o};for(var n,i=[],u=t;u.isNegative()||u.compareAbs(e)>=0;){u=(n=u.divmod(e)).quotient;var p=n.remainder;p.isNegative()&&(p=e.minus(p).abs(),u=u.next()),i.push(p.toJSNumber())}return i.push(u.toJSNumber()),{value:i.reverse(),isNegative:o}}function G(t,e,r){var o=F(t,e);return(o.isNegative?"-":"")+o.value.map(function(t){return function(t,e){return t<(e=e||i).length?e[t]:"<"+t+">"}(t,r)}).join("")}function H(t){if(f(+t)){var e=+t;if(e===c(e))return u?new l(BigInt(e)):new s(e);throw new Error("Invalid integer: "+t)}var o="-"===t[0];o&&(t=t.slice(1));var n=t.split(/e/i);if(n.length>2)throw new Error("Invalid integer: "+n.join("e"));if(2===n.length){var i=n[1];if("+"===i[0]&&(i=i.slice(1)),(i=+i)!==c(i)||!f(i))throw new Error("Invalid integer: "+i+" is not a valid exponent.");var p=n[0],v=p.indexOf(".");if(v>=0&&(i-=p.length-v-1,p=p.slice(0,v)+p.slice(v+1)),i<0)throw new Error("Cannot include negative exponent part for integers");t=p+=new Array(i+1).join("0")}if(!/^([0-9][0-9]*)$/.test(t))throw new Error("Invalid integer: "+t);if(u)return new l(BigInt(o?"-"+t:t));for(var h=[],g=t.length,m=r,d=g-m;g>0;)h.push(+t.slice(d,g)),(d-=m)<0&&(d=0),g-=m;return y(h),new a(h,o)}function K(t){return"number"==typeof t?function(t){if(u)return new l(BigInt(t));if(f(t)){if(t!==c(t))throw new Error(t+" is not an integer.");return new s(t)}return H(t.toString())}(t):"string"==typeof t?H(t):"bigint"==typeof t?new l(t):t}a.prototype.toArray=function(t){return F(this,t)},s.prototype.toArray=function(t){return F(this,t)},l.prototype.toArray=function(t){return F(this,t)},a.prototype.toString=function(t,e){if(void 0===t&&(t=10),10!==t)return G(this,t,e);for(var r,o=this.value,n=o.length,i=String(o[--n]);--n>=0;)r=String(o[n]),i+="0000000".slice(r.length)+r;return(this.sign?"-":"")+i},s.prototype.toString=function(t,e){return void 0===t&&(t=10),10!=t?G(this,t,e):String(this.value)},l.prototype.toString=s.prototype.toString,l.prototype.toJSON=a.prototype.toJSON=s.prototype.toJSON=function(){return this.toString()},a.prototype.valueOf=function(){return parseInt(this.toString(),10)},a.prototype.toJSNumber=a.prototype.valueOf,s.prototype.valueOf=function(){return this.value},s.prototype.toJSNumber=s.prototype.valueOf,l.prototype.valueOf=l.prototype.toJSNumber=function(){return parseInt(this.toString(),10)};for(var Q=0;Q<1e3;Q++)p[Q]=K(Q),Q>0&&(p[-Q]=K(-Q));return p.one=p[1],p.zero=p[0],p.minusOne=p[-1],p.max=z,p.min=R,p.gcd=k,p.lcm=function(t,e){return t=K(t).abs(),e=K(e).abs(),t.divide(k(t,e)).multiply(e)},p.isInstance=function(t){return t instanceof a||t instanceof s||t instanceof l},p.randBetween=function(t,r){var o=R(t=K(t),r=K(r)),n=z(t,r).subtract(o).add(1);if(n.isSmall)return o.add(Math.floor(Math.random()*n));for(var i=F(n,e).value,u=[],a=!0,s=0;s<i.length;s++){var l=a?i[s]:e,f=c(Math.random()*l);u.push(f),f<l&&(a=!1)}return o.add(p.fromArray(u,e,!1))},p.fromArray=function(t,e,r){return $(t.map(K),K(e||10),r)},p}();"undefined"!=typeof module&&module.hasOwnProperty("exports")&&(module.exports=bigInt),"function"==typeof define&&define.amd&&define("big-integer",[],function(){return bigInt});
=======
var bigInt=function(undefined){"use strict";var BASE=1e7,LOG_BASE=7,MAX_INT=9007199254740992,MAX_INT_ARR=smallToArray(MAX_INT),DEFAULT_ALPHABET="0123456789abcdefghijklmnopqrstuvwxyz",supportsNativeBigInt="function"==typeof BigInt,pow;function Integer(e,t,r,n){return void 0===e?Integer[0]:void 0!==t&&(10!=+t||r)?parseBase(e,t,r,n):parseValue(e)}function BigInteger(e,t){this.value=e,this.sign=t,this.isSmall=!1}function SmallInteger(e){this.value=e,this.sign=e<0,this.isSmall=!0}function NativeBigInt(e){this.value=e}function isPrecise(e){return-MAX_INT<e&&e<MAX_INT}function smallToArray(e){return e<1e7?[e]:e<1e14?[e%1e7,Math.floor(e/1e7)]:[e%1e7,Math.floor(e/1e7)%1e7,Math.floor(e/1e14)]}function arrayToSmall(e){trim(e);var t=e.length;if(t<4&&compareAbs(e,MAX_INT_ARR)<0)switch(t){case 0:return 0;case 1:return e[0];case 2:return e[0]+e[1]*BASE;default:return e[0]+(e[1]+e[2]*BASE)*BASE}return e}function trim(e){for(var t=e.length;0===e[--t];);e.length=t+1}function createArray(e){for(var t=new Array(e),r=-1;++r<e;)t[r]=0;return t}function truncate(e){return e>0?Math.floor(e):Math.ceil(e)}function add(e,t){var r,n,i=e.length,o=t.length,a=new Array(i),l=0,g=BASE;for(n=0;n<o;n++)l=(r=e[n]+t[n]+l)>=g?1:0,a[n]=r-l*g;for(;n<i;)l=(r=e[n]+l)===g?1:0,a[n++]=r-l*g;return l>0&&a.push(l),a}function addAny(e,t){return e.length>=t.length?add(e,t):add(t,e)}function addSmall(e,t){var r,n,i=e.length,o=new Array(i),a=BASE;for(n=0;n<i;n++)r=e[n]-a+t,t=Math.floor(r/a),o[n]=r-t*a,t+=1;for(;t>0;)o[n++]=t%a,t=Math.floor(t/a);return o}function subtract(e,t){var r,n,i=e.length,o=t.length,a=new Array(i),l=0,g=BASE;for(r=0;r<o;r++)(n=e[r]-l-t[r])<0?(n+=g,l=1):l=0,a[r]=n;for(r=o;r<i;r++){if(!((n=e[r]-l)<0)){a[r++]=n;break}n+=g,a[r]=n}for(;r<i;r++)a[r]=e[r];return trim(a),a}function subtractAny(e,t,r){var n;return compareAbs(e,t)>=0?n=subtract(e,t):(n=subtract(t,e),r=!r),"number"==typeof(n=arrayToSmall(n))?(r&&(n=-n),new SmallInteger(n)):new BigInteger(n,r)}function subtractSmall(e,t,r){var n,i,o=e.length,a=new Array(o),l=-t,g=BASE;for(n=0;n<o;n++)i=e[n]+l,l=Math.floor(i/g),i%=g,a[n]=i<0?i+g:i;return"number"==typeof(a=arrayToSmall(a))?(r&&(a=-a),new SmallInteger(a)):new BigInteger(a,r)}function multiplyLong(e,t){var r,n,i,o,a=e.length,l=t.length,g=createArray(a+l),u=BASE;for(i=0;i<a;++i){o=e[i];for(var s=0;s<l;++s)r=o*t[s]+g[i+s],n=Math.floor(r/u),g[i+s]=r-n*u,g[i+s+1]+=n}return trim(g),g}function multiplySmall(e,t){var r,n,i=e.length,o=new Array(i),a=BASE,l=0;for(n=0;n<i;n++)r=e[n]*t+l,l=Math.floor(r/a),o[n]=r-l*a;for(;l>0;)o[n++]=l%a,l=Math.floor(l/a);return o}function shiftLeft(e,t){for(var r=[];t-- >0;)r.push(0);return r.concat(e)}function multiplyKaratsuba(e,t){var r=Math.max(e.length,t.length);if(r<=30)return multiplyLong(e,t);r=Math.ceil(r/2);var n=e.slice(r),i=e.slice(0,r),o=t.slice(r),a=t.slice(0,r),l=multiplyKaratsuba(i,a),g=multiplyKaratsuba(n,o),u=addAny(addAny(l,shiftLeft(subtract(subtract(multiplyKaratsuba(addAny(i,n),addAny(a,o)),l),g),r)),shiftLeft(g,2*r));return trim(u),u}function useKaratsuba(e,t){return-.012*e-.012*t+15e-6*e*t>0}function multiplySmallAndArray(e,t,r){return new BigInteger(e<BASE?multiplySmall(t,e):multiplyLong(t,smallToArray(e)),r)}function square(e){var t,r,n,i,o=e.length,a=createArray(o+o),l=BASE;for(n=0;n<o;n++){r=0-(i=e[n])*i;for(var g=n;g<o;g++)t=i*e[g]*2+a[n+g]+r,r=Math.floor(t/l),a[n+g]=t-r*l;a[n+o]=r}return trim(a),a}function divMod1(e,t){var r,n,i,o,a,l,g,u=e.length,s=t.length,p=BASE,v=createArray(t.length),I=t[s-1],f=Math.ceil(p/(2*I)),y=multiplySmall(e,f),m=multiplySmall(t,f);for(y.length<=u&&y.push(0),m.push(0),I=m[s-1],n=u-s;n>=0;n--){for(r=p-1,y[n+s]!==I&&(r=Math.floor((y[n+s]*p+y[n+s-1])/I)),i=0,o=0,l=m.length,a=0;a<l;a++)i+=r*m[a],g=Math.floor(i/p),o+=y[n+a]-(i-g*p),i=g,o<0?(y[n+a]=o+p,o=-1):(y[n+a]=o,o=0);for(;0!==o;){for(r-=1,i=0,a=0;a<l;a++)(i+=y[n+a]-p+m[a])<0?(y[n+a]=i+p,i=0):(y[n+a]=i,i=1);o+=i}v[n]=r}return y=divModSmall(y,f)[0],[arrayToSmall(v),arrayToSmall(y)]}function divMod2(e,t){for(var r,n,i,o,a,l=e.length,g=t.length,u=[],s=[],p=BASE;l;)if(s.unshift(e[--l]),trim(s),compareAbs(s,t)<0)u.push(0);else{i=s[(n=s.length)-1]*p+s[n-2],o=t[g-1]*p+t[g-2],n>g&&(i=(i+1)*p),r=Math.ceil(i/o);do{if(compareAbs(a=multiplySmall(t,r),s)<=0)break;r--}while(r);u.push(r),s=subtract(s,a)}return u.reverse(),[arrayToSmall(u),arrayToSmall(s)]}function divModSmall(e,t){var r,n,i,o,a=e.length,l=createArray(a),g=BASE;for(i=0,r=a-1;r>=0;--r)i=(o=i*g+e[r])-(n=truncate(o/t))*t,l[r]=0|n;return[l,0|i]}function divModAny(e,t){var r,n=parseValue(t);if(supportsNativeBigInt)return[new NativeBigInt(e.value/n.value),new NativeBigInt(e.value%n.value)];var i,o=e.value,a=n.value;if(0===a)throw new Error("Cannot divide by zero");if(e.isSmall)return n.isSmall?[new SmallInteger(truncate(o/a)),new SmallInteger(o%a)]:[Integer[0],e];if(n.isSmall){if(1===a)return[e,Integer[0]];if(-1==a)return[e.negate(),Integer[0]];var l=Math.abs(a);if(l<BASE){i=arrayToSmall((r=divModSmall(o,l))[0]);var g=r[1];return e.sign&&(g=-g),"number"==typeof i?(e.sign!==n.sign&&(i=-i),[new SmallInteger(i),new SmallInteger(g)]):[new BigInteger(i,e.sign!==n.sign),new SmallInteger(g)]}a=smallToArray(l)}var u=compareAbs(o,a);if(-1===u)return[Integer[0],e];if(0===u)return[Integer[e.sign===n.sign?1:-1],Integer[0]];i=(r=o.length+a.length<=200?divMod1(o,a):divMod2(o,a))[0];var s=e.sign!==n.sign,p=r[1],v=e.sign;return"number"==typeof i?(s&&(i=-i),i=new SmallInteger(i)):i=new BigInteger(i,s),"number"==typeof p?(v&&(p=-p),p=new SmallInteger(p)):p=new BigInteger(p,v),[i,p]}function compareAbs(e,t){if(e.length!==t.length)return e.length>t.length?1:-1;for(var r=e.length-1;r>=0;r--)if(e[r]!==t[r])return e[r]>t[r]?1:-1;return 0}function isBasicPrime(e){var t=e.abs();return!t.isUnit()&&(!!(t.equals(2)||t.equals(3)||t.equals(5))||!(t.isEven()||t.isDivisibleBy(3)||t.isDivisibleBy(5))&&(!!t.lesser(49)||void 0))}function millerRabinTest(e,t){for(var r,n,i,o=e.prev(),a=o,l=0;a.isEven();)a=a.divide(2),l++;e:for(n=0;n<t.length;n++)if(!e.lesser(t[n])&&!(i=bigInt(t[n]).modPow(a,e)).isUnit()&&!i.equals(o)){for(r=l-1;0!=r;r--){if((i=i.square().mod(e)).isUnit())return!1;if(i.equals(o))continue e}return!1}return!0}BigInteger.prototype=Object.create(Integer.prototype),SmallInteger.prototype=Object.create(Integer.prototype),NativeBigInt.prototype=Object.create(Integer.prototype),BigInteger.prototype.add=function(e){var t=parseValue(e);if(this.sign!==t.sign)return this.subtract(t.negate());var r=this.value,n=t.value;return t.isSmall?new BigInteger(addSmall(r,Math.abs(n)),this.sign):new BigInteger(addAny(r,n),this.sign)},BigInteger.prototype.plus=BigInteger.prototype.add,SmallInteger.prototype.add=function(e){var t=parseValue(e),r=this.value;if(r<0!==t.sign)return this.subtract(t.negate());var n=t.value;if(t.isSmall){if(isPrecise(r+n))return new SmallInteger(r+n);n=smallToArray(Math.abs(n))}return new BigInteger(addSmall(n,Math.abs(r)),r<0)},SmallInteger.prototype.plus=SmallInteger.prototype.add,NativeBigInt.prototype.add=function(e){return new NativeBigInt(this.value+parseValue(e).value)},NativeBigInt.prototype.plus=NativeBigInt.prototype.add,BigInteger.prototype.subtract=function(e){var t=parseValue(e);if(this.sign!==t.sign)return this.add(t.negate());var r=this.value,n=t.value;return t.isSmall?subtractSmall(r,Math.abs(n),this.sign):subtractAny(r,n,this.sign)},BigInteger.prototype.minus=BigInteger.prototype.subtract,SmallInteger.prototype.subtract=function(e){var t=parseValue(e),r=this.value;if(r<0!==t.sign)return this.add(t.negate());var n=t.value;return t.isSmall?new SmallInteger(r-n):subtractSmall(n,Math.abs(r),r>=0)},SmallInteger.prototype.minus=SmallInteger.prototype.subtract,NativeBigInt.prototype.subtract=function(e){return new NativeBigInt(this.value-parseValue(e).value)},NativeBigInt.prototype.minus=NativeBigInt.prototype.subtract,BigInteger.prototype.negate=function(){return new BigInteger(this.value,!this.sign)},SmallInteger.prototype.negate=function(){var e=this.sign,t=new SmallInteger(-this.value);return t.sign=!e,t},NativeBigInt.prototype.negate=function(){return new NativeBigInt(-this.value)},BigInteger.prototype.abs=function(){return new BigInteger(this.value,!1)},SmallInteger.prototype.abs=function(){return new SmallInteger(Math.abs(this.value))},NativeBigInt.prototype.abs=function(){return new NativeBigInt(this.value>=0?this.value:-this.value)},BigInteger.prototype.multiply=function(e){var t,r=parseValue(e),n=this.value,i=r.value,o=this.sign!==r.sign;if(r.isSmall){if(0===i)return Integer[0];if(1===i)return this;if(-1===i)return this.negate();if((t=Math.abs(i))<BASE)return new BigInteger(multiplySmall(n,t),o);i=smallToArray(t)}return useKaratsuba(n.length,i.length)?new BigInteger(multiplyKaratsuba(n,i),o):new BigInteger(multiplyLong(n,i),o)},BigInteger.prototype.times=BigInteger.prototype.multiply,SmallInteger.prototype._multiplyBySmall=function(e){return isPrecise(e.value*this.value)?new SmallInteger(e.value*this.value):multiplySmallAndArray(Math.abs(e.value),smallToArray(Math.abs(this.value)),this.sign!==e.sign)},BigInteger.prototype._multiplyBySmall=function(e){return 0===e.value?Integer[0]:1===e.value?this:-1===e.value?this.negate():multiplySmallAndArray(Math.abs(e.value),this.value,this.sign!==e.sign)},SmallInteger.prototype.multiply=function(e){return parseValue(e)._multiplyBySmall(this)},SmallInteger.prototype.times=SmallInteger.prototype.multiply,NativeBigInt.prototype.multiply=function(e){return new NativeBigInt(this.value*parseValue(e).value)},NativeBigInt.prototype.times=NativeBigInt.prototype.multiply,BigInteger.prototype.square=function(){return new BigInteger(square(this.value),!1)},SmallInteger.prototype.square=function(){var e=this.value*this.value;return isPrecise(e)?new SmallInteger(e):new BigInteger(square(smallToArray(Math.abs(this.value))),!1)},NativeBigInt.prototype.square=function(e){return new NativeBigInt(this.value*this.value)},BigInteger.prototype.divmod=function(e){var t=divModAny(this,e);return{quotient:t[0],remainder:t[1]}},NativeBigInt.prototype.divmod=SmallInteger.prototype.divmod=BigInteger.prototype.divmod,BigInteger.prototype.divide=function(e){return divModAny(this,e)[0]},NativeBigInt.prototype.over=NativeBigInt.prototype.divide=SmallInteger.prototype.over=SmallInteger.prototype.divide=BigInteger.prototype.over=BigInteger.prototype.divide,BigInteger.prototype.mod=function(e){return divModAny(this,e)[1]},NativeBigInt.prototype.mod=NativeBigInt.prototype.remainder=SmallInteger.prototype.remainder=SmallInteger.prototype.mod=BigInteger.prototype.remainder=BigInteger.prototype.mod,BigInteger.prototype.pow=function(e){var t,r,n,i=parseValue(e),o=this.value,a=i.value;if(0===a)return Integer[1];if(0===o)return Integer[0];if(1===o)return Integer[1];if(-1===o)return i.isEven()?Integer[1]:Integer[-1];if(i.sign)return Integer[0];if(!i.isSmall)throw new Error("The exponent "+i.toString()+" is too large.");if(this.isSmall&&isPrecise(t=Math.pow(o,a)))return new SmallInteger(truncate(t));for(r=this,n=Integer[1];!0&a&&(n=n.times(r),--a),0!==a;)a/=2,r=r.square();return n},SmallInteger.prototype.pow=BigInteger.prototype.pow,supportsNativeBigInt&&(pow=eval("(a,b)=>a**b")),NativeBigInt.prototype.pow=function(e){var t=parseValue(e),r=this.value,n=t.value;return n===BigInt(0)?Integer[1]:r===BigInt(0)?Integer[0]:r===BigInt(1)?Integer[1]:r===BigInt(-1)?t.isEven()?Integer[1]:Integer[-1]:t.isNegative()?new NativeBigInt(BigInt(0)):new NativeBigInt(pow(r,n))},BigInteger.prototype.modPow=function(e,t){if(e=parseValue(e),(t=parseValue(t)).isZero())throw new Error("Cannot take modPow with modulus 0");for(var r=Integer[1],n=this.mod(t);e.isPositive();){if(n.isZero())return Integer[0];e.isOdd()&&(r=r.multiply(n).mod(t)),e=e.divide(2),n=n.square().mod(t)}return r},NativeBigInt.prototype.modPow=SmallInteger.prototype.modPow=BigInteger.prototype.modPow,BigInteger.prototype.compareAbs=function(e){var t=parseValue(e),r=this.value,n=t.value;return t.isSmall?1:compareAbs(r,n)},SmallInteger.prototype.compareAbs=function(e){var t=parseValue(e),r=Math.abs(this.value),n=t.value;return t.isSmall?r===(n=Math.abs(n))?0:r>n?1:-1:-1},NativeBigInt.prototype.compareAbs=function(e){var t=this.value,r=parseValue(e).value;return(t=t>=0?t:-t)===(r=r>=0?r:-r)?0:t>r?1:-1},BigInteger.prototype.compare=function(e){if(e===1/0)return-1;if(e===-1/0)return 1;var t=parseValue(e),r=this.value,n=t.value;return this.sign!==t.sign?t.sign?1:-1:t.isSmall?this.sign?-1:1:compareAbs(r,n)*(this.sign?-1:1)},BigInteger.prototype.compareTo=BigInteger.prototype.compare,SmallInteger.prototype.compare=function(e){if(e===1/0)return-1;if(e===-1/0)return 1;var t=parseValue(e),r=this.value,n=t.value;return t.isSmall?r==n?0:r>n?1:-1:r<0!==t.sign?r<0?-1:1:r<0?1:-1},SmallInteger.prototype.compareTo=SmallInteger.prototype.compare,NativeBigInt.prototype.compare=function(e){if(e===1/0)return-1;if(e===-1/0)return 1;var t=this.value,r=parseValue(e).value;return t===r?0:t>r?1:-1},NativeBigInt.prototype.compareTo=NativeBigInt.prototype.compare,BigInteger.prototype.equals=function(e){return 0===this.compare(e)},NativeBigInt.prototype.eq=NativeBigInt.prototype.equals=SmallInteger.prototype.eq=SmallInteger.prototype.equals=BigInteger.prototype.eq=BigInteger.prototype.equals,BigInteger.prototype.notEquals=function(e){return 0!==this.compare(e)},NativeBigInt.prototype.neq=NativeBigInt.prototype.notEquals=SmallInteger.prototype.neq=SmallInteger.prototype.notEquals=BigInteger.prototype.neq=BigInteger.prototype.notEquals,BigInteger.prototype.greater=function(e){return this.compare(e)>0},NativeBigInt.prototype.gt=NativeBigInt.prototype.greater=SmallInteger.prototype.gt=SmallInteger.prototype.greater=BigInteger.prototype.gt=BigInteger.prototype.greater,BigInteger.prototype.lesser=function(e){return this.compare(e)<0},NativeBigInt.prototype.lt=NativeBigInt.prototype.lesser=SmallInteger.prototype.lt=SmallInteger.prototype.lesser=BigInteger.prototype.lt=BigInteger.prototype.lesser,BigInteger.prototype.greaterOrEquals=function(e){return this.compare(e)>=0},NativeBigInt.prototype.geq=NativeBigInt.prototype.greaterOrEquals=SmallInteger.prototype.geq=SmallInteger.prototype.greaterOrEquals=BigInteger.prototype.geq=BigInteger.prototype.greaterOrEquals,BigInteger.prototype.lesserOrEquals=function(e){return this.compare(e)<=0},NativeBigInt.prototype.leq=NativeBigInt.prototype.lesserOrEquals=SmallInteger.prototype.leq=SmallInteger.prototype.lesserOrEquals=BigInteger.prototype.leq=BigInteger.prototype.lesserOrEquals,BigInteger.prototype.isEven=function(){return 0==(1&this.value[0])},SmallInteger.prototype.isEven=function(){return 0==(1&this.value)},NativeBigInt.prototype.isEven=function(){return(this.value&BigInt(1))===BigInt(0)},BigInteger.prototype.isOdd=function(){return 1==(1&this.value[0])},SmallInteger.prototype.isOdd=function(){return 1==(1&this.value)},NativeBigInt.prototype.isOdd=function(){return(this.value&BigInt(1))===BigInt(1)},BigInteger.prototype.isPositive=function(){return!this.sign},SmallInteger.prototype.isPositive=function(){return this.value>0},NativeBigInt.prototype.isPositive=SmallInteger.prototype.isPositive,BigInteger.prototype.isNegative=function(){return this.sign},SmallInteger.prototype.isNegative=function(){return this.value<0},NativeBigInt.prototype.isNegative=SmallInteger.prototype.isNegative,BigInteger.prototype.isUnit=function(){return!1},SmallInteger.prototype.isUnit=function(){return 1===Math.abs(this.value)},NativeBigInt.prototype.isUnit=function(){return this.abs().value===BigInt(1)},BigInteger.prototype.isZero=function(){return!1},SmallInteger.prototype.isZero=function(){return 0===this.value},NativeBigInt.prototype.isZero=function(){return this.value===BigInt(0)},BigInteger.prototype.isDivisibleBy=function(e){var t=parseValue(e);return!t.isZero()&&(!!t.isUnit()||(0===t.compareAbs(2)?this.isEven():this.mod(t).isZero()))},NativeBigInt.prototype.isDivisibleBy=SmallInteger.prototype.isDivisibleBy=BigInteger.prototype.isDivisibleBy,BigInteger.prototype.isPrime=function(e){var t=isBasicPrime(this);if(t!==undefined)return t;var r=this.abs(),n=r.bitLength();if(n<=64)return millerRabinTest(r,[2,325,9375,28178,450775,9780504,1795265022]);for(var i=Math.log(2)*n.toJSNumber(),o=Math.ceil(!0===e?2*Math.pow(i,2):i),a=[],l=0;l<o;l++)a.push(bigInt(l+2));return millerRabinTest(r,a)},NativeBigInt.prototype.isPrime=SmallInteger.prototype.isPrime=BigInteger.prototype.isPrime,BigInteger.prototype.isProbablePrime=function(e){var t=isBasicPrime(this);if(t!==undefined)return t;for(var r=this.abs(),n=e===undefined?5:e,i=[],o=0;o<n;o++)i.push(bigInt.randBetween(2,r.minus(2)));return millerRabinTest(r,i)},NativeBigInt.prototype.isProbablePrime=SmallInteger.prototype.isProbablePrime=BigInteger.prototype.isProbablePrime,BigInteger.prototype.modInv=function(e){for(var t,r,n,i=bigInt.zero,o=bigInt.one,a=parseValue(e),l=this.abs();!l.isZero();)t=a.divide(l),r=i,n=a,i=o,a=l,o=r.subtract(t.multiply(o)),l=n.subtract(t.multiply(l));if(!a.isUnit())throw new Error(this.toString()+" and "+e.toString()+" are not co-prime");return-1===i.compare(0)&&(i=i.add(e)),this.isNegative()?i.negate():i},NativeBigInt.prototype.modInv=SmallInteger.prototype.modInv=BigInteger.prototype.modInv,BigInteger.prototype.next=function(){var e=this.value;return this.sign?subtractSmall(e,1,this.sign):new BigInteger(addSmall(e,1),this.sign)},SmallInteger.prototype.next=function(){var e=this.value;return e+1<MAX_INT?new SmallInteger(e+1):new BigInteger(MAX_INT_ARR,!1)},NativeBigInt.prototype.next=function(){return new NativeBigInt(this.value+BigInt(1))},BigInteger.prototype.prev=function(){var e=this.value;return this.sign?new BigInteger(addSmall(e,1),!0):subtractSmall(e,1,this.sign)},SmallInteger.prototype.prev=function(){var e=this.value;return e-1>-MAX_INT?new SmallInteger(e-1):new BigInteger(MAX_INT_ARR,!0)},NativeBigInt.prototype.prev=function(){return new NativeBigInt(this.value-BigInt(1))};for(var powersOfTwo=[1];2*powersOfTwo[powersOfTwo.length-1]<=BASE;)powersOfTwo.push(2*powersOfTwo[powersOfTwo.length-1]);var powers2Length=powersOfTwo.length,highestPower2=powersOfTwo[powers2Length-1];function shift_isSmall(e){return Math.abs(e)<=BASE}function bitwise(e,t,r){t=parseValue(t);for(var n=e.isNegative(),i=t.isNegative(),o=n?e.not():e,a=i?t.not():t,l=0,g=0,u=null,s=null,p=[];!o.isZero()||!a.isZero();)l=(u=divModAny(o,highestPower2))[1].toJSNumber(),n&&(l=highestPower2-1-l),g=(s=divModAny(a,highestPower2))[1].toJSNumber(),i&&(g=highestPower2-1-g),o=u[0],a=s[0],p.push(r(l,g));for(var v=0!==r(n?1:0,i?1:0)?bigInt(-1):bigInt(0),I=p.length-1;I>=0;I-=1)v=v.multiply(highestPower2).add(bigInt(p[I]));return v}BigInteger.prototype.shiftLeft=function(e){var t=parseValue(e).toJSNumber();if(!shift_isSmall(t))throw new Error(String(t)+" is too large for shifting.");if(t<0)return this.shiftRight(-t);var r=this;if(r.isZero())return r;for(;t>=powers2Length;)r=r.multiply(highestPower2),t-=powers2Length-1;return r.multiply(powersOfTwo[t])},NativeBigInt.prototype.shiftLeft=SmallInteger.prototype.shiftLeft=BigInteger.prototype.shiftLeft,BigInteger.prototype.shiftRight=function(e){var t,r=parseValue(e).toJSNumber();if(!shift_isSmall(r))throw new Error(String(r)+" is too large for shifting.");if(r<0)return this.shiftLeft(-r);for(var n=this;r>=powers2Length;){if(n.isZero()||n.isNegative()&&n.isUnit())return n;n=(t=divModAny(n,highestPower2))[1].isNegative()?t[0].prev():t[0],r-=powers2Length-1}return(t=divModAny(n,powersOfTwo[r]))[1].isNegative()?t[0].prev():t[0]},NativeBigInt.prototype.shiftRight=SmallInteger.prototype.shiftRight=BigInteger.prototype.shiftRight,BigInteger.prototype.not=function(){return this.negate().prev()},NativeBigInt.prototype.not=SmallInteger.prototype.not=BigInteger.prototype.not,BigInteger.prototype.and=function(e){return bitwise(this,e,function(e,t){return e&t})},NativeBigInt.prototype.and=SmallInteger.prototype.and=BigInteger.prototype.and,BigInteger.prototype.or=function(e){return bitwise(this,e,function(e,t){return e|t})},NativeBigInt.prototype.or=SmallInteger.prototype.or=BigInteger.prototype.or,BigInteger.prototype.xor=function(e){return bitwise(this,e,function(e,t){return e^t})},NativeBigInt.prototype.xor=SmallInteger.prototype.xor=BigInteger.prototype.xor;var LOBMASK_I=1<<30,LOBMASK_BI=(BASE&-BASE)*(BASE&-BASE)|LOBMASK_I;function roughLOB(e){var t=e.value,r="number"==typeof t?t|LOBMASK_I:"bigint"==typeof t?t|BigInt(LOBMASK_I):t[0]+t[1]*BASE|LOBMASK_BI;return r&-r}function integerLogarithm(e,t){if(t.compareTo(e)<=0){var r=integerLogarithm(e,t.square(t)),n=r.p,i=r.e,o=n.multiply(t);return o.compareTo(e)<=0?{p:o,e:2*i+1}:{p:n,e:2*i}}return{p:bigInt(1),e:0}}function max(e,t){return e=parseValue(e),t=parseValue(t),e.greater(t)?e:t}function min(e,t){return e=parseValue(e),t=parseValue(t),e.lesser(t)?e:t}function gcd(e,t){if(e=parseValue(e).abs(),t=parseValue(t).abs(),e.equals(t))return e;if(e.isZero())return t;if(t.isZero())return e;for(var r,n,i=Integer[1];e.isEven()&&t.isEven();)r=min(roughLOB(e),roughLOB(t)),e=e.divide(r),t=t.divide(r),i=i.multiply(r);for(;e.isEven();)e=e.divide(roughLOB(e));do{for(;t.isEven();)t=t.divide(roughLOB(t));e.greater(t)&&(n=t,t=e,e=n),t=t.subtract(e)}while(!t.isZero());return i.isUnit()?e:e.multiply(i)}function lcm(e,t){return e=parseValue(e).abs(),t=parseValue(t).abs(),e.divide(gcd(e,t)).multiply(t)}function randBetween(e,t){var r=min(e=parseValue(e),t=parseValue(t)),n=max(e,t).subtract(r).add(1);if(n.isSmall)return r.add(Math.floor(Math.random()*n));for(var i=toBase(n,BASE).value,o=[],a=!0,l=0;l<i.length;l++){var g=a?i[l]:BASE,u=truncate(Math.random()*g);o.push(u),u<g&&(a=!1)}return r.add(Integer.fromArray(o,BASE,!1))}BigInteger.prototype.bitLength=function(){var e=this;return e.compareTo(bigInt(0))<0&&(e=e.negate().subtract(bigInt(1))),0===e.compareTo(bigInt(0))?bigInt(0):bigInt(integerLogarithm(e,bigInt(2)).e).add(bigInt(1))},NativeBigInt.prototype.bitLength=SmallInteger.prototype.bitLength=BigInteger.prototype.bitLength;var parseBase=function(e,t,r,n){r=r||DEFAULT_ALPHABET,e=String(e),n||(e=e.toLowerCase(),r=r.toLowerCase());var i,o=e.length,a=Math.abs(t),l={};for(i=0;i<r.length;i++)l[r[i]]=i;for(i=0;i<o;i++){if("-"!==(s=e[i])&&(s in l&&l[s]>=a)){if("1"===s&&1===a)continue;throw new Error(s+" is not a valid digit in base "+t+".")}}t=parseValue(t);var g=[],u="-"===e[0];for(i=u?1:0;i<e.length;i++){var s;if((s=e[i])in l)g.push(parseValue(l[s]));else{if("<"!==s)throw new Error(s+" is not a valid character");var p=i;do{i++}while(">"!==e[i]&&i<e.length);g.push(parseValue(e.slice(p+1,i)))}}return parseBaseFromArray(g,t,u)};function parseBaseFromArray(e,t,r){var n,i=Integer[0],o=Integer[1];for(n=e.length-1;n>=0;n--)i=i.add(e[n].times(o)),o=o.times(t);return r?i.negate():i}function stringify(e,t){return e<(t=t||DEFAULT_ALPHABET).length?t[e]:"<"+e+">"}function toBase(e,t){if((t=bigInt(t)).isZero()){if(e.isZero())return{value:[0],isNegative:!1};throw new Error("Cannot convert nonzero numbers to base 0.")}if(t.equals(-1)){if(e.isZero())return{value:[0],isNegative:!1};if(e.isNegative())return{value:[].concat.apply([],Array.apply(null,Array(-e.toJSNumber())).map(Array.prototype.valueOf,[1,0])),isNegative:!1};var r=Array.apply(null,Array(e.toJSNumber()-1)).map(Array.prototype.valueOf,[0,1]);return r.unshift([1]),{value:[].concat.apply([],r),isNegative:!1}}var n=!1;if(e.isNegative()&&t.isPositive()&&(n=!0,e=e.abs()),t.isUnit())return e.isZero()?{value:[0],isNegative:!1}:{value:Array.apply(null,Array(e.toJSNumber())).map(Number.prototype.valueOf,1),isNegative:n};for(var i,o=[],a=e;a.isNegative()||a.compareAbs(t)>=0;){a=(i=a.divmod(t)).quotient;var l=i.remainder;l.isNegative()&&(l=t.minus(l).abs(),a=a.next()),o.push(l.toJSNumber())}return o.push(a.toJSNumber()),{value:o.reverse(),isNegative:n}}function toBaseString(e,t,r){var n=toBase(e,t);return(n.isNegative?"-":"")+n.value.map(function(e){return stringify(e,r)}).join("")}function parseStringValue(e){if(isPrecise(+e)){var t=+e;if(t===truncate(t))return supportsNativeBigInt?new NativeBigInt(BigInt(t)):new SmallInteger(t);throw new Error("Invalid integer: "+e)}var r="-"===e[0];r&&(e=e.slice(1));var n=e.split(/e/i);if(n.length>2)throw new Error("Invalid integer: "+n.join("e"));if(2===n.length){var i=n[1];if("+"===i[0]&&(i=i.slice(1)),(i=+i)!==truncate(i)||!isPrecise(i))throw new Error("Invalid integer: "+i+" is not a valid exponent.");var o=n[0],a=o.indexOf(".");if(a>=0&&(i-=o.length-a-1,o=o.slice(0,a)+o.slice(a+1)),i<0)throw new Error("Cannot include negative exponent part for integers");e=o+=new Array(i+1).join("0")}if(!/^([0-9][0-9]*)$/.test(e))throw new Error("Invalid integer: "+e);if(supportsNativeBigInt)return new NativeBigInt(BigInt(r?"-"+e:e));for(var l=[],g=e.length,u=LOG_BASE,s=g-u;g>0;)l.push(+e.slice(s,g)),(s-=u)<0&&(s=0),g-=u;return trim(l),new BigInteger(l,r)}function parseNumberValue(e){if(supportsNativeBigInt)return new NativeBigInt(BigInt(e));if(isPrecise(e)){if(e!==truncate(e))throw new Error(e+" is not an integer.");return new SmallInteger(e)}return parseStringValue(e.toString())}function parseValue(e){return"number"==typeof e?parseNumberValue(e):"string"==typeof e?parseStringValue(e):"bigint"==typeof e?new NativeBigInt(e):e}BigInteger.prototype.toArray=function(e){return toBase(this,e)},SmallInteger.prototype.toArray=function(e){return toBase(this,e)},NativeBigInt.prototype.toArray=function(e){return toBase(this,e)},BigInteger.prototype.toString=function(e,t){if(e===undefined&&(e=10),10!==e)return toBaseString(this,e,t);for(var r,n=this.value,i=n.length,o=String(n[--i]);--i>=0;)r=String(n[i]),o+="0000000".slice(r.length)+r;return(this.sign?"-":"")+o},SmallInteger.prototype.toString=function(e,t){return e===undefined&&(e=10),10!=e?toBaseString(this,e,t):String(this.value)},NativeBigInt.prototype.toString=SmallInteger.prototype.toString,NativeBigInt.prototype.toJSON=BigInteger.prototype.toJSON=SmallInteger.prototype.toJSON=function(){return this.toString()},BigInteger.prototype.valueOf=function(){return parseInt(this.toString(),10)},BigInteger.prototype.toJSNumber=BigInteger.prototype.valueOf,SmallInteger.prototype.valueOf=function(){return this.value},SmallInteger.prototype.toJSNumber=SmallInteger.prototype.valueOf,NativeBigInt.prototype.valueOf=NativeBigInt.prototype.toJSNumber=function(){return parseInt(this.toString(),10)};for(var i=0;i<1e3;i++)Integer[i]=parseValue(i),i>0&&(Integer[-i]=parseValue(-i));return Integer.one=Integer[1],Integer.zero=Integer[0],Integer.minusOne=Integer[-1],Integer.max=max,Integer.min=min,Integer.gcd=gcd,Integer.lcm=lcm,Integer.isInstance=function(e){return e instanceof BigInteger||e instanceof SmallInteger||e instanceof NativeBigInt},Integer.randBetween=randBetween,Integer.fromArray=function(e,t,r){return parseBaseFromArray(e.map(parseValue),parseValue(t||10),r)},Integer}();"undefined"!=typeof module&&module.hasOwnProperty("exports")&&(module.exports=bigInt),"function"==typeof define&&define.amd&&define("big-integer",[],function(){return bigInt});
>>>>>>> develop

},{}]},{},[1]);
